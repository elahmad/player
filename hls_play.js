//www.elahmad.com
var peer5=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){n(116),e.exports=n(122)},function(e,t){e.exports={core:{apis:{},apiValidators:{},dataStructures:{},data:{},controllers:{},media:{},protocol:{},transport:{},util:{},stats:{},workers:{},playlist:{}},client:{downloader:{}},state:{},players:{}}},function(e,t,n){"use strict";var r=n(29);e.exports={VERSION:"2.1",CHUNKY_HEAD_LENGTH:1e5,SMALL_FILE_SIZE:10485760,USE_HEAD:!1,IGNORE_LENGTH:!1,PLAYER_REQUEST_ALWAYS_HTTP:!1,MIMIC_REAL_HTTP_DOWNLOAD:!1,MIMIC_REAL_HTTP_INTERVAL:100,REMOVE_QUERYSTRING_FOR_HASH:!0,REMOVE_WOWZA_SESSION_ID_FOR_HASH:!0,REMOVE_SUBDOMAIN_FOR_HASH:!1,REPLACE_IP_TOKEN_FOR_HASH:!1,REPLACE_HOSTNAME_WITH_TOKEN_FOR_HASH:!1,HASH_ALLOWED_QUERY_PARAMETERS:[],REMOVE_REGEX_MATCH_FOR_HASH:null,REMOVE_PROTOCOL_FOR_HASH:!0,DISABLE_CHROME:!1,DISABLE_FIREFOX:!1,HTTP_ONLY:!1,PC_MOCK:!1,STUN_SERVERS:["stun.l.google.com:19302"],TURN_SERVERS:[],TURN_CREDENTIALS:[],MAX_CONNECTIONS:15,MIN_CONNECTIONS:10,SECONDS_BEFORE_IDLE:120,SECONDS_SINCE_LAST_HAVE:60,PC_FAIL_TIMEOUT:15e3,PC_RECON_METHOD:"none",PC_RECON_EXP_COEF:2,PC_RECON_DELAY:1e4,PC_RESEND_INTERVAL:1e3,PC_CREATE_INTERVAL:0,REQUEST_DROPPED_FAIL:20,SMALL_WINDOW_THRESHOLD:1,CLOSE_SMALL_WINDOW_CONNECTIONS:!1,CHUNK_SIZE:16e3,BLOCK_SIZE:12e5,MAX_PENDING_CHUNKS:100,PC_CHUNK_EXPIRATION_TIMEOUT:4e3,P2P_SEND_RETRIES:3,PC_POOL_SIZE:100,PC_POOL_INIT_INTERVAL:100,PC_POOL_LOW:10,PC_POOL_REGEN_INTERVAL:5e3,MAX_PC_CREATE:1e5,PC_CLOSE_TIMEOUT:5e3,PC_SDP_FLUSH_TIMEOUT:300,PC_SDP_FLUSH_LENGTH:4,PC_ALLOCATE_CHUNKS_EVENLY:!1,DC_UNORDERED:!0,DC_MAX_RETRANSMITS:void 0,DC_MAX_PACKET_LIFE_TIME:void 0,PEER_UPLINK_REPORT_INTERVAL:1e4,DELAY_REPORT_INTERVAL:1e4,PC_IDLE_FACTOR:.66,PC_LATENCY_INTERVAL:1e3,PC_LATENCY_ENABLED:!1,ALLOWED_FILE_SIZE:268697600,ALLOWED_FILE_SIZE_FF:10737418240,USE_FS:!0,USE_PERSISTENT:!0,DISABLE_FS_FF:!0,PROMPT_TIMEOUT:2e4,PERSISTENT_FS_SIZE:10737418240,TEMPORARY_FS_SIZE:32212254720,CACHE_SIZE:52428800,FS_ROOT_DIR:"peer5/",PREALLOCATE_FILE:!0,PERIODIC_CACHE_CLEANUP_PERIOD:6048e5,TIME_PERIOD_FILE_STILL_LIVE:72e5,SOCKET_RECONNECTION_INTERVAL:3e4,WS_ENABLED:!0,WS_URL:"",XHR_INITIAL_TIMEOUT:1e4,XHR_MAXIMUM_TIMEOUT:3e4,XHR_MINIMUM_TIMEOUT:2e3,XHR_TIMEOUT_FACTOR:2,XHR_ALLOW_RANGE:!1,XHR_MAX_GET:1,XHR_CONCURRENT:4,HTTP_IDLE_RESET_DURATION:3e4,XHR_SLOT_PROBE_INTERVAL:3e4,MONITOR_INTERVAL:200,REPORT_INTERVAL:2e4,REPORT_TTL_MS:3e5,STAT_CALC_INTERVAL:500,DISABLE_GOOGLE_ANALYTICS:!1,DISABLE_GOOGLE_EVENTS:!0,GOOGLE_SAMPLING_RATIO:20,SEQUENTIAL_DOWNLOAD:!1,INITIAL_DL_SECS_ESTIMATION:0,PARALLEL_HTTP_AND_P2P:!0,SYNCED_BUFFERS:!0,HIGH_BUFFER_HTTP_CONSTRAINT:1e4,EXTERNAL_MINIMUM_HTTP_CONSTRAINT:1e4,EXTERNAL_MAXIMUM_HTTP_CONSTRAINT:1e4,BLOCK_ALLOCATION_INTERVAL:100,HTTP_FETCH_AHEAD:!1,FETCH_AHEAD_MIN_SEEDERS:1,P2P_DOWNLOADING_MSG:!0,HTTP_INIT_AHEAD:!1,HTTP_INIT_AHEAD_MIN_SEEDERS:1,PEER_LIVE_DETECTION:!1,EARLY_LIVE_DETECTION:!1,EARLY_LIVE_DETECTION_INTERVAL:1e3,LIVE_DETECTION_WINDOW:10,MERGE_REQUESTS:!1,P2P_VOD_WINDOW:10,HTTP_VOD_WINDOW:5,MAX_P2P_REQUESTS:2,MAX_HTTP_REQUESTS:0,DYNAMIC_PREFETCH:!1,PREFETCH_AFTER_MAXBUFFER:!1,MAX_REQUEST_CACHE_SIZE_VOD:314572800,MAX_REQUEST_CACHE_SIZE_LIVE:104857600,SKIP_JOIN_MIN_TIME:0,SKIP_JOIN_INITIAL_CONSTRAINT:!1,SKIP_JOIN_INITIAL_SEGMENTS:!1,EXTERNAL_MEDIA_FALLBACK_ON_FLASH:!1,EXTERNAL_MEDIA_LOWBUFFER:.1,EXTERNAL_MEDIA_MINBUFFER:-1,EXTERNAL_MEDIA_MINBUFFER_LENGTH_CAPPING:-1,EXTERNAL_MEDIA_MAXBUFFER:120,EXTERNAL_MEDIA_LIVE_START_POS:-1,EXTERNAL_MEDIA_MAXBUFFER_SIZE:6e7,EXTERNAL_MEDIA_MANIFEST_TIMEOUT:1e4,EXTERNAL_MEDIA_MANIFEST_RETRIES:6,EXTERNAL_MEDIA_MANIFEST_RETRY_DELAY:500,EXTERNAL_MEDIA_FRAGMENT_TIMEOUT:12e4,EXTERNAL_MEDIA_FRAGMENT_RETRIES:6,EXTERNAL_MEDIA_FRAGMENT_RETRY_DELAY:500,EXTERNAL_MEDIA_FPS_MONITOR_PERIOD:5e3,EXTERNAL_MEDIA_FPS_MONITOR_THRESHOLD:.2,EXTERNAL_MEDIA_HLSJS_ENABLE:!0,EXTERNAL_MEDIA_HLSJS_DEBUG:!1,EXTERNAL_MEDIA_HLSJS_OVERRIDE:!0,EXTERNAL_MEDIA_MAX_BUFFER_HOLE:.5,EXTERNAL_VIDEOTAG_MONITORING:!0,EXTERNAL_MEDIA_WATERMARK:!1,EXTERNAL_DISABLE_UNSUPPORTED:!0,EXTERNAL_DISABLE_DVR:!1,EXTERNAL_DISABLE_PLUGINS:!1,VIDEOTAG_FIND_INTERVAL:500,INTERNAL_VIDEOTAG_MONITORING:!1,DISABLE_ABR_CONFIGURE:!1,AGGRESSIVE_P2P:!1,REQUEST_TIMEOUT:!0,P2P_TIMEOUT_DURATION:1e4,HTTP_TIMEOUT_DURATION:1e5,PLAYLIST_TIMEOUT:!0,PLAYLIST_TIMEOUT_DURATION:1e4,INITIAL_P2P_SLOTS:2,MINIMUM_P2P_SLOTS:1,ADD_SLOT_LOADED_REQUESTS_THRESHOLD:3,REDUCE_SLOT_ABORTS_THRESHOLD:2,TIME_ESTIMATION_LIST_LENGTH:5,ZIXI_DIGEST:!1,MINIMUM_METADATA_SIZE:1e6,VIDEO_DOWNLOAD_SIZE:3e5,BUFFERING_THRESHOLD:.1,URGENT_THRESHOLD:2,BYTE_NEEDED_THRESHOLD:10,ENOUGH_BYTES_THRESHOLD:20,STOP_BUFFERING_THRESHOLD:2,BLOCK_GAP:17,BANDWIDTH_INTERVAL:1e4,LIVE_SECONDS_DELAY:r.randomOffset(10,35,5),MIN_NUMBER_OF_REMAINING_SEGMENTS:3,SEGMENTS_AFTER_PRUNE:3,FEATURE_PRUNE_SEGMENTS_FROM_START:!0,FEATURE_DATACHANNEL_KEY:"DATACHANNEL",FEATURE_DATACHANNEL_ENABLED:!0,FEATURE_PAGE_WHITELIST_KEY:"PAGE_WHITELIST",FEATURE_PAGE_WHITELIST_ENABLED:!1,FEATURE_PAGE_WHITELIST_REGEX:/peer5/,FEATURE_PAGE_BLACKLIST_KEY:"PAGE_BLACKLIST",FEATURE_PAGE_BLACKLIST_ENABLED:!1,FEATURE_PAGE_BLACKLIST_REGEX:/peer5/,FEATURE_XHR_KEY:"XHR",FEATURE_XHR_ENABLED:!0,FEATURE_PEER5_KEY:"PEER5",FEATURE_PEER5_ENABLED:!0,FEATURE_P2P_IMPROVEMENT_ENABLED:!1,FEATURE_LIMIT_SLOTS_BY_PEERS:!1,FEATURE_CLOSE_DEAD_CONNECTIONS:!0,FEATURE_CLOSE_DEAD_CONNECTIONS_PERMANENTLY:!1,FEATURE_CLOSE_OVERLAPPING_CONNECTIONS:!0,FEATURE_CLOSE_OVERLAPPING_CONNECTIONS_PERMANENTLY:!1,FEATURE_PRE_PLAY_PREFETCH:!0,SEGMENTS_TO_PREFETCH_BEFORE_PLAY:10,STOP_PREFETCH_AFTER_SECONDS:60,PLAYER_SEGMENTS_BUFFER:3,PREFETCH_LIVE_INTERVAL_MS:2e3,MAX_REBUFFER_DURATION:18e4,FEATURE_DOWNLOAD_SPEED_ESTIMATION:!1,RELEVANT_LAST_ENTRIES:5,SIMPLE_SPEED_ESTIMATOR:!1,SPEED_SMOOTH_FACTOR:.1,SPEED_FACTOR:1,URL_ALLOWED_QUERY_PARAMETERS:[],FEATURE_WS_HEARTBEAT:!1,FEATURE_WS_HEARTBEAT_INTERVAL:5e3,FEATURE_WS_HEARTBEAT_ELAPSED:6e4,LOG_LEVEL:0,TRACK_REPORT_LEVEL:1,TRACK_PLAYER_EVENTS_MAX:16,GA_ONERROR:!0,SENTRY_APP_URL:"https://a9e5ea6c873c451cbc2da95cbdb1e74e@app.getsentry.com/78409",SENTRY_THROTTLE_FACTOR:.05,EXTERNAL_XHR_FALLBACK:Math.random()<.01,AB_TEST_TOGETHER:!1,LEECH:!1,BUFFER_LENGTH_LEECH_LOW_SEC:0,LEECH_ON_METERED:!0,A_B_TEST:{},A_B_INITIAL_JSON:null,A_B_CONFIG_JSON:null,DYNAMIC_CONFIG:!1,STATS_RECENT_QUERY_AGE:15e3,STATS_RECENT_MAX_AGE:12e4,STATS_ENABLE_OVERLAY:!1,EXTERNAL_JW_MUX_PLUGIN:!1}},function(e,t,n){(function(t){"use strict";function r(e,t,n){n&&console[e]("[peer5] > EXCEPTION:",n);var r=t;"string"!=typeof t&&(r=JSON.stringify(t)),console[e]("[peer5] > "+r)}function i(e){var t=e;return"string"==typeof e&&(t={message:e}),t.lastPlayerEvents=d,t}function a(e,t,n){n&&!n.stack&&c.warn("Invalid logging!"),l[u[e]]++;var a=o.LOG_LEVEL;if(!(e>o.TRACK_REPORT_LEVEL&&e>a))switch(e){case 1:o.TRACK_REPORT_LEVEL>=1&&s.trackError(n,i(t)),a>=1&&r("error",t,n);break;case 2:o.TRACK_REPORT_LEVEL>=2&&s.trackWarning(n,i(t)),a>=2&&r("warn",t,n);break;case 3:a>=3&&r("info",t,n);break;default:throw new Error("internal")}}var o=n(2),s=n(42),u=["none","error","warn","info"],c={},l={error:0,warn:0,info:0},d=[];c.setLogLevel=function(e){o.LOG_LEVEL=e},c.logPlayerEvent=function(e){for(;d.length>=o.TRACK_PLAYER_EVENTS_MAX;)d.shift();d.push([Date.now(),e])},c.info=function(e){a(3,e)},c.warn=function(e,t){a(2,e,t)},c.error=function(e,n){var r,i=typeof e;if(a(1,e,n),o.GA_ONERROR){if("object"===i)r=JSON.stringify(e);else{if("string"!==i)return void t.warn("couldnt send error event of type "+i);r=e}n&&(r+=": "+n),radio("peer5error").broadcast(r)}},c.getMetrics=function(){return l},["setLogLevel","info","warn","error"].forEach(function(e){t[e]=c[e]}),e.exports=c}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(){function e(e){k[e]={},y.forEach(function(t){k[e][t]=0});for(var n in R)k[e][n]=0;M[e]=new t.core.stats.StatsCalculator(e)}function n(){return D}function r(e){var t=e||"*",r={};for(var i in k[t])r[i]=k[t][i];for(var i in w)r[i]=w[i];return r.numOfPeers=n(),r}function a(e){return s.getPredictedSpeed(e)||O||C||s.getSpeed(e)||0}function c(){for(var e in M)M[e].calcAvg(k[e])}function l(e,t){k[e]&&(Object.keys(t).forEach(function(n){k[e][n]=(k[e][n]||0)+t[n]}),N.sum(t))}function d(e){N.sum(e)}function h(e){N.max(e)}function f(e){N.average(e)}function p(e){N.sumRecent(e)}function g(e){N.averageRecent(e)}function v(e){return N.getStats(e)}function m(e){var n=s.getPredictedSpeed(e),r=s.getSpeed(e);r>0?(C=r,t.info("last http speed for "+e+" updated to: "+r)):t.info("last http speed value is invalid: "+r),n>0?(O=n,t.info("last http predicted speed for "+e+" updated to: "+n)):t.info("last http predicted speed value is invalid: "+n)}function _(e,t){delete M[e],delete k[e],delete M[t],delete k[t],s.removeResource(e)}function E(e){u(I,e)}function b(){return u({},I)}function S(){radio("report:full").subscribe([function(t,n){k[t]||e(t);for(var r in R){var i=R[r];k["*"][r]+=n[i],k[t][r]+=n[i]}}]),radio("report:p2pWaste").subscribe([function(t,n){k[t]||e(t);var r="totalP2PWaste";k["*"][r]+=n,k[t][r]+=n}]),radio("httpDownloaded").subscribe([function(t,n){k[t]||e(t),k["*"].totalHttpDownloaded+=n,k[t].totalHttpDownloaded+=n,k[t].totalHttpProgress+=n}]),radio("chunkSent").subscribe([function(t,n){k[t]||e(t),k["*"].totalP2PUploaded+=n,k[t].totalP2PUploaded+=n,p({recentP2PUploaded:n})}]),radio("blockReceived").subscribe([function(t,n){k[t]||e(t);var r="totalVerifiedBytes";k["*"][r]+=n,k[t][r]+=n}]),radio("blockVerifiedP2P").subscribe([function(t){k[t]||e(t),k[t].totalP2PProgress=0}]),radio("blockVerifiedHTTP").subscribe([function(t){k[t]||e(t);var n=k[t].totalP2PProgress;k[t].totalP2PWaste+=n,k[t].totalP2PProgress=0}]),radio("resourceAdded").subscribe([function(n){k[n]||e(n),k[n].totalHttpProgress=0,k[n].start=performance.now(),k[n].startLoaded=k[n].totalVerifiedBytes;var r=Math.round(1e3*t.core.apis.MediaFetcher.mediaController.getBufferLength());k[n].startBufferHealth=r}]),radio("resourceLoadEnd").subscribe([function(e){k[e].end=performance.now(),m(e)}]),radio("external.player").subscribe([function(e){L.processEvent(e.action),P.indexOf(e.action)!==-1&&E({lastPlayerEvent:e.action,sinceLastPlayerEvent:Date.now()}),void 0!==w[e.action]&&"number"==typeof e.duration?w[e.action].push(e.duration):"fps.drop"===e.action&&(A.push(e.value),e.value&&N.sum({totalFPSDrop:e.value}))}]),radio("player.attach").subscribe([function(e){Object.keys(w).forEach(function(t){e.on(t,function(e){w[t].push(e.duration)})}),P.forEach(function(t){e.on(t,function(){L.processEvent(t),E({lastPlayerEvent:t,sinceLastPlayerEvent:Date.now()})})}),e.on("fps.drop",function(e){A.push(e.value)}),e.on("fps.drop.raw",function(e){N.sum({totalFPSDrop:e.value||0})}),e.on("bitsDecoded",function(e){if(e.value){N.sum({totalBitsDecoded:e.value});var t=L.getTotalDurations();E({avgBitrate:1e3*Math.round(N.getStats().totalBitsDecoded/t.play)||0})}}),e.on("media.info",function(e){E(e)})}]),radio("fileInfoProcessed").subscribe([function(t){t.swarmId&&t.url&&(k[t.swarmId]&&!k[t.url]?(k[t.url]=k[t.swarmId],M[t.url]=M[t.swarmId]):k[t.url]&&!k[t.swarmId]?(k[t.swarmId]=k[t.url],M[t.swarmId]=M[t.url]):k[t.swarmId]||k[t.url]||(e(t.swarmId),k[t.url]=k[t.swarmId],M[t.url]=M[t.swarmId]),M[t.swarmId].url=t.url,M[t.swarmId].size=t.size)}]),radio("activePeerConnectionsNumberChanged").subscribe([function(e){D=e}])}function T(){return r()}var y=["totalP2PDownloaded","totalP2PUploaded","totalP2PWaste","totalHttpDownloaded","totalHttpWaste","totalFSLoaded","totalVerifiedBytes","totalP2PProgress","totalHttpProgress"],R={totalP2PDownloaded:"p2pDown",totalP2PWaste:"p2pWaste",totalHttpWaste:"httpWaste",totalFSLoaded:"fsLoad"},w={"load.end":[],"seek.end":[],"rebuffer.end":[]},P=["ready","load.start","load.end","pause.start","pause.end","rebuffer.start","rebuffer.end","seek.start","seek.end"],I={},A=[],C=0,O=0,k={},D=0,M={},N=i(),L=o();return e("*"),S(),{getStats:r,getNumOfPeers:n,getSpeed:a,calcAvg:c,sum:l,sumGlobal:d,maxGlobal:h,avgGlobal:f,sumRecentGlobal:p,averageRecentGlobal:g,getGlobalStats:v,removeResource:_,publicGetStats:T,getTotalDurations:L.getTotalDurations,statsCalculators:M,setMediaInfo:E,getMediaInfo:b}}n(27);var i=n(138),a=n(2),o=n(135),s=n(a.SIMPLE_SPEED_ESTIMATOR?76:26),u=n(15),c=r();e.exports=c,t.core.stats.StatsCollector=e.exports}).call(t,n(1))},function(e,t){"use strict";function n(e,n,r){this.tag=t.P2P_DATA,this.swarmId=e,this.chunkId=n,this.payload=r}function r(e,n){this.tag=t.P2P_REQUEST,this.swarmId=e,this.chunkIds=n}function i(e,n,r,i,a){this.tag=t.P2P_HAVE,this.swarmId=e,this.hashUrl=i||"0123456789abcdefghijklmnopqrstuv",this.seeder=n,this.filesize=a,this.blockIds=[],n||(this.complete=!0,this.availabilityMap=r)}function a(e,n){this.tag=t.P2P_DONT_HAVE,this.swarmId=e,this.hashUrl=n||"0123456789abcdefghijklmnopqrstuv"}function o(e,n){this.tag=t.P2P_VERSION,this.client=e,this.conf=n}function s(e,n){this.tag=t.P2P_LATENCY_REQUEST,this.timestamp=e,this.originBufferedAmount=n}function u(e,n,r){this.tag=t.P2P_LATENCY_RESPONSE,this.timestamp=e,this.originBufferedAmount=n,this.remoteBufferedAmount=r}function c(e,n){this.tag=t.P2P_DOWNLOADING,this.swarmId=e,this.hashUrl=n}function l(e){this.tag=t.P2P_NEW_SEGMENT,this.segSeq=e}function d(e){this.tag=t.P2P_INITIALIZING,this.hashUrl=e}function h(e,n,r,i,a,o){this.tag=t.FILE_INFO,this.swarmId=e,this.size=n,this.hash=r,this.hashes=i,this.blockSize=a,this.url=o}function f(e,n){this.tag=t.JOIN,this.swarmId=e,this.matchMe=n}function p(e){this.tag=t.LEAVE,this.swarmId=e}function g(e){this.tag=t.GROUP_REPORT,this.body=e}function v(){this.tag=t.HEARTBEAT}function m(e,n,r,i,a,o){this.tag=t.SHARE,this.swarmId=e,this.size=n,this.hash=r,this.hashes=i,this.blockSize=a,this.url=o}function _(e){this.tag=t.LEECH,this.swarmId=e}function E(e,n,r){this.tag=t.GROUP_SDP,this.originId=e,this.destId=n,this.sdp=r}function b(e){this.tag=t.AB_CONFIG,this.conf=e}function S(e){this.tag=t.SESSION_REPORT,this.body=e}t.SWARM_NOT_FOUND=0,t.P2P_DATA=17,t.P2P_REQUEST=18,t.P2P_HAVE=20,t.P2P_DONT_HAVE=22,t.P2P_VERSION=23,t.P2P_LATENCY_REQUEST=24,t.P2P_LATENCY_RESPONSE=25,t.P2P_DOWNLOADING=26,t.P2P_NEW_SEGMENT=27,t.P2P_INITIALIZING=28,t.FILE_INFO=34,t.JOIN=36,t.LEAVE=37,t.CLOSE=38,t.SWARM_ERROR=48,t.GROUP_REPORT=51,t.GROUP_MATCH=52,t.HEARTBEAT=57,t.SHARE=59,t.LEECH=60,t.GROUP_SDP=61,t.AB_CONFIG=62,t.SESSION_REPORT=63,t.INFO_UPDATE_FROM_SERVER=64,t.DataMessage=n,t.RequestMessage=r,t.HaveMessage=i,t.DontHaveMessage=a,t.VersionMessage=o,t.LatencyRequestMessage=s,t.LatencyResponseMessage=u,t.DownloadingMessage=c,t.NewSegmentMessage=l,t.InitializingMessage=d,t.FileInfoMessage=h,t.JoinMessage=f,t.LeaveMessage=p,t.GroupReportMessage=g,t.HeartbeatMessage=v,t.ShareMessage=m,t.LeechMessage=_,t.GroupSdpMessage=E,t.ABConfigMessage=b,t.SessionReport=S},function(e,t,n){"use strict";function r(){function e(e){for(var t=e;l[t];)t=l[t];return t}function t(e){for(var t=e;l[t];){var n=l[t];delete l[t],t=n}}function n(t){var n=e(t);return!!c[n]}function r(e,t){n(e)&&i.warn("overriding blockmap with key "+e),c[e]=t}function a(t){var n=e(t);return c[n]}function o(e,t){return n(e)?void i.warn("trying to alias an already existing key"):void(l[e]=t)}function s(n){var r=e(n),i=c[r];i&&i.dtor(),delete c[r],t(n)}function u(e){Object.keys(c).forEach(function(t){e(t,c[t])})}var c=Object.create(null),l=Object.create(null);return{add:r,get:a,alias:o,has:n,remove:s,forEach:u}}var i=n(3);r.singleton=r(),e.exports=r},function(e,t){"use strict";e.exports=window.XMLHttpRequest},function(e,t,n){(function(e){function r(e,t){t=t||[];var n=e.split("&"),r=n.filter(function(e){var n=e.split("=")[0];return t.indexOf(n)>-1});return r.join("&")}function i(e){return e.replace(d,s.TOKEN)}function a(e){return e.replace(l,s.TOKEN)}function o(e){return e.replace(h,"")}var s=n(2),u=n(145),c=n(10),l=/^https?:\/\/(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])*/,d=/^https?:\/\/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])/,h=/^https?:\/\//;t.zixi=function(e){var t,n=e.indexOf("hlsid=HLS_"),r=e.indexOf("interstream");if(n!==-1&&r!==-1){e=e.replace(":80/","/");var i=e.split("?"),a=i[0]+"?",o=i[1].split("&"),s=o[0].indexOf("interstream"),u=o[0].substring(0,s+13)+"1&",c=o[1]+"&",l=o[2].indexOf("hlsid=HLS"),d=o[2].substring(0,l)+"hlsid=HLS_1";t=[a,u,c,d].join("")}else t=e;return t},t.urlWithAllowedKeys=function(e,t){var n=e.indexOf("?");if(n!==-1){var i=e.substring(0,n),a=e.substring(n+1),o=r(a,t);return o?i+"?"+o:i}return e},t.swarmId=function(n){var r=n;return s.REMOVE_QUERYSTRING_FOR_HASH===!0&&(r=t.urlWithAllowedKeys(r,s.HASH_ALLOWED_QUERY_PARAMETERS)),s.REMOVE_WOWZA_SESSION_ID_FOR_HASH===!0&&(r=u.wowza(r)),s.REPLACE_HOSTNAME_WITH_TOKEN_FOR_HASH===!0?r=a(r):s.REPLACE_IP_TOKEN_FOR_HASH===!0?r=i(r):s.REMOVE_SUBDOMAIN_FOR_HASH===!0?r=e.core.util.removeSubDomain(r):s.REMOVE_PROTOCOL_FOR_HASH===!0&&(r=o(r)),s.REMOVE_REGEX_MATCH_FOR_HASH&&(r=r.replace(s.REMOVE_REGEX_MATCH_FOR_HASH,"")),r};var f=Object.create(null);t.getNormalizedUrlHash=function(e){var n=f[e];if(n)return n;var r=t.swarmId(e);return n=c.hash(r),f[e]=n,n}}).call(t,n(1))},function(e,t,n){"use strict";var r=n(8),i=n(10);e.exports=function(e){var t=r.swarmId(e);return i.hash(t)}},function(e,t,n){!function(t){e.exports=t()}(function(e){"use strict";function t(e,t){var n=e[0],r=e[1],i=e[2],a=e[3];n+=(r&i|~r&a)+t[0]-680876936|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[1]-389564586|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[2]+606105819|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[3]-1044525330|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&a)+t[4]-176418897|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[5]+1200080426|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[6]-1473231341|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[7]-45705983|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&a)+t[8]+1770035416|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[9]-1958414417|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[10]-42063|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[11]-1990404162|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&a)+t[12]+1804603682|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[13]-40341101|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[14]-1502002290|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[15]+1236535329|0,r=(r<<22|r>>>10)+i|0,n+=(r&a|i&~a)+t[1]-165796510|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[6]-1069501632|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[11]+643717713|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[0]-373897302|0,r=(r<<20|r>>>12)+i|0,n+=(r&a|i&~a)+t[5]-701558691|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[10]+38016083|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[15]-660478335|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[4]-405537848|0,r=(r<<20|r>>>12)+i|0,n+=(r&a|i&~a)+t[9]+568446438|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[14]-1019803690|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[3]-187363961|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[8]+1163531501|0,r=(r<<20|r>>>12)+i|0,n+=(r&a|i&~a)+t[13]-1444681467|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[2]-51403784|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[7]+1735328473|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[12]-1926607734|0,r=(r<<20|r>>>12)+i|0,n+=(r^i^a)+t[5]-378558|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[8]-2022574463|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[11]+1839030562|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[14]-35309556|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^a)+t[1]-1530992060|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[4]+1272893353|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[7]-155497632|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[10]-1094730640|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^a)+t[13]+681279174|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[0]-358537222|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[3]-722521979|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[6]+76029189|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^a)+t[9]-640364487|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[12]-421815835|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[15]+530742520|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[2]-995338651|0,r=(r<<23|r>>>9)+i|0,n+=(i^(r|~a))+t[0]-198630844|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[7]+1126891415|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[14]-1416354905|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[5]-57434055|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~a))+t[12]+1700485571|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[3]-1894986606|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[10]-1051523|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[1]-2054922799|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~a))+t[8]+1873313359|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[15]-30611744|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[6]-1560198380|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[13]+1309151649|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~a))+t[4]-145523070|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[11]-1120210379|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[2]+718787259|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[9]-343485551|0,r=(r<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=a+e[3]|0}function n(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function i(e){var r,i,a,o,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(l,n(e.substring(r-64,r)));for(e=e.substring(r-64),i=e.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)a[r>>2]|=e.charCodeAt(r)<<(r%4<<3);if(a[r>>2]|=128<<(r%4<<3),r>55)for(t(l,a),r=0;r<16;r+=1)a[r]=0;return o=8*c,o=o.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(o[2],16),u=parseInt(o[1],16)||0,a[14]=s,a[15]=u,t(l,a),l}function a(e){var n,i,a,o,s,u,c=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(l,r(e.subarray(n-64,n)));for(e=n-64<c?e.subarray(n-64):new Uint8Array(0),i=e.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)a[n>>2]|=e[n]<<(n%4<<3);if(a[n>>2]|=128<<(n%4<<3),n>55)for(t(l,a),n=0;n<16;n+=1)a[n]=0;return o=8*c,o=o.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(o[2],16),u=parseInt(o[1],16)||0,a[14]=s,a[15]=u,t(l,a),l}function o(e){var t,n="";for(t=0;t<4;t+=1)n+=g[e>>8*t+4&15]+g[e>>8*t&15];return n}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=o(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var n,r=e.length,i=new ArrayBuffer(r),a=new Uint8Array(i);for(n=0;n<r;n+=1)a[n]=e.charCodeAt(n);return t?a:i}function l(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function d(e,t,n){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),n?r:r.buffer}function h(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function f(){this.reset()}var p=function(e,t){return e+t&4294967295},g=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&(p=function(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function t(e,t){return e=0|e||0,e<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,r){var i,a,o,s,u=this.byteLength,c=t(n,u),l=u;return r!==e&&(l=t(r,u)),c>l?new ArrayBuffer(0):(i=l-c,a=new ArrayBuffer(i),o=new Uint8Array(a),s=new Uint8Array(this,c,i),o.set(s),a)}}(),f.prototype.append=function(e){return this.appendBinary(u(e)),this},f.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var r,i=this._buff.length;for(r=64;r<=i;r+=64)t(this._hash,n(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},f.prototype.end=function(e){var t,n,r=this._buff,i=r.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(a,i),n=s(this._hash),e&&(n=h(n)),this.reset(),n},f.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},f.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},f.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},f.prototype._finish=function(e,n){var r,i,a,o=n;if(e[o>>2]|=128<<(o%4<<3),o>55)for(t(this._hash,e),o=0;o<16;o+=1)e[o]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),a=parseInt(r[1],16)||0,e[14]=i,e[15]=a,t(this._hash,e)},f.hash=function(e,t){return f.hashBinary(u(e),t)},f.hashBinary=function(e,t){var n=i(e),r=s(n);return t?h(r):r},f.ArrayBuffer=function(){this.reset()},f.ArrayBuffer.prototype.append=function(e){var n,i=d(this._buff.buffer,e,!0),a=i.length;for(this._length+=e.byteLength,n=64;n<=a;n+=64)t(this._hash,r(i.subarray(n-64,n)));return this._buff=n-64<a?new Uint8Array(i.buffer.slice(n-64)):new Uint8Array(0),this},f.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)a[t>>2]|=r[t]<<(t%4<<3);return this._finish(a,i),n=s(this._hash),e&&(n=h(n)),this.reset(),n},f.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},f.ArrayBuffer.prototype.getState=function(){var e=f.prototype.getState.call(this);return e.buff=l(e.buff),e},f.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),f.prototype.setState.call(this,e)},f.ArrayBuffer.prototype.destroy=f.prototype.destroy,f.ArrayBuffer.prototype._finish=f.prototype._finish,f.ArrayBuffer.hash=function(e,t){var n=a(new Uint8Array(e)),r=s(n);return t?h(r):r},f})},function(e,t,n){(function(t){n(28);var r=n(13),i=n(19),a=n(4),o=n(20),s=n(7),u=n(144),c=n(2),l=n(32),d=n(133),h=n(134)(),f=(n(8),"أ¯آ»آ؟"),p=r.HYBRID,g=r.P2P,v=r.HTTP,m=r.DYNAMIC,_=Object.subClass({ctor:function(e){this.readyState=0,this.response,this.responseText=null,this._responseHeaders="server: peer5",this.responseType="",this.timeout="unimplemented",this.status,this._range,this._url,this._method,this._data,this.withCredentials=!1,this._swarmState={uploaded:0},this.fileInfo,this._meta={},e=this.sanitizeCtorArgs(e),this.downloadMode=e.downloadMode,this.md5=e.md5,this.sha1=e.sha1,this.origin=e.origin,this._responseHeadersMap=Object.create(null),this._startLoaded,this._startTime,this._speed,this._constraint,this.onloadstart,this.onprogress,this.onabort,this.onerror,this.onload,this.ontimeout="unimplemented",this.onloadend,this.onreadystatechange,this.onswarmstatechange,this.eventListeners=Object.create(null),this.eventListeners.loadstart=[],this.eventListeners.progress=[],this.eventListeners.abort=[],this.eventListeners.error=[],this.eventListeners.load=[],this.eventListeners.timeout=[],this.eventListeners.loadend=[],this.eventListeners.readystatechange=[],this.eventListeners.swarmstatechange=[],this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4},open:function(e,t){if(t=u.normalizeUrl(t),this._method=e&&e.toUpperCase(),!this._method)return!1;if("GET"===this._method&&t)this._url=t;else if(this.isCatchAllRequest)this._url=t;else{if("POST"!==this._method)return this._url=t,!1;this._url="peer5://"+i()}return this.changeReadyState(1),this.isMethodSupported(this._method)?void 0:this.fallbackToNative()},setResponseHeaders:function(e){for(var t=e.split("\n"),n=0;n<t.length;n++){var r=t[n].split(":"),i=r.shift().trim(),a=r.join(":").trim();this._responseHeadersMap[i]=a}},forceImmediateLoad:function(e){t.client.bypassServer(this,e)},setRequestHeader:function(e,t){},send:function(e){if(this._data=e,radio("requestSent").broadcast(this),!t.clientInstance.isValidated()){var n=this;return void t.getCompatibilityStatus(function(e){n.handleRequestError(e[0])})}e||"GET"!==this._method||1!=this.readyState||(this._meta={sha1:this.sha1,md5:this.md5,origin:this.origin,constraint:this._constraint,httpConstraint:this._httpConstraint,skipJoin:this.skipJoin},this._startLoaded=t.core.stats.StatsCollector.getStats(this._url).totalVerifiedBytes||0,this._startTime=Date.now(),h.addRequest(this)),e&&"POST"===this._method&&1==this.readyState&&e instanceof Blob&&this.changeReadyState(2)&&h.addRequest(this)},getResponseHeader:function(e){if(this.readyState<2)throw"Response headers are available only when readystate >=2";var n=this._responseHeadersMap[e];return n?n:(t.warn('Refused to get unsafe header "'+e+'"'),null)},getAllResponseHeaders:function(){return this._responseHeaders},getFileInfo:function(){if(this.readyState>=2)return this.fileInfo},abort:function(e){this.readyState>=1&&this.readyState<3&&t.warn("peer5.Request::abort: aborting a request with readyState < 3: "+this.readyState+" "+this._url),t.info("peer5.Request::abort "+this.readyState+" "+this._url);var n=this.createProgressEvent();e&&e.leaveSwarm?t.clientInstance.removeResource(this._url):t.clientInstance.stopResource(this._url),this.changeReadyState(4,!0)&&(this._triggerEvent("progress",n),this._triggerEvent("abort",n),this._triggerEvent("loadend",n),h.removeRequest(this))},addEventListener:function(e,t){this.eventListeners[e]&&this.eventListeners[e].push(t)},removeEventListener:function(e,t){if(this.eventListeners[e]){var n=this.eventListeners[e].indexOf(t);n!==-1&&this.eventListeners[e].splice(n,1)}},HTTPHeadersReceivedEvent:function(e,t,n){this._responseHeaders=t,this._responseHeadersMap=n},fileInfoProcessedEvent:function(e){"GET"===this._method&&(this.fileInfo=e,this.changeReadyState(2))},resourceReadyEvent:function(e){var n=this,r=e.swarmId;if("GET"===this._method){if(!this.changeReadyState(3))return;if(3!=this.readyState)return;var i=this.createProgressEvent();this._triggerEvent("loadstart",i),t.clientInstance.isFull(r,function(i){t.info("Resource "+r+" is ready and full="+i),i?c.MIMIC_REAL_HTTP_DOWNLOAD?d(n,e.swarmId,n._getDownloadSpeed(),e.size,function(e){3===n.readyState&&n._triggerEvent("progress",e)},function(){3===n.readyState&&n.handleTransferLoaded(e)}):n.handleTransferLoaded(e):t.config.SYNCED_BUFFERS?radio("needByteRangeEvent").broadcast(n._url,void 0,void 0,n._constraint):radio("needByteRangeEvent").broadcast(n._url)})}else if("POST"===this._method){if(this.fileInfo=e,e.url="peer5://"+e.swarmId,3!==this.readyState)return;this._getUrlAndTriggerOnLoad(e)}},blockReceivedEvent:function(){var e=this.createProgressEvent();this._triggerEvent("progress",e)},httpProgressEvent:function(){var e=this.createProgressEvent();this._triggerEvent("progress",e)},transferLoadedEvent:function(e){this.handleTransferLoaded(e)},requestErrorEvent:function(e,t){this.handleRequestError(e,t)},activePeerConnectionsNumberChangedEvent:function(e){this._swarmState.numOfPeers=e;var t=this.createSwarmStateEvent();this._triggerEvent("swarmstatechange",t)},chunkSentEvent:function(e,n){var r=this;t.clientInstance.getUploadedStats(e,function(e){for(var i in e)"numOfPeers"===i&&0===e[i]&&t.error("chunkSentEvent: sent p2p while connected to 0 peers"),r._swarmState[i]=e[i];var a=r.createSwarmStateEvent();a.sent=n,r._triggerEvent("swarmstatechange",a)})},sanitizeCtorArgs:function(e){switch(e||(e=Object.create(null)),e.downloadMode){case"p2p":e.downloadMode=g;break;case"http":e.downloadMode=v;break;case"dynamic":e.downloadMode=m;break;default:e.downloadMode=p}if(e.md5){if("[object String]"!=Object.prototype.toString.call(e.md5))return t.error("options.sha1 contains invalid characters"),!1}else e.md5=null;if(e.sha1){if("[object String]"!=Object.prototype.toString.call(e.sha1))return t.error("options.sha1 contains invalid characters"),!1}else e.sha1=null;return e},createProgressEvent:function(){var e=l(this);e.verified=t.clientInstance.getNumOfVerifiedBytes(this._url),e.loaded=0,e.lengthComputable=!1;var n=t.clientInstance.getLoadedStats(this._url);for(var r in n)e[r]=n[r],e.loaded+=e[r];return this.fileInfo&&(e.lengthComputable=!0,e.total=this.fileInfo.size),e},createSwarmStateEvent:function(){var e=l(this);for(var t in this._swarmState)e[t]=this._swarmState[t];return e},createEvent:function(){var e={};
return e.currentTarget=this,e.target=this,e},changeReadyState:function(e,n){if(n||this.readyState==e-1){if(4===e&&4===this.readyState)return t.info("request has already finished (readystate=4)"),!1;if(this.readyState=e,3==this.readyState&&(this.queuedCommand&&t.core.util.executeFunctionByName(this.queuedCommand[0],this,[this.queuedCommand[1]]),"GET"===this._method),this.fileInfo){var r=this.createProgressEvent();this._triggerEvent("readystatechange",r)}else{var i=l(this);this._triggerEvent("readystatechange",i)}return!0}return t.info("ready state has jumped a stage"),!1},handleTransferLoaded:function(e){"GET"===this._method?3===this.readyState&&this._getUrlAndTriggerOnLoad(e):"POST"===this._method&&(this.changeReadyState(3),this.fileInfo=e)},handleRequestError:function(e,t){if(this.status=e,this.description=t,h.removeRequest(this),this.changeReadyState(4,!0)){var n=this.createProgressEvent();this._triggerEvent("progress",n),this._triggerEvent("error",n),this._triggerEvent("loadend",n)}},_getDownloadSpeed:function(){return t.core.stats.StatsCollector.getSpeed(this._url)},_complete:function(e){if(this.response=e,this.changeReadyState(4)){var t=this.createProgressEvent();this._triggerEvent("progress",t),this._triggerEvent("load",t),this._triggerEvent("loadend",t),h.removeRequest(this)}},_getUrlAndTriggerOnLoad:function(e){var n=this;this.status=200,t.info("onload "+this._url+" responseType: "+this.responseType+" speed: "+this._speed),t.core.util.asyncDefer(function(){switch(this.responseType){case"arraybuffer":t.clientInstance.getUint8Array(e.swarmId,function(e,r){e?n._complete(r.buffer):t.error("couldn't receive arraybuffer")});break;case"blob":t.clientInstance.getBlob(e.swarmId,function(e,r){e?n._complete(r):t.error("couldn't receive blob")});break;case"document":t.error("document responseType isn't supported"),this.handleRequestError(this.INVALID_RESPONSETYPE,"document is not implemented");break;case"json":t.error("json responseType isn't supported"),this.handleRequestError(this.INVALID_RESPONSETYPE,"json is not implemented");break;case"blobUrl":t.clientInstance.getBlobUrl(e.swarmId,function(e,r){e?n._complete(r):t.error("couldn't receive blobUrl")});break;case"text":default:t.clientInstance.getText(e.swarmId,function(e,r){e?(r=r.replace(f,""),n.responseText=r,n._complete(r)):t.error("couldn't receive text")})}},this)},_triggerEvent:function(e,n){if("progress"===e){var r=this._getDownloadSpeed(this._url),i=c.SPEED_FACTOR;i&&(r*=i),this._speed=r,this._speed<0&&t.error("_speed is negative ("+this._speed+")"),n.loadedHTTP===n.total&&a.avgGlobal({avgHTTPSpeed:this._speed})}for(var o=0;o<this.eventListeners[e].length;o++)t.core.util.envokeCallback(this.eventListeners[e][o],[n],this);t.core.util.envokeCallback(this["on"+e],[n],this)},isMethodSupported:function(e){return/^(GET|POST)$/i.test(e)&&(!this.isCatchAllRequest||"POST"!==e)},fallbackToNative:function(){var e=new s;return e.open(this._method,this._url),o(e,this),e},discontinue:function(){this._method=null}});_.INVALID_RESPONSETYPE=669,_.INVALID_RESPONSELENGTH=668,_.SWARMID_NOT_FOUND_ERR=650,_.FILE_SIZE_ERR=640,_.FIREFOX_ONLY_SWARM_ERR=641,_.CHROME_ONLY_SWARM_ERR=642,_.BROWSER_SWARM_COMPAT_ERR=643,_.OUT_OF_SPACE_ERR=644,_.WRITE_ERR=645,_.VERIFICATION_ERR=646,_.UNSENT=0,_.OPENED=1,_.HEADERS_RECEIVED=2,_.LOADING=3,_.DONE=4,e.exports=t.Request=_}).call(t,n(1))},function(e,t){"use strict";function n(e){return arguments.length?n.$.channel(e):n.$.reset(),n.$}var r=this;n.$={version:"0.2",channelName:"",channels:[],reset:function(){n.$.channelName="",n.$.channels=[]},broadcast:function(){var e,t,n,i,a=this.channels[this.channelName],o=a.length;for(e=0;e<o;e++)t=a[e],"object"==typeof t&&t.length&&(n=t[0],i=t[1]||r),n.apply(i,arguments);return this},channel:function(e){var t=this.channels;return t[e]||(t[e]=[]),this.channelName=e,this},subscribe:function(){var e,t,n=arguments,r=this.channels[this.channelName],i=n.length,a=[];for(e=0;e<i;e++)a=n[e],t="function"==typeof a?[a]:a,"object"==typeof t&&t.length&&r.push(t);return this},unsubscribe:function(){var e,t,n,r=arguments,i=this.channels[this.channelName],a=r.length,o=i.length,s=0;for(e=0;e<a;e++)for(s=0,o=i.length,t=0;t<o;t++)n=t-s,(!(r[e]instanceof Array)&&i[n][0]===r[e]||r[e]instanceof Array&&i[n][0]===r[e][0])&&(r[e]instanceof Array&&i[n][1]!==r[e][1]||(i.splice(n,1),s++));return this}},e.exports=window.radio=n},function(e,t){"use strict";e.exports={HYBRID:1,P2P:2,HTTP:3,DYNAMIC:4}},function(e,t){"use strict";e.exports={LOADING:1,STOPPED:2}},function(e,t){"use strict";function n(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function r(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(e){return t[e]});if("0123456789"!==r.join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(e){i[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}var i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=r()?Object.assign:function(e,t){for(var r,s,u=n(e),c=1;c<arguments.length;c++){r=Object(arguments[c]);for(var l in r)a.call(r,l)&&(u[l]=r[l]);if(i){s=i(r);for(var d=0;d<s.length;d++)o.call(r,s[d])&&(u[s[d]]=r[s[d]])}}return u}},function(e,t,n){(function(t){"use strict";function n(e,t){var n=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r=new RegExp("[\\?&]"+n+"=([^&#]*)"),i=r.exec(e);return i&&decodeURIComponent(i[1].replace(/\+/g," "))}function r(e){for(var t=0;t<e.length;t++)if(e[t])return e[t];return null}function i(e,t){var i=[].slice.call(document.getElementsByTagName("script"));return r(i.filter(function(t){return t.src.indexOf(e)>=0}).map(function(e){return n(e.src,t)}))}var a;e.exports=function(e){var n=e||"peer5.js";return a=a||i(n,"id")||"undefined"!=typeof t&&t.config&&t.config.TOKEN}}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(11);e.exports=t.VideoRequest=r.subClass({ctor:function(e){this.isVideoPlayerRequest=!0,this._super(e)}})}).call(t,n(1))},function(e,t){e.exports=function(){var e=[],t=0;this.getLength=function(){return e.length-t},this.isEmpty=function(){return 0==e.length},this.enqueue=function(t){e.push(t)},this.dequeue=function(){if(0!=e.length){var n=e[t];return 2*++t>=e.length&&(e=e.slice(t),t=0),n}},this.peek=function(){return e.length>0?e[t]:void 0}}},function(e,t){"use strict";function n(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)}var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",i=/[xy]/g;e.exports=function(){return r.replace(i,n)}},function(e,t,n){"use strict";function r(e,t){var n=Object.create(null);return Object.keys(e).forEach(function(t){n[t]=e[t]}),n.currentTarget=t,n.target=t,n}function i(e,t){return e?function(){if(arguments.length>0){var n=r(arguments[0],t);e.call(t,n)}else e.call(t)}:null}function a(e,t,n){var r=e;try{Object.defineProperty(t,n,{configurable:!0,set:function(e){r[n]=e},get:function(){return e[n]}})}catch(e){h.warn("proxying future event assignments failed",e)}}function o(e,t,n){var r=e;r[n]=i(t[n],t)||r[n]}function s(e,t,n){o(e,t,n),a(e,t,n)}function u(e,t,n){var r=t;e.addEventListener("readystatechange",function(t){Object.keys(Object.getPrototypeOf(e)).concat(Object.keys(e)).forEach(function(i){return"response"===i&&4===t.currentTarget.readyState&&n?(r[i]=n(e[i]),null):"responseXML"===i?(4!==t.currentTarget.readyState||""!==e.responseType&&"document"!==e.responseType||(n?r[i]=n(e[i]):r[i]=e[i]),null):"responseText"===i?(4!==t.currentTarget.readyState||""!==e.responseType&&"text"!==e.responseType||(n?r[i]=n(e[i]):r[i]=e[i]),null):"function"==typeof e[i]?null:(r[i]=e[i],null)});var i=this.getAllResponseHeaders();i&&r.setResponseHeaders(i)})}function c(e,t){var n=e;n.responseType=t.responseType,f.forEach(function(n){s(e,t,n)}),Object.keys(t.eventListeners).forEach(function(e){for(var r=t.eventListeners[e],a=0;a<r.length;a++){var o=i(r[a],t);n.addEventListener(e,o)}})}function l(e,t){function n(t){r[t]=function(){return e[t].apply(e,arguments)}}var r=t;Object.keys(Object.getPrototypeOf(e)).concat(Object.keys(e)).forEach(function(e){"function"==typeof t[e]&&f.indexOf(e)===-1&&n(e)})}function d(e,t,n){u(e,t,n),c(e,t),l(e,t)}var h=n(3),f=["onreadystatechange","onloadstart","onprogress","onabort","onerror","onload","ontimeout","onloadend"];e.exports=d},function(e,t){"use strict";function n(e,t){if(e in r){var n,i=r[e];for(n in t){if(!(n in i))return!1;if(typeof t[n]!==i[n].type)return!1}for(var a in i)if(i[a].required&&typeof t[a]!==i[a].type)return!1;return!0}return!1}var r={player:{action:{type:"string",required:!0},label:{type:"string",required:!0},value:{type:"number",required:!1},timeSinceLoaded:{type:"number",required:!1},duration:{type:"number",required:!1},vendor:{type:"string",required:!0},id:{type:"string",required:!0},occurrence:{type:"number",required:!1},timeSinceReady:{type:"number",required:!1}}};e.exports=function(e,t){n(e,t)&&radio("external."+e).broadcast(t)}},function(e,t,n){"use strict";var r=n(17);e.exports=r.subClass({ctor:function(e){this.isVideoPlayerRequest=!0,this.isCatchAllRequest=!0,this._super(e)}})},function(e,t,n){(function(t){"use strict";var r=n(11);e.exports=t.FragmentRequest=r.subClass({ctor:function(e){this.isFragmentRequest=!0,this._super(e)}})}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(){function e(e,t){void 0===r[e]&&(r[e]=i(e,t))}function t(e,t){var i=r[e],a=i.getEvents(t);n("player",a)}function n(e,t){t.forEach(function(t){a(e,t)})}var r=Object.create(null);return{updateAction:t,initPlayer:e}}var i=n(49),a=n(21);e.exports=t.players.EventsDispatcher=r()}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(11);e.exports=t.PlaylistRequest=r.subClass({ctor:function(e){this.isPlaylistRequest=!0,this._super(e)}})}).call(t,n(1))},function(e,t,n){(function(t){function r(){function e(e){if(!d[e]){var t=Object.create(null);t.slots=0,t.loaded=0,t.endedIntervalsDuration=0,t.currIntervalStart=null,t.speed=void 0,t.nbProgress=0,d[e]=t}var n=d[e];n.slots++,1===n.slots&&(n.currIntervalStart=performance.now())}function n(e){var t=d[e];t&&(t.slots--,0===t.slots&&(t.endedIntervalsDuration+=performance.now()-t.currIntervalStart,r(e,t.endedIntervalsDuration)))}function r(e,n){if(i.has(e)){var r=d[e],a=i.get(e),o=a.fileSize,s=(o-r.loaded)/h;s<0&&t.error("durationLeft is negative ("+s+")"),r.predictedSpeed=o/(s+n/1e3)}}function o(e,t){var n=performance.now(),i=d[e];if(i){i.loaded+=t,i.nbProgress++;var a=n-i.currIntervalStart+i.endedIntervalsDuration;i.speed=i.loaded/(a/1e3),i.nbProgress>1&&(h=h?f*i.speed+(1-f)*h:i.speed,r(e,a))}}function s(e,n){var r=d[e];r&&(r.loaded-=n,r.slots--,r.loaded<0&&t.error("stat.loaded < 0 ("+r.loaded+")"),0===r.slots&&0===r.loaded&&delete d[e])}function u(e){var n=d[e];if(n)return n.predictedSpeed<0&&t.error("predicted speed is negative ("+n.predictedSpeed+")"),n.predictedSpeed}function c(e){delete d[e]}function l(e){var n=d[e];if(n)return n.speed<0&&t.error("speed is negative ("+n.speed+")"),n.speed}var d=Object.create(null),h=null,f=a.SPEED_SMOOTH_FACTOR;return radio("xhrSent").subscribe([e,this]),radio("xhrComplete").subscribe([n,this]),radio("httpDownloaded").subscribe([o,this]),radio("httpAborted").subscribe([s,this]),{getSpeed:l,getPredictedSpeed:u,removeResource:c}}var i=n(6).singleton,a=n(2);e.exports=r()}).call(t,n(1))},function(e,t,n){(function(e){!function(){e.core.stats.StatsCalculator=Object.subClass({ctor:function(){this.Total_Recv_No_Waste=0,this.Total_Recv_P2P=0,this.Total_Recv_HTTP=0,this.Total_Avg_Download=0,this.Avg_Recv_P2P=0,this.Avg_Recv_HTTP=0,this.Total_Avg_Download=0,this.statsTimestamp=0,this.startTime=Date.now()},calcAvg:function(e){var t=Date.now()-this.statsTimestamp;this.statsTimestamp+=t,t/=1e3,this.Total_Recv_No_Waste=e.totalP2PDownloaded+e.totalHttpDownloaded,this.Total_Avg_Download=(e.totalHttpDownloaded+e.totalP2PDownloaded)/((Date.now()-this.startTime)/1e3),this.Avg_Recv_P2P=(e.totalP2PDownloaded-this.Total_Recv_P2P)/t,this.Avg_Recv_HTTP=(e.totalHttpDownloaded-this.Total_Recv_HTTP)/t,this.Total_Recv_P2P=e.totalP2PDownloaded,this.Total_Recv_HTTP=e.totalHttpDownloaded}})}()}).call(t,n(1))},function(e,t){!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Object.subClass=function(n){function r(){!e&&this.ctor&&this.ctor.apply(this,arguments)}var i=this.prototype;e=!0;var a=new this;e=!1;var o;for(o in n){var s="function"==typeof n[o]&&"function"==typeof i[o]&&t.test(n[o]);a[o]=s?function(e,t){return function(){var n=this._super;this._super=i[e];var r=t.apply(this,arguments);return this._super=n,r}}(o,n[o]):n[o]}for(o in this)this.hasOwnProperty(o)&&"function"!=typeof this[o]&&(r[o]=this[o]);return r.prototype=a,r.constructor=r,r.subClass=arguments.callee,r.addBehavior=function(e,t){if(t=t||{},!e)throw"behaviorAbstractClass must be a vaild behavior class";override(a,t,new e)},r}}()},function(e,t,n){(function(t){"use strict";var n={};n.randomKFromN=function(e,t){var n=[];if(e>t){for(var r=0;r<=t;r++)n.push(r);return n}for(;n.length<e;){for(var i=Math.ceil(Math.random()*(t+1))-1,a=!1,r=0;r<n.length;r++)if(n[r]==i){a=!0;break}a||n.push(i)}return n},n.randSample=function(e,t){if(0==e.length)return e;var r=n.randomKFromN(t,e.length-1);return n.sampleIndexes(e,r)},n.sampleIndexes=function(e,t){for(var n=[],r=0;r<t.length;r++)n.push(e[t[r]]);return n},n.shuffle=function(e){var t,n,r=e.length;if(r)for(;--r;)n=Math.floor(Math.random()*(r+1)),t=e[n],e[n]=e[r],e[r]=t;return e},n.randomOffset=function(e,t,n){for(var r=(t-e)/n,i=[],a=0;a<=r;a++)for(var o=0;o<=a;o++)i.push(a);var s=i.length,u=Math.floor(Math.random()*s);return i[u]*n+e},Object.keys(n).forEach(function(e){t.core.util[e]=n[e]}),e.exports=n}).call(t,n(1))},function(e,t,n){"use strict";function r(e){if(!e||"object"!=typeof e||Array.isArray(e))return!1;var t=!1,n=e.EXPERIMENTS&&e.EXPERIMENTS[i.A_B_GROUP_ID];Object.keys(e).forEach(function(n){"EXPERIMENTS"!==n&&(t=!0,a.info("Updating config: "+n+": "+e[n]),i[n]=e[n])});var r=JSON.parse(i.A_B_CONFIG_JSON||"{}");return n&&"object"==typeof n&&Object.keys(n).forEach(function(e){t=!0,a.info("Updating AB config: "+e+": "+n[e]),i[e]=r[e]=n[e]}),"undefined"!=typeof r.DYNAMIC_CONFIG&&(t=!0,delete r.DYNAMIC_CONFIG),(r&&Object.keys(r).length||i.A_B_GROUP_ID)&&(i.A_B_CONFIG_JSON=JSON.stringify(r)),t}var i=n(2),a=n(3);e.exports=r},function(e,t,n){"use strict";function r(e){var t=window.peer5.getConfig("MEDIA_MAX_BUFFER_HOLE"),n=i(e.buffered,e.currentTime,t);return n.timeAhead}var i=n(140);e.exports=r},function(e,t){"use strict";e.exports=function(e){return{currentTarget:e,target:e}}},function(e,t){"use strict";e.exports=function(e,t){var n=t;return n="string"==typeof n?document.getElementById(n):n,n=n?n.tagName.toLowerCase()!==e?n.querySelector(e):n:document.querySelector(e),n||null}},function(e,t,n){(function(e){var t=n(7);!function(){e.overrideXHR=function(){window.XMLHttpRequest=e.Request},e.revertXHR=function(){window.XMLHttpRequest=t},e.clientInstance.isValidated()&&!e.config.EXTERNAL_XHR_FALLBACK||(e.CatchAllVideoRequest=e.PlaylistRequest=e.FragmentRequest=e.VideoRequest=e.Request=t),e.DATACHANNELS_ERROR=700,e.WEBSOCKETS_ERROR=701,e.FILESYSTEM_ERROR=702,e.getCompatibilityStatus=function(t){e.clientInstance.getCompatibilityStatus(function(n,r){var i=[];for(type in n)if(!n[type])switch(type){case"dataChannels":i.push(e.DATACHANNELS_ERROR);break;case"Websockets":i.push(e.WEBSOCKETS_ERROR);break;case"fileSystem":i.push(e.FILESYSTEM_ERROR)}t(i,r.name,r.version)})},e.isEnabled=function(){return e.feature.isEnabledAndInitialized(e.config.FEATURE_PEER5_KEY)}}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(39),r=n(41),i=n(51),a=n(13),o=n(19),s=n(6).singleton,u=n(2),c=n(119),l=n(75),d=n(4),h=n(5),f=n(143),p=n(9),g=n(10),v=a.HYBRID,m=a.P2P,_=a.HTTP,E=a.DYNAMIC;!function(n){var a=e.core.util.UrlSwarmIdMap;e.client.DownloadUploadManager=Object.subClass({ctor:function(){var n=this;if(this.registerEvents(),this.apiValidator=new e.core.apiValidators.ApiValidator({dataChannels:e.core.apiValidators.DataChannelsApiValidator,fileSystem:e.core.apiValidators.FileSystemApiValidator}),this.apiValidator.validate()){this.validated=!0,this.clientId=o(),this.wsConnection=new e.core.transport.WsConnection(u.WS_URL,this.clientId);var a=this.tracker=new i(this.wsConnection);if(this.signaller=new r(this.wsConnection),this.controller=new e.client.HybridController(new t(this.clientId,this.signaller)),this.reportBuilder=new l({onReportedEvent:function(){n.sendReportPeriodically()}}),u.DYNAMIC_CONFIG){var s=u.A_B_CONFIG_JSON;c(function(e){e&&s!==u.A_B_CONFIG_JSON&&a.updateABConfig(u.A_B_CONFIG_JSON),radio("loadedDynamicConfig").broadcast()})}else radio("loadedDynamicConfig").broadcast();this.lastReportTime=Date.now(),this.lastStatCalcTime=0,this.cron_interval_id=window.setInterval(function(){n.cron()},e.config.MONITOR_INTERVAL)}else this.validated=!1;e.core.data.FSio.executeOnReady({function:this.cleanOldFiles,args:function(){},context:this}),radio("scriptLoaded").broadcast(),radio("scriptValidated").broadcast(this.validated),f.onExit(function(){n.handleSessionEnd()})},cleanOldFiles:function(e){this.cleanOldFilesPersistent(this.cleanOldFilesTemporary,e)},cleanOldFilesPersistent:function(t,n){e.core.data.FSio.queryPersQuota(function(r,i,a){e.info("quota is : "+a),a>0?e.core.data.FSio.requestPersQuota(a-1,function(r){r?e.core.data.CacheManager.cleanOldFiles(function(e){t&&t(n)}):t&&t(n)}):t&&t(n)})},cleanOldFilesTemporary:function(t){e.core.data.FSio.queryTempQuota(function(n,r,i){i>0?e.core.data.FSio.requestTempQuota(e.config.TEMPORARY_FS_SIZE,function(n){n?e.core.data.CacheManager.cleanOldFiles(function(e){t&&t()}):t&&t()}):t&&t()})},getNumOfVerifiedBytes:function(e){if(!s.has(e))return 0;var t=s.get(e);return t.getNumOfVerifiedBytes()},getBlobUrl:function(e,t){var n=s.get(e);n.getBlobUrl(t)},getBlob:function(e,t){var n=s.get(e);n.getBlob(t)},getUint8Array:function(e,t){var n=s.get(e);n.getUint8Array(t)},getText:function(e,t){var n=s.get(e);n.getText(t)},isValidated:function(){return this.validated},isFull:function(e,t){var n=s.get(e);t(n.isFull())},addResource:function(t,n,r){radio("resourceAdded").broadcast(t),d.sum(t,{requestsCount:1});var i=p(t),a=e.state.resources.get(i);return a&&a.state>=0?void this.addExistingResource(t,i,n,r):void this.addNewResource(t,n,r)},addNewResource:function(t,n,r){if(e.info("Adding new resource "+t),e.state.resources.add({state:0,mod:n,sha1:r.sha1,md5:r.md5,origin:r.origin,url:t,constraint:r.constraint,httpConstraint:r.httpConstraint,start:performance.now(),skipJoin:r.skipJoin}),t.indexOf("http")!=-1)this._initiateHttpResource(t);else if(t.indexOf("peer5://")!=-1){var i=t.slice(8);e.state.resources.alias(i,t),this.leechSwarm(i)}},addExistingResource:function(t,n,r,i){var a=e.state.resources.get(n);if(e.info("Adding existing resource "+t+" with state: "+a.state),a.url!==t&&s.has(a.url)&&(s.alias(t,a.url),e.state.resources.alias(t,a.url)),s.has(t)){var o=s.get(t),u=o.getMetadata();return u?(u.url=t,a.url=t,a.url!==t&&e.core.util.UrlSwarmIdMap.addMapping(t,a.swarmId),a.mod=r,a.constraint=i.constraint,a.httpConstraint=i.httpConstraint,this.controller.init(t),radio("fileInfoProcessed").broadcast(u),void radio("resourceReady"+t).broadcast(u)):void e.error("adding existing resource but no blockMap but no fileInfo")}e.error("adding existing resource but no blockMap")},removeResource:function(t){var n=e.state.resources.get(t);return n?(e.info("removeResource: removing resource "+t+" with state: "+n.state),!n.state||n.state<=1?(e.warn("removing resource with state smaller than 1: "+t),this._removeResourceBeforeInit(t)):(n.swarmId&&this.tracker.leave(n.swarmId),n.state=4,n.end=performance.now(),this.controller.removeResource(t),radio("stopHttpInit"+t).broadcast(),d.removeResource(t,n.resourceId),s.remove(t),void e.state.resources.remove(t))):void e.error("tried to remove a resource that was already removed: "+t)},stopResource:function(t){var n=e.state.resources.get(t);if(n){if(e.info("stopResource: stopping resource "+t+" with state: "+n.state),!n.state||n.state<=1)return e.warn("removing resource with state smaller than 1: "+t),this._removeResourceBeforeInit(t);n.state=4,n.end=performance.now(),this.controller.stopResource(t),radio("stopHttpInit"+t).broadcast()}},readBlobData:function(t,n){var r=e.state.resources.add({url:t,state:0,origin:!0,hashAlg:new g.ArrayBuffer,blockHashes:[],chunkRead:0,mod:m}),i=n.size;s.add(t,new e.core.dataStructures.BlockMap(i,t,r.md5,r.sha1));var a=this,o=s.get(t);e.config.USE_FS&&o.fs?radio("filesystemInitiated"+t).subscribe([function(){1==o.fs&&e.config.PREALLOCATE_FILE?o.allocateFileSizeSync(function(r){r?a.readBlobInSlices(t,n):radio("removeResource").broadcast(t,e.Request.FILE_SIZE_ERR,"Not enough disk space for file")}):a.readBlobInSlices(t,n)},this]):this.readBlobInSlices(t,n),radio("transferLoaded").subscribe(function(n){var r=e.state.resources.get(t);n.url!==t||r.uploaded||e.core.util.asyncDefer(function(){r.uploaded=!0;var e=a.createAndUploadFileInfo(t);radio("transferLoaded"+t).broadcast(e)})})},getLoadedStats:function(e){var t;if(s.has(e)){var n=s.get(e);if(t=n._getResourceStats(),t.httpDown||t.p2pDown||t.fsLoad)return{loadedHTTP:t.httpDown,loadedP2P:t.p2pDown,loadedFS:t.fsLoad}}t=d.getStats(e);var r=Object.create(null);return r.loadedHTTP=t.totalHttpProgress,r.loadedP2P=t.totalP2PDownloaded,r.loadedFS=t.totalFSLoaded,r},getUploadedStats:function(e,t){var n=d.getStats(e),r=Object.create(null);r.uploaded=n.totalP2PUploaded,t(r)},getCompatibilityStatus:function(e){var t=this.apiValidator.getStatus(),n=this.apiValidator.getBrowser();e(t,n)},_initiateHttpResource:function(t){e.info("initializing http resource: "+t);var n=e.state.resources.get(t);if(n.hashUrl=p(t),e.state.resources.alias(n.hashUrl,t),n.hash&&n.length){var r=new h.FileInfoMessage(n.hash,n.length,n.hash,null,e.config.BLOCK_SIZE,t);this._joinSwarmAndHandleFileInfo(r,n)}else{var i=this;e.client.getHttpMeta(t,n,function(e,t,r){i._joinSwarmAndHandleFileInfo(e,n,t,r)})}},_joinSwarmAndHandleFileInfo:function(e,t,n,r){t.skipJoin||this.joinSwarm(e.swarmId),this.handleFileInfo(e,n,r)},createAndUploadFileInfo:function(t){var n=e.state.resources.get(t),r=n.hashAlg.end();a.addMapping(t,r),n.hash=r,this.changeResourceId(t,n.hash);var i=s.get(t);return this.tracker.share(n.hash,i.fileSize,n.hash,n.blockHashes,e.config.BLOCK_SIZE)},readBlobInSlices:function(t,n){var r=s.get(t);if(r&&!r.fs&&n.size>e.config.ALLOWED_FILE_SIZE)return void radio("removeResource").broadcast(t,e.Request.FILE_SIZE_ERR,"file size too big");var i=this;e.core.util.fileHandler.readFileInSlices(t,n,e.config.BLOCK_SIZE,function(t,n,r){t&&n&&r?i.addChunks(t,n,r):(!t||n||r)&&e.error("handle error")})},addChunks:function(t,n,r){var i=e.state.resources.get(t);i.hashAlg.append(n);for(var a=s.get(t),o=Math.ceil(n.byteLength/e.config.CHUNK_SIZE),u=0;u<o;u++){var c=u*e.config.CHUNK_SIZE,l=new Uint8Array(n.slice(c,Math.min(c+e.config.CHUNK_SIZE,n.byteLength))),d=a.setChunk(i.chunkRead,l),h=a.ingestBlock(d);h&&(i.blockHashes[d]=h),radio("chunkAddedToBlockMap").broadcast(),i.chunkRead++}i.chunkRead==this.numOfChunksInFile&&(this.hasEntireFile=!0),a.fs?e.core.data.FSio.notifyFinishWrite(r):r()},cron:function(){this.sendReportPeriodically(),this.calculateStats(),radio("cron").broadcast();for(var t in s._blockMaps){var n=e.state.resources.get(t),r=s.get(t);n&&n.mod!==m&&r&&!r.isFull()&&!n.preventDownload&&(0===d.statsCalculators[t].Avg_Recv_HTTP?n.httpIdle++:n.httpIdle=0,n.httpIdle>=e.config.HTTP_IDLE_RESET_DURATION/e.config.MONITOR_INTERVAL&&(this.controller.stopHttp(r.getMetadata().url),n.httpIdle=0),this.controller.downloadPeriodicTest(r.getMetadata().url))}},calculateStats:function(){var t=Date.now();t-this.lastStatCalcTime<e.config.STAT_CALC_INTERVAL||(this.lastStatCalcTime=t,d.calcAvg())},sendReport:function(){if(this.validated){var e=this.reportBuilder.rotateReport();e&&this.tracker.groupReport(e)}},sendReportPeriodically:function(){var e=this,t=Date.now();t-e.lastReportTime<u.REPORT_INTERVAL||(e.lastReportTime=t,e.sendReport())},handleFileInfo:function(t,n,r){var i=t.swarmId,o=t.url;a.addMapping(o,i),e.info("Handling file Info:: url="+o+" swarmId="+i);var u=e.state.resources.get(o),c=new e.core.dataStructures.BlockMap(t.size,i,u.md5,u.sha1);n>0&&(c.setResourceAsBeingDownloadedInHttp(),c.httpProgressBytes=n),r>0&&(c.httpExtraWaste=r),s.add(i,c),c.addMetadata(t),this.changeResourceId(o,i),s.alias(u.hashUrl,o),u.state=1,u.swarmId=i,radio("fileInfoProcessed").broadcast(t),c.fs||radio("resourceInit").broadcast(t)},updateFileInfo:function(t){var n=t.url,r=t.swarmId,i=e.state.resources.get(n);this.changeResourceId(n,r,function(n){if(n){i.state=1,i.swarmId=r;var a=s.get(r);a.addMetadata(t),radio("resourceInit").broadcast(t)}else e.warn("couldn't change resource Id")}),radio("fileInfoProcessed").broadcast(t)},joinSwarm:function(e){var t=this.controller.P2PController.getLookingForPeers();t&&this.tracker.join(e,t)},leechSwarm:function(e){this.tracker.leech(e)},_removeResourceBeforeInit:function(t){var n=e.state.resources.get(t);n&&(n.state=4,n.end=performance.now(),e.state.resources.remove(t),radio("stopHttpInit"+t).broadcast())},registerEvents:function(){radio("pauseResource").subscribe([function(t,n,r){this.stopResource(t),radio("resumeResource").subscribe([function(n){if(n===t){var r=null,i=e.state.resources.get(t);i.md5?r={md5:i.md5}:i.sha1&&(r={sha1:i.sha1}),this.addResource(t,i.mod,r)}},this])},this]),radio("stopResource").subscribe([function(t,n,r){var i=e.state.resources.get(t),a=i?i.mod:null;radio("requestError"+t).broadcast(n,r),radio("resourceLoadEnd").broadcast(t,a),this.stopResource(t)},this]),radio("removeResource").subscribe([function(t,n,r){e.warn("removing resource "+t),e.warn(n+": "+r);var i=e.state.resources.get(t);return i?(radio("requestError"+t).broadcast(n,r),void(i.state<1?this._removeResourceBeforeInit(t):this.removeResource(t))):void e.warn("Tried removing resource: "+t+" but it was already removed")},this]),radio("resourceInit").subscribe([function(t){var n=e.state.resources.get(t.swarmId);if(n&&n.state&&4!==n.state){n.state=2;var r=s.get(t.swarmId);if(!r.fs&&t.size>e.config.ALLOWED_FILE_SIZE)return void radio("removeResource").broadcast(t.url,e.Request.FILE_SIZE_ERR,"file size too big");this.controller.init(t.url),r.fs===!0&&e.config.PREALLOCATE_FILE&&r.allocateFileSize(function(t){t||e.warn("Couldn't allocate space for file")}),radio("resourceReady"+t.url).broadcast(t)}},this]),radio("fileInfoProcessed").subscribe([function(e){radio("fileInfoProcessed"+e.url).broadcast(e)},this]),radio("chunkSent").subscribe([function(t,n){var r=e.state.resources.get(t).url;radio("chunkSent"+r).broadcast(t,n)},this]),radio("blockReceived").subscribe([function(t,n){var r=e.state.resources.get(t);if(r){var i=r.url;radio("blockReceived"+i).broadcast(n)}},this]),radio("HTTPHeadersReceived").subscribe([function(e,t,n){radio("HTTPHeadersReceived"+e).broadcast(t,n)},this]),radio("needByteRangeEvent").subscribe([function(t,n,r,i){var a=e.state.resources.get(t);if(!a.preventDownload){var o=s.get(t),u=n?o.getBlockIndex(n):null,c=r?o.getBlockIndex(r):null;a.mod===E?this.controller.dynamicDownload(t,u,c,i):this.controller.download(t,u,c)}},this]),radio("receivedFileInfo").subscribe([function(t){var n=e.state.resources.get(t.swarmId);n?n&&0===n.state&&(t.url=n.url,n.origin?this.updateFileInfo(t):this.handleFileInfo(t)):e.warn("received fileInfo for a non existing swarm")},this]),radio("browserUnsupported").subscribe([function(t,n,r){e.warn("Unsupported browser for peer5"),radio("browserUnsupported").unsubscribe(arguments.callee),this.validated=!1},this]),radio("httpDownloaded").subscribe([function(e,t){if(s.has(e)){var n=s.get(e);n.addHttpProgressBytes(t)}},this]),radio("httpAborted").subscribe([function(e,t){if(s.has(e)){var n=s.get(e);n.removeHttpProgressBytes(t)}},this]),radio("swarmError").subscribe([function(t){var n,r=e.state.resources.get(t.swarmId);switch(t.error){case h.SWARM_NOT_FOUND:if(!r)return void e.warn("swarm not found for an unexisting resource");if(r.mod===v||r.mod===_)return;if(void 0!==r.hashUrl)return;if(r.mod===m){var n=e.Request.SWARMID_NOT_FOUND_ERR;break}}e.error("swarmError: "+t.error),radio("stopResource").broadcast(t.swarmId,n)},this]),radio("transferLoaded").subscribe([function(t){var n=e.state.resources.get(t.url);if(this.controller.stopResource(n.url),radio("stopHttpInit"+n.url).broadcast(),t&&t.swarmId&&n){n.state=4,n.end=performance.now();var r=n.url,i=n.mod;radio("resource:complete").broadcast(t),radio("resourceLoadEnd").broadcast(r,i)}},this]),radio("httpProgress").subscribe([function(e){radio("httpProgress"+e).broadcast(e)},this])},changeResourceId:function(t,n,r){var i=e.state.resources.get(t);i&&(e.state.resources.alias(n,t),i.resourceId=n),!s.has(t)||s.has(n)&&t!==n?!s.has(t)&&s.has(n)&&s.alias(t,n):s.alias(n,t),r&&s.get(n).resourceId!==n&&s.get(t).changeResourceId(n,r)},sendSessionSummary:function(){if(this.validated){var e=this.reportBuilder.getSessionSummary();e&&this.tracker.sessionReport(e)}},handleSessionEnd:function(){this.sendReport(),this.sendSessionSummary()}}),n.clientInstance=new e.client.DownloadUploadManager}(e)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(6).singleton,r=n(9),i=n(14);!function(){var n=e.core.dataStructures.PendingBlockMap;e.client.HTTPController=e.core.controllers.AbstractController.subClass({ctor:function(){this._super(),this.lastFailedStartBlock=Object.create(null),this.xhrs=Object.create(null),this.resourceState=Object.create(null),this.registerEvents()},isAvailable:function(t){return!(!this.resourceState[t]||this.resourceState[t]===i.STOPPED)&&(this.xhrs[t]?!this.xhrs[t].isHTTPBusy():(e.warn("HTTP downloaders corruption for url "+t),!1))},removeResource:function(t){e.info("removed http resource "+t),this._super(t),this.stop(t)},stopResource:function(t){e.info("stopped http resource "+t),this._super(t),this.stop(t)},init:function(r){function a(a,o){if(!o){var s,u=a.startRange,c=a.endRange;if(!c){if(!t.has(r))return;s=t.get(r),c=s.fileSize}!s&&t.has(r)&&(s=t.get(r));for(var l=u/e.config.CHUNK_SIZE,d=Math.ceil((c+1)/e.config.CHUNK_SIZE)-1,h=l;h<=d;h++)n.removeChunk(r,h),s&&s.unsetBlockAsBeingDownloadedInHttp(Math.floor(h/(e.config.BLOCK_SIZE/e.config.CHUNK_SIZE)));this.lastFailedStartBlock[r]=u/e.config.BLOCK_SIZE,this.resourceState[r]!==i.STOPPED&&radio("HTTPAvailableEvent").broadcast(r)}}if(this._super(r),!this.xhrs[r]){var o=new e.client.MultiSlotManager(r);radio("xhrFailed"+r).subscribe([a,this]),radio("xhrAbort"+r).subscribe([a,this]),this.xhrs[r]=o}},download:function(r,i,a){if(this.isAvailable(r)){this.xhrs[r]||(this.xhrs[r]=new e.client.HTTPDownloader(r));var o=this.xhrs[r];if(o.isHTTPBusy())return 0;var s=t.get(r);!this.lastFailedStartBlock[r]||s.has(this.lastFailedStartBlock[r])||n.isBlockPending(r,this.lastFailedStartBlock[r])||(i=this.lastFailedStartBlock[r],a=this.lastFailedStartBlock[r]);for(var u=a-i+1,c=i;c<=a;c++){s.setBlockAsBeingDownloadedInHttp(c);var l=s.getChunkIdsOfBlock(c);for(var d in l)n.addChunk(r,l[d])}var h=!1,f=e.config.BLOCK_SIZE*i,p=e.config.BLOCK_SIZE*(a+1)-1;return p>=s.fileSize-1&&(p=null),o.download(f,p,h),u}},validateFileSize:function(t,n){if(t>n)return!1;var r=t%e.config.BLOCK_SIZE;if(0===r)return!0;var i=n%e.config.BLOCK_SIZE;return r===i},addHTTPBytesToBlocks:function(i,a,o){if(!t.has(i))return void e.warn("addHTTPBytesToChunks - downloaded http for a resource that doesnt exist "+i);var s=t.get(i),u=o.length,c=u+a;if(!this.validateFileSize(c,s.fileSize)){e.warn("XHR response length isnt as expected "+i),radio("removeResource").broadcast(i,e.Request.INVALID_RESPONSELENGTH,"XHR response length isnt as expected");var l=r(i);return void e.client.FailedUrls.addUrl(l)}for(var d,h,f=0;f<u;)d=f+e.config.BLOCK_SIZE<=u?o.subarray(f,f+e.config.BLOCK_SIZE):o.subarray(f),
h=Math.floor((a+f)/e.config.BLOCK_SIZE),n.removeBlock(i,h),s.unsetBlockAsBeingDownloadedInHttp(h),s.isFull()||s.setBlock(h,d,"http"),f+=d.length},registerEvents:function(){radio("bytesReceivedEvent").subscribe([function(e){var n=e.url;this.addHTTPBytesToBlocks(n,e.offset,e.dataArray),t.has(n)&&radio("HTTPAvailableEvent").broadcast(n)},this]),radio("blockVerified").subscribe([function(e,t){var n=this.xhrs[e];n&&n.clearDownloadedBlock&&n.clearDownloadedBlock(t)},this])},stop:function(e){var r=this.xhrs[e];if(r){if(r.stop(),n.removeResource(e),t.has(e)){var i=t.get(e);i.unsetResourceAsBeingDownloadedInHttp()}delete this.xhrs[e]}}})}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(7);!function(){var n=e.config.XHR_INITIAL_TIMEOUT;e.client.HTTPDownloader=Object.subClass({ctor:function(e,n){if(this.url=e,this.method=null,this.httpRequestTime=0,this.firstRequest=!0,this.lastTimerTimestamp=null,this.lengthKnown="undefined"==typeof n||n,this.xhr=new t,this.xhr.url=this.url,!this.xhr)throw"Cannot instantiate XHR";this.registerEvents()},isHTTPBusy:function(){return this.xhr.busy},cleanHTTP:function(){this.xhr.busy=!1,this.httpRequestTime=0,this.xhr.lastTotalLoaded=0},stop:function(t){e.info("aborting XHR:"+this.url+" loaded so far "+this.xhr.lastTotalLoaded),this.xhr.busy&&!this.xhr.aborted&&(this.xhr.aborted=!0,"GET"===this.method&&radio("xhrAbort"+this.url).broadcast(this.xhr,t),this.xhr.abort()),this.cleanHTTP(),clearTimeout(this.timerId)},head:function(){this.method="HEAD",this.xhr.open("HEAD",this.url),this.xhr.busy=!0,this.xhr.aborted=!1;var t=this;this.xhr.onload=function(n){this.busy=!1;var r=this.getAllResponseHeaders();200===this.status||206===this.status?(radio("responseHeadersReceived"+this.url).broadcast(r),n.lengthComputable&&n.total>0&&radio("responseLengthReceived"+this.url).broadcast(n.total)):(e.warn("Expecting status code 200/206 from HEAD request. Got "+this.status),radio("xhrFailed"+this.url).broadcast(this)),t.stop()},this.xhr.onerror=function(e){this.busy=!1,radio("xhrFailed"+this.url).broadcast(this)},this.xhr.lastModified=Date.now(),this.resetTimer(this.xhr.lastModified),this.xhr.send(null)},resetTimer:function(t){if(this.timerId&&clearTimeout(this.timerId),this.lastTimerTimestamp){var r=Date.now()-this.lastTimerTimestamp,i=(n+e.config.XHR_TIMEOUT_FACTOR*r)/2;n=Math.round(Math.max(e.config.XHR_MINIMUM_TIMEOUT,i))}var a=this;this.timerId=setTimeout(function(){a.expireRequest(t)},n),this.lastTimerTimestamp=Date.now()},download:function(t,r){this.method="GET",e.info("Downloading in http "+this.url+" start="+t+" end="+r);var i=this;this.httpRequestTime=Date.now(),this.xhr.lastModified=this.httpRequestTime,this.xhr.loaded=0,this.xhr.aborted=!1;try{this.xhr.open("GET",this.url,!0)}catch(t){return this.xhr.busy=!1,e.warn("xhr onerror!"),void radio("xhrFailed"+this.xhr.url).broadcast(this.xhr)}this.xhr.busy=!0,this.xhr.isRange=t&&t>0||r,r?this.xhr.setRequestHeader("Range","bytes="+t+"-"+r):t&&t>0?this.xhr.setRequestHeader("Range","bytes="+t+"-"):t=0,this.xhr.startRange=t,this.xhr.endRange=r,(!this.xhr.lastTotalLoaded||t>this.xhr.lastTotalLoaded||r&&r<this.xhr.lastTotalLoaded)&&(this.xhr.lastTotalLoaded=t),this.xhr.onloadend=function(t){if(clearTimeout(i.timerId),this.busy=!1,i.httpRequestTime=0,this.status<300&&this.status>=200&&this.response){var n=this.response;i.lengthKnown||this.isRange||(t.lengthComputable&&t.total>0?radio("responseLengthReceived"+this.url).broadcast(t.total):n.byteLength>0?radio("responseLengthReceived"+this.url).broadcast(n.byteLength):n.length>0&&radio("responseLengthReceived"+this.url).broadcast(n.length),radio("xhrBytesReceived"+this.url).broadcast(this.url,n.byteLength||n.length)),radio("xhrComplete"+this.url).broadcast(t),e.info("xhr onload: "+this.url+"start= "+this.startRange+"end= "+this.endRange),radio("bytesReceivedEvent"+this.url).broadcast({url:this.url,offset:this.startRange,dataArray:new Uint8Array(n)})}else radio("xhrFailed"+this.url).broadcast(this)},this.xhr.onabort=function(){e.warn("xhr onabort: "+this.url)},this.xhr.onerror=function(){e.warn("xhr onerror: "+this.url)},this.xhr.onreadystatechange=function(){if(this.readyState===this.HEADERS_RECEIVED&&(i.resetTimer(this.lastModified),this.onreadystatechange=null,this.status>=200&&this.status<300)){var e=this.getAllResponseHeaders();radio("responseHeadersReceived"+this.url).broadcast(e)}},this.xhr.responseType="arraybuffer",this.xhr.onprogress=function(t){if(this.status<300&&this.status>=200){var r=Date.now(),a=r-this.lastModified;a>n/2&&e.info("onprogress last part arrived in "+a+"ms"),this.lastModified=r,this.loaded=t.loaded,i.resetTimer(this.lastModified),!i.lengthKnown&&t.lengthComputable&&t.total>0&&!this.isRange&&(i.lengthKnown=!0,radio("responseLengthReceived"+this.url).broadcast(t.total));var o=t.loaded+t.target.startRange-t.target.lastTotalLoaded;o>0&&(i.lengthKnown&&radio("xhrBytesReceived"+this.url).broadcast(this.url,o),radio("httpDownloaded"+this.url).broadcast(this.url,o),t.target.lastTotalLoaded=t.loaded+t.target.startRange,radio("onprogressEvent"+this.url).broadcast(this.url))}},this.resetTimer(this.xhr.lastModified);try{radio("xhrSent"+this.url).broadcast(),this.xhr.send(null)}catch(t){e.error("xhr native error: "+this.url,t)}},requestRetry:function(){var t=this;this.xhr.onloadend=function(n){var r=n.currentTarget.startRange,i=n.currentTarget.endRange;e.info("retrying request: "+t.url+" Range="+r+"-"+i),setTimeout(function(){t.download(r,i)},0)},this.stop(!0),this.xhr.busy=!0},registerEvents:function(){var t=this;this.expireRequest=function(r){t.xhr.lastModified==r&&(e.warn("expiring xhr requested on: "+r),radio("xhrRetry"+t.url).broadcast(),n=Math.round(Math.min(e.config.XHR_MAXIMUM_TIMEOUT,2*n)),"GET"===t.method?t.requestRetry():(t.stop(),t.xhr.busy=!1,radio("xhrTimeout"+t.url).broadcast(t.xhr)))}}})}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(13),r=n(6).singleton,i=n(14),a=t.P2P,o=t.HTTP,s=t.DYNAMIC;!function(){var t=e.core.dataStructures.PendingBlockMap,n=e.core.util.UrlSwarmIdMap;e.client.HybridController=e.core.controllers.AbstractController.subClass({ctor:function(t){if(this.P2PController=new e.core.controllers.P2PController(t),this.httpController=new e.client.HTTPController,this.resourceState=Object.create(null),this.registerEvents(),this.lastBlockRequestedInP2P=Object.create(null),this.nonFullResources=Object.create(null),e.config.SYNCED_BUFFERS){var n=this;setInterval(function(){n.blockAllocationCron()},e.config.BLOCK_ALLOCATION_INTERVAL)}},registerEvents:function(){radio("P2PMaybeAvailableEvent").subscribe([function(t,n){if(this.P2PController.isPeerAvailable(n)){var i=e.state.resources.get(t);if(i&&r.has(t)){var u=r.get(t);if(u.isFull())return void e.info("Peer "+n+" is available but swarm "+t+" is full");var c=i.url,l=i.mod;if(i.mod===s)return void this.allocateBlocks(c);if(l!==a&&l!==o){var d=null;d=e.config.SEQUENTIAL_DOWNLOAD?this.relaxedP2PDownload(c,null,null,n):this.relaxedP2PDownloadRandomly(c,null,null,n),!d||0===d.length}}}},this]),radio("HTTPAvailableEvent").subscribe([function(t){if(this.httpController.isAvailable(t)){var n=r.get(t);if(n.isFull())return e.info("HTTP Available but already have everything"),void this.httpController.stop(t);if(e.state.resources.get(t).mod===s)return void this.allocateBlocks(t);if(!e.config.XHR_ALLOW_RANGE)return void this.aggressiveHTTPDownloadFull(t);var i;i=e.config.SEQUENTIAL_DOWNLOAD?this.relaxedHTTPDownload(t):this.relaxedHTTPDownloadRandomly(t),0===i&&(e.config.SEQUENTIAL_DOWNLOAD?this.aggressiveHTTPDownload(t):this.aggressiveHTTPDownloadRandomly(t))}},this]),radio("xhrRangeFailed").subscribe([function(t){e.warn("XHR Range failed for url: "+t),this.stopResource(t),this.init(t),this.aggressiveHTTPDownloadFull(t)},this])},removeResource:function(t){var r=n.getSwarmId(t);r?this.P2PController.removeResource(r):e.info("not removing p2p resource "+t+" - no swarmId"),this.httpController.removeResource(t),delete this.nonFullResources[t],delete this.resourceState[t],delete this.lastBlockRequestedInP2P[t]},stopResource:function(t){this.resourceState[t]=i.STOPPED,delete this.nonFullResources[t];var r=n.getSwarmId(t);r?this.P2PController.stopResource(r):e.info("not stopping p2p resource "+t+" -  no swarmId"),this.httpController.stopResource(t)},download:function(t,i,s){if(this.isAvailable(t)){var u=r.get(t);if(!u.isFull()){if(i||0===i||(i=u.getMissingBlock()),s||0===s||(s=u.getNumOfBlocks()-1),i>u.getNumOfBlocks()-1||s>u.getNumOfBlocks()-1)return void e.warn("out of range");var c=i;i=u.getMissingBlock(),c<i&&radio("blockReceived").broadcast(t,e.config.BLOCK_SIZE);var l=e.state.resources.get(t);if(l.mod!==a&&!e.config.XHR_ALLOW_RANGE)return void this.aggressiveHTTPDownloadFull(t);if(l.mod===o)return void(e.config.SEQUENTIAL_DOWNLOAD?this.aggressiveHTTPDownload(t,i,s):this.aggressiveHTTPDownloadRandomly(t,i,s));this.P2PController.isAvailable(n.getSwarmId(t))&&(e.config.SEQUENTIAL_DOWNLOAD?this.relaxedP2PDownload(t,i,s):this.relaxedP2PDownloadRandomly(t,i,s)),this.httpController.isAvailable(t)&&(e.config.SEQUENTIAL_DOWNLOAD?this.relaxedHTTPDownload(t,i,s):this.relaxedHTTPDownloadRandomly(t,i,s))}}},blockAllocationCron:function(){for(var e=Object.keys(this.nonFullResources),t=0,n=e.length;t<n;t++){var a=e[t];if(this.resourceState[a]===i.LOADING){var o=r.get(a);if(o.isFull())delete this.nonFullResources[a];else{var s=o.getMissingBlock(),u=o.getNumOfBlocks()-1;this.allocateBlocks(e[t],s,u)}}}},dynamicDownload:function(t,n,r,i){"number"!=typeof i&&e.warn("HybridController::allocateBlocks: constraint is not defined:"+i),this.nonFullResources[t]=i,this.allocateBlocks(t,n,r)},allocateBlocks:function(t,r,i){var a=performance.now(),o=e.state.resources.get(t),s=o?o.constraint:null,u=o?o.httpConstraint:null;if("number"!=typeof s)return void e.warn("constraint is not a number for resource "+t);var c=n.getSwarmId(t),l=o?o.hashUrl:null;if(e.config.HTTP_FETCH_AHEAD){var d=this.P2PController.numOfSeeders(c,l);if(d<e.config.FETCH_AHEAD_MIN_SEEDERS)return e.info("seeders < MIN_SEEDERS, fetching ahead in http"+t),void(e.config.XHR_ALLOW_RANGE?this.aggressiveHTTPDownloadRandomly(t,r,i):this.aggressiveHTTPDownloadFull(t))}u||s-a<e.config.EXTERNAL_MINIMUM_HTTP_CONSTRAINT?(e.config.XHR_ALLOW_RANGE?this.aggressiveHTTPDownloadRandomly(t,r,i):this.aggressiveHTTPDownloadFull(t),e.config.PARALLEL_HTTP_AND_P2P===!0&&this.aggressiveP2PDownloadRandomly(t,r,i)):this.relaxedP2PDownloadRandomly(t,r,i)},relaxedHTTPDownload:function(i,a,o){var s=r.get(i);a||0===a||(a=s.getFirstMissingBlock()),o||0===o||(o=s.getNumOfBlocks()-1);var u=this.getSeqBlocks(i,e.config.XHR_MAX_GET,function(e){return e>=a&&e<=o&&s.isEmpty(e)&&!t.isBlockPending(i,e)&&!t.isBlockPending(n.getSwarmId(i),e)});return 0===u.length?0:(e.info("downloading in relaxed http: "+i),this.httpController.download(i,u[0],u[u.length-1]),u[u.length-1]-u[0]+1)},aggressiveHTTPDownload:function(n,i,a){var o=r.get(n);i||0===i||(i=o.getFirstMissingBlock()),a||0===a||(a=o.getNumOfBlocks()-1);var s=this.getSeqBlocks(n,e.config.XHR_MAX_GET,function(e){return e>=i&&e<=a&&!t.isBlockPending(n,e)});return 0===s.length?0:(e.info("downloading in aggressive http: "+n),this.httpController.download(n,s[0],s[s.length-1]),s[s.length-1]-s[0]+1)},relaxedHTTPDownloadRandomly:function(i,a,o){var s=r.get(i);a||0===a||(a=s.getFirstMissingBlock()),o||0===o||(o=s.getNumOfBlocks()-1);var u=this.getRarestBlocks(i,e.config.XHR_MAX_GET,function(e){return e>=a&&e<=o&&s.isEmpty(e)&&!t.isBlockPending(i,e)&&!t.isBlockPending(n.getSwarmId(i),e)}),c=e.core.util.longestSequence(u);return c.length>0&&(a=c[0],o=c[c.length-1],e.info("downloading in relaxed-random http: "+i),this.httpController.download(i,a,o)),c.length},aggressiveHTTPDownloadFull:function(n){if(!t.isFullResourcePending(n)){var i=r.get(n),a=0,o=i.getNumOfBlocks()-1,s=i.fileSize;return t.addFullResource(n,s),e.info("downloading in aggressive-full http: "+n),this.httpController.download(n,a,o),o-a+1}return 0},aggressiveHTTPDownloadRandomly:function(n,i,a){var o=r.get(n);i||0===i||(i=o.getFirstMissingBlock()),a||0===a||(a=o.getNumOfBlocks()-1);var s=this.getRarestBlocks(n,e.config.XHR_MAX_GET,function(e){return e>=i&&e<=a&&!o.has(e)&&!t.isBlockPending(n,e)}),u=e.core.util.longestSequence(s);return u.length>0&&(i=u[0],a=u[u.length-1],e.info("downloading in aggressive-random http: "+n),this.httpController.download(n,i,a)),u.length},relaxedP2PDownload:function(i,a,o,s){var u=r.get(i),c=n.getSwarmId(i);if(this.P2PController.isAvailable(c)){if(a||0===a||(a=u.getFirstMissingBlock()),o||0===o||(o=u.getNumOfBlocks()-1),a>u.getNumOfBlocks()-1||o>u.getNumOfBlocks()-1)return void e.warn("out of range");var l=a;for(a=this.lastBlockRequestedInP2P[i]&&!u.has(this.lastBlockRequestedInP2P[i])?this.lastBlockRequestedInP2P[i]:u.getFirstMissingBlock(),l<a&&radio("blockReceived").broadcast(i,e.config.BLOCK_SIZE);a<=o&&(t.isBlockPending(i,a)||this.P2PController.isPendingEntireBlock(c,a));)a++;for(var d,h=[],f=a;f<=o&&f<u.getNumOfBlocks()&&h.length<this.P2PController.getAvailableNumOfChunksToSend();++f)if(!t.isBlockPending(i,f)&&!this.P2PController.isPendingEntireBlock(c,f)){d=u.getChunkIdsOfBlock(f);for(var p=0;p<d.length;++p)u.hasOrPendingChunk(d[p])||h.push(d[p]);this.lastBlockRequestedInP2P[i]=f}return e.info("downloading in relaxed p2p: "+i),this.P2PController.distributeChunksAmongSources(c,h,s),h.length}},relaxedP2PDownloadRandomly:function(i,a,o,s){if(!r.has(i))return 0;var u=r.get(i);a||0===a||(a=u.getFirstMissingBlock()),o||0===o||(o=u.getNumOfBlocks()-1);var c=n.getSwarmId(i),l=this,d=function(e){return e>=a&&e<=o&&!u.has(e)&&!t.isBlockPending(i,e)&&!l.P2PController.isPendingEntireBlock(c,e)};e.info("downloading in relaxed-random p2p: "+i);var h=this.P2PController.download(c,s,d);return h},aggressiveP2PDownloadRandomly:function(t,i,a,o){if(!r.has(t))return 0;var s=r.get(t);i||(i=s.getFirstMissingBlock()),a||(a=s.getNumOfBlocks()-1);var u=n.getSwarmId(t),c=this,l=function(e){return e>=i&&e<=a&&!s.has(e)&&!c.P2PController.isPendingEntireBlock(u,e)};e.info("downloading in aggressive-random p2p: "+t);var d=this.P2PController.download(u,o,l);return d},init:function(t){var n=e.state.resources.get(t);if(!n)return void e.error("HybridController::init:no resource found: "+t);var r=n.mod,s=n.swarmId;e.info("initiating resource controllers: url="+t+" swarmId="+s+" mod="+r),this.resourceState[t]=i.LOADING,this.P2PController.init(s),r!==a&&this.httpController.init(t),r===o&&this.P2PController.stopResource(s)},isAvailable:function(e){return(this.P2PController.isAvailable(n.getSwarmId(e))||this.httpController.isAvailable(e))&&this.resourceState[e]&&!(this.resourceState[e]===i.STOPPED)},downloadPeriodicTest:function(e){this.resourceState[e]&&this.httpController.isAvailable(e)&&radio("HTTPAvailableEvent").broadcast(e)},stopHttp:function(e){this.httpController.stop(e)},getNumberOfConnectedPeers:function(){return Object.keys(this.P2PController.peerConnections).length},numOfSeeders:function(e,t){return this.P2PController.numOfSeeders(e,t)}})}()}).call(t,n(1))},function(e,t,n){(function(t){var r=n(80),i=n(2);e.exports=Object.subClass({ctor:function(e,t){this.id=e,this.signaller=t},connect:function(e,n,a){return i.PC_MOCK?r(this,e,n):new t.core.transport.PeerConnectionImpl(this,e,n,a)}})}).call(t,n(1))},function(e,t,n){(function(e){var t=n(19),r=n(4),i=n(5);!function(){e.client.MultiSlotManager=Object.subClass({ctor:function(t){this.url=t,this.xhrs=[],this.rampup=!0,this.progress=Object.create(null),this.createNewSlot(this.url),this.firstRequest=!0;var n=this;this.cronIntervalId=window.setInterval(function(){n.cron()},e.config.XHR_SLOT_PROBE_INTERVAL)},createNewSlot:function(n){if(e.config.XHR_CONCURRENT>=2)var r=n.indexOf("?")>-1?"&":"?";else var r="#";var i=t(),a=n+r+i,o=new e.client.HTTPDownloader(a,!0);this.xhrs.push(o),e.info("created new slot "+a),this.registerNewSlotEvents(a)},isHTTPBusy:function(){for(var e=0;e<this.xhrs.length;++e)if(!this.xhrs[e].isHTTPBusy())return!1;return!0},download:function(t,n){for(var r,a=0;a<this.xhrs.length;++a)if(!this.xhrs[a].isHTTPBusy()){r=this.xhrs[a];break}var o=e.state.resources.get(this.url);e.config.P2P_DOWNLOADING_MSG&&radio("p2p.send.all").broadcast(new i.DownloadingMessage(o.swarmId,o.hashUrl),"Downloading"),r.blockIds=Object.create(null);for(var a=t||0;a<(n||o.length);a+=e.config.BLOCK_SIZE){var s=Math.floor(a/e.config.BLOCK_SIZE);r.blockIds[s]=!0}r.download(t,n),this.isHTTPBusy()||radio("HTTPAvailableEvent").broadcast(this.url)},clearDownloadedBlock:function(t){for(var n=0;n<this.xhrs.length;++n){var r=this.xhrs[n];if(r.blockIds&&r.blockIds[t]===!0)return delete r.blockIds[t],void(r.xhr.busy&&e.core.util.isObjectEmpty(r.blockIds)&&(this.unregisterSlotEvents(r.url),r.stop(),this.unregisterAbortEvent(r.url)))}},stop:function(){for(var e=0;e<this.xhrs.length;++e){var t=this.xhrs[e].url;this.unregisterSlotEvents(t),this.xhrs[e].stop(),this.unregisterAbortEvent(t)}window.clearInterval(this.cronIntervalId)},registerNewSlotEvents:function(e){radio("bytesReceivedEvent"+e).subscribe([this.onBytesReceivedEvent,this]),radio("xhrFailed"+e).subscribe([this.onXhrFailed,this]),radio("xhrTimeout"+e).subscribe([this.onXhrTimeout,this]),radio("xhrBytesReceived"+e).subscribe([this.onXhrBytesReceived,this]),radio("httpDownloaded"+e).subscribe([this.onHttpDownloaded,this]),radio("onprogressEvent"+e).subscribe([this.onprogressEvent,this]),radio("xhrSent"+e).subscribe([this.onXhrSent,this]),radio("xhrComplete"+e).subscribe([this.onXhrComplete,this]),radio("xhrRetry"+e).subscribe([this.onXhrRetry,this]),radio("xhrAbort"+e).subscribe([this.onXhrAbort,this])},unregisterSlotEvents:function(e){radio("bytesReceivedEvent"+e).unsubscribe([this.onBytesReceivedEvent,this]),radio("xhrFailed"+e).unsubscribe([this.onXhrFailed,this]),radio("xhrTimeout"+e).unsubscribe([this.onXhrTimeout,this]),radio("xhrBytesReceived"+e).unsubscribe([this.onXhrBytesReceived,this]),radio("httpDownloaded"+e).unsubscribe([this.onHttpDownloaded,this]),radio("onprogressEvent"+e).unsubscribe([this.onprogressEvent,this]),radio("xhrSent"+e).unsubscribe([this.onXhrSent,this]),radio("xhrComplete"+e).unsubscribe([this.onXhrComplete,this]),radio("xhrRetry"+e).unsubscribe([this.onXhrRetry,this])},unregisterAbortEvent:function(e){radio("xhrAbort"+e).unsubscribe([this.onXhrAbort,this])},onBytesReceivedEvent:function(e){this.firstRequest=!1,e.url=this.url,radio("bytesReceivedEvent").broadcast(e)},onXhrFailed:function(t){var n=t.url;e.info("failed xhr: "+this.url+" start: "+t.startRange+" end: "+t.endRange),this.rampup=!1;for(var r=this.xhrs[0]&&this.xhrs[0].url===n&&t.isRange&&this.firstRequest,i=0;i<this.xhrs.length;++i)if(this.xhrs[i]&&this.xhrs[i].url===n){var a=this.xhrs.splice(i,1)[0];this.unregisterSlotEvents(n),a.stop(),this.unregisterAbortEvent(n),e.info("removed slot "+n);break}r?radio("xhrRangeFailed").broadcast(this.url):radio("xhrFailed"+this.url).broadcast(t)},onXhrTimeout:function(e){radio("xhrFailed"+this.url).broadcast(e)},onXhrRetry:function(){r.sum(this.url,{internalHTTPTimeouts:1})},onXhrBytesReceived:function(e,t){radio("xhrBytesReceived").broadcast(this.url,t)},onHttpDownloaded:function(e,t){radio("httpDownloaded").broadcast(this.url,t)},onXhrAbort:function(e,t){var n=e.loaded;n>0&&radio("httpAborted").broadcast(this.url,n),radio("xhrAbort"+this.url).broadcast(e,t)},onprogressEvent:function(t){!this.progress[t]&&this.rampup&&this.xhrs.length<e.config.XHR_CONCURRENT&&(this.createNewSlot(this.url),this.progress[t]=!0,radio("HTTPAvailableEvent").broadcast(this.url)),radio("httpProgress").broadcast(this.url)},onXhrSent:function(){radio("xhrSent").broadcast(this.url)},onXhrComplete:function(e){radio("xhrComplete").broadcast(this.url,e)},cron:function(){this.xhrs.length<e.config.XHR_CONCURRENT&&(this.createNewSlot(this.url),radio("HTTPAvailableEvent").broadcast(this.url))}})}()}).call(t,n(1))},function(e,t,n){var r=n(5),i=n(4);e.exports=Object.subClass({ctor:function(e){this.ws=e},groupSdp:function(e,t,n){var a=new r.GroupSdpMessage(e,t,n);return i.sumGlobal({sdpMessagesSent:1}),this.ws.sendMessage(a),a}})},function(e,t,n){"use strict";function r(e){this.name="UnknownError",this.message=e||"Internal error?",this.stack=(new Error).stack}function i(e,t,n){var i="string"==typeof n?{message:n}:n,o=e||new r(i.message);return a.captureException(o,{level:t,extra:i})}var a=n(151),o=n(16),s=n(2);r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,s.SENTRY_APP_URL&&a.config(s.SENTRY_APP_URL,{release:"0.72.2",shouldSendCallback:function(){return Math.random()<=s.SENTRY_THROTTLE_FACTOR},tags:{token:o(),abConfig:s.A_B_CONFIG_JSON}}),e.exports={trackError:function(e,t){s.SENTRY_APP_URL&&i(e,"error",t)},trackWarning:function(e,t){s.SENTRY_APP_URL&&i(e,"warning",t)}}},function(e,t,n){(function(e){!function(e){function t(){function e(e){n[e]=!0}function t(e){return!!n[e]}var n=Object.create(null);return{addUrl:e,contains:t}}e.FailedUrls=t()}(e.client)}).call(t,n(1))},function(e,t,n){(function(e){!function(){var t=window.GoogleAnalyticsObject||"__ga__",n=t;Object.defineProperty(window,"GoogleAnalyticsObject",{get:function(){return n},set:function(e){e!==n&&(n=e,window[t]&&window[t].q&&(window[e]=window[t],t=n))}}),function(e,t,n,r,i,a,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(n),o=t.getElementsByTagName(n)[0],a.async=1,a.src=r,o.parentNode.insertBefore(a,o)}(window,document,"script","//www.google-analytics.com/analytics.js",n),e.gaManager=function(){e.config.DISABLE_GOOGLE_ANALYTICS||(window[t]("create","UA-37859248-1",{name:"peer5",sampleRate:e.config.GOOGLE_SAMPLING_RATIO}),window[t]("peer5.send","pageview"),window[t]("peer5.set","dimension2",e.config.EXTERNAL_XHR_FALLBACK),e.config.DISABLE_GOOGLE_EVENTS||this.registerEvents())},e.gaManager.prototype={registerEvents:function(){radio("scriptLoaded").subscribe([function(){e.info("script loaded "+Date.now()),window[t]("peer5.send","event","script","loaded")},this]),radio("scriptValidated").subscribe([function(n){n?(e.info("script passed validated"),window[t]("peer5.send","event","script","browser passed validation")):(e.info("script failed validation"),window[t]("peer5.send","event","script","browser failed validation"))},this]),radio("unhandledError").subscribe([function(e,n,r){window[t]("peer5.send","event","unhandled errors",e,n,r)},this]),radio("fileVerificationFailed").subscribe([function(){window[t]("peer5.send","event","errors","file verification failed")},this]),radio("peer5error").subscribe([function(e){window[t]("peer5.send","event","peer5error",e)},this]),radio("external.player").subscribe([function(e){window[t]("peer5.send","event","player",e.action,e.label,e.value)},this]),radio("mediaElementWrapperFailure").subscribe(function(e,n){window[t]("peer5.send","event","failure",e,n,0)}),radio("resumeStarted").subscribe([function(){e.info("resume started "+Date.now()),window[t]("peer5.send","event","storage","resume started")},this]),radio("resumeEnded").subscribe([function(){e.info("resume ended "+Date.now()),window[t]("peer5.send","event","storage","resume ended")},this]),radio("requestedPersQuota").subscribe([function(){e.info("requested persistent quota event"),window[t]("peer5.send","event","user","prompt persistent quota")},this]),radio("persQuotaAnswer").subscribe([function(n){n?(e.info("user has approved using persistent quota"),window[t]("peer5.send","event","user","approved persistent quota")):(e.info("user has denied using persistent quota"),window[t]("peer5.send","event","user","denied persistent quota"))},this]),radio("persQuotaTimeout").subscribe([function(){window[t]("peer5.send","event","user","persistent quota timed out")},this]),radio("offlineStorageError").subscribe([function(e){window[t]("peer5.send","event","errors","offline storage",e)},this]),radio("usingFileSystem").subscribe([function(e){window[t]("peer5.send","event","cacheMethod","filesystem","fileSize",e)},this]),radio("usingMemory").subscribe([function(e){window[t]("peer5.send","event","cacheMethod","memory","fileSize",e)},this]),radio("outOfMemoryError").subscribe([function(e){window[t]("peer5.send","event","errors","out of memory","heap size",e)},this])}},radio("loadedDynamicConfig").subscribe(function(){e.gaManager=new e.gaManager})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(){var t=[{key:e.config.FEATURE_DATACHANNEL_KEY,enabled:e.config.FEATURE_DATACHANNEL_ENABLED,initialized:!1,initFunction:function(e,t){var n=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r="stun:stun.l.google.com:19302",i={iceServers:[{urls:r}]};try{var a=new n(i),o=a.createDataChannel("test_data_channels",{});o.close(),a.close()}catch(e){return t()}e()}},{key:e.config.FEATURE_PAGE_WHITELIST_KEY,enabled:e.config.FEATURE_PAGE_WHITELIST_ENABLED,initialized:!1,initFunction:function(t,n){return null!==document.location.href.match(e.config.FEATURE_PAGE_WHITELIST_REGEX)?t():n()}},{key:e.config.FEATURE_PAGE_BLACKLIST_KEY,enabled:e.config.FEATURE_PAGE_BLACKLIST_ENABLED,initialized:!1,initFunction:function(t,n){return null!==document.location.href.match(e.config.FEATURE_PAGE_BLACKLIST_REGEX)?t():n()}},{key:e.config.FEATURE_XHR_KEY,enabled:e.config.FEATURE_XHR_ENABLED,initialized:!1,initFunction:function(e,t){return window.XMLHttpRequest?e():t()}},{key:e.config.FEATURE_PEER5_KEY,enabled:e.config.FEATURE_PEER5_ENABLED,initialized:!1,initFunction:function(t,n){return(e.feature.isDisabled(e.config.FEATURE_PAGE_WHITELIST_KEY)||e.feature.isEnabledAndInitialized(e.config.FEATURE_PAGE_WHITELIST_KEY))&&!e.feature.isEnabledAndInitialized(e.config.FEATURE_PAGE_BLACKLIST_KEY)&&e.feature.isEnabledAndInitialized(e.config.FEATURE_XHR_KEY)?t():n()}}];t.forEach(e.feature.add)}function r(){e.feature=e.featureToggle.create()}t.init=function(){r(),n()},t.init()}(e)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(){function t(t){return t.httpConstraint===!0?(e.info("resource is within critical zone, init by download "+t.url),r):e.config.HTTP_FETCH_AHEAD&&0===e.clientInstance.controller.getNumberOfConnectedPeers()?(e.info("not connected to any peers, init by download "+t.url),r):e.config.HTTP_INIT_AHEAD?e.clientInstance.controller.numOfSeeders(null,t.hashUrl)<e.config.HTTP_INIT_AHEAD_MIN_SEEDERS?e.config.USE_HEAD?(e.info("not enough seeders, init by head "+t.url),i):(e.info("not enough seeders, init by download "+t.url),r):e.config.USE_HEAD?(e.info("enough seeders, init by head "+t.url),i):(e.info("enough seeders, wait for init by peers "+t.url),a):e.config.USE_HEAD?(e.info("default, init by head "+t.url),i):(e.info("default, wait for init by peers "+t.url),a)}return{chooseMethod:t}}var r="download",i="head",a="wait";t.initDecider=n()}(e.client)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(20),r=n(7);!function(n){function i(t,n){var r=e.core.util.ManifestManipulator(t),i=r.delayManifest(n);return i}function a(n){function a(t){if(t&&"string"==typeof t&&t.indexOf(".m3u8")===-1){o=!0;var n=i(t,e.config.LIVE_SECONDS_DELAY);return n}return t}var s=new r;return s.open("GET",n._url),o?t(s,n):t(s,n,a),s}var o=!1;n.createManifestRequest=a,n.setDelayedAlready=function(e){o=e}}(e.client)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(2),r=n(4),i=n(5),a=n(8),o=n(10);!function(n){function s(n,s,u){function c(e,t){radio("xhrBytesReceived").broadcast(e,t)}function l(e,t){P+=t,radio("httpDownloaded").broadcast(e,t)}function d(){radio("httpProgress").broadcast(n)}function h(){radio("xhrSent").broadcast(n)}function f(){radio("xhrComplete").broadcast(n)}function p(e){var t=e.url,n=e.loaded;n>0&&(P-=n,I+=n,radio("httpAborted").broadcast(t,n))}function g(t){e.core.dataStructures.PendingBlockMap.removeResource(n),e.info("received bytes "+n),radio("bytesReceivedEvent"+n).unsubscribe(g),radio("xhrBytesReceived"+n).unsubscribe(c),radio("httpDownloaded"+n).unsubscribe(l),radio("onprogressEvent"+n).unsubscribe(d),radio("xhrComplete"+n).unsubscribe(f),radio("xhrFailed"+n).unsubscribe(y),radio("xhrTimeout"+n).unsubscribe(y),radio("xhrRetry"+n).unsubscribe(R),radio("xhrAbort"+n).unsubscribe(p),radio("xhrSent"+n).unsubscribe(h),radio("stopHttpInit"+n).unsubscribe(m),radio("bytesReceivedEvent").broadcast(t),w.stop(),s&&(s.preventDownload=!1)}function v(r){e.info("received bytes "+n),radio("bytesReceivedEvent"+n).unsubscribe(v),radio("xhrFailed"+n).unsubscribe(y),radio("xhrTimeout"+n).unsubscribe(y),radio("xhrRetry"+n).unsubscribe(R),radio("xhrAbort"+n).unsubscribe(p),radio("xhrSent"+n).unsubscribe(h),radio("stopHttpInit"+n).unsubscribe(m);var a=new o.ArrayBuffer;a.append(r.dataArray),a.append(new Uint8Array(t.VERSION.split(""))),a.append(new Uint8Array(s.length.toString().split(""))),t.A_B_INITIAL_JSON&&!t.AB_TEST_TOGETHER&&a.append(new Uint8Array(t.A_B_INITIAL_JSON.split("")));var c=a.end();e.info("SwarmId for url: "+n+" is: "+c),s.hashUrl=o.hash(n);var l=new i.FileInfoMessage(c,s.length,null,null,t.BLOCK_SIZE,n);u(l,P,I)}function m(){e.info("stopping httpDownloader init "+n),A&&clearTimeout(A),radio("responseLengthReceived"+n).unsubscribe(T),radio("responseHeadersReceived"+n).unsubscribe(S),radio("xhrFailed"+n).unsubscribe(y),radio("xhrTimeout"+n).unsubscribe(y),radio("xhrRetry"+n).unsubscribe(R),radio("xhrSent"+n).unsubscribe(h),radio("bytesReceivedEvent"+n).unsubscribe(v),radio("bytesReceivedEvent"+n).unsubscribe(g),radio("xhrBytesReceived"+n).unsubscribe(c),radio("httpDownloaded"+n).unsubscribe(l),radio("onprogressEvent"+n).unsubscribe(d),radio("xhrComplete"+n).unsubscribe(f),radio("stopHttpInit"+n).unsubscribe(m),w&&w.stop(),radio("xhrAbort"+n).unsubscribe(p),s&&delete s.preventDownload}function _(){var e=new i.FileInfoMessage(s.md5,s.length,s.md5,null,t.BLOCK_SIZE,n);u(e,P,I),s.length>t.SMALL_FILE_SIZE&&w.stop()}function E(){"download"===O?(e.core.dataStructures.PendingBlockMap.addFullResource(n,s.length),4===s.mod&&t.PARALLEL_HTTP_AND_P2P!==!1||(s.preventDownload=!0),radio("xhrFailed"+n).subscribe(y),radio("xhrTimeout"+n).subscribe(y),radio("xhrRetry"+n).subscribe(R),radio("xhrAbort"+n).subscribe(p),radio("xhrSent"+n).subscribe(h),radio("bytesReceivedEvent"+n).subscribe(g),radio("xhrBytesReceived"+n).subscribe(c),radio("xhrComplete"+n).subscribe(f)):radio("stopHttpInit"+n).unsubscribe(m);var r=a.swarmId(n),l=s.length+r+t.VERSION;e.config.A_B_INITIAL_JSON&&!t.AB_TEST_TOGETHER&&(l+=t.A_B_INITIAL_JSON);var d=o.hash(l);e.core.util.UrlSwarmIdMap.addMapping(n,d),e.info("SwarmId for url: "+n+" is: "+d);var v=new i.FileInfoMessage(d,s.length,null,null,t.BLOCK_SIZE,n);u(v,P,I),t.P2P_DOWNLOADING_MSG&&radio("p2p.send.all").broadcast(new i.DownloadingMessage(d,s.hashUrl),"Downloading")}function b(){w&&w.stop(),w=new e.client.HTTPDownloader(n),radio("xhrFailed"+n).subscribe(y),radio("xhrTimeout"+n).subscribe(y),radio("xhrRetry"+n).subscribe(R),radio("xhrAbort"+n).subscribe(p),radio("xhrSent"+n).subscribe(h),radio("bytesReceivedEvent"+n).subscribe(v),radio("httpDownloaded"+n).unsubscribe(l),w.download(0,t.CHUNKY_HEAD_LENGTH)}function S(t){s.state>=1&&e.warn("receiveHeaders but resource is already initiated"),radio("responseHeadersReceived"+n).unsubscribe(S),"head"===O&&(radio("xhrFailed"+n).unsubscribe(y),radio("xhrTimeout"+n).unsubscribe(y),radio("xhrRetry"+n).unsubscribe(R),radio("xhrAbort"+n).unsubscribe(p));var r=e.core.util.parseResponseHeaders(t);radio("HTTPHeadersReceived"+n).broadcast(n,t,r),r["content-md5"]&&(s.md5=r["content-md5"]);var i=e.core.util.parseResponseLengthHeader(r["content-range"],r["content-length"]);i&&T(i)}function T(r){return s.length?void e.warn("received length for resource that already has length, skipping "+n):(A&&clearTimeout(A),radio("responseHeadersReceived"+n).unsubscribe(S),radio("responseLengthReceived"+n).unsubscribe(T),radio("xhrFailed"+n).unsubscribe(y),radio("xhrTimeout"+n).unsubscribe(y),radio("xhrRetry"+n).unsubscribe(R),radio("xhrAbort"+n).unsubscribe(p),radio("xhrSent"+n).unsubscribe(h),s.length=r,!t.USE_FS&&s.length>t.ALLOWED_FILE_SIZE?void radio("removeResource").broadcast(n,e.Request.FILE_SIZE_ERR,"file size too big"):s.md5?void _():s.length<=t.SMALL_FILE_SIZE?void E():void b());
}function y(e){A&&clearTimeout(A),radio("responseLengthReceived"+n).unsubscribe(T),radio("responseHeadersReceived"+n).unsubscribe(S),radio("xhrFailed"+n).unsubscribe(y),radio("xhrTimeout"+n).unsubscribe(y),radio("xhrRetry"+n).unsubscribe(R),radio("xhrAbort"+n).unsubscribe(p),radio("xhrSent"+n).unsubscribe(h),radio("bytesReceivedEvent"+n).unsubscribe(v),radio("bytesReceivedEvent"+n).unsubscribe(g),radio("xhrBytesReceived"+n).unsubscribe(c),radio("httpDownloaded"+n).unsubscribe(l),radio("onprogressEvent"+n).unsubscribe(d),radio("xhrComplete"+n).unsubscribe(f),radio("stopHttpInit"+n).unsubscribe(m),radio("removeResource").broadcast(n,e.status,"xhr failed or timed out")}function R(){r.sum(n,{internalHTTPTimeouts:1})}var w,P=0,I=0,A=null,C=e.core.util.HashUrlLengthMap.getLength(s.hashUrl);if(!C||t.USE_HEAD||t.IGNORE_LENGTH){var O="download";switch(4===s.mod?O=e.client.initDecider.chooseMethod(s):2===s.mod&&(O=t.USE_HEAD||"preload"===s.origin||0===e.clientInstance.controller.getNumberOfConnectedPeers()?"head":"wait"),radio("responseLengthReceived"+n).subscribe(T),radio("stopHttpInit"+n).subscribe(m),O){case"head":e.info("initializing resource with HEAD: "+n),radio("responseHeadersReceived"+n).subscribe(S),radio("xhrFailed"+n).subscribe(y),radio("xhrTimeout"+n).subscribe(y),radio("xhrRetry"+n).subscribe(R),radio("xhrAbort"+n).subscribe(p),radio("xhrSent"+n).subscribe(h),w=new e.client.HTTPDownloader(n,!1),w.head();break;case"download":e.info("initializing resource with GET: "+n),radio("responseHeadersReceived"+n).subscribe(S),radio("xhrFailed"+n).subscribe(y),radio("xhrTimeout"+n).subscribe(y),radio("xhrRetry"+n).subscribe(R),radio("xhrAbort"+n).subscribe(p),radio("xhrSent"+n).subscribe(h),radio("onprogressEvent"+n).subscribe(d),radio("httpDownloaded"+n).subscribe(l),w=new e.client.HTTPDownloader(n,!1),w.download();break;case"wait":if(C&&t.IGNORE_LENGTH)e.info("Decided to wait, initializing resource with pre-saved length: "+n),T(C);else if("undefined"!=typeof s.constraint){var k=s.constraint-t.EXTERNAL_MINIMUM_HTTP_CONSTRAINT-performance.now();e.info("waiting for up to "+k+"ms for peers to initialize resource: "+n),A=setTimeout(function(){s.length||(O="download",e.info("timed-out waiting for peers to initialize resource: "+n),radio("responseHeadersReceived"+n).subscribe(S),radio("xhrFailed"+n).subscribe(y),radio("xhrTimeout"+n).subscribe(y),radio("xhrRetry"+n).subscribe(R),radio("xhrAbort"+n).subscribe(p),radio("xhrSent"+n).subscribe(h),radio("onprogressEvent"+n).subscribe(d),radio("httpDownloaded"+n).subscribe(l),w=new e.client.HTTPDownloader(n,!1),w.download(),radio("p2p.send.all").broadcast(new i.InitializingMessage(s.hashUrl),"Initializing"))},k)}else e.error("waiting forever for peers to initialize resource: "+n);return}radio("p2p.send.all").broadcast(new i.InitializingMessage(s.hashUrl),"Initializing")}else e.info("initializing resource with pre-saved length: "+n),T(C)}n.getHttpMeta=s}(e.client)}).call(t,n(1))},function(e,t){"use strict";function n(e,t){function n(){if(p)return[];if(g)return[];b++,p=Date.now();var e=Date.now()-m,t={action:"rebuffer.start",label:"playback",timeSinceLoaded:e,id:h,vendor:f,occurrence:b};return[t]}function r(){S++,g=Date.now();var e=Date.now()-m,t={action:"seek.start",label:"seek",timeSinceLoaded:e,id:h,vendor:f,occurrence:S};return[t]}function i(){var e=Date.now();if(!v){v=e;var t={action:"load.start",label:"load",id:h,vendor:f};return E&&(E=!1,_&&(t.timeSinceReady=e-_)),[t]}return[]}function a(){var e=Date.now();if(v){var t=e-v;v=null;var n={action:"load.end",label:"load",duration:t,id:h,vendor:f};return m=e,[n]}return[]}function o(){var e=Date.now();if(p){var t=e-p;p=null;var n=e-m,r={action:"rebuffer.end",label:"playback",timeSinceLoaded:n,duration:t,id:h,vendor:f,occurrence:b};return[r]}if(g){var t=e-g;g=null;var n=e-m,i={action:"seek.end",label:"seek",timeSinceLoaded:n,duration:t,id:h,vendor:f,occurrence:S};return[i]}return[]}function s(){_=Date.now(),E=!0;var e={action:"ready",label:"ready",id:h,vendor:f};return[e]}function u(){T=!0;var e={action:"pause.start",label:"pause",id:h,vendor:f};return[e]}function c(){var e={action:"stop",label:"stop",id:h,vendor:f};return[e]}function l(){T=!1;var e={action:"pause.end",label:"pause",id:h,vendor:f};return[e]}function d(e){var t=[];switch(e){case"ready":t=s();break;case"buffer":t=n();break;case"seek":t=r();break;case"loadStart":t=i();break;case"loadEnd":t=a();break;case"pause":t=u();break;case"stop":t=c();break;case"play":t=l();break;case"resume":t=o();break;default:console.error("unrecognized action:"+e)}return t}var h=e,f=t,p=null,g=null,v=null,m=null,_=null,E=!0,b=0,S=0,T=!0;return{getEvents:d}}e.exports=n},function(e,t,n){(function(e){!function(t){function n(t,n){t.response=n,""!==t.responseType&&"text"!==t.responseType||(t.responseText=n),t.readyState=4,t.responseURL=t._url,t.status=200;for(var r={currentTarget:t,target:t,lengthComputable:!0,loaded:n.length,loadedFS:0,loadedHTTP:n.length,loadedP2P:0,total:n.length},i=0;i<t.eventListeners.readystatechange.length;i++){var a=t.eventListeners.readystatechange[i];e.core.util.envokeCallback(a,[r],t)}e.core.util.envokeCallback(t.onreadystatechange,[r],t);for(var i=0;i<t.eventListeners.load.length;i++){var a=t.eventListeners.load[i];e.core.util.envokeCallback(a,[r],t)}e.core.util.envokeCallback(t.onload,[r],t);for(var i=0;i<t.eventListeners.loadend.length;i++){var a=t.eventListeners.loadend[i];e.core.util.envokeCallback(a,[r],t)}e.core.util.envokeCallback(t.onloadend,[r],t)}t.bypassServer=n}(e.client)}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(5),i=n(4);e.exports=Object.subClass({ctor:function(e){this.ws=e},groupReport:function(e){var n=new r.GroupReportMessage(e),i=Date.now()+t.config.REPORT_TTL_MS;return this.ws.sendMessage(n,function(){return Date.now()<i}),n},join:function(e,t){var n=new r.JoinMessage(e,t);return i.sumGlobal({joinMessagesSent:1}),this.ws.sendMessage(n,!0),n},leech:function(e){var t=new r.LeechMessage(e);return this.ws.sendMessage(t,!0),t},share:function(e,t,n,i,a,o){var s=new r.ShareMessage(e,t,n,i,a,o);return this.ws.sendMessage(s,!0),s},leave:function(e){var t=new r.LeaveMessage(e);return i.sumGlobal({leaveMessagesSent:1}),this.ws.sendMessage(t,!0),t},updateABConfig:function(e){var t=new r.ABConfigMessage(e);return this.ws.sendMessage(t,!0),t},sessionReport:function e(t){var e=new r.SessionReport(t);return this.ws.sendMessage(e,!0),e}})}).call(t,n(1))},function(e,t,n){(function(e){!function(){e.core.apiValidators.ApiValidator=Object.subClass({ctor:function(t){var n=this.detectBrowser();this.browserName=n[0].toLowerCase(),this.browserVersion=n[1],this.validators={},this.validity={},e.browserName=this.browserName,e.browserVersion=this.browserVersion;for(var r in t)this.validators[r]=new t[r](this.browserName,this.browserVersion),this.validity[r]=!1},detectBrowser:function(){var e,t=navigator.appName,n=navigator.userAgent,r=n.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return r&&null!=(e=n.match(/version\/([\.\d]+)/i))&&(r[2]=e[1]),r=r?[r[1],r[2]]:[t,navigator.appVersion,"-?"],r&&r[0]&&"Netscape"===r[0]&&(r[0]="msie"),r},validate:function(){var t=!0;switch(this.browserName){case"chrome":if(e.config.DISABLE_CHROME)return!1;break;case"firefox":if(e.config.DISABLE_FIREFOX)return!1}for(var n in this.validators)t=t&&this.validators[n].validate();return t},getBrowser:function(){return{name:this.browserName,version:this.browserVersion}},getStatus:function(){var e={};for(var t in this.validators)e[t]=this.validators[t].status;return e}})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(){e.core.apiValidators.ApiValidatorBase=Object.subClass({ctor:function(){this.status=!1}})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(){e.core.apiValidators.DataChannelsApiValidator=e.core.apiValidators.ApiValidatorBase.subClass({ctor:function(e,t){this._super(),this.browserName=e,this.browserVersion=t},validate:function(){var e,t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=!0;try{var r="stun:stun.l.google.com:19302",i={iceServers:[{urls:r}]};e=new t(i),e.createDataChannel("test_data_channels",{ordered:!1,maxRetransmits:0})}catch(e){n=!1}return e&&e.close(),n||radio("browserUnsupported").broadcast(this.browserName,this.browserVersion,"data channels"),this.status=n,n}})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(){e.core.apiValidators.FileSystemApiValidator=e.core.apiValidators.ApiValidatorBase.subClass({ctor:function(e,t){this._super(),this.browserName=e,this.browserVersion=t},validate:function(){if(0==e.config.USE_FS)return!0;var t=this;return"firefox"==this.browserName?(e.config.ALLOWED_FILE_SIZE=e.config.ALLOWED_FILE_SIZE_FF,e.config.IS_FIREFOX=!0,!e.config.USE_PERSISTENT||e.config.DISABLE_FS_FF?e.config.USE_FS=!1:window.indexedDB&&window.indexedDB.open?e.core.data.FSio=new e.core.data.FSioFireFox(function(n){n||(e.info("changing USE_FS to false"),t.status=!1,e.config.USE_FS=!1)}):e.config.USE_FS=!1):window.webkitRequestFileSystem&&navigator.webkitTemporaryStorage?(e.core.data.FSio.requestTempQuota(100,function(n){n||(e.info("changing USE_FS to false"),t.status=!1,e.config.USE_FS=!1)}),e.config.IS_CHROME=!0):e.config.USE_FS=!1,this.status=e.config.USE_FS,!0}})}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(13),r=n(20),i=n(4),a=n(5),o=n(7),s=(n(8),n(9)),u=n(2),c=t.HYBRID,l=t.P2P,d=t.HTTP,h=t.DYNAMIC;!function(t){e.core.apis.MediaFetcher=Object.subClass({ctor:function(){this.segmentsInfo=Object.create(null),this.interceptRequests=Object.create(null),this.playlistsHandler=e.core.playlist.PlaylistsHandler(),this.playlistsCache=e.core.util.createPlaylistCache(),this.segmentsPrefetcher=null,this.prePlaySegmentsPrefetcher=null,this.requests=Object.create(null),this.numOfPeers=0,this.httpPendingRequests=0,this.p2pPendingRequests=0,this.peersHave=Object.create(null);var t=this;this.requestLRU=new e.core.dataStructures.LRU(null,function(){return t._scavange.apply(t,arguments)},function(){return t._requestCacheTester.apply(t,arguments)}),this.totalRequestSize=0,this.downloadSpeed=[0,0],this.playerStarted=!1,this.mediaController=new e.core.media.MediaController,this.playlistXhr=null,this.playlistXhrTimer=null,this.httpConstraintOn=!0,this.httpConstraintChanged=!1,this.firstRequestTimestamp=null,radio("requestSent").subscribe([this._interceptP5Request,this]),radio("activePeerConnectionsNumberChanged").subscribe([this._changeNumOfPeers,this]),radio("receivedHaveMessage").subscribe([this._handleHaveMessage,this]),radio("receivedDontHaveMessage").subscribe([this._handleDontHaveMessage,this]),radio("connectionFailed").subscribe([this._handleConnectionFail,this]),radio("external.prePlayPrefetch").subscribe([this._prePlayPrefetch,this]),radio("peerDiscoveredSegment").subscribe([this._handleDiscoveredSegment,this]),this._initPrefetchers()},_initPrefetchers:function(){var t=this,n={requestSwarmStateChanged:function(){return t._requestSwarmStateChanged.apply(t,arguments)},saveDownloadSpeed:function(){return t._saveDownloadSpeed.apply(t,arguments)},reportProgress:this.reportProgress,onP2PPrefetchComplete:function(){return t._prefetch.apply(t,arguments)},getSeeders:function(){return t._getSeeders.apply(t,arguments)}},r={playlistsHandler:this.playlistsHandler,prefetchSlotsHandler:e.core.util.PrefetchSlotsHandler(function(){return t._peersCount()}),prefetchSpeedEstimator:e.core.util.PrefetchSpeedEstimator(),playlistsCache:this.playlistsCache};this.segmentsPrefetcher=e.core.util.SegmentsPrefetcher(r,n),this.prePlaySegmentsPrefetcher=e.core.util.prePlayPrefetcher(r,n)},_peersCount:function(){return this.numOfPeers},_getSeeders:function(e){var t=s(e);return this.segmentsInfo[t]},_prePlayPrefetch:function(t){u.FEATURE_PRE_PLAY_PREFETCH&&e.VideoRequest!==o&&this.prePlaySegmentsPrefetcher.startPrefetch(t)},_interceptP5Request:function(t){if(!t.mediaPrefetch){var n=t._url,r=s(n);if(this.interceptRequests[r])e.config.PREFETCH_AFTER_MAXBUFFER&&(this.playerStarted=!0),this._interceptSegmentRequest(t);else if(t.isFragmentRequest)e.info("segment is not in known manifests "+n),e.config.PREFETCH_AFTER_MAXBUFFER&&(this.playerStarted=!0),this._interceptSegmentRequest(t),e.config.PREFETCH_AFTER_MAXBUFFER&&this.guessPlaylistOfUnknownSegment(n);else if(e.core.util.PlaylistParserFactory.isPlaylistCandidate(t)||t.isPlaylistRequest)this.prePlaySegmentsPrefetcher.stopPrefetch(),this.playerStarted=!0,this._interceptPlaylistRequest(t);else if(t.isVideoPlayerRequest){var i=t.fallbackToNative();i.send(),t.discontinue()}else e.info("didnt intercept: "+n)}},_interceptPlaylistRequest:function(t){this.firstRequestTimestamp||(this.firstRequestTimestamp=performance.now()),this.playlistXhr&&(this.playlistXhr.abort(),this.playlistXhr=null),this.playlistXhrTimer&&(clearInterval(this.playlistXhrTimer),this.playlistXhrTimer=null),e.info("Intercepted a playlist request"),t.discontinue();var n=this,r=t._url,i=this.playlistsCache.load(r);if(i)return void e.core.util.envokeCallback(function(){e.client.setDelayedAlready(!0),setTimeout(function(){n.playlistsCache.remove(r)},1e3),t.addEventListener("load",function(e){n._parsePlaylist(e,r)}),t.forceImmediateLoad(i)},null,this);t.addEventListener("load",function(e){var t=e.currentTarget.status;t<200||t>=300||n._cachePlaylist(e)});var a=e.client.createManifestRequest(t),o=a.onreadystatechange;if(a.onreadystatechange=function(e){var t=e.currentTarget.status;4===a.readyState&&t>=200&&t<300&&n._parsePlaylist(e,r),o&&o.apply(this,arguments)},a.send(),u.PLAYLIST_TIMEOUT){var s=u.PLAYLIST_TIMEOUT_DURATION;setTimeout(function(){a.readyState<4&&(e.info("playlist request timedout "+r),a.abort())},s)}},_interceptSegmentRequest:function(t){var n=this,i=t._url,a=s(i);e.info("intercepted an interesting request: "+i);var c=performance.now();if(this.firstRequestTimestamp||(this.firstRequestTimestamp=c),c-this.firstRequestTimestamp<u.SKIP_JOIN_MIN_TIME&&(t.skipJoin=!0),e.client.FailedUrls.contains(a)){var l=new o;return l.open("GET",i),r(l,t),l.addEventListener("load",function(e){n._onXhrLoad(t,e)}),l.send(),void t.discontinue()}u.FEATURE_P2P_IMPROVEMENT_ENABLED?this.segmentsPrefetcher.updatePlayerLastRequestedSegment(i):this.playlistsHandler.setLastRequestedSegment(i),t.addEventListener("load",function(){n._requestLoaded.apply(n,arguments)}),t.addEventListener("swarmstatechange",function(){n._requestSwarmStateChanged.apply(n,arguments)}),this._overrideInterceptedRequest(t),this._requestExist(i)?this._updateRequest(t,i):this._addRequest(t,i)},_onXhrLoad:function(t,n){var r=t._url;if(e.info("failed request "+r+" loaded"),2==parseInt(n.currentTarget.status/100)){this.playlistsHandler.deleteToSegment(r),this.playlistsHandler.setLastLoadedSegment(r);var i=this;setTimeout(function(){i._prefetchBoth()},10)}},_prefetchBoth:function(){this._prefetch("http"),this._prefetch("p2p")},_changeNumOfPeers:function(e){this.numOfPeers=e,this.reportProgress({type:"swarmChange",peers:e})},_handleHaveMessage:function(e,t){var n=e.hashUrl;this.segmentsInfo[n]||(this.segmentsInfo[n]=Object.create(null)),this.segmentsInfo[n][t]=!!e.seeder,this.peersHave[t]||(this.peersHave[t]=Object.create(null)),this.peersHave[t][n]=!0,this._prefetch("p2p")},_handleDontHaveMessage:function(t,n){var r=t.hashUrl;e.info("peer "+n+": dont have swarm with hashUrl - "+r),this.segmentsInfo[r]&&this.segmentsInfo[r][n]&&(delete this.segmentsInfo[r][n],delete this.peersHave[n][r])},_handleConnectionFail:function(e){if(this.peersHave[e]){for(var t=Object.keys(this.peersHave[e]),n=0,r=t.length;n<r;n++)delete this.segmentsInfo[t[n]][e];delete this.peersHave[e]}},_requestLoaded:function(t){var n=t.currentTarget._url;if(e.info("request "+n+" loaded"),this._decreasePendingRequests(t.currentTarget.downloadMode),this.reportProgress({type:"fileDownloaded",url:n,loaded:t.loaded,p2p:t.loadedP2P,http:t.loadedHTTP,waste:t.loadedP2P+t.loadedHTTP-t.total,fileSize:t.total,downloadTimeMS:Date.now()-t.currentTarget.timestamp}),t.currentTarget.status>=200&&t.currentTarget.status<300){this.playlistsHandler.deleteToSegment(n),this.playlistsHandler.setLastLoadedSegment(n),this._saveDownloadSpeed(t.currentTarget);var r=this;setTimeout(function(){r._prefetchBoth()},10)}this._updateRequestHttpConstraint()},_requestSwarmStateChanged:function(e){if(e.sent){var t={type:"swarmChange",sent:e.sent};this.reportProgress(t)}},_prefetch:function(t){if(this.playerStarted&&0!==this.numOfPeers)if(u.FEATURE_P2P_IMPROVEMENT_ENABLED)for(var n=this.segmentsPrefetcher.prefetchSegments(),r=0;r<n.length;r++){var i=n[r];this._addRequest(i.xhr,i.url)}else if("http"===t){if(this.httpPendingRequests>=u.MAX_HTTP_REQUESTS||0===u.MAX_HTTP_REQUESTS)return;for(var a=[],o=this.playlistsHandler.getNextSegmentsWindow(u.HTTP_VOD_WINDOW),r=0;r<o.length;r++){var c=o[r];if(!this._requestExist(c)){var l=s(c),d=Object.keys(this.segmentsInfo[l]).length;0===d&&a.push(c)}}var c=a[Math.floor(Math.random()*a.length)];if(!c)return void this._prefetch("p2p");e.info("prefetching "+c+" in http"),this._requestP5(c,null,{downloadMode:"http"}),this._prefetch("http")}else if("p2p"===t){if((this.p2pPendingRequests>=u.MAX_P2P_REQUESTS||0===u.MAX_P2P_REQUESTS)&&!this._shouldPrefetchAfterMaxBuffer())return;for(var a=[],h=1,o=this.playlistsHandler.getNextSegmentsWindow(u.P2P_VOD_WINDOW),r=0;r<o.length;r++){var c=o[r];if(!this._requestExist(c)){var l=s(c),f=this.segmentsInfo[l];if(f){var d=Object.keys(f).length;d===h?a.push(c):d>h&&(a=[c],h=d)}}}var c=a[Math.floor(Math.random()*a.length)];if(!c)return;u.DYNAMIC_PREFETCH&&(t="dynamic"),e.info("prefetching "+c+" in "+t+" mod"),this._requestP5(c,null,{downloadMode:t}),this._prefetch("p2p")}},_requestP5:function(t,n,r){var i=new e.VideoRequest({downloadMode:r.downloadMode});i.mediaPrefetch=!0,i.responseType="arraybuffer",i.open("GET",t);var a=this;i.addEventListener("swarmstatechange",function(){return a._requestSwarmStateChanged.apply(a,arguments)}),i.addEventListener("error",function(n){e.warn("onerror prefetching resource: "+t+" "+n)}),i.addEventListener("loadend",function(n){e.info("MediaFetcher::_requestP5:onloadend "+t," status ",this.status),a._decreasePendingRequests(n.currentTarget.downloadMode),this.status>=200&&this.status<300&&(a._saveDownloadSpeed(this),a.reportProgress({type:"fileDownloaded",url:t,loaded:n.loaded,p2p:n.loadedP2P,http:n.loadedHTTP,waste:n.loadedP2P+n.loadedHTTP-n.total,fileSize:n.total,downloadTimeMS:Date.now()-n.currentTarget.timestamp})),a._prefetch(r.downloadMode||"http")}),e.info("MediaFetcher::_requestP5:requesting "+t),this._increasePendingRequests(i.downloadMode),this._addRequest(i,t),"dynamic"===r.downloadMode&&this._addRequestTimeConstraints(i),i.send()},_requestExist:function(e){var t=s(e);return t in this.requests},_addRequest:function(t,n){e.info("adding request "+n+" to requests"),t.timestamp=Date.now();var r=s(n);this.requests[r]=t;var i=this.requestLRU.get(r,t);i?this.requestLRU.update(r,t):this.requestLRU.set(r,t);var a,o=this,u=function(e){!a&&t.readyState>=2&&e.lengthComputable&&(o.totalRequestSize+=e.total,a=!0)};t.addEventListener("readystatechange",u)},_updateRequest:function(t,n){e.info("updating request "+n+" to requests"),t.timestamp=Date.now();var i=s(n),a=this.requests[i];if(a.readyState<4)if(u.MERGE_REQUESTS){e.info("MediaFetcher::_updateRequest: merging new request to a prefetched request: "+n),r(a,t),t.discontinue();var o=e.state.resources.get(n);o&&(o.httpConstraint=t._httpConstraint,e.info("updated httpConstraint for resource "+n+" to "+t._httpConstraint))}else e.info("aborting a prefetched request:"+n),a.abort(),this.reportProgress({type:"requestAborted",mode:a.downloadMode===l?"p2p":"http"}),this._saveDownloadSpeed(a);this.requests[i]=t,this.requestLRU.update(i,t)},_scavange:function(t,n){var r=n._url;if(e.info("removing request"+r),!n)return void e.warn("scavanging an undefined request");var i=n.getFileInfo();i?(n.abort({leaveSwarm:!0}),n.readyState>=2&&(this.totalRequestSize-=i.size)):e.warn("scavanged a request that hadnt initiated"+r),delete this.requests[t]},_requestCacheTester:function(){return this.totalRequestSize>this.MAX_REQUEST_CACHE_SIZE},_cachePlaylist:function(t){e.info("caching playlist");var n=t.currentTarget._url,r=t.currentTarget.response;this.playlistsCache.save(n,r);var i=this;setTimeout(function(){i.playlistsCache.remove(n)},1e3)},_parsePlaylist:function(t,n,r){e.info("parsing playlist");var o;switch(t.currentTarget.responseType){case"blob":return void e.warn("playlist was requested as a blob: "+n);case"arraybuffer":o=String.fromCharCode.apply(null,new Uint8Array(t.currentTarget.response));break;default:o=t.currentTarget.response}var c=this.playlistsHandler.hasLivePlaylist();i.setMediaInfo({type:c?"live":"vod"}),this.MAX_REQUEST_CACHE_SIZE=c?u.MAX_REQUEST_CACHE_SIZE_LIVE:u.MAX_REQUEST_CACHE_SIZE_VOD;var l=this.playlistsHandler.getNewestSegment(n),d=this.playlistsHandler.extractSegments(n,o),h=this.playlistsHandler.getNewestSegment(n);if(d&&0!==d.length){for(var f=0;f<d.length;f++){var p=d[f],g=s(p);this.segmentsInfo[g]||(this.segmentsInfo[g]=Object.create(null)),this.interceptRequests[g]=!0}if(u.PEER_LIVE_DETECTION&&l&&l!==h){e.info("detected new segment, sending to peers");var v=this.playlistsHandler.getSegmentData(h).segmentData,m=v.seqs,_=new a.NewSegmentMessage(m);radio("p2p.send.all").broadcast(_,"NewSegment")}if(u.EARLY_LIVE_DETECTION){var E=this;this.playlistXhrTimer=setTimeout(function(){E._detectLiveEarly(n)},u.EARLY_LIVE_DETECTION_INTERVAL)}(u.EARLY_LIVE_DETECTION||u.PEER_LIVE_DETECTION)&&l&&h!==l&&!this._isActivePlayerRequest()&&r&&(e.info("discovered new segment - prefetching: "+h),this._requestP5(h,null,{downloadMode:"dynamic"}))}},_detectLiveEarly:function(e){this.playlistXhrTimer=null,this._requestPlaylist(e)},_overrideInterceptedRequest:function(t){var n,r=s(t._url),i=this.segmentsInfo[r],a=i?Object.keys(i).length:0;0===a?n=0:a>=1&&(n=this.downloadSpeed[1]),u.AGGRESSIVE_P2P&&n>this.downloadSpeed[0]?(e.info("override interception to p2p"),t.downloadMode=l):u.SYNCED_BUFFERS?(e.info("override interception to dynamic mode"),t.downloadMode=h,this._addRequestTimeConstraints(t)):(e.info("override interception to http"),t.downloadMode=d),this._increasePendingRequests(t.downloadMode),this._timeoutPlayerRequests(t)},_addRequestTimeConstraints:function(t){var n=this.mediaController.getBufferLength(),r=this.mediaController.getPosition(),i=t._url,a=n>0?this.playlistsHandler.getDurationFromLastLoadedToSegment(i):0,o=n+a,s=(u.EXTERNAL_MEDIA_FRAGMENT_TIMEOUT-u.HIGH_BUFFER_HTTP_CONSTRAINT+u.EXTERNAL_MINIMUM_HTTP_CONSTRAINT)/1e3,c=Math.min(o,s);this._updateRequestHttpConstraint(),t._constraint=performance.now()+1e3*c,t._httpConstraint=this.httpConstraintOn,!t.mediaPrefetch&&u.PLAYER_REQUEST_ALWAYS_HTTP?(t._httpConstraint=!0,e.info("resource "+i+" was requested by the player, downloading in http")):1e3*(n+a)>u.EXTERNAL_MAXIMUM_HTTP_CONSTRAINT&&(t._httpConstraint=!1,e.info("resource "+i+" is further than maximum http constraint")),this.httpConstraintChanged||t._httpConstraint!==!1||(this.httpConstraintChanged=!0,e.info("resource "+i+" flipped initial http constraint")),u.SKIP_JOIN_INITIAL_CONSTRAINT&&!this.httpConstraintChanged&&(t.skipJoin=!0,e.info("resource "+i+" skipping join due to initial http constraint")),u.SKIP_JOIN_INITIAL_SEGMENTS&&1e3*(r+n)<=u.EXTERNAL_MAXIMUM_HTTP_CONSTRAINT&&(t.skipJoin=!0,e.info("resource "+i+" skipping join due to initial segment")),e.info("player buffer is "+n+"s, extra buffer is "+a+"s for resource "+i+". httpConstraint is "+t._httpConstraint)},_updateRequestHttpConstraint:function(){var t=this.mediaController.getBufferLength();this.httpConstraintOn===!1&&t<u.EXTERNAL_MINIMUM_HTTP_CONSTRAINT/1e3?(this.httpConstraintOn=!0,e.info("player buffer ("+t+"s) is lower than minimum http constraint, changing httpConstraint to http mode")):this.httpConstraintOn===!0&&t>u.EXTERNAL_MAXIMUM_HTTP_CONSTRAINT/1e3&&(this.httpConstraintOn=!1,e.info("player buffer ("+t+"s) is higher than maximum http constraint, changing httpConstraint to p2p mode"))},_timeoutPlayerRequests:function(e){if(u.REQUEST_TIMEOUT){var t,n=e.downloadMode;switch(n){case l:t=u.P2P_TIMEOUT_DURATION;break;case d:t=u.HTTP_TIMEOUT_DURATION;break;default:t=u.HTTP_TIMEOUT_DURATION}if(u.REQUEST_TIMEOUT){var r=this;setTimeout(function(){r._requestTimeout(e)},t)}}},_requestTimeout:function(t){t.readyState<4&&(i.sumGlobal({playlistTimeouts:1}),e.info("intercepted request timedout "+t._url),t.abort(),this._decreasePendingRequests(t.downloadMode),this._saveDownloadSpeed(t))},_saveDownloadSpeed:function(t){var n=t._speed;if(n){if(t.downloadMode===l)var r=1;else var r=0;this.downloadSpeed[r]=n,e.info("speed ="+n+" bucket="+r)}},_increasePendingRequests:function(t){t&&t===l?this._increaseP2PPendingRequests():t&&t===d?this._increaseHTTPPendingRequests():t&&t===h||e.error("unidentified downloadMode request started: "+t)},_decreasePendingRequests:function(t){t===l?this._decreaseP2PPendingRequests():t===d||t===c?this._decreaseHTTPPendingRequests():t===h||e.error("unidentified downloadMode request loaded: "+t)},_increaseHTTPPendingRequests:function(){this.httpPendingRequests++},_increaseP2PPendingRequests:function(){this.p2pPendingRequests++},_decreaseHTTPPendingRequests:function(){this.httpPendingRequests--,this.httpPendingRequests<0&&e.error("httpPendingRequests smaller than 0")},_decreaseP2PPendingRequests:function(){this.p2pPendingRequests--,this.p2pPendingRequests<0&&e.error("p2pPendingRequests smaller than 0")},_requestPlaylist:function(e){if(!this.playlistXhr){var t=new o,n=this;t.open("GET",e),t.onloadend=function(t){n.playlistXhr=!1;var r=t.currentTarget.status,i=t.currentTarget.response;r>=200&&r<300&&i&&n._parsePlaylist(t,e,!0)},t.send(),this.playlistXhr=t}},_shouldPrefetchAfterMaxBuffer:function(){return e.config.PREFETCH_AFTER_MAXBUFFER&&0===this.p2pPendingRequests&&this.mediaController.getBufferLength()>e.config.EXTERNAL_MEDIA_MAXBUFFER},_handleDiscoveredSegment:function(t){var n=this.playlistsHandler.getCurrentPlaylist();if(n){var r=this.playlistsHandler.getNewestSegment(n),i=this.playlistsHandler.getSegmentData(r).segmentData.seqs,a=this.playlistsHandler.getLastRequestedSegment(),o=this.playlistsHandler.getSegmentData(a).segmentData.seqs;t>i&&t-o<u.LIVE_DETECTION_WINDOW&&(e.info("new segment #"+t+" discovered by a peer, downloading playlist (old seq # is "+i+")"),this._requestPlaylist(n))}},_isActivePlayerRequest:function(){var e=this.playlistsHandler.getLastRequestedSegment(),t=s(e),n=this.requests[t];return!n||4!==n.readyState},guessPlaylistOfUnknownSegment:function(t){var n=t.replace(".ts",".m3u8");e.info("guessing manifest url "+n),this._requestPlaylist(n)},reportProgress:function(e){window.P2PPerformanceUpdate&&window.P2PPerformanceUpdate(e)}}),t.core.apis.MediaFetcher=new e.core.apis.MediaFetcher,t.prefetch=function(e){radio("external.prePlayPrefetch").broadcast(e)}}(e)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(6).singleton,r=n(14);!function(){var n=e.core.util.UrlSwarmIdMap;e.core.controllers.AbstractController=Object.subClass({ctor:function(){this.resourceState=Object.create(null)},init:function(e){this.resourceState[e]=r.LOADING},removeResource:function(t){delete this.resourceState[t],e.core.dataStructures.PendingBlockMap.removeResource(t)},stopResource:function(t){this.resourceState[t]=r.STOPPED,e.core.dataStructures.PendingBlockMap.removeResource(t)},getRarestBlocks:function(r,i,a){for(var o,s,u=t.get(r),c=[],l=[],d=this.P2PController||this,h=n.getSwarmId(r)||r,f=0,p=u.getNumOfBlocks();f<p;f++)if(s=0,a(f)){for(var g in d.remoteAvailabilityMaps[h])d.remoteAvailabilityMaps[h][g].has(f)&&s++;0==l.length?(c.push(f),o=s):s===o?c.push(f):s<o&&(c=[f],o=s)}var v=e.core.util.randSample(c,i);return v},getSeqBlocks:function(e,n,r){for(var i=t.get(e),a=[],o=i.getFirstMissingBlock(),s=i.getNumOfBlocks()-1,u=o;u<=s&&a.length<n;u++)if(r(u))a.push(u);else if(a.length)break;return a}})}()}).call(t,n(1))},function(e,t,n){(function(e){var t="0.72.2",r=n(123),i=n(5),a=n(4),o=n(14),s=n(6).singleton,u=n(2);!function(){function n(){return u.LEECH||u.BUFFER_LENGTH_LEECH_LOW_SEC&&e.core.apis.MediaFetcher.mediaController.getBufferLength()<u.BUFFER_LENGTH_LEECH_LOW_SEC}var c=[],l=!1;e.core.controllers.P2PController=e.core.controllers.AbstractController.subClass({ctor:function(t){this._super(),this.peersPerformanceTracker=e.core.util.PeersPerformanceTracker,this.lastSwarmDownloaded={swarmId:null,timeStamp:null},this.peersBlacklist=Object.create(null),this.peer=t,this.lastBlockRequestedInP2P=Object.create(null),this.peerConnections=Object.create(null),this.initPeerConnections=Object.create(null),this.attemptedConnections=Object.create(null),this.deletedPeerConnections=Object.create(null),this.numberOfPCCreated=0,this.remoteAvailabilityMaps=Object.create(null),this.remoteHave=Object.create(null),this.remoteDownloading=Object.create(null),this.peerSwarms=Object.create(null),this.prefetchFlag=Object.create(null),this.resourceState=Object.create(null),this.pendingResources=Object.create(null),this._peerConnectionsToCreate=0,this.initClosePCQueue(),this.registerEvents(),this.startMeasuringLatency(),this.lookingForPeers=!0,this.initPCPool(),this.pcOpenQueue=[],this.pcInterval=null},init:function(t){l=!0,this._super(t),this.remoteAvailabilityMaps[t]||(this.remoteAvailabilityMaps[t]=Object.create(null)),this.prefetchFlag[t]=2===e.state.resources.get(t).mod,this.addResourceAsPending(t),this.loadCachedHaveRequests(t)},startPeerConnectionOpenInterval:function(){if(!this.pcInterval){var e=this;if(u.PC_CREATE_INTERVAL>0)this.pcInterval=setInterval(function(){var t=e.pcOpenQueue.pop();return t?void e.ensurePeerConnectionInitialized(t,!0):(clearInterval(e.pcInterval),void(e.pcInterval=null))},u.PC_CREATE_INTERVAL);else{var t=e.pcOpenQueue.pop();e.ensurePeerConnectionInitialized(t,!0)}}},download:function(e,t,n){if(s.has(e)){var r,i=s.get(e);if(r=t?[t]:this.getAvailablePeerIdsForSwarmId(e),r&&0!==r.length){t||(this.lastSwarmDownloaded.swarmId=e,this.lastSwarmDownloaded.timeStamp=Date.now());var a=this.getNumOfChunksToAllocate(r);if(!(a<=0)){var o,c,l=[];if((this.lastBlockRequestedInP2P[e]||0===this.lastBlockRequestedInP2P[e])&&!i.has(this.lastBlockRequestedInP2P[e])){c=this.lastBlockRequestedInP2P[e],o=i.getChunkIdsOfBlock(c);for(var d=0;d<o.length&&l.length<a;++d)i.hasOrPendingChunk(o[d])||l.push(o[d])}if(a-=l.length,a<=0)return this.distributeChunksAmongSources(e,l);for(var h=Math.ceil(a/(u.BLOCK_SIZE/u.CHUNK_SIZE)),f=this,p=function(t){for(var a=0,o=r.length;a<o;a++){var s=r[a],u=f.remoteAvailabilityMaps[e][s];if(u&&u.has(t))return n?n(t):!i.has(t)&&!f.isPendingEntireBlock(e,t)}return!1},g=this.getRarestBlocks(e,h,p),d=0;d<g.length;d++)if(g[d]!==c){o=i.getChunkIdsOfBlock(g[d]);for(var v=0;v<o.length&&l.length<=a;++v)i.hasOrPendingChunk(o[v])||l.push(o[v]);this.lastBlockRequestedInP2P[e]=g[d]}return this.distributeChunksAmongSources(e,l)}}}},getNumOfChunksToAllocate:function(e){e.length||(e=[e]);var t=0,n=this;return e.forEach(function(e){t+=n.peerConnections[e].maxNumOfPendingChunks-n.peerConnections[e].numOfPendingChunks}),t},isPendingEntireBlock:function(e,t){var n=s.get(e),r=n.getNumOfChunksPresetInBlock(t),i=n.getNumOfChunksSetInBlock(t),a=n.getNumOfChunksInBlock(t);return r+i===a},isAvailable:function(e){if(!this.resourceState[e]||this.resourceState[e]===o.STOPPED)return!1;if(!s.has(e))return!1;for(var t in this.peerConnections)if(this.remoteAvailabilityMaps[e][t]&&this.isPeerAvailable(t))return!0;return!1},isPeerAvailable:function(t){var n=this.peerConnections[t];return!!n&&(n.numOfPendingChunks<.9*n.maxNumOfPendingChunks&&(!!n.isAvailable()&&(!!this.peerSwarms[t]&&!e.core.util.isObjectEmpty(this.peerSwarms[t]))))},getAvailableNumOfChunksToSend:function(){var e=0;for(var t in this.peerConnections)e+=this.peerConnections[t].maxNumOfPendingChunks-this.peerConnections[t].numOfPendingChunks;return e},removeResource:function(t){e.info("removed p2p resource "+t),this.sendToAll(this.createDontHaveMessage(t),"DontHave"),
this._super(t),delete this.pendingResources[t],delete this.lastBlockRequestedInP2P[t]},stopResource:function(t){e.info("stopped p2p resource "+t),this._super(t),delete this.pendingResources[t]},numOfSeeders:function(e,t){var n={};if(e&&this.remoteAvailabilityMaps[e])for(var r in this.remoteAvailabilityMaps[e])this.remoteAvailabilityMaps[e][r].isFull()&&this.peerConnections[r]&&!n[r]&&(n[r]=!0);if(e&&this.remoteDownloading[e])for(var r in this.remoteDownloading[e])this.remoteDownloading[e][r]&&this.peerConnections[r]&&!n[r]&&(n[r]=!0);if(t&&this.remoteDownloading[t])for(var r in this.remoteDownloading[t])this.remoteDownloading[t][r]&&this.peerConnections[r]&&!n[r]&&(n[r]=!0);return Object.keys(n).length},getLookingForPeers:function(){return this.lookingForPeers},registerEvents:function(){radio("P2PMaybeAvailableEvent").subscribe([function(e,t){this.isPeerAvailable(t)&&this.prefetch(e,t)},this]),radio("blockReceived").subscribe([function(e,t){if(e){var n=this.createHaveMessage(e);n&&this.sendToAll(n,"Have")}},this]),radio("dataReceivedEvent").subscribe([function(t,n){var r=n.targetId;if(n!=this.peerConnections[r])return void e.info("got dataReceivedEvent from peerId "+r+"which was not found in peerConnections");switch(t.tag){case i.P2P_HAVE:a.sumGlobal({p2pHaveMessagesReceived:1}),this.peersPerformanceTracker.reportPeerHaveSwarm(r,t.swarmId),this.receiveHaveMessage(t,r),radio("P2PMaybeAvailableEvent").broadcast(t.swarmId,n.targetId),radio("receivedHaveMessage").broadcast(t,r);break;case i.P2P_DONT_HAVE:a.sumGlobal({p2pDontHaveMessagesReceived:1}),this.receiveDontHaveMessage(t,r),radio("receivedDontHaveMessage").broadcast(t,r);break;case i.P2P_REQUEST:a.sumGlobal({p2pRequestMessagesReceived:1}),this.resourceState[t.swarmId]&&this.receiveRequestMessage(t,r);break;case i.P2P_DATA:a.sumGlobal({p2pDataMessagesReceived:1}),this.peersPerformanceTracker.reportChunksReceivedFromPeer(r,t.swarmId,{id:t.chunkId,bytes:t.payload.length});break;case i.P2P_VERSION:break;case i.P2P_LATENCY_REQUEST:var o=t.timestamp,s=t.originBufferedAmount,u=n.getBufferedAmount();n.queue(new i.LatencyResponseMessage(o,s,u));break;case i.P2P_LATENCY_RESPONSE:this.receiveLatencyMessage(t,r);break;case i.P2P_DOWNLOADING:a.sumGlobal({p2pDownloadingMessagesReceived:1}),this.receiveDownloadingMessage(t,r);break;case i.P2P_NEW_SEGMENT:a.sumGlobal({p2pNewSegmentMessagesReceived:1}),radio("peerDiscoveredSegment").broadcast(t.segSeq);break;case i.P2P_INITIALIZING:a.sumGlobal({p2pInitializingMessagesReceived:1}),this.receiveInitializingMessage(t,r);break;default:e.warn("received a p2p message not in protocol from "+r)}},this]),radio("connectionIdle").subscribe([function(e){if(!(Object.keys(this.peerConnections).length<u.MAX_CONNECTIONS*u.PC_IDLE_FACTOR)){var t=!1;u.FEATURE_CLOSE_DEAD_CONNECTIONS&&(t=this.closeDeadConnections(e)),t||u.FEATURE_CLOSE_OVERLAPPING_CONNECTIONS&&this.closeOverlappingConnections(e)}},this]),radio("connectionReady").subscribe([function(t){var n=this.peerConnections[t];if(n)e.warn("peerConnection to "+t+" was initialized, but we already have a connection to him");else{if(e.info("new peer connection to "+t),n=this.peerConnections[t]=this.initPeerConnections[t],delete this.initPeerConnections[t],!n)return void e.warn("this should not happen with the new peer connection implementation");this.peersPerformanceTracker.reportPeerConnected(t);var r=Object.keys(this.peerConnections).length;r>=u.MAX_CONNECTIONS&&(this.lookingForPeers=!1),radio("activePeerConnectionsNumberChanged").broadcast(r)}this.peerSwarms[t]=Object.create(null),this.sendVersionTo(n),this.sendAllHavesTo(n)},this]),radio("connectionFailed").subscribe([function(t){e.info("onConnectionFailed: closing connection with "+t);var n=this.peerConnections[t]||this.initPeerConnections[t]||this.deletedPeerConnections[t];if(this.closeConnection(n,!1),this.peerSwarms[t]&&delete this.peerSwarms[t],delete this.deletedPeerConnections[t],n&&n.forceClosed)return void delete this.attemptedConnections[t];if(n&&n.initiator){if("exponential"===u.PC_RECON_METHOD)var r=1e3*Math.pow(u.PC_RECON_EXP_COEF,this.attemptedConnections[t]-1);else{if("single"!==u.PC_RECON_METHOD)return;if(this.attemptedConnections[t]>1)return;var r=u.PC_RECON_DELAY||1e4}var i=this;setTimeout(function(){i.ensurePeerConnectionInitialized(t,!0)},r)}},this]),radio("receivedGroupMatchEvent").subscribe([function(t){e.info("peer "+this.peer.id+" received match with peers: "+t.peerIds),t.peerIds.forEach(function(e){void 0===this.attemptedConnections[e]&&(this.pcOpenQueue.push(e),this.attemptedConnections[e]=this.attemptedConnections[e]+1||1,this.startPeerConnectionOpenInterval())},this)},this]),radio("receivedSDP").subscribe([function(e){this.ensurePeerConnectionInitialized(e.originId,!1),this.initPeerConnections[e.originId]&&this.initPeerConnections[e.originId].handleMessage(e)},this]),radio("receivedGroupSDP").subscribe([function(e){e.sdp.forEach(function(t){radio("receivedSDP").broadcast({originId:e.originId,destId:e.destId,sdpMessage:t})},this)},this]),radio("transferLoaded").subscribe([function(e){delete this.pendingResources[e.swarmId]},this]),radio("p2p.send.all").subscribe([function(e,t){this.sendToAll(e,t)},this])},startMeasuringLatency:function(){var e=this;!this.latencyInterval&&u.PC_LATENCY_ENABLED&&(this.latencyInterval=setInterval(function(){for(var t in e.peerConnections){var n=e.peerConnections[t];if(n&&n.ready){var r=Math.floor(performance.now()),a=n.getBufferedAmount();n.queue(new i.LatencyRequestMessage(r,a))}}},u.PC_LATENCY_INTERVAL))},prefetch:function(e,t){if(this.prefetchFlag[e]&&this.resourceState[e]===o.LOADING){var n=this.download(e,t);n&&0!==n||this.prefetchPendingResources(e,t)}},prefetchPendingResources:function(e,t){for(var n in this.pendingResources)if(n!==e&&this.prefetchFlag[n]&&void 0!==this.remoteAvailabilityMaps[n][t]){var r=this.download(n,t);if(r>0)break}},addResourceAsPending:function(e){if(this.prefetchFlag[e]&&s.has(e)){var t=s.get(e);t.isFull()||(this.pendingResources[e]=!0)}},getSwarmPeersCount:function(e){var t=this.remoteAvailabilityMaps[e];return t?Object.keys(t).length:0},receiveRequestMessage:function(e,t){this.sendData(e.swarmId,t,e.chunkIds,0,0),radio("requestChunks").broadcast(e.swarmId,t,e.chunkIds)},receiveLatencyMessage:function(e,t){var n=Math.floor(performance.now()),r=e.timestamp,i=e.originBufferedAmount,a=e.remoteBufferedAmount,o=Math.round(n-r),s=this.peerConnections[t];s&&0===i&&0===a&&(!s.lastLatencyTimestamp||s.lastLatencyTimestamp<r)&&(s.lastLatencyTimestamp=r,s.latencySlidingWindow.addValue(o))},receiveDownloadingMessage:function(e,t){var n=e.swarmId,r=e.hashUrl;this.remoteDownloading[n]||(this.remoteDownloading[n]={}),this.remoteDownloading[r]||(this.remoteDownloading[r]={}),this.remoteDownloading[n][t]=!0,this.remoteDownloading[r][t]=!0},receiveInitializingMessage:function(e,t){var n=e.hashUrl;this.remoteDownloading[n]||(this.remoteDownloading[n]={}),this.remoteDownloading[n][t]=!0},getAvailablePeerIdsForSwarmId:function(e){var t=this;if(!this.remoteAvailabilityMaps[e])return[];var n=Object.keys(this.remoteAvailabilityMaps[e]);return n.filter(function(e){return t.isPeerAvailable(e)})},sortPeerIdsByLoad:function(e){var t=this;return e.sort(function(e,n){var r=t.peerConnections[e],i=t.peerConnections[n];return r.numOfPendingChunks>i.numOfPendingChunks?1:r.numOfPendingChunks<i.numOfPendingChunks?-1:i.maxNumOfPendingChunks-i.numOfPendingChunks-(r.maxNumOfPendingChunks-r.numOfPendingChunks)})},distributeChunksAmongSources:function(t,n,a){if(!this.remoteAvailabilityMaps[t]||0===n.length)return 0;var o;if(a)o=[a];else{var c=this.getAvailablePeerIdsForSwarmId(t);o=this.sortPeerIdsByLoad(c)}for(var l,d=Object.create(null),h=0,f=0;f<n.length;++f)for(var p=n[f],g=Math.floor(p/(u.BLOCK_SIZE/u.CHUNK_SIZE)),v=0;v<o.length;++v)if(l=u.PC_ALLOCATE_CHUNKS_EVENLY?o[(v+f)%o.length]:o[v],d[l]||(d[l]=[]),this.remoteAvailabilityMaps[t][l]&&this.remoteAvailabilityMaps[t][l].has(g)&&!this.peerConnections[l].isFull(d[l].length)){d[l].push(p),h++;break}for(var m=0;m<o.length;++m)if(l=o[m],n=d[l],n&&n.length>0){var _=this.peerConnections[l];e.info("requesting "+n.length+" chunks from peer "+l+" with window "+_.maxNumOfPendingChunks+" pending "+_.numOfPendingChunks+" for swarm "+t),r(_,s.get(t),n),this.peersPerformanceTracker.reportChunksRequestFromPeer(t,n)}if(u.P2P_DOWNLOADING_MSG&&h>0){var E=e.state.resources.get(t);E.hashUrl&&this.sendToAll(new i.DownloadingMessage(t,E.hashUrl),"Downloading")}return h},sendToAll:function(e,t){for(var n in this.peerConnections){var r=this.peerConnections[n];if(r&&r.ready){var i={};i["p2p"+t+"MessagesSent"]=1,a.sumGlobal(i),r.queue(e)}}},ensurePeerConnectionInitialized:function(t,n){if(!(this.peersBlacklist[t]||this.peerConnections[t]||this.initPeerConnections[t]||Object.keys(this.peerConnections).length>=u.MAX_CONNECTIONS||"chrome"===e.browserName&&u.MAX_PC_CREATE&&this.numberOfPCCreated>=u.MAX_PC_CREATE)){if("firefox"===e.browserName&&e.browserVersion<43&&c.length<=0)return void this.allocateMorePC();n||(this.attemptedConnections[t]=this.attemptedConnections[t]+1||1),this.initPeerConnections[t]=this.peer.connect(t,n,c.shift()),this.increaseCreatedPCCount(),c.length<u.PC_POOL_LOW&&this.allocateMorePC(),n&&this.initPeerConnections[t].setupCall()}},increaseCreatedPCCount:function(){this.numberOfPCCreated++,"chrome"===e.browserName&&u.MAX_PC_CREATE&&radio("availablePeerConnectionsNumberChanged").broadcast(u.MAX_PC_CREATE-this.numberOfPCCreated)},sendData:function(t,n,r,o,u){if(this.canUpload(t)){var c=r[o];o++;var l=this;if(s.has(t)){var d=s.get(t);d.getChunk(c,function(s,d){return s&&d?(u+=d.length,a.sumGlobal({p2pDataMessagesSent:1}),l.peerConnections[n].queue(new i.DataMessage(t,c,d)),void(o<r.length?l.sendData(t,n,r,o,u):(l.peersPerformanceTracker.reportUploadToPeer(n,u),radio("chunkSent").broadcast(t,u)))):void e.warn("cannot send data, getChunk failed for swarm: "+t+", chunkId: "+c)})}}},sendAllHavesTo:function(e){var t,n,r=[],i=this;s.forEach(function(e,a){var o=a.metadata;o&&i.resourceState[o.swarmId]&&(t=o.swarmId,n=i.createHaveMessage(t),n&&r.push(n))});var o=u.CHUNK_SIZE/76;o=Math.floor(.9*o);for(var c=0,l=r.length;c<l;c+=o)a.sumGlobal({p2pHaveMessagesSent:1}),e.queue(r.slice(c,c+o))},sendVersionTo:function(e){e.queue(new i.VersionMessage(t,u.VERSION))},receiveHaveMessage:function(t,n){var r=t.swarmId,i=t.hashUrl,a=t.filesize;if(a>0&&!u.USE_HEAD){e.core.util.HashUrlLengthMap.addMapping(i,a);var o=e.state.resources.get(i);o&&!o.length&&(e.info("length "+a+" received for swarm: "+r+" hashUrl: "+i+" from peer: "+n),radio("responseLengthReceived"+o.url).broadcast(a))}this.receiveDownloadingMessage(t,n);var c=this.remoteAvailabilityMaps[r];if(!c)return this.remoteHave[r]=this.remoteHave[r]||{},void(this.remoteHave[r][n]=t);if(!c[n]){if(e.info("got a have message from a peer with a non initialized availabilityMap"),!s.has(r))return;var l=s.get(r);c[n]=new e.core.dataStructures.AvailabilityMap(l.getNumOfBlocks())}t.availabilityMap?c[n].deserializeAndCopy(t.availabilityMap):t.seeder?c[n].setSeeder():c[n].deserializeAndUpdate(t.blockIds),this.peerSwarms[n]||(this.peerSwarms[n]=Object.create(null)),this.peerSwarms[n][r]=!0},receiveDontHaveMessage:function(e,t){var n=e.swarmId,r=e.hashUrl;!this.remoteAvailabilityMaps[n]&&this.remoteHave[n]&&this.remoteHave[n][t]&&delete this.remoteHave[n][t],this.remoteAvailabilityMaps[n]&&this.remoteAvailabilityMaps[n][t]&&delete this.remoteAvailabilityMaps[n][t],this.remoteDownloading[n]&&delete this.remoteDownloading[n][t],this.remoteDownloading[r]&&delete this.remoteDownloading[r][t]},loadCachedHaveRequests:function(e){if(void 0!==this.remoteHave[e]){var t=Object.keys(this.remoteHave[e]),n=this;t.forEach(function(t){n.receiveHaveMessage(n.remoteHave[e][t],t)})}},createHaveMessage:function(t){if(s.has(t)&&!n()){var r,a=s.get(t),o=e.state.resources.get(t),u=o?o.hashUrl:null;return r=a.isFull()?new i.HaveMessage(t,!0,null,u,a.fileSize):new i.HaveMessage(t,!1,a.getSerializedMap(),u,a.fileSize)}},createDontHaveMessage:function(t){var n=e.state.resources.get(t),r=n?n.hashUrl:null,a=new i.DontHaveMessage(t,r);return a},closeDeadConnections:function(t){var n=(Date.now()-t.peerData.lastHaveReportTimestamp)/1e3,r=this.peerConnections[t.peerId];return!!(n>u.SECONDS_SINCE_LAST_HAVE&&r&&r.initiator)&&(e.info("closing dead connection "+t.peerId),this.closeConnection(r,u.FEATURE_CLOSE_DEAD_CONNECTIONS_PERMANENTLY),r.forceClosed=!0,!0)},closeOverlappingConnections:function(t){var n=this.peerConnections[t.peerId];t.peerData.lastSwarmReportedAsHave===this.lastSwarmDownloaded.swarmId&&n&&n.initiator&&(e.info("closing overlapping connection "+t.peerId),this.closeConnection(n,u.FEATURE_CLOSE_OVERLAPPING_CONNECTIONS_PERMANENTLY),n.forceClosed=!0)},closeConnection:function(t,n,r){var i=t&&t.targetId;return e.info("closing connection with "+i),t&&(this.peerConnections[i]||this.initPeerConnections[i]||this.deletedPeerConnections[i])===t?(this.closePC(t),this.deletePeerConnection(t),void(n&&(this.peersBlacklist[i]=!0))):void e.error("could not close corrupted peer connection to "+i)},deletePeerConnection:function(e){var t=e.targetId;this.deletedPeerConnections[t]=e,delete this.peerConnections[t],delete this.initPeerConnections[t];var n=Object.keys(this.peerConnections).length;n<=u.MIN_CONNECTIONS&&(this.lookingForPeers=!0),radio("activePeerConnectionsNumberChanged").broadcast(n),this.peersPerformanceTracker.reportPeerDisconnected(t)},canUpload:function(){return!0},allocateMorePC:function(){this._peerConnectionsToCreate>0||(this._peerConnectionsToCreate=u.PC_POOL_SIZE,this._createPoolConnections())},_createPoolConnections:function(){if(this._peerConnectionsToCreate>0){var e=this;setTimeout(function(){e._createPoolConnection()},u.PC_POOL_REGEN_INTERVAL)}},_createPoolConnection:function(){u.PC_MOCK?c.push({}):c.push(e.core.transport.PeerConnectionImpl.createPeerConnection()),this._peerConnectionsToCreate--,this._createPoolConnections()},initClosePCQueue:function(){this.pcCloseQueue=e.core.util.taskQueue();var t=0;this.pcCloseQueue.canrun=function(){var e=Date.now()-t,n=u.PC_CLOSE_TIMEOUT-e;return n<0||n},this.closePC=function(e){this.pcCloseQueue.push(function(){t=Date.now(),e&&e.close&&e.close()})}},initPCPool:function(){"complete"===document.readyState?(u.PC_MOCK?c.push({}):c.push(e.core.transport.PeerConnectionImpl.createPeerConnection()),this.allocateMorePC()):document.addEventListener("DOMContentLoaded",function(){var t=0,n=setInterval(function(){u.PC_MOCK?c.push({}):c.push(e.core.transport.PeerConnectionImpl.createPeerConnection()),t++,(t>u.PC_POOL_SIZE||l)&&clearInterval(n)},u.PC_POOL_INIT_INTERVAL)})}})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(){e.core.data.CacheManager=Object.subClass({ctor:function(){this.mb=1048576},getRandomArbitrary:function(e,t){return Math.floor(Math.random()*(t-e)+e)},testFillLibrary:function(e,t,n){this.fillLibraryWithMultipleFiles(0,e,t,n,function(e){console.log("wrote all test files")})},fillLibraryWithMultipleFiles:function(t,n,r,i,a){var o=this,s=this.getRandomArbitrary(r,i);if(console.log(s),t==n)a(!0);else{var u=Date.now();e.core.data.FSio.createResource(u,function(c){console.log("started to write file with id "+u),e.core.data.FSio.write(u,new Uint8Array([]),s,function(e,c){e?(console.log("wrote file with id "+u),o.fillLibraryWithMultipleFiles(t+1,n,r,i,a)):"space"===c&&o.handleOutOfSpace(u,s,function(){console.log("handleOutOfSpace")})})},!0)}},performHandleOuOfSpaceMainFunction:function(t,n,r,i,a,o,s){var u=t;e.core.data.FSio.getLibraryStatistics(function(t){a=t;var c=u.getFileSizeFromArray(n,a.filesStats),l=u.sumFilesSizeExcludingCurrent(n,a.filesStats),d=0,h=[],f=0;if(r>(c+l+s)/o)u.failedToCleanUpOutOfSpace(n,a,i);else{for(u.sortArrayOfFilesObjectByLastModified(a.filesStats);(d<o*r-c-s||d<(l-c-s)/2+r)&&f<a.filesStats.length;)if(a.filesStats[f].key.toString().indexOf(".fi")==-1)if(n!=a.filesStats[f].key&&u.isSafeToDeleteFile(a.filesStats[f])){h.push(a.filesStats[f]);var p=u.findCorrespondingFileInfo(a.filesStats,a.filesStats[f].key+".fi");p&&h.push(p),d+=a.filesStats[f].size,f++}else f++;else f++;d>=o*r-c-s?e.core.data.FSio.deleteFiles(h,e.core.data.FSio,function(t){t?i&&i(!0):(e.error("deleteFiles failed for an unknown reason"),i&&i(!1))}):u.failedToCleanUpOutOfSpace(n,a,i)}})},handleOutOfSpace:function(t,n,r){var i,a,o=this,s=0;e.config.IS_FIREFOX?(a=2,s=0,o.performHandleOuOfSpaceMainFunction(o,t,n,r,i,a,s)):(a=1,e.core.data.FSio.getUnUsedQuotaSpace(function(e){s=e,o.performHandleOuOfSpaceMainFunction(o,t,n,r,i,a,s)}))},test:function(){var t,n=this;e.core.data.FSio.getLibraryStatistics(function(e){t=e,n.standardCleanUp(t,function(e){console.log(e)})})},standardCleanUp:function(t,n){var r=0,i=[],a=0;for(this.sortArrayOfFilesObjectByLastModified(t.filesStats);r<t.size/2&&a<t.filesStats.length;)if(t.filesStats[a].key.toString().indexOf(".fi")==-1)if(this.isSafeToDeleteFile(t.filesStats[a])){i.push(t.filesStats[a]);var o=this.findCorrespondingFileInfo(t.filesStats,t.filesStats[a].key+".fi");o&&i.push(o),r+=t.filesStats[a].size,a++}else a++;else a++;e.core.data.FSio.deleteFiles(i,e.core.data.FSio,function(e){e?n&&n(!0):n&&n(!1)})},testCleanOldFiles:function(){this.cleanOldFiles(function(e){console.log(e)})},isSafeToDeleteFile:function(t){var n=0;return n=Date.now()-t.lastModified.getTime(),!(n<e.config.TIME_PERIOD_FILE_STILL_LIVE)},cleanOldFiles:function(t){var n=this;e.core.data.FSio.getLibraryStatistics(function(r){var i=r,a=0,o=[],s=0;n.sortArrayOfFilesObjectByLastModified(i.filesStats);for(var u in i.filesStats)if(s=Date.now()-i.filesStats[u].lastModified.getTime(),s>e.config.PERIODIC_CACHE_CLEANUP_PERIOD){o.push(i.filesStats[u]);var c=n.findCorrespondingFileInfo(i.filesStats,i.filesStats[u].key+".fi");c&&o.push(c),a+=i.filesStats[u].size}e.core.data.FSio.deleteFiles(o,e.core.data.FSio,function(e){e?t&&t(!0):t&&t(!1)})})},convertMiliToDays:function(e){return Math.floor(e/864e5)},findCorrespondingFileInfo:function(e,t){var n;for(var r in e)e[r].key==t&&(n=e[r]);return n},spliceFileObjectFromArray:function(e,t){for(var n in e)e[n].key==t&&e.splice(n,1)},sortArrayOfFilesObjectByLastModified:function(e){return e.sort(function(e,t){var n=new Date(e.lastModified),r=new Date(t.lastModified);return n<r?-1:n>r?1:0}),e},getFileSizeFromArray:function(e,t){var n=0;for(var r in t)if(t[r].key==e){n=t[r].size;break}return n},sumFilesSizeExcludingCurrent:function(e,t){for(var n=0,r=0;r<t.length;r++)t[r].key!=e&&this.isSafeToDeleteFile(t[r])&&(n+=t[r].size);return n},failedToCleanUpOutOfSpace:function(t,n,r){var i=this,a=[],o=this.findCorrespondingFileInfo(n.filesStats,t),s=this.findCorrespondingFileInfo(n.filesStats,t+".fi");o&&a.push(o),s&&a.push(s),o&&(n.size-=o.size),s&&(n.size-=s.size),this.spliceFileObjectFromArray(n.filesStats,t),this.spliceFileObjectFromArray(n.filesStats,t+".fi"),e.core.data.FSio.deleteFiles(a,e.core.data.FSio,function(t){e.warn("handleOutOfSpace can not clean enough space for the wanted download "),i.standardCleanUp(n,function(e){r(!1)})})}}),e.core.data.CacheManager=new e.core.data.CacheManager}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(18);!function(){e.core.data.FSio=Object.subClass({ctor:function(){this.writeQueue=new t,this.registerEvents(),this.pendingObjectUrlCb={},this.finishWriteCbs=[],this.currentlyWriting=!1},executeOnReady:function(e){},createResource:function(t,n,r){t=t.replace("peer5://",""),e.info("Adding resource "+t+" to the filesystem.");var i=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{create:!0},function(e){n&&n(!0)},function(e){i.errorHandler(e,n)})},removeResource:function(t,n){t=t.replace("peer5://","");var r=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{create:!1},function(e){e.remove(function(){n&&n(!0)},function(e){r.errorHandler(e,n)})},function(e){r.errorHandler(e,n)})},renameResource:function(t,n,r){t=t.replace("peer5://",""),n=n.replace("peer5://",""),e.info("changing resource name from "+t+" to "+n);var i=this;this.fs.root.getDirectory(e.config.FS_ROOT_DIR,{create:!1},function(a){a.getFile(t,{create:!1},function(t){t.moveTo(a,n,function(t){t&&e.info("succesfully renamed"),r&&r(!0)},function(e){i.errorHandler(e,r)})},function(e){i.errorHandler(e,r)})},function(e){i.errorHandler(e,r)})},write:function(e,t,n,r){e=e.replace("peer5://",""),t=new Blob([t]),this._writeAvailable()?(this._addWriteCommand(e,t,n,r),this._write(e,t,n,r)):this.currentlyWriting?this._addWriteCommand(e,t,n,r):this.continueWriting()},continueWriting:function(){var e=this.writeQueue.peek();this._write(e.resourceId,e.data,e.position,e.cb)},read:function(t,n,r,i){t=t.replace("peer5://","");var a=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{},function(e){e.file(function(e){var t=new FileReader;t.onloadend=function(e){e.target.readyState!=FileReader.DONE||e.target.error||i&&i(!0,new Uint8Array(e.target.result))},t.onerror=function(e){a.errorHandler(e,i)};var o=e.slice(n,r);t.readAsArrayBuffer(o)},function(e){a.errorHandler(e,i)})},function(e){a.errorHandler(e,i)})},getBlob:function(t,n,r,i){t=t.replace("peer5://","");var a=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{},function(e){e.file(function(e){var t=e.slice(n,r);i(!0,t)},function(e){a.errorHandler(e,i)})},function(e){a.errorHandler(e,i)})},getArrayBuffer:function(t,n,r,i){t=t.replace("peer5://","");var a=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{},function(t){t.file(function(t){var a,o=new FileReader;o.onloadend=function(t){t.target.readyState==FileReader.DONE?i(!0,t.target.result):e.error("getArrayBuffer::onloadend returned with error: "+o.readyState)},a=t.slice(n,r),o.readAsArrayBuffer(a)},function(e){a.errorHandler(e,i)})},function(e){a.errorHandler(e,i)})},getResourceDetails:function(t,n){t=t.replace("peer5://","");var r=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{},function(e){e.file(function(e){n(!0,{size:e.size})},function(e){r.errorHandler(e,n)})},function(e){r.errorHandler(e,n)})},createObjectURL:function(t,n){t=t.replace("peer5://","");var r=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{},function(e){n&&n(!0,e.toURL())},function(e){r.errorHandler(e,n)})},notifyFinishWrite:function(e){this.writeQueue.getLength()<=0?e():this.finishWriteCbs.push(e)},isExist:function(t,n){t=t.replace("peer5://","");var r=this;this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{create:!1},function(e){n&&n(!0)},function(e){r.errorHandler(e,n)})},getFileInfo:function(t,n){this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{create:!1},function(e){e.file(function(e){console.log(e)})})},listFiles:function(e){var t=this,n=this.fs.root.createReader();n.readEntries(function(t){e(!0,t)},function(n){t.errorHandler(n,e)})},removeAll:function(t){e.warn("removing all files in filesystem");var n=this,r=this.fs.root.createReader();r.readEntries(function(e){for(var r,i=0;r=e[i];++i)r.isDirectory?r.removeRecursively(function(){t&&t(!0)},function(e){n.errorHandler(e,t)}):r.remove(function(){t&&t(!0)},function(e){n.errorHandler(e,t)})},function(e){n.errorHandler(e,t)})},removeRootDir:function(t){e.warn("removing all files in filesystem under "+e.config.FS_ROOT_DIR);var n=this,r=this.fs.root.createReader();r.readEntries(function(r){for(var i,a=0;i=r[a];++a)i.isDirectory&&i.name+"/"==e.config.FS_ROOT_DIR&&i.removeRecursively(function(){n.fs.root.getDirectory(e.config.FS_ROOT_DIR,{create:!0},function(e){t(!0)},function(e){n.errorHandler(e,t)})},function(e){n.errorHandler(e,t)})},function(e){n.errorHandler(e,t)})},getLibraryStatistics:function(t){var n=this,r=[],i=[];this.fs&&this.fs.root.getDirectory(e.config.FS_ROOT_DIR,{},function(e){var a=e.createReader();a.readEntries(function(e){for(var a=0;a<e.length;a++)r.push(e[a]),i.push(e[a].name);n.getStatsOfFileArray(0,{size:0,filesStats:[]},r,i,function(e){t&&t(e)})})},function(e){n.errorHandler(e,t)})},printDirectory:function(){this.fs&&this.fs.root.getDirectory(e.config.FS_ROOT_DIR,{},function(e){var t=e.createReader();t.readEntries(function(e){for(var t=0;t<e.length;t++)console.log(e[t].name)})},function(e){console.log(e)})},getStatsOfFileArray:function(e,t,n,r,i){var a=this;if(e==n.length)i&&i(t);else{var o=n[e];o.file(function(s){var u=s.size;t.size+=u,t.filesStats.push({key:s.name,size:u,lastModified:s.lastModifiedDate,fileInstance:o}),a.getStatsOfFileArray(e+1,t,n,r,i)})}},deleteFiles:function(e,t,n){var r=t,i=[];for(var a in e)i.push(e[a]);r.deleteMultipleFiles(0,i,t,n)},deleteMultipleFiles:function(e,t,n,r){if(e==t.length)r&&r(!0);else{var i=t[e],a=n;i.fileInstance.remove(function(){n.deleteMultipleFiles(e+1,t,n,r)},function(e){a.errorHandler(e,r)})}},removeAllButThis:function(t,n,r){t=t.replace("peer5://",""),n=n.replace("peer5://",""),e.info("removing all files in filesystem under "+e.config.FS_ROOT_DIR+" besides "+t+","+n);var i=this;this.fs.root.getDirectory(e.config.FS_ROOT_DIR,{},function(e){var a=e.createReader();a.readEntries(function(e){for(var a,o=e.length,s=0;a=e[s];++s)a.name!=t&&a.name!=n?a.isDirectory?a.removeRecursively(function(){o--,0===o&&r(!0)},function(e){i.errorHandler(e,r)}):a.remove(function(){o--,0===o&&r(!0)},function(e){i.errorHandler(e,r)}):o--})},function(e){i.errorHandler(e,r)});var i=this,a=this.fs.root.createReader();a.readEntries(function(t){for(var n,a=0;n=t[a];++a)n.isDirectory&&n.name+"/"==e.config.FS_ROOT_DIR&&n.removeRecursively(function(){i.fs.root.getDirectory(e.config.FS_ROOT_DIR,{create:!0},function(e){r(!0)},function(e){i.errorHandler(e,r)})},function(e){i.errorHandler(e,r)})},function(e){i.errorHandler(e,r)})},getTypeOfFS:function(){if(this.fs){if(this.fs.name.indexOf("Pers")>-1)return"PERS";if(this.fs.name.indexOf("Temp")>-1)return"TEMP"}return null},getUnUsedQuotaSpace:function(e){"PERS"==this.getTypeOfFS()&&navigator.webkitPersistentStorage.queryUsageAndQuota(function(t,n){e&&e(n-t)},function(t){e&&e(0)}),"TEMP"==this.getTypeOfFS()&&navigator.webkitTemporaryStorage.queryUsageAndQuota(function(t,n){e&&e(n-t)},function(t){e&&e(0)})},requestTempQuota:function(t,n){if(!t)var t=16106127360;if(!n)var n=function(){};e.info("requesting quota size = "+t);var r=this,i=1.1*t;window.webkitRequestFileSystem(window.TEMPORARY,i,function(e){r.onInitFs(e),r.queryTempQuota(function(e,t,r){n(!0,r-t)})},function(e){r.errorHandler(e,n)})},testRequestPersQuota:function(e){if(!e)var e=16106127360;navigator.webkitPersistentStorage.requestQuota(e,function(e){console.log("requestQuota and got: "+e)},function(e){console.log("requestQuota Error "+e)})},testRequestTempQuota:function(e){if(!e)var e=32212254720;navigator.webkitTemporaryStorage.requestQuota(e,function(e){console.log("requestQuota and got: "+e)},function(e){console.log("requestQuota Error "+e)})},testPersQueryUsageAndQuota:function(){navigator.webkitPersistentStorage.queryUsageAndQuota(function(e,t){console.log("Used quota: "+e+", total quota: "+t)},function(e){console.log("Error",e)})},testTempQueryUsageAndQuota:function(){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(e,t){console.log("Used quota: "+e+", total quota: "+t)},function(e){console.log("Error",e)})},requestPersQuota:function(t,n){if(!t)var t=16106127360;if(!n)var n=function(){};e.info("requesting perma quota size = "+t);var r=this,i=t,a=!1;radio("requestedPersQuota").broadcast(),navigator.webkitPersistentStorage.requestQuota(i,function(e){if(!a){if(a=!0,0===e)return radio("persQuotaAnswer").broadcast(!1),void(n&&n(!1));window.webkitRequestFileSystem(window.PERSISTENT,e,function(e){radio("persQuotaAnswer").broadcast(!0),r.onInitFs(e),r.queryPersQuota(function(e,t,r){n(!0,r-t)})},function(e){r.errorHandler(e,n),radio("persQuotaAnswer").broadcast(!1)})}},function(e){r.errorHandler(e,n),radio("persQuotaAnswer").broadcast(!1)}),window.setTimeout(function(){a||(a=!0,n(!1),radio("persQuotaTimeout").broadcast())},e.config.PROMPT_TIMEOUT)},queryTempQuota:function(t){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(n,r){e.info("Using: "+n/r*100+"% of temporary storage"),t&&t(!0,n,r)},function(n){e.error("queryTempQuota failed to query webkitTemporaryStorage",n),t&&t(!1)})},queryPersQuota:function(t){navigator.webkitPersistentStorage.queryUsageAndQuota(function(n,r){e.info("Using: "+n/r*100+"% of persistent storage"),t&&t(!0,n,r)},function(n){e.error("queryTempQuota failed to query webkitTemporaryStorage",n),t&&t(!1)})},_writeAvailable:function(){return this.writeQueue.isEmpty()},_write:function(t,n,r,i){t=t.replace("peer5://","");var a=this;a.currentlyWriting=!0,this.fs.root.getFile(e.config.FS_ROOT_DIR+t,{create:!1},function(e){e.createWriter(function(e){r>e.length?(e.onwriteend=function(o){return a.currentlyWriting=!1,o.target.error?(a.errorHandler(e.error,i),void a.writeQueue.dequeue()):void a._write(t,n,r,i)},e.truncate(r)):(e.onwriteend=function(e){if(a.currentlyWriting=!1,e.currentTarget.error)return void a.errorHandler(e.currentTarget.error,i);if(a.writeQueue.dequeue(),a.writeQueue.isEmpty()){i&&setTimeout(function(){i(!0)},0),a.pendingObjectUrlCb[t]&&(a.createObjectURL(t,a.pendingObjectUrlCb[t]),delete a.pendingObjectUrlCb[t]);for(var n=0;n<a.finishWriteCbs.length;++n)a.finishWriteCbs[n](t);a.finishWriteCbs=[]}else{i&&setTimeout(function(){i(!0)},0);var r=a.writeQueue.peek();a._write(r.resourceId,r.data,r.position,r.cb)}},e.onerror=function(e){a.currentlyWriting=!1,a.errorHandler(e.currentTarget.error,i)},e.seek(r),e.write(n))},function(e){a.currentlyWriting=!1,a.errorHandler(e,i)})},function(e){a.currentlyWriting=!1,a.errorHandler(e,i)})},_addWriteCommand:function(e,t,n,r){e=e.replace("peer5://","");var i={resourceId:e,data:t,position:n,cb:r};this.writeQueue.enqueue(i)},testQuota:function(){window.webkitStorageInfo.queryUsageAndQuota(webkitStorageInfo.TEMPORARY,function(e,t){console.log("Used quota: "+e+", remaining quota: "+t)},function(e){console.log("Error",e)})},registerEvents:function(){var t=this;this.onInitFs=function(n){t.fs=n,n.root.getDirectory(e.config.FS_ROOT_DIR,{create:!0},function(t){e.info("initiated filesystem")},function(n){t.errorHandler(n),e.warn("failed to create peer5 directory")})},this.errorHandler=function(t,n){var r="";switch(t.name){case"QuotaExceededError":r="QuotaExceededError",n&&n(!1,"space");break;case"NotFoundError":r="NotFoundError",n&&n(!1);break;case"SecurityError":r="SecurityError",n&&n(!1);break;case"InvalidModificationError":r="InvalidModificationError",n&&n(!1);break;case"InvalidStateError":r="InvalidStateError",n&&n(!1);break;default:r="Unknown Error",n&&n(!1)}radio("offlineStorageError").broadcast(r),e.warn("File system error: "+r)}}}),e.core.data.FSio=new e.core.data.FSio}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(18);!function(){e.core.data.FSioFireFox=Object.subClass({ctor:function(n){this.writeQueue=new t,this.executeOnInit=[],this.registerEvents(),this.pendingObjectUrlCb={},this.finishWriteCbs=[],this.db,this.filesObjectStore="files",this.filesMetaData={},this.flushSize=67108864,this.currentlyWriting=!1;var r=this;this.createTempDB(function(t){t?(r.createMainDB(function(t){t?e.info("mainDB created successfuly"):e.warn("mainDB creation had error"),n(t)}),e.info("tmpDB created successfuly")):e.warn("tmpDB creation had error")})},createTempDB:function(t){var n=this,r=window.indexedDB.open(e.config.FS_ROOT_DIR,{version:4,storage:"temporary"});r.onerror=function(e){n.errorHandler(e),console.log(e),t&&t(!1)},r.onupgradeneeded=function(e){e.target.result.createObjectStore(n.filesObjectStore)},r.onsuccess=function(e){n.tempStorageDB=e.target.result,t&&t(!0)}},actualCreationOfmainDB:function(t){var n=this,r=window.indexedDB.open(e.config.FS_ROOT_DIR,{version:4,storage:"persistent"});r.onerror=function(e){n.errorHandler(e),console.log(e),t&&t(!1)},r.onupgradeneeded=function(e){e.target.result.createObjectStore(n.filesObjectStore)},r.onsuccess=function(r){n.db=r.target.result;for(var i=0;i<n.executeOnInit.length;i++)e.core.util.envokeCallback(n.executeOnInit[i].function,n.executeOnInit[i].args,n.executeOnInit[i].context);t&&t(!0)}},createMainDB:function(e,t){var n=this;t?n.actualCreationOfmainDB(e):n.isExist("confirmed_persistent",function(t){
t?n.actualCreationOfmainDB(e):e&&e(!0)},n.tempStorageDB)},executeOnReady:function(e){this.executeOnInit.push(e)},createResource:function(t,n,r){var i=this;r||(r=i.db),e.info("Adding resource "+t+" to the indexedDB.");var i=this,a=r.mozCreateFileHandle(t);a.onsuccess=function(e){var a=this.result,o=r.transaction([i.filesObjectStore],"readwrite").objectStore(i.filesObjectStore),s=o.put(a,t);s.onsuccess=function(e){i.filesMetaData[t]={fileLength:0,appendedSinceLastFlush:0},n&&n(!0)},s.onerror=function(e){i.errorHandler(e),n&&n(!1)}},a.onerror=function(e){i.errorHandler(e),n&&n(!1)}},removeResource:function(e,t){var n=this,r=n.db.transaction([n.filesObjectStore],"readwrite").objectStore(n.filesObjectStore),i=r.delete(e);i.onsuccess=function(r){delete n.filesMetaData[e],t&&t(!0)},i.onerror=function(e){n.errorHandler(e),t&&t(!1)}},renameResource:function(t,n,r){e.info("changing resource name from "+t+" to "+n);var i=this,a=i.db.transaction([i.filesObjectStore],"readwrite").objectStore(i.filesObjectStore),o=a.get(t);o.onsuccess=function(s){if(!s.target.result)return i.errorHandler({code:"record was not found for key"+t}),void(r&&r(!1));var u=o.result,c=a.put(u,n);i.filesMetaData[n]=i.filesMetaData[t],c.onsuccess=function(n){var a=i.db.transaction([i.filesObjectStore],"readwrite").objectStore(i.filesObjectStore),o=a.delete(t);o.onsuccess=function(n){delete i.filesMetaData[t],e.info("succesfully renamed"),r&&r(!0)},o.onerror=function(e){i.errorHandler(e),r&&r(!1)}},c.onerror=function(e){i.errorHandler(e),r&&r(!1)}},o.onerror=function(e){i.errorHandler(e),r&&r(!1)}},write:function(t,n,r,i){n||e.error("Writing to resource "+t+" with no data: "+n),this._writeAvailable()?(this._addWriteCommand(t,n,r,i),this._write(t,n,r,i)):this.currentlyWriting?this._addWriteCommand(t,n,r,i):this.continueWriting()},continueWriting:function(){var e=this.writeQueue.peek();this._write(e.resourceId,e.data,e.position,e.cb)},read:function(e,t,n,r){var i=this,a=i.db.transaction(["files"]),o=a.objectStore("files"),s=o.get(e);s.onsuccess=function(a){if(!a.target.result)return i.errorHandler({code:"record was not found for key"+e}),void(r&&r(!1));var o=s.result,u=o.open("readwrite");u.location=t;var c=u.readAsArrayBuffer(n-t);c.onsuccess=function(e){r&&r(!0,new Uint8Array(e.target.result))},c.onerror=function(e){i.errorHandler(e),r&&r(!1)}},s.onerror=function(e){i.errorHandler(e),r&&r(!1)}},getBlob:function(e,t,n,r){},getResourceDetails:function(e,t){var n=this,r=n.db.transaction([n.filesObjectStore],"readwrite").objectStore(n.filesObjectStore),i=r.get(e);i.onsuccess=function(r){if(!r.target.result)return n.errorHandler({code:"record was not found for key"+e}),void(t&&t(!1));var a=i.result,o=a.open("readwrite"),s=o.getMetadata();s.onsuccess=function(e){t(!0,{size:e.target.result.size})},s.onerror=function(e){n.errorHandler(e),t&&t(!1)}},i.onerror=function(e){n.errorHandler(e),t&&t(!1)}},createObjectURL:function(e,t){var n=this,r=n.db.transaction([n.filesObjectStore],"readwrite").objectStore(n.filesObjectStore),i=r.get(e);i.onsuccess=function(r){if(!r.target.result)return n.errorHandler({code:"record was not found for key"+e}),void(t&&t(!1));var a=i.result,o=a.open("readwrite");n.checkAndFlush(o,n,e,function(e){var r=(o.name,a.getFile());r.onsuccess=function(e){var n=e.target.result;!window.URL&&window.webkitURL&&(window.URL=window.webkitURL),t&&t(!0,URL.createObjectURL(n))},r.onerror=function(e){n.errorHandler(e),t&&t(!1)}},!0)},i.onerror=function(e){n.errorHandler(e),t&&t(!1)}},notifyFinishWrite:function(e){this.writeQueue.getLength()<=0?e():this.finishWriteCbs.push(e)},isExistConfirmedPersistent:function(e,t){t(localStorage.confirmedPersistent?!0:!1)},isExist:function(e,t,n){var r=this;n||(n=r.db);try{var i=n.transaction([r.filesObjectStore],"readwrite").objectStore(r.filesObjectStore)}catch(e){console.log(e)}if(!i)return void(t&&t(!1));var a=i.get(e);a.onsuccess=function(n){if(!n.target.result)return void(t&&t(!1));var i=n.target.result,a=i.open("readonly"),o=a.getMetadata();o.onsuccess=function(n){r.filesMetaData[e]={fileLength:n.target.result.size,appendedSinceLastFlush:0},t&&t(!0)},o.onerror=function(e){r.errorHandler(e),t&&t(!1)}},a.onerror=function(e){r.errorHandler(e),t&&t(!1)}},listFiles:function(e){var t=this,n=t.db.transaction([t.filesObjectStore],"readwrite").objectStore(t.filesObjectStore),r=!0;n.openCursor().onsuccess=function(t){var n=[],i=t.target.result;i?(r=!1,n.push(i.key),i.continue()):(e(!0,n),alert("No more entries!"))}},forceRemoveAllDBwhenOutOfSpace:function(t){this.db.close(),window.indexedDB.deleteDatabase(e.config.FS_ROOT_DIR),this.createMainDB(function(e){e?t&&t(!0):t&&t(!1)})},removeAllNew:function(){var e=this,t=e.db.transaction([e.filesObjectStore],"readwrite"),n=t.objectStore(e.filesObjectStore).clear();n.onsuccess=function(e){console.log("Filesystem is empty")},n.onerror=function(e){console.log("removeAll() failed")}},removeDep:function(t){e.warn("removing all files in filesystem");var n=this,r=n.db.transaction([n.filesObjectStore],"readwrite").objectStore(n.filesObjectStore),i=!0;r.openCursor().onsuccess=function(e){var a=e.target.result;if(a){i=!1;var o=r.delete(a.key);o.onsuccess=function(e){n.filesMetaData[a.key]&&delete n.filesMetaData[a.key],a.continue()},o.onerror=function(e){t&&t(!1)}}else t&&t(!0)}},getAllKeys:function(t,n){e.warn("removing all files in filesystem");var r=this,i=r.db.transaction([r.filesObjectStore],"readwrite").objectStore(r.filesObjectStore),a=[],o=[];i.openCursor().onsuccess=function(e){var r=e.target.result;r?"confirmed_persistent"!=r.key||n?(a.push(r.key),o.push(r.value),r.continue()):r.continue():(console.log("get all keys : "+a.length),console.log("get all keys : "+o.length),t&&t(o,a))}},filterEntries:function(e,t,n,r){var i=this;if(e==t.length)r&&r(t,n);else{var a=t[e].open("readwrite"),o=a.getMetadata();o.onsuccess=function(a){var o=a.target.result.lastModified;Date.now()-o.getTime()>24?i.filterEntries(e+1,t,n,r):(t.splice(e,1),n.splice(e,1),i.filterEntries(e,t,n,r))}}},getStatsOfFileArray:function(e,t,n,r,i){var a=this;if(e==n.length)i&&i(t);else{var o=n[e].open("readwrite"),s=o.getMetadata();s.onsuccess=function(o){var s=o.target.result.size,u=o.target.result.lastModified;t.size+=s,t.filesStats.push({key:r[e],size:s,lastModified:u,fileInstance:n[e]}),a.getStatsOfFileArray(e+1,t,n,r,i)}}},printDirectory:function(){var e=this;e.getAllKeys(function(e,t){for(var n=0;n<t.length;n++)console.log(t[n])},!0)},cleanSpaceForFileDuringOutOfSpace:function(e,t){},getLibraryStatistics:function(e){var t=this;t.getAllKeys(function(n,r){t.getStatsOfFileArray(0,{size:0,filesStats:[]},n,r,function(t){e&&e(t)})})},removeOldEntries:function(e){var t=this;t.getAllKeys(function(n,r){console.log("removeOldEntries "+r),console.log("removeOldEntries "+n),t.filterEntries(0,n,r,function(n,r){console.log("truncating"),t.truncateFiles(0,n,t,function(n){n?(console.log("done truncating successfully"),t.deleteMultipleFiles(0,r,t,function(t){t?(e&&e(!0),console.log("done removeOldEntries successfully")):(console.log("done removeOldEntries failure"),e&&e(!1))})):(console.log("done truncating failure"),e&&e(!1))})})})},deleteFiles:function(e,t,n){var r=t,i=[],a=[];for(var o in e)a.push(e[o].key),i.push(e[o].fileInstance);r.truncateFiles(0,i,r,function(e){e?(console.log("done truncating successfully"),r.deleteMultipleFiles(0,a,r,function(e){e?n&&n(!0):(n&&n(!1),console.log("delete failure"))})):(console.log("truncating failure"),n&&n(!1))})},removeAll:function(e){var t=this;t.getAllKeys(function(n,r){console.log("truncating");for(var i=0;i<r.length;i++)if("confirmed_persistent"==r[i]){r.splice(i,1),n.splice(i,1);break}t.truncateFiles(0,n,t,function(n){n?(console.log("done truncating all files successfully"),t.deleteMultipleFiles(0,r,t,function(t){t?(e&&e(!0),console.log("done removeAll successfully")):(console.log("done removeAll failure"),e&&e(!1))})):(console.log("done truncating failure"),e&&e(!1))})})},deleteMultipleFiles:function(t,n,r,i){if(t==n.length)i&&i(!0);else{var a=r.db.transaction([r.filesObjectStore],"readwrite").objectStore(r.filesObjectStore),o=a.delete(n[t]);o.onsuccess=function(){r.deleteMultipleFiles(t+1,n,r,i)},o.onerror=function(t){e.error("delete multiple files error"),i&&i(!1)}}},truncateFiles:function(t,n,r,i){if(t==n.length)i&&i(!0);else{console.log("truncating "+n[t]);var a=n[t],o=a.open("readwrite"),s=o.truncate(0);s.onsuccess=function(){r.truncateFiles(t+1,n,r,i)},s.onerror=function(t){e.error("truncate needed files failure"),i&&i(!1)}}},removeRootDir:function(e){this.removeAll(e)},requestPersQuota:function(t,n,r){var i=this;i.isExist("confirmed_persistent",function(t){return t?void n(!0,e.config.PERSISTENT_FS_SIZE):r<=e.config.ALLOWED_FILE_SIZE?void n(!1,0):void i.createMainDB(function(t){t?i.createResource("confirmed_persistent",function(t){return t?(e.info("mainDB created in requestPersQuota successfuly"),localStorage.confirmedPersistent=!0,radio("persQuotaAnswer").broadcast(!0),void n(!0,e.config.PERSISTENT_FS_SIZE)):(e.warn("mainDB creation in requestPersQuota had error"),void n(!1,0))},i.tempStorageDB):(e.warn("mainDB creation had error"),n(!1,0)),window.setTimeout(function(){localStorage.confirmedPersistent||(radio("persQuotaTimeout").broadcast(),n(!1,0))},e.config.PROMPT_TIMEOUT),n(t)},!0)},i.tempStorageDB)},requestPersQuota1:function(t,n,r){var i=this;i.isExist("confirmed_persistent",function(t){if(t)return void n(!0,e.config.PERSISTENT_FS_SIZE);if(r<=e.config.ALLOWED_FILE_SIZE)return void n(!1,0);radio("requestedPersQuota").broadcast();var a,o=(new Date).getTime()+100,s=window.indexedDB.open(o,1),u=!1;s.onerror=function(e){console.log("Error obtaining quota, retrying..."),n(!1,0)},s.onsuccess=function(e){a=s.result,s.getquota()},s.onupgradeneeded=function(e){e.target.result.createObjectStore(o)},s.getquota=function(){var t=a.transaction(o,"readwrite");t.oncomplete=function(){a.close(),window.indexedDB.deleteDatabase(o),i.createResource("confirmed_persistent",function(t){if(!u){if(u=!0,!t)return void n(!1,0);radio("persQuotaAnswer").broadcast(!0),n(!0,e.config.PERSISTENT_FS_SIZE)}},!0)},t.onerror=function(e){if(!u)return u=!0,radio("persQuotaAnswer").broadcast(!1),a.close(),window.indexedDB.deleteDatabase(o),void n(!1,0)},t.objectStore(o).put(new Blob([new ArrayBuffer(62914560)]),"quota"),window.setTimeout(function(){u||(t.oncomplete=function(){},t.onerror=function(){},radio("persQuotaTimeout").broadcast(),a.close(),window.indexedDB.deleteDatabase(o),n(!1,0))},e.config.PROMPT_TIMEOUT)}})},requestTempQuota:function(t,n){e.warn("requestTempQuota shouldn't be called in firefox")},queryPersQuota1:function(t){this.isExist("confirmed_persistent",function(n){return n?void t(!0,0,e.config.PERSISTENT_FS_SIZE):void t(!1,0,0)})},queryPersQuota:function(t){var n=this;this.isExist("confirmed_persistent",function(n){return n?void t(!0,0,e.config.PERSISTENT_FS_SIZE):void t(!1,0,0)},n.tempStorageDB)},queryTempQuota:function(e){e(!1,0,0)},_writeAvailable:function(){return this.writeQueue.isEmpty()},_write_dep:function(t,n,r,i){var a=this,o=window.indexedDB.open(e.config.FS_ROOT_DIR,3);o.onerror=function(e){a.errorHandler(e),i&&i(!1)},o.onsuccess=function(e){a.db=o.result;var s=a.db.transaction([a.filesObjectStore],"readwrite").objectStore(a.filesObjectStore),u=s.get(t);u.onsuccess=function(e){if(!e.target.result)return a.errorHandler({code:"record was not found for key"+t}),void(i&&i(!1));var o=u.result,s=o.open("readwrite"),c=s.getMetadata();c.onsuccess=function(e){var s=e.target.result.size;if(r>s){var u=new FileReader;u.onload=function(e){var n=e.target.result,u=o.open("readwrite");u.oncomplete=function(){if(a.writeQueue.dequeue(),a.writeQueue.isEmpty()){i&&i(!0),a.pendingObjectUrlCb[t]&&(a.createObjectURL(t,a.pendingObjectUrlCb[t]),delete a.pendingObjectUrlCb[t]);for(var e=0;e<a.finishWriteCbs.length;++e)a.finishWriteCbs[e](t);a.finishWriteCbs=[]}else{i&&i(!0);var n=a.writeQueue.peek();a._write(n.resourceId,n.data,n.position,n.cb)}};for(var c=r-s,l=0,d=new ArrayBuffer(1048576);l<c;)c-l<1048576&&(d=new ArrayBuffer(c-l)),l+=1048576,u.append(d);var h=u.append(n);h.onerror=function(e){a.errorHandler(e),i&&i(!1)}},u.readAsArrayBuffer(n)}else{var u=new FileReader;u.onload=function(e){var n=e.target.result,s=o.open("readwrite");s.location=r;var u=s.write(n);if(u||0!=r||0!=n.byteLength)u.onsuccess=function(){var e=s.flush();e.onsuccess=function(e){if(a.writeQueue.dequeue(),a.writeQueue.isEmpty()){i&&i(!0),a.pendingObjectUrlCb[t]&&(a.createObjectURL(t,a.pendingObjectUrlCb[t]),delete a.pendingObjectUrlCb[t]);for(var n=0;n<a.finishWriteCbs.length;++n)a.finishWriteCbs[n](t);a.finishWriteCbs=[]}else{i&&i(!0);var r=a.writeQueue.peek();a._write(r.resourceId,r.data,r.position,r.cb)}},e.onerror=function(e){a.errorHandler(e),i&&i(!1)}},u.onerror=function(e){a.errorHandler(e),i&&i(!1)};else if(a.writeQueue.dequeue(),i&&i(!0),a.writeQueue.isEmpty()){a.pendingObjectUrlCb[t]&&(a.createObjectURL(t,a.pendingObjectUrlCb[t]),delete a.pendingObjectUrlCb[t]);for(var c=0;c<a.finishWriteCbs.length;++c)a.finishWriteCbs[c](t);a.finishWriteCbs=[]}else{var l=a.writeQueue.peek();a._write(l.resourceId,l.data,l.position,l.cb)}},u.readAsArrayBuffer(n)}},c.onerror=function(e){a.errorHandler(e),i&&i(!1)}},u.onerror=function(e){a.errorHandler(e),i&&i(!1)}}},_write_no_flush:function(t,n,r,i){var a=this,o=window.indexedDB.open(e.config.FS_ROOT_DIR,3);o.onerror=function(e){a.errorHandler(e),i&&i(!1)},o.onsuccess=function(e){a.db=o.result;var s=a.db.transaction([a.filesObjectStore],"readwrite").objectStore(a.filesObjectStore),u=s.get(t);u.onsuccess=function(e){if(!e.target.result)return a.errorHandler({code:"record was not found for key"+t}),void(i&&i(!1));var o=u.result,s=o.open("readwrite"),c=s.getMetadata();c.onsuccess=function(e){var s=e.target.result.size;if(r>s){var u=o.open("readwrite"),c=r-s;a.appendZerosBeforeRealData(u,t,c,n.buffer,!1,i,function(){a.performAfterWriteOperations(t,i)})}else{var u=o.open("readwrite");u.location=r;var l=u.write(n.buffer);if(!l&&0==r&&0==n.buffer.byteLength)return void a.performAfterWriteOperations(t,i);l.onsuccess=function(){a.performAfterWriteOperations(t,i)},l.onerror=function(e){a.currentlyWriting=!1,a.errorHandler(e),i&&i(!1)}}},c.onerror=function(e){a.currentlyWriting=!1,a.errorHandler(e),i&&i(!1)}},u.onerror=function(e){a.currentlyWriting=!1,a.errorHandler(e),i&&i(!1)}}},_write:function(e,t,n,r){var i=this,a=i.db.transaction([i.filesObjectStore],"readwrite").objectStore(i.filesObjectStore),o=a.get(e);i.currentlyWriting=!0,o.onsuccess=function(a){if(!a.target.result)return i.currentlyWriting=!1,i.errorHandler({code:"record was not found for key"+e}),void(r&&r(!1));var s=o.result,u=s.open("readwrite");if(i.filesMetaData[e]){var c=i.filesMetaData[e].fileLength;if(i.filesMetaData[e].fileLength=Math.max(c,n+t.buffer.byteLength),n>c){var u=s.open("readwrite"),l=n-c;i.appendZerosBeforeRealData(u,e,l,t.buffer,!1,r,function(){i.performAfterWriteOperations(e,r)})}else{var u=s.open("readwrite");u.location=n;var d=u.write(t.buffer);if(!d&&0==t.buffer.byteLength)return void i.performAfterWriteOperations(e,r);d.onsuccess=function(){i.filesMetaData[e].appendedSinceLastFlush+=t.buffer.byteLength,i.performAfterWriteOperations(e,r),i.checkAndFlush(u,i,e,function(e){e||console.log("checkAndFlush error")},!1)},d.onerror=function(e){i.errorHandler(e),r&&r(!1)}}}else;},o.onerror=function(e){i.errorHandler(e),r&&r(!1)}},performAfterWriteOperations:function(e,t){var n=this;if(n.writeQueue.dequeue(),n.currentlyWriting=!1,n.writeQueue.isEmpty()){t&&setTimeout(function(){t(!0)},0),n.pendingObjectUrlCb[e]&&(n.createObjectURL(e,n.pendingObjectUrlCb[e]),delete n.pendingObjectUrlCb[e]);for(var r=0;r<n.finishWriteCbs.length;++r)n.finishWriteCbs[r](e);n.finishWriteCbs=[]}else{t&&setTimeout(function(){t(!0)},0);var i=n.writeQueue.peek();n._write(i.resourceId,i.data,i.position,i.cb)}},_addWriteCommand:function(e,t,n,r){var i={resourceId:e,data:t,position:n,cb:r};this.writeQueue.enqueue(i)},appendZerosBeforeRealData:function(e,t,n,r,i,a,o){var s=this;if(i)if(r.byteLength>0){var u=e.append(r);u.onsuccess=function(){s.filesMetaData[t].appendedSinceLastFlush+=r.byteLength,o&&o()},u.onerror=function(){s.currentlyWriting=!1,s.writeQueue.dequeue(),a&&a(!1)}}else o&&o();else if(n>=67108864){var c=e.append(new ArrayBuffer(67108864));c.onsuccess=function(){var i=e.flush();i.onsuccess=function(i){s.appendZerosBeforeRealData(e,t,n-67108864,r,!1,a,o)},i.onerror=function(e){}},c.onerror=function(e){s.currentlyWriting=!1,s.writeQueue.dequeue(),"The operation failed for reasons unrelated to the file storage itself and not covered by any other error code."==e.target.error.message&&"UnknownError"==e.target.error.name||"The current locked file exceeded its quota limitations."==e.target.error.message&&"QuotaExceededError"==e.target.error.name?a&&a(!1,"space"):a&&a(!1)}}else if(n>0){var l=e.append(new ArrayBuffer(n));l.onsuccess=function(){if(s.filesMetaData[t].appendedSinceLastFlush+=n,s.filesMetaData[t].appendedSinceLastFlush>s.flushSize){var i=e.flush();i.onsuccess=function(n){s.appendZerosBeforeRealData(e,t,0,r,!0,a,o)},i.onerror=function(e){}}else s.appendZerosBeforeRealData(e,t,0,r,!0,a,o)},l.onerror=function(e){"The operation failed for reasons unrelated to the file storage itself and not covered by any other error code."==e.target.error.message&&"UnknownError"==e.target.error.name||"The current locked file exceeded its quota limitations."==e.target.error.message&&"QuotaExceededError"==e.target.error.name?(s.currentlyWriting=!1,s.writeQueue.dequeue(),a&&a(!1,"space")):a&&a(!1)}}else s.appendZerosBeforeRealData(e,t,0,r,!0,a,o)},checkAndFlush:function(e,t,n,r,i){if(t.filesMetaData[n].appendedSinceLastFlush>t.flushSize||i){var a=e.flush();a.onsuccess=function(e){t.filesMetaData[n].appendedSinceLastFlush=0,r&&r(!0)},a.onerror=function(e){console.log("flush error in checkAndFlush function")}}else r&&r(!0)},registerEvents:function(){this.errorHandler=function(t){var n="";switch(t.code){default:n=t}radio("offlineStorageError").broadcast(n),e.warn("File system error: "+n)}}})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(e){e.AvailabilityMap=Object.subClass({ctor:function(e,t){if(this.seeder=t,this.size=e,this.length=Math.ceil(this.size/8),this.bitArray=new Uint8Array(this.length),t)for(var n=0;n<this.length;n++)this.bitArray[n]=255;this.numOfOnBits=0,this.bitMask=[1,2,4,8,16,32,64,128]},has:function(e){if(this.isFull())return!0;var t=this.getOffsets(e);return this.bitArray[t.index]&this.bitMask[t.bit]},set:function(e){if(!this.has(e)){var t=this.getOffsets(e);return this.bitArray[t.index]=this.bitArray[t.index]|this.bitMask[t.bit],this.numOfOnBits++,!0}return!1},setSeeder:function(e){this.numOfOnBits=this.size},isFull:function(){return this.numOfOnBits==this.size},serialize:function(){return this.bitArray},deserializeAndCopy:function(e){this.bitArray=e;for(var t=0,n=0;n<e.length;++n)if(0!=e[n])for(var r=0;r<this.bitMask.length;++r)this.bitArray[n]&this.bitMask[r]&&t++;this.numOfOnBits=t},deserializeAndUpdate:function(e){for(var t=0;t<e;++t)this.set(e[t]);this.numOfOnBits+=e.length},getOffsets:function(e){var t={};return t.index=Math.floor(e/8),t.bit=e%8,t}})}(e.core.dataStructures)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){var n=e.core.dataStructures.AvailabilityMap;t.AvailabilityMapFS=n.subClass({ctor:function(e,t,n,r){this._super(e,!1),this.numOfOnFSBits=0,this.resourceId=t,this.metadataFile=t+".fi",this._initiateFromFilesystem(n,r),this.fsBitArray=new Uint8Array(this.length)},setFS:function(t,n){if(!this.has(t)||this.hasFS(t))return void n(!1);var r=this.getOffsets(t),i=new Uint8Array([this.fsBitArray[r.index]|this.bitMask[r.bit]]);this.fsBitArray[r.index]=this.fsBitArray[r.index]|this.bitMask[r.bit],this.numOfOnFSBits++;var a=this;e.core.data.FSio.write(this.metadataFile,i,r.index,function(t,r){return t?void n(!0):(e.warn("couldn't write index to metadata file "+a.metadataFile),"space"===r?a._handleOutOfSpaceError():a._handleWriteError(),void n(error))})},setFSFull:function(t){var n=this;e.core.data.FSio.write(this.metadataFile,this.bitArray,0,function(e){return e?void t(!0):(n._handleWriteError(),void t(!1))})},hasFS:function(e){if(this.isFullFS())return!0;var t=this.getOffsets(e);return this.fsBitArray[t.index]&this.bitMask[t.bit]},isFullFS:function(){return this.numOfOnFSBits===this.size},deserializeAndCopy:function(e){this.fsBitArray=e;for(var t=0,n=0;n<e.length;++n)if(0!=e[n])for(var r=0;r<this.bitMask.length;++r)this.fsBitArray[n]&this.bitMask[r]&&t++;this.numOfOnFSBits=t},removeBlock:function(t,n){if(this.has(t)){var r=this.getOffsets(t),i=this.bitArray[r.index]&~this.bitMask[r.bit],a=this;e.core.data.FSio.write(this.metadataFile,i,r.index,function(t,o){t?(a.bitArray[r.index]=i,n(!0)):(e.warn("couldn't write index to metadata file "+a.metadataFile),"space"===o?a._handleOutOfSpaceError():a._handleWriteError(),n(!1))})}else n(!0)},removeBlocksFrom:function(e,t){if(e>this.size-1)return void t(!0);var n=this;this.removeBlock(e,function(r){return r?void n.removeBlocksFrom(e+1,t):void t(!1)})},reset:function(e){this.removeBlocksFrom(0,e)},renameResource:function(t,n){var r=t+".fi",i=this;e.core.data.FSio.renameResource(this.metadataFile,r,function(e){e&&(i.metadataFile=r),n(e)})},_initiateFromFilesystem:function(t,n){var r=this;e.core.data.FSio.isExist(this.metadataFile,function(i){i?(e.info("metadata file "+r.metadataFile+" exists"),e.core.data.FSio.read(r.metadataFile,0,r.length,function(t,i){t?(r.deserializeAndCopy(i),e.info("finished initiating AvailabilityMap from FS"),n(!0)):(e.warn("error reading metadataFile "+r.metadataFile),n(!1))})):(e.info("metadata file "+r.metadataFile+" doesn't exist, creating a new one"),r.length<t?e.core.data.FSio.createResource(r.metadataFile,function(t){t?e.core.data.FSio.write(r.metadataFile,new Uint8Array([]),r.length-1,function(e,t){e?n(!0):("space"===t?r._handleOutOfSpaceError():r._handleWriteError(),n(!1))}):n(!1)}):(e.warn("not enough space to create metadata file: "+r.metadatFile+", removing root dir"),e.core.data.FSio.removeRootDir(function(){e.core.data.FSio.createResource(r.metadataFile,function(t){t?e.core.data.FSio.write(r.metadataFile,new Uint8Array([]),r.length-1,function(e,t){e?n(!0):("space"===t?radio("handleOutOfSpaceError").broadcast():radio("handleWriteError").broadcast(),n(!1))}):n(!1)})})))})}})}(e.core.dataStructures)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(10);!function(){e.core.Block=Object.subClass({ctor:function(t){this.blockSize=t,this.length=Math.ceil(this.blockSize/e.config.CHUNK_SIZE),this.buffer=null,this.verified=!1,this.hash=null,this.chunkMap=[],this.numOfChunksSet=0,this.numOfChunksPreset=0,this.isBeingDownloadedInHTTP=!1,this.httpDown=0,this.p2pDown=0,this.httpWaste=0,this.p2pWaste=0,this.fsLoad=0},getBlock:function(){return!!this.verified&&(!this.buffer||this.buffer)},setBlock:function(e,t){if(e.length===this.blockSize){if(!this.verified)for(var n=0,r=this.length;n<r;n++)this.setChunkOn(n);return this.buffer=e,this.httpWaste+=this.httpDown,this.p2pWaste+=this.p2pDown,this.httpDown=0,this.p2pDown=0,this.updateStats(t,e.length),!0}return!1},getChunk:function(t){if(this.verified){if(this.buffer){var n=t*e.config.CHUNK_SIZE,r=(1+t)*e.config.CHUNK_SIZE;return this.buffer.subarray(n,r)}return!0}return!1},hasChunk:function(e){return this.chunkMap[e]},hasOrPendingChunk:function(e){return"undefined"!=typeof this.chunkMap[e]},verifySize:function(t,n){return(t.length===e.config.CHUNK_SIZE||this.buffer.length===n)&&!(this.buffer.length<n)},setChunk:function(t,n,r){this.buffer||(this.buffer=new Uint8Array(this.blockSize));var i=new Uint8Array(n),a=t*e.config.CHUNK_SIZE,o=this.verifySize(n,i.length+a);return o?(this.buffer.set(i,a),this.setChunkOn(t),this.updateStats(r,n.length),!0):(e.warn("Tried to set chunk with corrupt data"),this.resetChunk(t),!1)},updateStats:function(e,t){"http"===e?this.httpDown+=t:"p2p"===e?this.p2pDown+=t:"fs"===e&&(this.fsLoad+=t)},presetChunk:function(t){return this.chunkMap||(this.chunkMap=[]),"undefined"!=typeof this.chunkMap[t]?void e.warn("The chunk is already pre/set"):(this.chunkMap[t]=!1,void this.numOfChunksPreset++)},resetChunk:function(t){return this.chunkMap||(this.chunkMap=[]),"undefined"==typeof this.chunkMap[t]?void e.warn("The chunk is not even pre/set"):(this.chunkMap[t]?this.numOfChunksSet--:this.numOfChunksPreset--,void delete this.chunkMap[t])},setChunkOn:function(t){if(this.chunkMap||(this.chunkMap=[]),"undefined"!=typeof this.chunkMap[t]){if(this.chunkMap[t])return void e.info("The chunk is already set");this.numOfChunksPreset--}this.chunkMap[t]=!0,this.numOfChunksSet++},getNumOfChunksSet:function(){return this.numOfChunksSet},isFull:function(){return this.numOfChunksSet===this.length},getNumOfChunksPreset:function(){return this.numOfChunksPreset},getNumOfBytesSet:function(){return this.chunkMap[this.length-1]&&this.blockSize!==e.config.BLOCK_SIZE?(this.numOfChunksSet-1)*e.config.CHUNK_SIZE+(this.blockSize%e.config.CHUNK_SIZE||e.config.CHUNK_SIZE):this.numOfChunksSet*e.config.CHUNK_SIZE},removeBlockData:function(){delete this.buffer},verifyBlock:function(n,r){if(this.verified)return 0;for(var i=0;i<this.length;++i)if(!this.chunkMap[i])return 0;if(null==this.hash)return this.verified=!0,1;if(this.buffer){var a=t.ArrayBuffer.hash(this.buffer.buffer);if(a===this.hash)return this.verified=!0,1;e.error("Hash didn't verify, block has been polluted")}else if(n){var a=t.ArrayBuffer.hash(n.buffer);if(a===this.hash)return this.buffer=n,this.verified=!0,this.updateStats(r,n.length),1;e.error("Hash didn't verify, block has been polluted")}},hashBlock:function(){for(var e=0;e<this.length;++e)if(!this.chunkMap[e])return 0;return this.hash=t.ArrayBuffer.hash(this.buffer.buffer),this.hash}})}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(2),r=n(10);!function(){var i=e.core.dataStructures.PendingBlockMap,a=n(5);e.core.dataStructures.BlockMap=Object.subClass({ctor:function(t,n,i,o){this.init=!1,this.resourceId=n,o?(this.hashAlg=e.CryptoJS.algo.SHA1.create(),this.aprioriHash=o):i&&(this.hashAlg=new r.ArrayBuffer,this.aprioriHash=i),this.metadata=new a.FileInfoMessage(null,t,null,null,e.config.BLOCK_SIZE,null,null,null,null),this.metadata.url=n,this.privateBlockMap=Object.create(null),this.numOfChunksInBlock=e.config.BLOCK_SIZE/e.config.CHUNK_SIZE,this.fileSize=t,this.numOfBlocks=Math.ceil(this.fileSize/e.config.BLOCK_SIZE),this.numOfChunks=Math.ceil(this.fileSize/e.config.CHUNK_SIZE),this.numOfVerifiedBlocks=0,this.firstMissingBlock=0,this.sizeOfLastBlock=t%e.config.BLOCK_SIZE,0==this.sizeOfLastBlock&&(this.sizeOfLastBlock=e.config.BLOCK_SIZE),this.availabilityMap,this.reportedToServer=!1,this.httpProgressBytes=0,this.httpExtraWaste=0,this.fs=!0,this._registerEvents(),e.config.USE_FS&&this.fileSize>e.config.SMALL_FILE_SIZE?(this.lruMap=new e.core.dataStructures.LRU(Math.floor(e.config.CACHE_SIZE/e.config.BLOCK_SIZE),this._lruRemoveCb),this._initiateFileSystem()):(this.fs=!1,this.availabilityMap=new e.core.dataStructures.AvailabilityMap(this.numOfBlocks))},dtor:function(){if(radio("handleOutOfSpaceError").unsubscribe([this._handleOutOfSpaceError,this]),radio("handleWriteError").unsubscribe([this._handleWriteError,this]),!this.isFull()){var e=this._getResourceStats();e.httpWaste+=e.httpDown,e.p2pWaste+=e.p2pDown,e.httpDown=0,e.p2pDown=0,radio("report:full").broadcast(this.resourceId,e)}},getSerializedMap:function(){return this.availabilityMap.serialize()},isFull:function(){return this.numOfBlocks==this.numOfVerifiedBlocks},has:function(e){return this.privateBlockMap[e]&&this.privateBlockMap[e].verified},hasChunk:function(e){var t=this.calcBlockIdChunkOffset(e);if(this.privateBlockMap[t.block])return this.privateBlockMap[t.block].hasChunk(t.chunk)},hasOrPendingChunk:function(e){var t=this.calcBlockIdChunkOffset(e);if(this.privateBlockMap[t.block])return this.privateBlockMap[t.block].hasOrPendingChunk(t.chunk)},getNumOfBlocks:function(){return this.numOfBlocks},getNumOfVerifiedBytes:function(){return this.numOfVerifiedBlocks==this.numOfBlocks?this.fileSize:this.numOfVerifiedBlocks*e.config.BLOCK_SIZE},getNumOfChunksInBlock:function(t){return t==this.numOfBlocks-1?Math.ceil(this.sizeOfLastBlock/e.config.CHUNK_SIZE):this.numOfChunksInBlock},getBlock:function(t,n){if(this.privateBlockMap[t]){var r=this.privateBlockMap[t].getBlock(t);if(this.fs){if(!r)return!1;if(1==r){var i=t*e.config.BLOCK_SIZE,a=this;e.core.data.FSio.read(this.resourceId,i,i+e.config.BLOCK_SIZE,function(e,r){if(e){var i=a.privateBlockMap[t];i.setBlock(r),a.lruMap.set(t,i),a.getBlock(t,n)}})}else this.lruMap.get(t),n(r)}else n(r)}},getChunkIdsOfBlock:function(t){if(t>=this.numOfBlocks)return[];for(var n=t==this.numOfBlocks-1?Math.ceil(this.sizeOfLastBlock/e.config.CHUNK_SIZE):this.numOfChunksInBlock,r=[],i=t*this.numOfChunksInBlock,a=i;a<i+n;++a)r.push(a);return r},getNumOfChunksSetInBlock:function(e){return void 0!==this.privateBlockMap[e]?this.privateBlockMap[e].getNumOfChunksSet():0},getNumOfChunksPresetInBlock:function(e){return this.privateBlockMap[e]?this.privateBlockMap[e].getNumOfChunksPreset():0},getNumOfBytesSetInBlock:function(e){return void 0!==this.privateBlockMap[e]?this.privateBlockMap[e].getNumOfBytesSet():0},getChunk:function(t,n){var r=this,i=this.calcBlockIdChunkOffset(t);if(this.privateBlockMap[i.block]){var a=this.privateBlockMap[i.block].getChunk(i.chunk);if(this.fs){if(!a)return n(!1);if(1==a){var o=i.block*e.config.BLOCK_SIZE;e.core.data.FSio.read(this.resourceId,o,o+e.config.BLOCK_SIZE,function(e,a){if(e){var o=r.privateBlockMap[i.block];o.setBlock(a),r.lruMap.set(i.block,o),r.getChunk(t,n)}})}else this.lruMap.get(i.block),n(!0,a)}else n(!0,a)}},resetChunk:function(e){var t=this.calcBlockIdChunkOffset(e);this.privateBlockMap[t.block]&&(this.privateBlockMap[t.block].resetChunk(t.chunk),i.removeChunk(this.resourceId,e))},presetChunk:function(e){var t=this.calcBlockIdChunkOffset(e);this.privateBlockMap[t.block]||this._createANewBlock(t.block),this.privateBlockMap[t.block].presetChunk(t.chunk),i.addChunk(this.resourceId,e)},setChunk:function(t,n,r){var a=this.calcBlockIdChunkOffset(t);this.privateBlockMap[a.block]||this._createANewBlock(a.block);var o=this.privateBlockMap[a.block].setChunk(a.chunk,n,r);return o?(this.verifyBlock(a.block,r),a.block):(i.removeChunk(this.resourceId,t),void radio("removeResource").broadcast(this.metadata.url,e.Request.FILE_SIZE_ERR,"Wrong filesize was received from the server"))},setWasteChunk:function(e,t){var n=this.calcBlockIdChunkOffset(e);this.privateBlockMap[n.block]||this._createANewBlock(n.block),this.privateBlockMap[n.block].p2pWaste+=t},setBlock:function(t,n,r){this.privateBlockMap[t]||this._createANewBlock(t);var i=this.privateBlockMap[t].setBlock(n,r);i&&(this.httpProgressBytes-=n.length,this.httpProgressBytes<0&&e.error("httpProgressBytes ("+this.httpProgressBytes+") < 0")),this.verifyBlock(t,r)},setResourceAsBeingDownloadedInHttp:function(){for(var e in this.privateBlockMap)this.privateBlockMap[e].isBeingDownloadedInHTTP=!0},unsetResourceAsBeingDownloadedInHttp:function(){for(var e in this.privateBlockMap)this.privateBlockMap[e].isBeingDownloadedInHTTP=!1},setBlockAsBeingDownloadedInHttp:function(e){this.privateBlockMap[e]||this._createANewBlock(e),this.privateBlockMap[e].isBeingDownloadedInHTTP=!0},unsetBlockAsBeingDownloadedInHttp:function(e){this.privateBlockMap[e]||this._createANewBlock(e),this.privateBlockMap[e].isBeingDownloadedInHTTP=!1},isEmpty:function(e){return!this.privateBlockMap[e]||!this.privateBlockMap[e].buffer},getBlockIndex:function(t){return Math.ceil(t/e.config.BLOCK_SIZE)},getMissingBlock:function(e){return e?this.getRandomMissingBlock():this.getFirstMissingBlock()},getFirstMissingBlock:function(){return this.firstMissingBlock},getRandomMissingBlock:function(){for(var e=0;e<1e3;e++){var t=this.numOfBlocks-this.firstMissingBlock,n=this.firstMissingBlock+Math.floor(Math.random()*t);if(!(n in this.privateBlockMap&&this.privateBlockMap[n].verified))return n;
}return this.firstMissingBlock},verifyBlock:function(t,n){if(this.privateBlockMap[t]){if(1==this.privateBlockMap[t].verifyBlock()){for(this.numOfVerifiedBlocks++;this.has(this.firstMissingBlock);)this.firstMissingBlock++;radio("blockVerified").broadcast(this.metadata.url,t);var r=this.privateBlockMap[t].blockSize;"p2p"===n?radio("blockVerifiedP2P").broadcast(this.resourceId,r):"http"===n&&radio("blockVerifiedHTTP").broadcast(this.resourceId,r),radio("blockReceived").broadcast(this.resourceId,r);var i=this;this.fs?i.getBlock(t,function(n){e.core.data.FSio.write(i.resourceId,n,t*e.config.BLOCK_SIZE,function(n,r){n?(i.lruMap.set(t,i.privateBlockMap[t]),i.availabilityMap.setFS(t,function(t){i.availabilityMap.isFullFS()&&i._verifyResource(function(t){t?(i._onResourceComplete(),radio("transferLoaded").broadcast(i.metadata)):(e.error("file verification failed"),radio("fileVerificationFailed").broadcast(),radio("removeResource").broadcast(i.resourceId,e.Request.VERIFICATION_ERR,"file verification failed"))})})):(e.warn("couldn't write block "+t+" to filesystem"),"space"===r?i._handleOutOfSpaceError():i._handleWriteError())})}):this.isFull()&&this._verifyResource(function(t){t?(i._onResourceComplete(),radio("transferLoaded").broadcast(i.metadata)):(e.error("file verification failed"),radio("fileVerificationFailed").broadcast(),radio("removeResource").broadcast(i.resourceId,e.Request.VERIFICATION_ERR,"file verification failed"))})}if(this.privateBlockMap[t].verified)return this.availabilityMap.set(t),!0}return!1},ingestBlock:function(e){return!(!this.privateBlockMap[e]||!this.privateBlockMap[e].hashBlock())&&(this.verifyBlock(e),this.privateBlockMap[e].hash)},addMetadata:function(e){this.metadata=e,this.init=!0},getMetadata:function(){return this.metadata},initiateFromLocalData:function(t,n,r){var i=this;n||(n=0),r||0==r?i.availabilityMap.hasFS(n)?e.core.data.FSio.read(i.resourceId,n*e.config.BLOCK_SIZE,(n+1)*e.config.BLOCK_SIZE,function(a,o){a?(i.initiateBlockFromLocalData(n,o)&&radio("blockReceived").broadcast(i.resourceId,i.privateBlockMap[n].blockSize),n<r?(n++,i.initiateFromLocalData(t,n,r)):(e.info("finished initiating from filesystem"),radio("resumeEnded").broadcast(),t(!0))):e.warn("couldn't initiate block "+n+" from filesystem")}):n<r?(n++,i.initiateFromLocalData(t,n,r)):(e.info("finished initiating from filesystem"),radio("resumeEnded").broadcast(),t(!0)):e.core.data.FSio.getResourceDetails(this.resourceId,function(r,a){var o=Math.floor(a.size/e.config.BLOCK_SIZE);i.availabilityMap.removeBlocksFrom(o+1,function(r){r?i.initiateFromLocalData(t,n,o):e.error("couldn't remove blocks from availability map")})})},initiateBlockFromLocalData:function(t,n){this._createANewBlock(t);for(var r=Math.ceil(n.length/e.config.CHUNK_SIZE),i=n.length-(r-1)*e.config.CHUNK_SIZE,a=this.privateBlockMap[t],o=0;o<r;++o)a.setChunkOn(o);if(a.verifyBlock(n,"fs")){for(this.numOfVerifiedBlocks++,a.fsLoad=a.blockSize;this.has(this.firstMissingBlock);)this.firstMissingBlock++;for(var o=0;o<r;++o){var s=o<r-1?e.config.CHUNK_SIZE:i;radio("peer5_received_fs_chunk").broadcast(this.resourceId,s,t*this.numOfChunksInBlock+o)}if(this.availabilityMap.set(t),this.isFull()){var u=this;this.availabilityMap.setFSFull(function(){u._onResourceComplete(),radio("transferLoaded").broadcast(u.metadata)})}return!0}return delete this.privateBlockMap[t],!1},changeResourceId:function(t,n){if(this.fs){var r=this;e.core.data.FSio.renameResource(this.resourceId,t,function(e){e?(r.resourceId=t,r.availabilityMap.renameResource(t,function(e){n(e)})):n(e)})}else this.resourceId=t,n(!0)},getDataBlob:function(e){var t=[];this._iterateBlocks(function(e){t.push(e)},0,this.numOfBlocks-1,function(){try{var n=new Blob(t,{type:"application/octet-binary"})}catch(e){"NS_ERROR_OUT_OF_MEMORY"===e.name&&radio("outOfMemoryError").broadcast(e.result)}e(n)})},getDataUint8Array:function(e){try{var t=new Uint8Array(this.metadata.size)}catch(t){if("NS_ERROR_OUT_OF_MEMORY"===t.name){t.result;radio("outOfMemoryError").broadcast(t.result),e(!1)}return}var n=0;this._iterateBlocks(function(e){t.set(e,n),n+=e.length},0,this.numOfBlocks-1,function(n){e(t)})},getBlobUrl:function(t){var n=this;if(this.fs)e.core.data.FSio.createObjectURL(this.resourceId,function(e,n){return e?void t(e,n):void t(!1)});else{var r=function(){try{n.getDataBlob(function(e){var n=window.URL.createObjectURL(e);t(!0,n)})}catch(e){"NS_ERROR_OUT_OF_MEMORY"===e.name&&(setTimeout(r,1e4),radio("outOfMemoryError").broadcast(e.result))}};r()}},getBlob:function(t){this.fs?e.core.data.FSio.getBlob(this.resourceId,0,this.fileSize,t):this.getDataBlob(function(e){t(!0,e)})},getUint8Array:function(t){this.fs?e.core.data.FSio.getArrayBuffer(this.resourceId,0,this.fileSize,function(e,n){e?t(!0,new Uint8Array(n)):t(!1)}):this.getDataUint8Array(function(e){e?t(!0,e):t(!1)})},getText:function(t){this.getUint8Array(function(n,r){n?t(!0,e.core.util.uint8ToString(r)):t(!1)})},allocateFileSize:function(t){var n=this;e.core.data.FSio.write(this.resourceId,new Uint8Array([]),this.fileSize,function(r,i){r||"space"!=i?r||e.error("error in allocateFileSize"):n._handleOutOfSpaceError(),t(r)})},allocateFileSizeSync:function(t){e.core.data.FSio.write(this.resourceId,new Uint8Array([]),this.fileSize,function(n,r){n||"space"!=r?(n||e.error("error in allocateFileSizeSync"),t&&t(n)):e.core.data.CacheManager.handleOutOfSpace(this.resourceId,this.fileSize,function(n){n?t&&t(n):(e.warn("couldn't clear enough space from offline storage"),t&&t(n))})})},_onResourceComplete:function(){this.unsetResourceAsBeingDownloadedInHttp(),this.httpExtraWaste+=this.httpProgressBytes,this.httpProgressBytes=0,this._reportStatsToServer()},_reportStatsToServer:function(){if(!this.reportedToServer){this.reportedToServer=!0;var t=this._getResourceStats();e.info("reporting to server stats: "+this.resourceId),e.info(t),radio("report:full").broadcast(this.resourceId,t)}},_registerEvents:function(){var e=this;this._lruRemoveCb=function(t){e._removeBlockData(t)},radio("handleOutOfSpaceError").subscribe([this._handleOutOfSpaceError,this]),radio("handleWriteError").subscribe([this._handleWriteError,this])},_initiateFileSystem:function(){var t=this;e.config.USE_PERSISTENT?e.core.data.FSio.queryPersQuota(function(n,r,i){0!=i?e.core.data.FSio.requestPersQuota(i,function(n,r){n?t._createOrResumeResource(r):(e.warn("couldn't initiate filesystem"),t._fallbackToNoFS())},t.fileSize):t._initiateTempFileSystem()}):this._initiateTempFileSystem()},_initiateTempFileSystem:function(){var t=this;e.core.data.FSio.queryTempQuota(function(n,r,i){i<t.fileSize?e.config.USE_PERSISTENT?e.core.data.FSio.requestPersQuota(e.config.PERSISTENT_FS_SIZE,function(n,r){n?t.availabilityMap=new e.core.dataStructures.AvailabilityMapFS(t.numOfBlocks,t.resourceId,r,function(n){n?e.core.data.FSio.createResource(t.resourceId,function(n){n?t._resourceInitedWithFS():(e.warn("failed to create resource in filesystem"),t._fallbackToNoFS())}):(e.warn("couldn't initiate metadata file"),t._fallbackToNoFS())}):(e.warn("couldn't initiate persistent filesystem"),t._fallbackToNoFS())},t.fileSize):(e.warn("not enough space in temporary storage"),t._fallbackToNoFS()):i-r>t.fileSize?t._createOrResumeResource(i-r):i-r<t.fileSize&&t._createOrResumeResource(i-r)})},addHttpProgressBytes:function(t){this.httpProgressBytes+=t,this.httpProgressBytes>this.fileSize&&e.error("httpProgressBytes ("+this.httpProgressBytes+") > fileSize ("+this.fileSize+")")},removeHttpProgressBytes:function(t){this.isFull()||(this.httpProgressBytes-=t,this.httpExtraWaste+=t,this.httpProgressBytes<0&&e.error("httpProgressBytes ("+this.httpProgressBytes+") < 0"))},_createOrResumeResource:function(t){var n=this;n.availabilityMap=new e.core.dataStructures.AvailabilityMapFS(n.numOfBlocks,n.resourceId,t,function(t){t?n.availabilityMap.numOfOnFSBits>0?e.core.data.FSio.isExist(n.resourceId,function(t){t?(e.info("Resource "+n.resourceId+" exists already in the filesystem."),radio("resumeStarted").broadcast(),n.initiateFromLocalData(function(t){t?n._resourceInitedWithFS():(e.warn("there was a problem resuming the resource"),n._fallbackToNoFS())})):n.availabilityMap.reset(function(t){t?e.core.data.FSio.createResource(n.resourceId,function(t){t?n._resourceInitedWithFS():(e.warn("failed to create resource in filesystem"),n._fallbackToNoFS())}):(e.error("couldn't reset the availability map"),n._fallbackToNoFS())})}):e.core.data.FSio.createResource(n.resourceId,function(t){t?n._resourceInitedWithFS():(e.warn("failed to create resource in filesystem"),n._fallbackToNoFS())}):(e.warn("couldn't initiate metadata file"),n._fallbackToNoFS())})},_resourceInitedWithFS:function(){this.fs=!0,radio("filesystemInitiated"+this.resourceId).broadcast(),this.init&&radio("resourceInit").broadcast(this.metadata)},_fallbackToNoFS:function(){this.fs=!1,this.availabilityMap=new e.core.dataStructures.AvailabilityMap(this.numOfBlocks),this.init&&radio("resourceInit").broadcast(this.metadata),radio("filesystemInitiated"+this.resourceId).broadcast()},_removeBlockData:function(e){this.privateBlockMap[e]&&this.privateBlockMap[e].removeBlockData()},_handleOutOfSpaceError:function(){var t;t=this.metadata.url?this.metadata.url:this.resourceId,e.info("Out of space error"),radio("pauseResource").broadcast(t,e.Request.OUT_OF_SPACE_ERR,"out of space"),e.core.data.CacheManager.handleOutOfSpace(this.resourceId,this.fileSize,function(n){n?radio("resumeResource").broadcast(t):(e.warn("couldn't clear enough space from offline storage"),radio("removeResource").broadcast(t,e.Request.OUT_OF_SPACE_ERR,"out of space"))})},_handleWriteError:function(){e.error("offline storage write error");var t;t=this.metadata.url?this.metadata.url:this.resourceId,radio("removeResource").broadcast(t,e.Request.WRITE_ERR,"offline storage write error")},_verifyResource:function(t){if(!this.hashAlg)return void t(!0);var n=this;return this.hashAlg?void this._iterateBlocks(function(t){n.hashAlg.append?n.hashAlg.append(t):n.hashAlg.update(e.core.util.base64.encode(t))},0,this.numOfBlocks-1,function(){if(n.hashAlg.end)var r=n.hashAlg.end().toUpperCase();else var r=n.hashAlg.finalize().toString().toUpperCase();e.info("resourceId "+n.resourceId+" loaded with hash = "+r),t(r===n.aprioriHash)}):void t(!0)},_getResourceStats:function(){var e={httpDown:this.httpProgressBytes,p2pDown:0,httpWaste:this.httpExtraWaste,p2pWaste:0,fsLoad:0};for(var n in this.privateBlockMap){var r=this.privateBlockMap[n];(this.isFull()||!r.isBeingDownloadedInHTTP&&t.XHR_ALLOW_RANGE&&r.isFull())&&(e.p2pDown+=r.p2pDown),e.httpDown+=r.httpDown,e.httpWaste+=r.httpWaste,e.p2pWaste+=r.p2pWaste,e.fsLoad+=r.fsLoad}return e},_iterateBlocks:function(e,t,n,r){var i=this,a=function(t){i.getBlock(t,function(i){i&&e(i,t),t++,t<=n?a(t):r(!0)})};a(t)},_createANewBlock:function(t){var n=t==this.numOfBlocks-1?this.sizeOfLastBlock:e.config.BLOCK_SIZE;this.privateBlockMap[t]=new e.core.Block(n),this.metadata.hashes&&(this.privateBlockMap[t].hash=this.metadata.hashes[t])},calcBlockIdChunkOffset:function(e){var t=Math.floor(e/this.numOfChunksInBlock),n=e%this.numOfChunksInBlock;return{block:t,chunk:n}}})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(e){e.core.dataStructures.DoublyLinkedList=Object.subClass({ctor:function(){this.length=0,this.tail=null,this.head=null},insert:function(e){var t={prev:this.tail,next:null,value:e};this.tail&&(this.tail.next=t),this.tail=t,0==this.length&&(this.head=t),this.length++},remove:function(t){t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),this.tail==t&&(this.tail=t.prev),this.head==t&&(this.head=t.next),!this.head&&this.length>1&&e.error("removing elem: "+t+" but no head in the DoublyLinkedList"),this.length--},toString:function(){for(var e=this.head;e;)e=e.next}})}(e)}).call(t,n(1))},function(e,t,n){(function(e){!function(){e.core.dataStructures.LRU=Object.subClass({ctor:function(t,n,r){this.max=t,this.dict={},this.list=new e.core.dataStructures.DoublyLinkedList,this.deleteCB=n,this.maxSizeThresholder=r},set:function(t,n){for(this.dict[t]&&(e.error("LRU: setting an element that already exists: "+t),this._delete(t)),this.list.insert(t),this.dict[t]={value:n,p:this.list.tail};this.maxSizeThresholder&&this.maxSizeThresholder()||!this.maxSizeThresholder&&this.list.length>this.max;){if(this.list.length<=0)return e.error("LRU::set: removed all elements");var r=this.list.head;this._delete(r.value,this.deleteCB)}},update:function(t,n){this.dict[t]?this.dict[t].value=n:e.error("LRU: updating an element that didnt exist: "+t)},get:function(e){if(this.dict[e]){var t=this.dict[e].p;return t==this.list.tail?this.dict[e].value:(this.list.remove(t),this.list.insert(e),this.dict[e].p=this.list.tail,this.dict[e].value)}return!1},_delete:function(e,t){var n=this.dict[e];this.list.remove(n.p),delete this.dict[e],t&&t(e,n.value)}})}()}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(){function t(e){var t=Math.floor(e/r);return t}function n(e){var t=h[e];if(!t)return!1;var n=Object.keys(t);for(var r in n){var i=a(e,r);if(i)return!0}return!1}function i(e){return!!f[e]}function a(t,n){var r=h[t];if(!r)return!1;var i=r[n];if(!i)return!1;var a=!e.core.util.isObjectEmpty(i);return a}function o(e,n){var r=t(n);h[e]||(h[e]=Object.create(null)),h[e][r]||(h[e][r]=Object.create(null)),h[e][r][n]=Date.now()}function s(t,n){for(var r=Math.floor(n/e.config.CHUNK_SIZE)+1,i=0;i<r;i++)o(t,i)}function u(e,t){s(e,t),f[e]=!0}function c(e,n){if(h[e]){var r=t(n);h[e][r]&&(delete h[e][r][n],delete f[e])}}function l(e,t){h[e]&&(delete h[e][t],delete f[e])}function d(e){delete h[e],delete f[e]}var h=Object.create(null),f=Object.create(null);return{isResourcePending:n,isBlockPending:a,isFullResourcePending:i,addChunk:o,addResource:s,addFullResource:u,removeChunk:c,removeBlock:l,removeResource:d}}var r=e.config.BLOCK_SIZE/e.config.CHUNK_SIZE;t.PendingBlockMap=n()}(e.core.dataStructures)}).call(t,n(1))},function(e,t,n){(function(e){!function(e,t){e.taskQueue=function(){function e(){return d[0]}function n(){l=t.core.util.asyncDefer(r)}function r(){if(0!==h){var t=s();t===!0?i(e()):("number"!=typeof t&&(t=0),window.setTimeout(n,t))}}function i(e){try{e()}catch(e){t.error("taskQueue::task() failed",e)}o(),h>0&&n()}function a(e){d[h]=e,h++,1===h&&n()}function o(){d.shift(),h--}function s(){if(!f.canrun)return!0;try{return f.canrun()}catch(e){return t.warn("taskQueue::canrun failed",e),o(),!1}}function u(){d=[],h=0}function c(){return d}var l,d=[],h=0,f={push:a,getTasks:c,reset:u,canrun:null};return f}}(e.core.util,e)}).call(t,n(1))},function(e,t,n){(function(e){!function(e,t){function r(t,n,r){function l(t){var n=e.getElementsByTagName(t);if(n.length>1){if(c.info("found multiple elements with tag "+t+", searching for correct one"),"video"!==t){c.info("looking for flash specific properties");for(var r=0;r<n.length;r++){var i=n[r];try{if(i&&(i.getbufferLength||i.vjs_getProperty))return c.info("Found element with getbufferLength or vjs_getProperty function"),i}catch(e){c.warn("flash element not accessible")}}return void c.warn("Could not find correct flash element")}c.info("no specific property for video tags yet, selecting first one")}else if(0===n.length)return;return n[0]}function d(){var e;return f?e=i(f):[p,g].some(function(t){if(t)return e=a(t),!!e||void 0}),e=e||0,s.maxGlobal({maxBufferHealth:Math.round(1e3*e)}),e}function h(){var e;return f?e=f.currentTime:[p,g].some(function(t){if(t)return e=o(t),!!e||void 0}),e=e||0}var f=t||null,p=n||null,g=r||null;return t||setInterval(function(){f=l("video")},u.VIDEOTAG_FIND_INTERVAL),n||setInterval(function(){p=l("object")},u.VIDEOTAG_FIND_INTERVAL),g||setInterval(function(){g=l("embed")},u.VIDEOTAG_FIND_INTERVAL),{getBufferLength:d,getPosition:h}}var i=n(31),a=n(124),o=n(125),s=n(4),u=n(2),c=n(3);t.MediaController=r}(document,e.core.media)}).call(t,n(1))},function(e,t,n){"use strict";var r=n(24),i=n(128),a=n(12),o=n(2),s=n(33),u=n(3);if(o.INTERNAL_VIDEOTAG_MONITORING){var c,l=function(e){function t(e,t){"error"===e?u.error("internal video tag monitor error",t):o[e]?r.updateAction(n,o[e]):"fps.drop"===e&&a("external.player").broadcast({action:"fps.drop",value:t.count,vendor:"videoTag",id:n})}var n=e.id||"player";r.initPlayer(n,"videoTag");var o={ready:"ready",stop:"stop","load.start":"loadStart","load.end":"loadEnd","rebuffer.start":"buffer","rebuffer.end":"resume","seek.start":"seek","seek.end":"resume","pause.start":"pause","pause.end":"play"};i(e,t)},d=!1,h=function(){if(!d){var e=s("video");e&&(d=!0,clearInterval(c),l(e))}};document.addEventListener("DOMContentLoaded",h),document.addEventListener("readystatechange",h),c=setInterval(h,50),h()}},function(e,t,n){(function(e){!function(e){e.create=function(){function e(e,n){n=n||{};var r={init:"boolean"!=typeof n.init||n.init,enabled:"boolean"!=typeof n.enabled||n.enabled,initFunction:"function"==typeof n.initFunction?n.initFunction:null,enableFunction:"function"==typeof n.enableFunction?n.enableFunction:null,disableFunction:"function"==typeof n.disableFunction?n.disableFunction:null,retryTimer:null,initialized:"boolean"!=typeof n.initialized||n.initialized};g[e]=r,r.init&&r.initFunction&&t(e)}function t(e){var t=g[e];t.initFunction&&t.initFunction(function(){a(e)},function(){o(e)})}function n(e,t){var n=g[e];n.enableFunction?n.enableFunction(function(){n.enabled=!0},t):n.enabled=!0}function r(e,t){var n=g[e];n.disableFunction?n.disableFunction(function(){n.enabled=!1},t):n.enabled=!1}function i(t,n){if("object"==typeof t&&(n=t,t=n.key),c(t))throw new Error("Trying to init a new feature that already exist");e(t,n)}function a(e){g[e].initialized=!0}function o(e){g[e].initialized=!1}function s(e,t){c(e)&&p(e)&&n(e,t)}function u(e,t){c(e)&&f(e)&&r(e,t)}function c(e){return void 0!==g[e]}function l(e){return!!c(e)&&g[e].initialized===!0}function d(e){return!!c(e)&&(f(e)&&l(e))}function h(e){return!!c(e)&&(p(e)&&l(e))}function f(e){return!!c(e)&&g[e].enabled===!0}function p(e){return f(e)===!1}var g=Object.create(null);return{add:i,enable:s,disable:u,isEnabled:f,isDisabled:p,isEnabledAndInitialized:d,isDisabledAndInitialized:h}}}(e.featureToggle=e.featureToggle||{})}).call(t,n(1))},function(e,t,n){(function(e){var t=n(9);!function(e){e.Playlist=function(e){function n(e){for(var n=t(e),r=0;r<g.length;r++){var i=t(g[r]);if(i===n)return r}return-1}function r(e,t,n){for(var r=t;r<n;r++){var i=e.segments[r],a={duration:e.durations[r],seqs:e.seqs[r]};v[i]=a}}function i(e){var t=e.segments;if(t&&0!==t.length&&(n(t[0])===-1||n(t[t.length-1])===-1)){if(n(t[0])!==-1){for(var i=0;i<t.length&&n(t[i])!==-1;i++);r(e,i,t.length);var a=t.slice(i);return void(g=g.concat(a))}if(n(t[t.length-1])!==-1){for(var i=0;i<t.length&&n(t[i])===-1;i++);r(e,0,i);var o=t.slice(0,i);return void(g=o.concat(g))}r(e,0,t.length),g=t.slice()}}function a(){return g}function o(e){return n(e)}function s(e){var t=n(e);return 0===g.length||t===g.length-1?null:t===-1?g[0]:g[t+1]}function u(e){var t=n(e);if(t!==-1){g.splice(0,t)}}function c(e,t){var n=o(e)+1,i=n+t;if(i>=g.length&&p){for(var a=g[g.length-1],s=p(a),u=[],c=0;c<s.segs.length;c++)u[c]=s.duration;var l={segments:s.segs,durations:u};r(l,0,s.segs.length),g=g.concat(s.segs)}return g.slice(n,i)}function l(e,t){var n=c(e,t),r=n.map(function(e){var t=v[e];return{segment:e,segmentData:t}});return r}function d(){return m}function h(e){var t=v[e];return{segment:e,segmentData:t}}function f(){return g[g.length-1]}var p=e.generateNextSegments,g=[],v=Object.create(null),m=e.mode;return i(e),{getSegments:a,addSegments:i,getIndex:o,getNextSegmentUrl:s,deleteToSegment:u,getSegmentsInterval:c,getSegmentsDataInterval:l,getMode:d,getSegmentData:h,getNewestSegment:f}}}(e.core.playlist)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(4),r=n(9);!function(n){n.PlaylistsHandler=function(){function n(e){if(e){var t=r(e);for(var n in T){var i=r(n);if(i===t)return T[n]}}}function i(){return S}function a(t,n){if(!n)return[];void 0!==S[t]?S[t].addSegments(n):S[t]=e.core.playlist.Playlist(n);for(var r=0;r<n.segments.length;r++){var i=n.segments[r];T[i]=t}return n.segments}function o(){if(y)return n(y)}function s(){return y}function u(e){y=e}function c(e){R=e}function l(e){var t=n(e);if(t){var r=S[t];r.deleteToSegment(e)}}function d(e){var t=n(e),r=S[t];return r.getNextSegmentUrl(e)}function h(e){if(!y)return null;var t=n(y),r=S[t],i=r.getIndex(e);if(i===-1)return null;var a=r.getIndex(y);return i-a}function f(e){if(!y||e<=0)return[];var t=n(y);if(!t)return[];var r=S[t],i=r.getSegmentsInterval(y,e);return i}function p(e){e||(e=n(y));var t=S[e];if(t)return t.getNewestSegment()}function g(e){if(!y||e<=0)return null;var t=n(y),r=S[t],i=r.getSegmentsDataInterval(y,e);i.forEach(function(e){e.segmentData.playlistName=t});var a={segmentsData:i,playlistName:t};return a}function v(){if(!y)return!1;var e=n(y),t=S[e],r=t.getIndex(y);return r>-1}function m(n,r){var i=e.core.util.PlaylistParserFactory.getParser(n);if(!i)return[];t.setMediaInfo({protocol:i.protocol});var o=i.extractPlaylistsData(n,r);if(!o)return[];var s=[];for(var u in o){var c=o[u],l=a(u,c);l&&l.length>0&&(s=s.concat(l))}return s}function _(){for(var e in S)if("live"===S[e].getMode())return!0;return!1}function E(e){var t=n(e),r=S[t],i=r.getSegmentData(e);return i.segmentData.playlistName=t,i}function b(t){if(!R)return 0;var r=n(t);if(!r)return 0;var i=S[r];if(!i)return 0;var a=i.getIndex(R),o=i.getIndex(t),s=i.getSegments();if(a===-1||o===-1)return e.warn("couldnt find lastRequestSegment or segment in playlist "+R+" "+t),0;for(var u=0,c=a+1;c<o;c++){var l=E(s[c]);u+=l.segmentData.duration}return u}var S=Object.create(null),T=Object.create(null),y=null,R=null;return{getPlaylists:i,getCurrentPlaylist:o,getLastRequestedSegment:s,setLastRequestedSegment:u,setLastLoadedSegment:c,deleteToSegment:l,getNextSegmentUrl:d,getPositionRelativeToLastRequested:h,getNextSegmentsWindow:f,getNewestSegment:p,getNextSegmentsDataWindow:g,lastRequestedSegmentExists:v,extractSegments:m,updatePlaylist:a,hasLivePlaylist:_,getSegmentData:E,getDurationFromLastLoadedToSegment:b}}}(e.core.playlist)}).call(t,n(1))},function(e,t,n){(function(t){function r(e){this.currentReport={},this.urlsMap={},this.playerEventsSanitizer=a();var t=e||{};this.onReportedEvent=t.onReportedEvent||function(){},this.registerEvents()}var i=n(6).singleton,a=n(137),o=n(12),s=n(3),u=n(4),c=n(2),l=n(15);r.prototype.registerEvents=function(){var e={speedEstimationCalculated:function(e){var t=this.urlsMap[e.url];if(t){var n=this.getSwarmReport(t);n.mode=e.mode,n.predictedSpeed=e.predictedSpeed,n.actualSpeed=e.actualSpeed,n.bytesDownloaded=e.bytesDownloaded}},fileInfoProcessed:function(e){e.swarmId&&e.url&&(this.urlsMap[e.url]=e.swarmId)},"report:full":function(e,t){var n=this.getSwarmReport(e);for(var r in t){var i=t[r];i>0&&(n[r]=n[r]?n[r]+t[r]:t[r])}},"report:p2pWaste":function(e,t){var n=this.getSwarmReport(e);n.p2pWaste=n.p2pWaste?n.p2pWaste+t:t},chunkSent:function(e,t){var n=this.getSwarmReport(e);n.p2pUp=n.p2pUp?n.p2pUp+t:t},"external.player":function(e){var t=this.playerEventsSanitizer.handle(e);if(t){"rebuffer.start"!==t.action&&"rebuffer.end"!==t.action||this.enrichRebufferReport(t);var n=this.getPlayerReport();n.push(t)}},"player.attach":function(e){["ready","load.start","load.end","pause.start","pause.end","rebuffer.start","rebuffer.end","seek.start","seek.end"].forEach(function(t){e.on(t,function(e){var t=u.getMediaInfo(),n=l({vendor:t.vendor,tracking:t.tracking,provider:t.provider},e),r=this.playerEventsSanitizer.handle(n);if(r){"rebuffer.start"!==r.action&&"rebuffer.end"!==r.action||this.enrichRebufferReport(r);var i=this.getPlayerReport();i.push(r)}},this)},this)},activePeerConnectionsNumberChanged:function(e){var t=this.getPeersReport();t.connected=e},availablePeerConnectionsNumberChanged:function(e){var t=this.getPeersReport();t.available=e}};Object.keys(e).forEach(function(t){var n=e[t];o(t).subscribe([function(){return this.onReportedEvent(),n.apply(this,arguments)},this])},this)},r.prototype.enrichRebufferReport=function(e){var n=u.getStats("*");e.context={},e.context.peers=n.numOfPeers,e.context.p2pDown=n.totalP2PDownloaded,e.context.p2pWaste=n.totalP2PWaste,e.context.httpDown=n.totalHttpDownloaded,e.context.httpWaste=n.totalHttpWaste,e.context["load.end"]=n["load.end"][0],e.context.numOfSeeks=n["seek.end"].length,e.context.numOfResources=this.getNumOfResources(),e.context.activeRequests=[],e.context.currentBuffer=t.core.apis.MediaFetcher.mediaController.getBufferLength();var r=this.getActiveResources();e.context.numOfActiveResources=r.length,r.forEach(function(t){var n=Math.round(performance.now()-t.start),r=t.resourceId||t.url;if(!r)return void s.error("Active resource without resourceId and url");var i=u.getStats(r),a=u.getSpeed(r);e.context.activeRequests.push({url:t.url,size:t.size,mod:t.mod,p2pDown:i.totalP2PDownloaded,p2pWaste:i.totalP2PWaste,p2pProgress:i.totalP2PProgress,httpDown:i.totalHttpDownloaded,httpWaste:i.totalHttpWaste,requestsCount:i.requestsCount,internalHTTPTimeouts:i.internalHTTPTimeouts||0,startBufferHealth:i.startBufferHealth,age:n,httpSpeed:Math.round(a)})});var i=u.getGlobalStats({recentAge:c.STATS_RECENT_QUERY_AGE});e.context.maxBufferHealth=i.maxBufferHealth||0,e.context.avgHTTPSpeed=Math.round(i.avgHTTPSpeed||0),e.context.internalHTTPTimeouts=i.internalHTTPTimeouts||0,e.context.playlistTimeouts=i.playlistTimeouts||0,e.context.recentP2PUploaded=i.recentP2PUploaded||0,e.context.peerConnectionsCreated=i.peerConnectionsCreated||0,e.context.totalFPSDrop=i.totalFPSDrop||0,e.context.p2pHaveReceived=i.p2pHaveMessagesReceived||0,e.context.p2pDontHaveReceived=i.p2pDontHaveMessagesReceived||0,e.context.p2pRequestReceived=i.p2pRequestMessagesReceived||0,e.context.p2pDataReceived=i.p2pDataMessagesReceived||0,e.context.p2pDownloadingReceived=i.p2pDownloadingMessagesReceived||0,e.context.p2pNewSegmentReceived=i.p2pNewSegmentMessagesReceived||0,e.context.p2pInitializingReceived=i.p2pInitializingMessagesReceived||0,e.context.p2pHaveSent=i.p2pHaveMessagesSent||0,e.context.p2pDontHaveSent=i.p2pDontHaveMessagesSent||0,e.context.p2pRequestSent=i.p2pRequestMessagesSent||0,e.context.p2pDataSent=i.p2pDataMessagesSent||0,e.context.p2pDownloadingSent=i.p2pDownloadingMessagesSent||0,e.context.p2pNewSegmentSent=i.p2pNewSegmentMessagesSent||0,e.context.p2pInitializingSent=i.p2pInitializingMessagesSent||0,e.context.matchReceived=i.matchMessagesReceived||0,e.context.sdpReceived=i.sdpMessagesReceived||0,e.context.sdpSent=i.sdpMessagesSent||0,e.context.joinSent=i.joinMessagesSent||0,e.context.leaveSent=i.leaveMessagesSent||0,e.context.numOfErrors=s.getMetrics().error},r.prototype.getActiveResources=function(){return t.state.resources.getActiveResources()},r.prototype.getNumOfResources=function(){return t.state.resources.getNumOfResources()},r.prototype.getSwarmReport=function(e){return e?(this.currentReport.swarms||(this.currentReport.swarms={}),this.currentReport.swarms[e]||(this.currentReport.swarms[e]={}),this.currentReport.swarms[e]):null},r.prototype.getPlayerReport=function(){return this.currentReport.player||(this.currentReport.player=[]),this.currentReport.player},r.prototype.getPeersReport=function(){return this.currentReport.peers||(this.currentReport.peers={}),this.currentReport.peers},r.prototype.getSwarmFileSize=function(e){if(!i.has(e))return 0;var t=i.get(e);return t.init?t.fileSize:0},r.prototype.addPeriodicalReports=function(){var e=u.getTotalDurations(),t=e.play-(this.lastPlayDuration||0),n=e.rebuffer-(this.lastRebufferDuration||0);if(this.lastPlayDuration=e.play,this.lastRebufferDuration=e.rebuffer,t||n){var r={vendor:u.getMediaInfo().vendor,action:"durations"};t>0&&(r.playDuration=t),n>0&&(r.rebufferDuration=n);var i=this.getPlayerReport();i.push(r)}},r.prototype.rotateReport=function(){this.addPeriodicalReports();var e=this.currentReport;if(e.swarms)for(var n=e.swarms,r=Object.keys(n),i=0,a=r.length;i<a;i++){var o=r[i],s=n[o],u=this.getSwarmFileSize(o);u&&(s.fileSize=u,s.httpDown+s.p2pDown>s.fileSize&&t.error("httpDown ("+s.httpDown+") + p2pDown ("+s.p2pDown+") > filesize ("+s.fileSize+")")),s.peers=t.clientInstance.controller.P2PController.getSwarmPeersCount(o)}if(!t.core.util.isObjectEmpty(e))return this.currentReport={},e},r.prototype.getSessionSummary=function(){var e=u.getTotalDurations(),n=u.getStats(),r=u.getGlobalStats(),i=u.getMediaInfo(),a=t.core.apis.MediaFetcher.mediaController.getBufferLength();return{action:"session.end",vendor:i.vendor,provider:i.provider,tracking:i.tracking,mediaType:i.type,mediaProtocol:i.protocol,playDuration:e.play,rebufferDuration:e.rebuffer,lastPlayerEvent:i.lastPlayerEvent,sinceLastPlayerEvent:i.sinceLastPlayerEvent?Date.now()-i.sinceLastPlayerEvent:void 0,numOfSeeks:n["seek.end"].length,numOfErrors:s.getMetrics().error,p2pDown:n.totalP2PDownloaded,p2pUp:n.totalP2PUploaded,httpDown:n.totalHttpDownloaded,fpsDrop:r.totalFPSDrop,avgBitrate:i.avgBitrate,currentBuffer:a}},e.exports=r}).call(t,n(1))},function(e,t,n){(function(t){function n(){function e(e){if(!c[e]){var t=Object.create(null);t.loaded=0,t.speed=void 0,t.start=performance.now(),c[e]=t}}function n(e){i(e,0)}function r(e,t){i(e,t)}function i(e,t){var n=performance.now(),r=c[e];r&&(r.loaded+=t,r.speed=r.loaded/((n-r.start)/1e3))}function a(e){delete c[e]}function o(e){var n=c[e];if(n)return n.speed<0&&t.error("speed is negative ("+n.speed+")"),n.speed}function s(e){return o(e)}function u(e){delete c[e]}var c=Object.create(null);return radio("xhrSent").subscribe([e,this]),radio("xhrComplete").subscribe([n,this]),radio("httpDownloaded").subscribe([r,this]),radio("httpAborted").subscribe([a,this]),{getSpeed:o,getPredictedSpeed:s,removeResource:u}}e.exports=n()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(146);!function(){e.core.transport.AbstractPeerConnection=Object.subClass({ctor:function(n,r,i){t.call(this),this.peerConnection,this.dataChannel,this.label=i?n+r:r+n,this.originId=n,this.targetId=r,this.createAnswerConstraints={},this.createOfferConstraints={},this.startTime,this.ready=!1,this.requestDropped=0,this.numOfPendingChunks=0,this.maxNumOfPendingChunks=e.config.MAX_PENDING_CHUNKS/2,this.failure=!1},isFull:function(e){return e?this.numOfPendingChunks+e>=this.maxNumOfPendingChunks:this.numOfPendingChunks>=this.maxNumOfPendingChunks},requestSucceeded:function(e){this.requestDropped=0,e&&this.increasePeerWindow()},requestFailed:function(){++this.requestDropped>=e.config.REQUEST_DROPPED_FAIL&&this.close()},chunksRequested:function(e){this.numOfPendingChunks+=e},chunksReceived:function(e,t){this.numOfPendingChunks-=e,this.validate()},chunksLate:function(t){this.decreasePeerWindow(t),this.validate(),e.info("peer: "+this.targetId+" has a window of "+this.maxNumOfPendingChunks+" requestDropped: "+this.requestDropped)},validate:function(){this.numOfPendingChunks<0&&(this.numOfPendingChunks=0,e.error("peerConnection numOfPendingChunks < 0"))},increasePeerWindow:function(){var t=this.maxNumOfPendingChunks;this.maxNumOfPendingChunks=Math.min(e.config.MAX_PENDING_CHUNKS,this.maxNumOfPendingChunks+1),e.info("peer "+this.targetId+" window increased from "+t+" to "+this.maxNumOfPendingChunks)},decreasePeerWindow:function(t){var n=this.maxNumOfPendingChunks;this.maxNumOfPendingChunks=Math.ceil(Math.max(this.maxNumOfPendingChunks/2,this.maxNumOfPendingChunks-2*t)),e.info("peer "+this.targetId+" window decreased from "+n+" to "+this.maxNumOfPendingChunks),this.maxNumOfPendingChunks<=e.config.SMALL_WINDOW_THRESHOLD&&e.config.CLOSE_SMALL_WINDOW_CONNECTIONS&&this.close()}}),e.core.transport.AbstractPeerConnection.prototype.__proto__=t.prototype}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(5),r=n(131),i=n(4);!function(){window.RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,window.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,window.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;var n=15728640-e.config.CHUNK_SIZE;e.core.transport.PeerConnectionImpl=e.core.transport.AbstractPeerConnection.subClass({
ctor:function(t,r,i,a){this._super(t.id,r,i),this.initiator=i,this.signaller=t.signaller,this.peerConnection=a,this.useBase64=!1,this.dataChannelOptions={},e.config.DC_UNORDERED&&(this.dataChannelOptions.ordered=!1),e.config.DC_MAX_RETRANSMITS?this.dataChannelOptions.maxRetransmits=e.config.DC_MAX_RETRANSMITS:e.config.DC_MAX_PACKET_LIFE_TIME&&(this.dataChannelOptions.maxPacketLifeTime=e.config.DC_MAX_PACKET_LIFE_TIME),this.initiatePeerConnection(i),this.sdpQueue=[],this.sdpQueueTimer=null,this.lastLatencyTimestamp=0,this.latencySlidingWindow=e.core.util.slidingWindow(),this.sendQueue=e.core.util.taskQueue();var o=this;this.sendQueue.canrun=function(){return o.ready&&o.isAvailable()&&o.getBufferedAmount()<=n}},setupCall:function(){if(this.startTime=Date.now(),"closed"===this.peerConnection.signalingState)return e.warn("cant create offer when signaling state is closed"),void this.handlePeerDisconnection();this.peerConnection.createOffer(this.setLocalAndSendMessage_,function(e){},this.createOfferConstraints);var t=this;setTimeout(function(){t.ready||(t.failure=!0,e.warn("timeout while trying to connect to peer "+t.targetId),t.handlePeerDisconnection(t.targetId))},e.config.PC_FAIL_TIMEOUT)},handleMessage:function(t){var n=t.sdpMessage;if(e.info("handling SDP message"),n.type){var r=new RTCSessionDescription(n),i=this;if(!this.peerConnectionStateValid())return;if(this.peerConnection.remoteDescriptionSet=!0,this.peerConnection.setRemoteDescription(r,function(){if(i.peerConnection.remoteDescriptionSuccessfullySet=!0,"offer"==r.type){if(!i.peerConnectionStateValid())return;i.peerConnection.createAnswer(i.setLocalAndSendMessage_,function(e){},i.createAnswerConstraints)}},function(e){}),this.peerConnection.candidatesMsgQueue){for(var a=0;a<this.peerConnection.candidatesMsgQueue.length;++a)this.peerConnection.addIceCandidate(new RTCIceCandidate(this.peerConnection.candidatesMsgQueue[a]),this.addIceCandidateFailureCallback_,this.addIceCandidateFailureCallback_);this.peerConnection.candidatesMsgQueue=null}}else if(n.candidate){if(!this.peerConnectionStateValid())return;if(!this.peerConnection.remoteDescriptionSet)return this.peerConnection.candidatesQueue||(this.peerConnection.candidatesMsgQueue=[]),void this.peerConnection.candidatesMsgQueue.push(n);var o=JSON.stringify(n);if(o in this.peerConnection.candidates)return void e.warn("candidate was already added");if(!this.peerConnectionStateValid())return;var s=new RTCIceCandidate(n);return this.peerConnection.addIceCandidate(s,this.addIceCandidateSuccessCallback_,this.addIceCandidateFailureCallback_),void(this.peerConnection.candidates[o]=Date.now())}},queue:function(t){var n=t;Array.isArray(t)||(n=[t]);var i=this;this.sendQueue.push(function(){"open"!=i.dataChannel.readyState.toLowerCase()&&e.warn("sending message to a non open channel "+JSON.stringify(t)+" to peer: "+i.targetId),i.send(r.encode(n))})},send:function(t){var n=this.useBase64?e.core.util.base64.encode(t):t.buffer;this._send(n,e.config.P2P_SEND_RETRIES)},_send:function(t,n){if(this.dataChannel&&"open"===this.dataChannel.readyState.toLowerCase())try{this.dataChannel.send(t);var r=this.dataChannel.bufferedAmount;r>0&&radio("channelBusy").broadcast(this.targetId)}catch(t){e.warn("dataChannel failed to send data",t)}else if(e.info("dataChannel was not ready, setting timeout"),n>0){n--;var i=this;setTimeout(function(){i._send(t,n)},e.config.PC_RESEND_INTERVAL)}},close:function(){this.ready=!1,this.sendQueue.reset();try{this.dataChannel&&this.dataChannel.close&&this.dataChannel.close()}catch(t){e.info("datachannel connection close error "+t.message)}try{this.peerConnection&&this.peerConnection.close&&"closed"!==this.peerConnection.signalingState&&this.peerConnection.close()}catch(t){e.info("peer connection close error "+t.message)}},getBufferedAmount:function(){return this.dataChannel.bufferedAmount},sendSdpMessage:function(t){if(this.sdpQueue.push(t),this.sdpQueue.length===e.config.PC_SDP_FLUSH_LENGTH)this.flushSdpMessageQueue();else if(!this.sdpQueueTimer){var n=this;this.sdpQueueTimer=setTimeout(function(){n.sdpQueueTimer=null,n.flushSdpMessageQueue()},e.config.PC_SDP_FLUSH_TIMEOUT)}},flushSdpMessageQueue:function(){if(clearTimeout(this.sdpQueueTimer),this.sdpQueueTimer=null,this.sdpQueue.length){var e=this.sdpQueue;this.sdpQueue=[],this.signaller.groupSdp(this.originId,this.targetId,e)}},initiatePeerConnection:function(e){this.initiatePeerConnectionCallbacks(),this.createPeerConnection(),e&&this.ensureHasDataChannel()},initiatePeerConnectionCallbacks:function(){this.registerEvents()},registerEvents:function(){var n=this;this.setLocalAndSendMessage_=function(e){e.sdp=n.transformOutgoingSdp(e.sdp),n.peerConnection.setLocalDescription(e,function(){},function(e){}),n.sendSdpMessage(e)},this.iceCallback_=function(e){e.candidate&&"disconnected"!=e.target.iceConnectionState&&n.sendSdpMessage(e.candidate)},this.iceStateChangedCallback_=function(t){t.target&&"disconnected"===t.target.iceConnectionState&&(e.info("iceStateChanged to disconnected"),n.handlePeerDisconnection())},this.signalingStateChangeCallback_=function(t){t.target&&"closed"==t.target.signalingState&&(e.info("signalingStateChanged to closed"),n.handlePeerDisconnection())},this.onCreateDataChannelCallback_=function(t){null!=n.dataChannel&&"closed"!=n.dataChannel.readyState&&e.warn("Received DataChannel, but we already have one."),n.dataChannel=t.channel,n.hookupDataChannelEvents()},this.onDataChannelReadyStateChange_=function(t){var r=t.target.readyState;e.info("dataChannel ready state changed for peer "+n.targetId+" to state: "+r),"open"==r.toLowerCase()&&(n.ready=!0,radio("connectionReady").broadcast(n.targetId))},this.onDataChannelClose_=function(){e.info("data channel was closed"),n.handlePeerDisconnection()},this.onMessageCallback_=function(i){var a=n.useBase64?e.core.util.base64.decode(i.data):new Uint8Array(i.data),o=r.decode(a);o.forEach(function(e){radio("dataReceivedEvent").broadcast(e,n),e.tag===t.P2P_DATA&&n.emit("data",e)})},this.addIceCandidateSuccessCallback_=function(e){},this.addIceCandidateFailureCallback_=function(t){e.warn("addIceCandidate failed "+t)}},ensureHasDataChannel:function(){null==this.peerConnection&&e.warn("Tried to create data channel, but have no peer connection."),null!=this.dataChannel&&"closed"!=this.dataChannel&&e.warn("Creating DataChannel, but we already have one."),this.createDataChannel()},createPeerConnection:function(){this.peerConnection?e.info("using peerConnection from pool"):(this.peerConnection=e.core.transport.PeerConnectionImpl.createPeerConnection(),e.info("creating peerConnection on demand")),this.peerConnection.candidates={},this.peerConnection.onicecandidate=this.iceCallback_,this.peerConnection.oniceconnectionstatechange=this.iceStateChangedCallback_,this.peerConnection.onicechange=this.iceStateChangedCallback_,this.peerConnection.onsignalingstatechange=this.signalingStateChangeCallback_,this.peerConnection.ondatachannel=this.onCreateDataChannelCallback_},createDataChannel:function(){e.info("createDataChannel "+this.targetId);try{this.dataChannel=this.peerConnection.createDataChannel(this.label,this.dataChannelOptions)}catch(t){return e.warn("failed creating datachannel: "+t.message),void this.handlePeerDisconnection()}this.hookupDataChannelEvents()},hookupDataChannelEvents:function(){this.dataChannel.binaryType="arraybuffer",this.dataChannel.onmessage=this.onMessageCallback_,this.dataChannel.onopen=this.onDataChannelReadyStateChange_,this.dataChannel.onclose=this.onDataChannelClose_,e.info("data-channel-status: "+this.dataChannel.readyState)},transformOutgoingSdp:function(e){var t=e.split("b=AS:30");if(t.length>1)var n=t[0]+"b=AS:1638400"+t[1];else n=e;return n},handlePeerDisconnection:function(){try{e.info("signaling state:",this.peerConnection.signalingState," icegathering state:",this.peerConnection.iceGatheringState," iceconnection state:",this.peerConnection.iceConnectionState," datachannel.readyState:",this.dataChannel?this.dataChannel.readyState:"undefined.undefined"),this.dataChannel&&"closed"!==this.dataChannel.readyState&&(e.info("handling peer disconnection: closing the datachannel"),this.dataChannel.close())}catch(t){e.info("error closing the data channel: "+t)}this.closed||(this.closed=!0,this.ready=!1,radio("connectionFailed").broadcast(this.targetId),this.emit("disconnect"))},peerConnectionStateValid:function(){try{return"closed"!=this.peerConnection.iceConnectionState&&"closed"!=this.peerConnection.signalingState||(e.warn("peerConnection state to "+this.targetId+" is invalid - 'not usable'"),!1)}catch(e){return!1}},isAvailable:function(){return this.dataChannel&&"open"===this.dataChannel.readyState.toLowerCase()}}),e.core.transport.PeerConnectionImpl.createPeerConnection=function(){for(var t,n=e.config.STUN_SERVERS,r=e.config.TURN_SERVERS?e.config.TURN_SERVERS:[],a=e.config.TURN_CREDENTIALS,o={iceServers:[]},s=0;s<n.length;++s)o.iceServers.push({urls:"stun:"+n[s]});for(var u=0;u<r.length;++u)o.iceServers.push({urls:"turn:"+r[u],credential:a[u]});try{t=new RTCPeerConnection(o),i.sumGlobal({peerConnectionsCreated:1})}catch(t){e.warn("Failed to create peer connection: "+t)}return t}}()}).call(t,n(1))},function(e,t,n){(function(e){var t=n(2),r=n(120),i=n(5),a=n(16),o=n(142),s=n(4),u=n(8);!function(){e.core.transport.WsConnection=Object.subClass({ctor:function(e,n){if(this.clientId=n,this.lastPingTimestamp=Date.now(),this.connectionDelay=0,this.socketOpenCallbacks=[],this.socket=null,this._wsServerUri=e,this._pageUrl=encodeURIComponent(u.urlWithAllowedKeys(window.location.href,t.URL_ALLOWED_QUERY_PARAMETERS)).replace(/'/g,"%27").replace(/"/g,"%22"),this._openSocket(),t.FEATURE_WS_HEARTBEAT){var r=this;setInterval(function(){r._heartbeat()},t.FEATURE_WS_HEARTBEAT_INTERVAL)}},_getWSUrl:function(){var n={id:this.clientId,page:this._pageUrl,token:a(),ver:"0.72.2",conf:t.VERSION,fallback:t.EXTERNAL_XHR_FALLBACK,enabled:e.feature.isEnabledAndInitialized(t.FEATURE_PEER5_KEY),abconfig:t.A_B_CONFIG_JSON,connectionType:window.navigator&&window.navigator.connection&&window.navigator.connection.type},r=o(n);return this._wsServerUri+"?"+r},_openSocket:function(n){if(!t.WS_ENABLED)return void e.warn("websocket is disabled");if(n&&this.socketOpenCallbacks.push(n),!this._socketInitializing){var r=this;this._socketInitializing=setTimeout(function(){r._createSocket()},this.connectionDelay)}},_createSocket:function(){e.info("trying to connect to a new websocket");try{this.socket=new(WebSocket||MozWebSocket)(this._getWSUrl())}catch(e){return void this._onSocketError(e)}this.socket.binaryType="arraybuffer",this._registerSocketEvents()},_destroySocket:function(){this._unregisterSocketEvents(),this.socket=null},_heartbeat:function(){var e=Date.now()-this.lastPingTimestamp;e>t.FEATURE_WS_HEARTBEAT_ELAPSED&&this.sendMessage(new i.HeartbeatMessage)},close:function(){this.socket.close()},_registerSocketEvents:function(){var e=this;this.socket.onopen=function(){return e._onSocketOpen.apply(e,arguments)},this.socket.onmessage=function(){return e._onSocketMessage.apply(e,arguments)},this.socket.onclose=function(){return e._onSocketClose.apply(e,arguments)},this.socket.onerror=function(){return e._onSocketError.apply(e,arguments)}},_unregisterSocketEvents:function(){this.socket.onerror=null,this.socket.onclose=null,this.socket.onmessage=null,this.socket.onopen=null},_onSocketOpen:function(){this._socketInitializing=!1,this.connectionDelay=0;for(var t;t=this.socketOpenCallbacks.shift();)e.core.util.asyncDefer(t)},_onSocketClose:function(){e.warn("websocket connection closed"),this._destroySocket()},_onSocketError:function(n){e.warn("websocket had socket error"),this._socketInitializing&&(this.connectionDelay=0===this.connectionDelay?5e3+Math.random()*t.SOCKET_RECONNECTION_INTERVAL:2*this.connectionDelay,this._socketInitializing=!1,this._openSocket())},_onSocketMessage:function(t){if("string"!=typeof t.data)return void e.warn("non string messages aren't supported");var n=JSON.parse(t.data);switch(n.tag){case i.GROUP_MATCH:s.sumGlobal({matchMessagesReceived:1}),radio("receivedGroupMatchEvent").broadcast(n);break;case i.FILE_INFO:radio("receivedFileInfo").broadcast(n);break;case i.SDP:radio("receivedSDP").broadcast(n);break;case i.GROUP_SDP:s.sumGlobal({sdpMessagesReceived:1}),radio("receivedGroupSDP").broadcast(n);break;case i.SWARM_ERROR:radio("swarmError").broadcast(n);break;case i.INFO_UPDATE_FROM_SERVER:r(n.body)}},sendData:function(e){var t=this.socket.send(e);return this.lastPingTimestamp=Date.now(),t},sendDataWithRetries:function(t,n){try{return this.sendData(t)}catch(a){e.info("cant send data - socket is not open",a);var r,i=this;"function"==typeof n?r=function(){if(n())return i.sendDataWithRetries(t,n)}:n&&(r=function(){i.sendDataWithRetries(t,!0)}),this._openSocket(r)}},sendMessage:function(e,t){return this.sendDataWithRetries(JSON.stringify(e),t)}})}()}).call(t,n(1))},function(e,t){"use strict";function n(){}function r(){for(var e,t=Math.random(),n=0;n<o.length;n++)if(t<o[n].tr){e=o[n];break}var r=e.from+Math.random()*(e.to-e.from);return r}var i=[{sdp:"v=0\no=- 395422344943089 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\nm=application 9 DTLS/SCTP 5000\nc=IN IP4 0.0.0.0\na=ice-ufrag:DABd\na=ice-pwd:SGoOIwXt/HM/kMeXGv2xZSAO\na=fingerprint:sha-256 74:AE:62:C0:D8:E4:7B:8E:70:B2:BE:DA:C5:51:E2:1C:FD:57:26:61:50:79:D7:10:C2:69:70:27:6B:50:EF:91\na=setup:actpass\na=mid:data\na=sctpmap:5000 webrtc-datachannel 1024\n",type:"offer"},{candidate:"candidate:1178812653 1 udp 2113937151 192.168.1.9 56060 typ host generation 0 ufrag DABd network-cost 50",sdpMLineIndex:0,sdpMid:"data"},{candidate:"candidate:842163049 1 udp 1677729535 77.139.183.253 56060 typ srflx raddr 192.168.1.9 rport 56060 generation 0 ufrag DABd network-cost 50",sdpMLineIndex:0,sdpMid:"data"}],a=[{sdp:"v=0\no=- 7150939944418278371 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\nm=application 9 DTLS/SCTP 5000\nc=IN IP4 0.0.0.0\nb=AS:1638400\na=ice-ufrag:UDM6\na=ice-pwd:K3qS2iHjp6JUl/9Y5CD/i+UI\na=fingerprint:sha-256 86:4B:EF:E1:D5:55:61:E1:E6:58:9D:A4:1E:6A:D0:55:0A:90:3A:16:17:52:F3:F4:47:C4:55:82:AB:AF:AB:BD\na=setup:active\na=mid:data\na=sctpmap:5000 webrtc-datachannel 1024\n",type:"answer"},{candidate:"candidate:1178812653 1 udp 2113937151 192.168.1.9 56060 typ host generation 0 ufrag DABd network-cost 50",sdpMLineIndex:0,sdpMid:"data"},{candidate:"candidate:842163049 1 udp 1677729535 77.139.183.253 56060 typ srflx raddr 192.168.1.9 rport 56060 generation 0 ufrag DABd network-cost 50",sdpMLineIndex:0,sdpMid:"data"}],o=[{from:0,to:20,tr:.0616},{from:21,to:50,tr:.133},{from:51,to:170,tr:.2773},{from:171,to:590,tr:.5183},{from:591,to:1890,tr:.897},{from:1891,to:86400,tr:1}];e.exports=function(e,t,o){function s(){return!1}function u(){g.groupSdp(f,p,i),m++}function c(){g.groupSdp(f,p,a),m++}function l(){v++,0===m&&c(),1===v&&(d(),setTimeout(h,1e3*r()))}function d(){radio("connectionReady").broadcast(p)}function h(){radio("connectionFailed").broadcast(p)}var f=e.id,p=t,g=e.signaller,v=0,m=0;return{queue:n,isFull:s,setupCall:u,handleMessage:l,initiator:o,targetId:p}}},function(e,t,n){"use strict";function r(){var e=Object.keys(a.A_B_TEST),t=null;return e.forEach(function(e){var n=a.A_B_TEST[e].length;return t&&n!==t?(o.error("A/B test config values do not match in length"),null):void(t=n)}),t}function i(){var e=r();if(!e)return"";var t=Object.keys(a.A_B_TEST),n=Math.floor(Math.random()*e),i=a.A_B_TEST.EXP_ID&&a.A_B_TEST.EXP_ID[n]||s.charAt(n),o=Object.create(null);t.forEach(function(e){var t=a.A_B_TEST[e],r=t[n];a[e]=r,o[e]=r}),o.EXP_ID=a.A_B_GROUP_ID=i,a.A_B_INITIAL_JSON=a.A_B_CONFIG_JSON=JSON.stringify(o)}var a=n(2),o=n(3),s="ABCDEFGHIJKMNLOPQRSTUVWXY";i()},function(e,t,n){(function(e){!function(e){var t=t||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((r+i)%4);else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-8*(r%4)&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-4*(r%8);return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-8*(r%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-8*(r%4);return new o.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0);if(t=s*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=d.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(){var e=t,n=e.lib,r=n.WordArray,i=n.Hasher,a=[],n=e.algo.SHA1=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],u=n[4],c=0;80>c;c++){if(16>c)a[c]=0|e[t+c];else{var l=a[c-3]^a[c-8]^a[c-14]^a[c-16];a[c]=l<<1|l>>>31}l=(r<<5|r>>>27)+u+a[c],l=20>c?l+((i&o|~i&s)+1518500249):40>c?l+((i^o^s)+1859775393):60>c?l+((i&o|i&s|o&s)-1894007588):l+((i^o^s)-899497514),u=s,s=o,o=i<<30|i>>>2,i=r,r=l}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[(r+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(r+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=i._createHelper(n),e.HmacSHA1=i._createHmacHelper(n)}(),e.CryptoJS=t}(e)}).call(t,n(1))},function(e,t,n){(function(e){!function(e){e.DownloadMode={HYBRID:1,P2P:2,HTTP:3,DYNAMIC:4}}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(e){return e&&e.stack&&r.test(e.stack)}var r=/peer5/i,i={registerEvents:function(){var t=null;t=window.onerror,"function"!=typeof t&&(t=function(){}),window.onerror=function(r,i,a,o,s){if(n(s)){e.error('Uncaught exception: "'+r+'" url:"'+i+'" line: '+a+" col: "+o,s);var u=radio("unhandledError");u.broadcast.apply(u,arguments)}t.apply(window,arguments)}}};i.registerEvents(),t.errorHandler=i}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){var n={readFileInSlices:function(t,n,r,i){var a,o=new FileReader,s=0;o.onloadend=function(u){u.target.readyState==FileReader.DONE&&i(t,u.target.result,function(){s++,(s+1)*r<n.size?(a=n.slice(s*r,(s+1)*r),1==o.readyState&&e.error("onloadend in file: "+n+" readyState==1"),o.readAsArrayBuffer(a)):s*r<n.size?(a=n.slice(s*r,n.size),o.readAsArrayBuffer(a)):i(t)})},a=n.slice(s*r,(s+1)*r),o.readAsArrayBuffer(a)}};t.fileHandler=n}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(e){function t(){function e(e,t){n[e]=t}function t(e){return n[e]}var n=Object.create(null);return{addMapping:e,getLength:t}}e.HashUrlLengthMap=t()}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(8);!function(n){var r=function(){function n(e){var t=e.split("?")[0],n=t.split("/");return n[n.length-1]="",n.join("/")}function r(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.hostname}function i(e,t){var n=e.split("/"),r=t.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/").trim()}function a(a,o){o=o.toString();var s=n(a),u=r(a),c=o.split("\n"),l=c.filter(function(e){return"#"!==e[0]&&""!==e}),d=l.map(function(n){return"/"===n[0]?n=u+n:s&&n.indexOf(s)===-1&&n.indexOf("://")===-1&&(n=i(s,n)),e.config.ZIXI_DIGEST&&(n=t.zixi(n)),n});return d}function o(e){e=e.toString();var t=e.split("\n"),n=t.filter(function(e){return e.indexOf("#EXTINF")!==-1}).map(function(e){var t=e.indexOf(",");return t===-1?Number(e.substring(8)):Number(e.substring(8,t))});return n}function s(e){for(var t,n,r=e.toString().split("\n"),i=0;i<r.length;i++)if(t=r[i],t.indexOf("#EXT-X-MEDIA-SEQUENCE:")>-1){n=t;break}var a=0;void 0!==n&&(a=+n.substr(22));var o=r.filter(function(e){return e.indexOf("#EXTINF")!==-1}).map(function(e,t){return a+t});return o}function u(r,i){var a=n(r),o=i.split("\n"),s=o.filter(function(e){return e=e.trim(),0!==e.indexOf("#")&&!!e.match(/\.(m3u8)/)}),u=s.map(function(n){return a&&n.indexOf(a)===-1&&n.indexOf("://")===-1&&(n=a+n),e.config.ZIXI_DIGEST&&(n=t.zixi(n)),n});return u}function c(e,t){var n=u(e,t);if(n&&n.length>0){for(var r=Object.create(null),i=0;i<n.length;i++){var c=n[i];r[c]=null}return r}var d=a(e,t),h=o(t),f=s(t),p=l(t)?"live":"vod",g={segments:d,durations:h,seqs:f,mode:p},v={};return v[e]=g,v}function l(e){return e=e.toString(),e.indexOf("#EXT-X-ENDLIST")===-1}return{extractPlaylistsData:c,isLiveMod:l,protocol:"hls"}},i=r();n.M3U8PlaylistParser=i}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){var n=function(t){function n(t,n){var r=t.querySelector("MPD").getAttribute("suggestedPresentationDelay");if(r){var i=e.core.util.durationToSeconds(r);i<0&&(i=0),n=Math.min(n,i)}for(var a=null,o=t.querySelectorAll("SegmentTemplate"),s=0;s<o.length;s++){var u=o[s],c=u.getAttribute("startNumber");if(c&&c>0){a=t;var l=u.getAttribute("duration"),d=u.getAttribute("timescale"),h=d?l/d:l,f=Math.floor(n/h),p=Math.max(0,c-f);u.setAttribute("startNumber",p)}}return a}function r(e,t){var n=e.documentElement.getAttribute("availabilityStartTime");if(!n)return e;var r=new Date(n);return r.setSeconds(r.getSeconds()+t),e.documentElement.setAttribute("availabilityStartTime",r.toISOString()),e}function i(e,t){var i=n(e,t);return i?i:r(e,t)}function a(e,t){for(var n=e.getAttribute("d"),r=e.getAttribute("r")||0;r>=0&&t>0;)t-=n,r--;return e.setAttribute("r",r),t}function o(e,t){for(var n=e.getAttribute("timescale"),r=t*n,i=e.querySelector("SegmentTimeline"),o=i.querySelectorAll("S");r>0&&o.length>0;){var s=o[o.length-1];if(r=a(s,r),s.getAttribute("r")<0){if(!(o.length>1)){s.setAttribute("r",0);break}i.removeChild(s)}o=i.querySelectorAll("S")}}function s(e,t){for(var n=e.querySelectorAll("SegmentTemplate"),r=0;r<n.length;r++){var i=n[r];o(i,t)}return e}function u(e,t){for(var n=Number(e.getAttribute("duration")),r=e.getAttribute("timescale"),i=r?Number(r):1,a=n/i,o=Math.floor(t/a),s=e.querySelectorAll("SegmentURL"),u=s.length>o?o:s.length-1,c=s.length-1;u>0;c--,u--)e.removeChild(s[c])}function c(e,t){for(var n=e.querySelectorAll("SegmentList"),r=0;r<n.length;r++){var i=n[r];u(i,t)}return e}function l(e,t){var n=e.documentElement.outerHTML;return n.indexOf("$Time$")!==-1&&(e=s(e,t)),n.indexOf("$Number$")!==-1&&(e=i(e,t)),n.indexOf("SegmentList")!==-1&&(e=c(e,t)),e.documentElement.outerHTML}function d(t,n,r){var i=r-e.config.SEGMENTS_AFTER_PRUNE+1;if(i<=0)return t;var a=t.indexOf(n[0])-1,o=t.indexOf(n[i])-1,s=t.slice(0,a),u=t.slice(o),c=s.concat(u);return c=c.map(function(e){if(e.indexOf("#EXT-X-MEDIA-SEQUENCE")!==-1){var t=+e.match(/\d+/)[0];e="#EXT-X-MEDIA-SEQUENCE:"+(t+i)}return e})}function h(t){if(e.config.EXTERNAL_MEDIA_LIVE_START_POS&&e.config.EXTERNAL_MEDIA_LIVE_START_POS!==-1)return p;var n=e.core.util.M3U8PlaylistParser.extractPlaylistsData("",p)[""];if(!n||"live"!==n.mode)return p;if(!n||void 0===n.durations)return p;for(var r=0,i=n.durations.length;r<t&&i>0;)r+=n.durations[i-1],i--;if(i=Math.max(i,e.config.MIN_NUMBER_OF_REMAINING_SEGMENTS),n.segments.length<=i)return p;var a,o=p.split("\n").map(function(e){return","===e[e.length-1]?e.substring(0,e.length-1):e}),s=n.segments[i],u=o.indexOf(s)-1,c=o.slice(0,u);return a=e.config.FEATURE_PRUNE_SEGMENTS_FROM_START?d(c,n.segments,i-1):c,""===o[o.length-1]&&""!==a[a.length-1]&&a.push(""),a.join("\n")}function f(e){if("string"!=typeof p||!p||0===p.length||0===e)return p;if(p.indexOf("#EXTM3U")>-1)return h(e);var t=new DOMParser,n=t.parseFromString(p,"application/xml"),r=n.querySelector("MPD");if(r&&"dynamic"===r.getAttribute("type")){var i=l(n,e);return i}return p}var p=t;return{delayManifest:f}};t.ManifestManipulator=n}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){window=window||self,function(t){t.loadScript=function(e,t){var n=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=t,r.onload=t,n.appendChild(r)},t.isObjectEmpty=function(e){for(var t in e)if(e[t])return!1;return!0},t.envokeCallback=function(e,n,r){r=r||window,e&&"function"==typeof e&&t.asyncDefer(function(){e.apply(r,n)})},t.envokeCallbackSync=function(e,t,n){n=n||window,e&&"function"==typeof e&&e.apply(n,t)},t.executeFunctionByName=function(e,t,n){for(var r=e.split("."),i=r.pop(),a=0;a<r.length;a++)t=t[r[a]];return t[i].apply(t,n)},t.uint8ToString=function(e){for(var t=32768,n=[],r=0;r<e.length;r+=t)n.push(String.fromCharCode.apply(null,e.subarray(r,r+t)));return n.join("")},t.overrideNative=function(){var e=Math.floor;Math.floor=function(t){var n=t;if(!isNaN(n))return e(t)};var t=Math.ceil;Math.ceil=function(e){var n=e;if(!isNaN(n))return t(e)};var n=Math.round;Math.round=function(e){var t=e;if(!isNaN(t))return n(e)}},t.parseResponseHeaders=function(e){var t={};if(!e)return t;for(var n=e.split("\r\n"),r=0;r<n.length;r++){var i=n[r],a=i.indexOf(": ");if(a>0){var o=i.substring(0,a).toLocaleLowerCase(),s=i.substring(a+2);t[o]=s}}return t},t.parseResponseLengthHeader=function(e,t){return e&&2==e.split("/").length?parseInt(e.split("/")[1]):t?parseInt(t):void 0};var n={},r=0;window.addEventListener("message",function(e){if(e.data&&"string"==typeof e.data&&e.data.indexOf("peer5")!==-1){var t=e.data.substr(6);void 0!==n[t]&&(n[t][0].apply(n[t][1]),delete n[t])}}),t.asyncDefer=function(e,t){r++,n[r]=[e,t],window.postMessage("peer5/"+r,location.href)},t.removeSubDomain=function(e){var t=e.split(".");return t.shift(),t.join(".")},t.durationToSeconds=function(e){function t(e){if(!e)return 0;var t=e.substring(0,e.length-1);return Number(t)}var n=/P([0-9.]+Y)?([0-9.]+M)?([0-9.]+D)?T([0-9.]+H)?([0-9.]+M)?([0-9.]+S)?$/i;if(n.test(e)){var r=n.exec(e),i=0;return i+=31536e3*t(r[1]),i+=2592e3*t(r[2]),i+=86400*t(r[3]),i+=3600*t(r[4]),i+=60*t(r[5]),i+=t(r[6])}return-1},t.longestSequence=function(e){for(var t=0,n=0,r=0,i=0,a=e.slice().sort(),o=1,s=a.length;o<s;o++)a[o]===a[o-1]+1?(i++,i>r&&(r=i,t=o-i,n=o)):i=0;return a.slice(t,n+1)},t.average=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n];return t/r},e.core.util.overrideNative()}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){var n=e.core.util,r=function(){function t(e,t){for(var n,r,i=0;i<Math.min(e.length,t.length);i++)if(e[i]!==t[i]){n=i;break}for(var a=e.length-1,o=t.length-1;a>=0&&o>=0;a--,o--)if(e[a]!==t[o]){r=o;break}var s=t.substring(n,r+1);return Number(s)}function r(e){var t=e.split("/"),n=t[0]+"//"+t[2]+"/";return n}function i(e){if(e.mpdAvailabilityStartTime>e.manifestCreationTime)return-1;var t=e.mpdSuggestedPresentationDelay||0,n=e.mpdTimeShiftBufferDepth||0,r=e.segmentTemplate,i=r.segmentDuration/r.timescale,a=e.manifestCreationTime-(e.mpdAvailabilityStartTime+e.periodStart);if(a<0)return-1;var o=a-2*i-n;o<0&&(o=0);var s=Math.ceil(o/i)*i,u=a;if(u<0)return-1;var c=Math.floor(u/i)*i,l=c-t;l<0&&(l=0);var d,h=Math.floor(l/i)*i;d=h>=s?h:s;var f=d/i+1;return f+=e.segmentTemplate.startNumber||0}function a(e,t){for(var n=[],r=e.mediaPresentationDuration,i=0;i<e.periods.length;i++){var a=e.periods[i];if(r=a.duration||r,a.adaptationSets)for(var o=0;o<a.adaptationSets.length;o++){var s=a.adaptationSets[o];if(s.representations)for(var u=0;u<s.representations.length;u++){var c=s.representations[u];c.mpdType=e.type,c.mpdAvailabilityStartTime=e.availabilityStartTime,c.mpdSuggestedPresentationDelay=e.suggestedPresentationDelay,c.mpdTimeShiftBufferDepth=e.timeShiftBufferDepth,c.periodStart=a.start,c.periodDuration=r,c.manifestCreationTime=t,n.push(c)}}}return n}function o(e){if(e.baseUrl&&e.baseUrl.path_){var t=e.baseUrl.path_.lastIndexOf("/");return t!==-1?e.baseUrl.path_.substring(0,t+1):e.baseUrl.path_}return""}function s(e){var r=n.UrlUtils.combine(e.urlPrefix,n.UrlUtils.combine(e.segmentBaseUrl,e.staticParsedUrlTemplate)),a=Math.ceil(1800/e.normalizedSegmentDuration),o=i(e);if(o<0)return null;for(var s=o+a,u=[],c=[],l=o;l<s;l++){var d=r.replace("$Number$",l);u.push(d),c.push(l)}return u={segs:u,seqs:c,generateNextSegments:function(n){for(var i=t(r,n),o=i+1,s=o+a,u=e.segmentTemplate.segmentDuration/(e.segmentTemplate.timescale||1),c=[],l=[],d=o;d<s;d++){var h=r.replace("$Number$",d);c.push(h),l.push(d)}return{segs:c,duration:u,seqs:l}}}}function u(e){for(var t=Math.ceil(e.periodDuration/e.normalizedSegmentDuration),r=e.segmentTemplate.startNumber||1,i=r+t,a=[],o=[],s=r;s<i;s++){var u=e.staticParsedUrlTemplate.replace("$Number$",s),c=n.UrlUtils.combine(e.urlPrefix,n.UrlUtils.combine(e.segmentBaseUrl,u));a.push(c),o.push(s)}return{segs:a,seqs:o}}function c(e){var t=[],r=[],i=[];if(e.segmentTemplate&&e.segmentTemplate.timeline&&e.segmentTemplate.timeline.timePoints&&e.segmentTemplate.timeline.timePoints.length>0)for(var a=null,o=0;o<e.segmentTemplate.timeline.timePoints.length;o++){var s=e.segmentTemplate.timeline.timePoints[o],u=[],c=s.startTime||a||0;a=c+s.duration*(s.repeat||1);for(var l=c,d=0;d<(s.repeat||1);l+=s.duration,d++){var h=s.duration/(e.segmentTemplate.timescale||1);r.push(h);var f=e.staticParsedUrlTemplate.replace("$Time$",l),p=n.UrlUtils.combine(e.urlPrefix,n.UrlUtils.combine(e.segmentBaseUrl,f));u.push(p),i.push(l)}t=t.concat(u)}return{segs:t,durations:r,seqs:i}}function l(e){var t;t=e.periodDuration?u(e):s(e);for(var n=e.segmentTemplate.segmentDuration/(e.segmentTemplate.timescale||1),r=[],i=0;i<t.segs.length;i++)r.push(n);return t.durations=r,t}function d(e){var t=o(e);if(e.segmentList&&e.segmentList.segmentUrls&&e.segmentList.segmentUrls.length>0){for(var r=e.segmentList.segmentDuration/(e.segmentList.timescale||1),i=[],a=0;a<e.segmentList.segmentUrls.length;a++)i.push(r);
var s=e.segmentList.segmentUrls.map(function(t){var r=n.UrlUtils.combine(e.urlPrefix,n.UrlUtils.combine(e.segmentBaseUrl,t.mediaUrl.path_));return r});return{segs:s,durations:i}}if(e.segmentTemplate&&e.segmentTemplate.mediaUrlTemplate){if(e.staticParsedUrlTemplate=e.segmentTemplate.mediaUrlTemplate.replace("$Bandwidth$",e.bandwidth).replace("$RepresentationID$",e.id),e.normalizedSegmentDuration=e.segmentTemplate.timescale?e.segmentTemplate.segmentDuration/e.segmentTemplate.timescale:e.segmentTemplate.segmentDuration,e.segmentBaseUrl=t,e.staticParsedUrlTemplate.indexOf("$Time$")!==-1)return c(e);if(e.staticParsedUrlTemplate.indexOf("$Number$")!==-1){var u=l(e);if(u)return u}return[]}return[]}function h(e,t,n){for(var r={},i=0;i<t.length;i++){var a=t[i];a.urlPrefix=e;var o=d(a),s="representation_"+i+"_"+a.id,u={segments:o.segs||[],durations:o.durations||[],seqs:o.seqs||[],mode:n,generateNextSegmentsFunc:o.generateNextSegments};r[s]=u}return r}function f(t,n){var i=e.shaka.dash.mpd.parseMpd(n,t);if(!i)return null;var o=(new Date).getTime()/1e3,s=a(i,o),u=r(t),c=p(n)?"live":"vod",l=h(u,s,c);return l}function p(t){var n=e.shaka.dash.mpd.parseMpd(t,"http://dummy.com/");return"dynamic"===n.type}return{extractPlaylistsData:f,isLiveMod:p,protocol:"dash"}},i=r();t.MPDPlaylistParser=i}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){var n=function(){function t(t){var n=l[t];n.idleTimeout&&clearTimeout(n.idleTimeout),n.idleTimeout=setTimeout(function(){radio("connectionIdle").broadcast({peerId:t,peerData:n})},1e3*e.config.SECONDS_BEFORE_IDLE)}function n(e){l[e]={idleTimeout:null,totalBytesReceived:0,totalDownloadTime:0,lastDownloadTimestamp:Date.now(),totalBytesSent:0,lastUploadTimestamp:Date.now(),lastSwarmReportedAsHave:null,lastHaveReportTimestamp:Date.now()},t(e)}function r(e,r){l[e]||n(e);var i=l[e];i.totalBytesSent+=r,i.lastUploadTimestamp=Date.now(),t(e)}function i(e,t){c[e]||(c[e]=Object.create(null));for(var n=0;n<t.length;n++){var r=t[n];c[e][r]=Date.now()}}function a(e,r,i){l[e]||n(e);var a=l[e],o=i.bytes,s=Date.now()-c[r][i.id];a.totalBytesReceived+=o,a.totalDownloadTime+=s,a.lastDownloadTimestamp=Date.now(),t(e)}function o(e){l[e]||n(e)}function s(e){delete l[e]}function u(e,t){l[e]||n(e);var r=l[e];r.lastSwarmReportedAsHave=t,r.lastHaveReportTimestamp=Date.now()}var c=Object.create(null),l=Object.create(null);return{reportChunksRequestFromPeer:i,reportChunksReceivedFromPeer:a,reportUploadToPeer:r,reportPeerConnected:o,reportPeerDisconnected:s,reportPeerHaveSwarm:u}};t.PeersPerformanceTracker=n()}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(){function t(t){for(;t.length>e.config.RELEVANT_LAST_ENTRIES;)t.pop()}function n(e,n,r){var i={bytes:n,speed:r};"p2p"===e?(u.unshift(i),t(u)):(c.unshift(i),t(c))}function r(t){var n=0,r=Math.min(e.config.RELEVANT_LAST_ENTRIES,t.length);if(r<=0)return 0;var i;for(i=0;i<r;i++)n+=t[i].speed;var a=n/i;return a}function i(){return r(u)}function a(){return r(c)}function o(e,t){var n,r,i;e.loadedP2P?(r=e.currentTarget._p2pBps,n="p2p",i=e.loadedP2P):e.loadedHTTP&&(r=e.currentTarget._httpBps,n="http",i=e.loadedHTTP);var a={url:e.currentTarget._url,mode:n,predictedSpeed:Math.round(r),actualSpeed:Math.round(t),bytesDownloaded:i};radio("speedEstimationCalculated").broadcast(a)}function s(t){if(t.total&&!(t.loadedP2P&&t.loadedHTTP||t.currentTarget._speed<=0)){if(t.loadedP2P)n("p2p",t.loadedP2P,t.currentTarget._speed);else{if(!t.loadedHTTP)return;n("http",t.loadedHTTP,t.currentTarget._speed)}e.config.FEATURE_DOWNLOAD_SPEED_ESTIMATION&&o(t,t.currentTarget._speed)}}var u=[],c=[];return function(){radio("downloadEnd").subscribe(s)}(),{p2pDownloadBPS:i,httpDownloadBPS:a}}radio("requestSent").subscribe(function(t){e.config.FEATURE_DOWNLOAD_SPEED_ESTIMATION&&(t._p2pBps=e.core.util.DownloadSpeedEstimator.p2pDownloadBPS(),t._httpBps=e.core.util.DownloadSpeedEstimator.httpDownloadBPS()),["load","abort"].forEach(function(e){t.addEventListener(e,function(t){t._event=e,radio("downloadEnd").broadcast(t)})})}),t.DownloadSpeedEstimator=n()}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){var n=function(){function t(e){var t=e._url.indexOf(".mpd")>-1&&"arraybuffer"===e.responseType;if(!t&&e.responseType&&"text"!==e.responseType)return!1;var r=e._url;return!!n(r)}function n(t){return t.indexOf("m3u8")>-1?e.core.util.M3U8PlaylistParser:t.indexOf("mpd")>-1?e.core.util.MPDPlaylistParser:null}return{isPlaylistCandidate:t,getParser:n}},r=n();t.PlaylistParserFactory=r}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(e){function t(){function e(e,t){i[e]=t}function t(e){return i[e]}function n(e){i[e]=null}function r(){i=Object.create(null)}var i=Object.create(null);return{save:e,load:t,remove:n,clear:r}}e.createPlaylistCache=t}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){var t=n(7);!function(n){function r(n,r){function s(t,n){e.info("prefetching "+t.segment+" in p2p"),t.downloadMode="p2p";var r={onswarmstatechange:function(e){b.requestSwarmStateChanged(e)},onerror:function(e){T.reportRequestDone(i),n()},onabort:function(e){T.reportRequestDone(o),y.onRequestEvent("abort",e),n()},onload:function(e){T.reportRequestDone(a),y.onRequestEvent("load",e),200===e.currentTarget.status&&b.saveDownloadSpeed(e.currentTarget),n()}},s=e.core.util.PrefetchRequestSender(t,r),u=s.send();return T.useP2PSlot(),R[u._segmentData.segment]=u,u}function u(n){var r=new t;r.open("GET",n),r.onloadend=function(){if(this.status>=200&&this.status<300&&this.response){var t=e.core.util.PlaylistParserFactory.getParser(n),r=t.extractPlaylistsData(n,this.response),i=Object.keys(r),a=r[i[0]];if(a){S.extractSegments(n,this.response),a.rawContent=this.response,a.manifestUrl=n;var o=t.isLiveMod(this.response);o?f(a):(w.save(n,this.response),g(a))}else w.save(n,this.response),u(i[0])}},r.send()}function c(){var t=e.core.util.ManifestManipulator(E.rawContent),n=t.delayManifest(e.config.LIVE_SECONDS_DELAY);w.save(E.manifestUrl,n);var r=e.core.util.PlaylistParserFactory.getParser(E.manifestUrl),i=r.extractPlaylistsData(E.manifestUrl,n),a=Object.keys(i),o=i[a[0]];return o}function l(t){var n=t.segments;if(!n||0===n.length)return e.warn("delayed manifest shouldnt be empty"),null;for(var r=null,i=0;i<e.config.PLAYER_SEGMENTS_BUFFER&&n.length>0;i++)r=n.pop();return r}function d(){var e=c(),t=l(e);if(!t)return 0;for(var n=E.segments.indexOf(t),r=0,i=n;i<E.segments.length;i++){var a=y.getAvgDownloadTime(E.manifestUrl),o=E.durations[i],s=o*a;if(r>=s)break;r+=o}return i}function h(){if(!P){for(var e=null,t=d();t<E.segments.length&&(e=E.segments[t],R[e]);t++);if(e)for(var n=v(e),r=T.availableP2PSlots();t<E.segments.length&&r>0;t++){var i=n.segmentsData.shift();s(i,function(){h()}),r--}}}function f(t){E=t,h(),P||setTimeout(function(){u(t.manifestUrl)},e.config.PREFETCH_LIVE_INTERVAL_MS)}function p(e){if(!P)for(var t=T.availableP2PSlots();t>0&&e.length>0;){var n=e.shift();s(n,function(){p(e)}),t--}}function g(e){if(e.segments&&0!==e.segments.length){var t=e.segments[0],n=v(t);p(n.segmentsData)}}function v(t){var n=S.getSegmentData(t);S.setLastRequestedSegment(t);var r=S.getNextSegmentsDataWindow(e.config.SEGMENTS_TO_PREFETCH_BEFORE_PLAY);return r.segmentsData.unshift(n),r}function m(t){u(t),setTimeout(function(){_(),w.clear()},1e3*e.config.STOP_PREFETCH_AFTER_SECONDS)}function _(){P=!0,Object.keys(R).forEach(function(e){var t=R[e];4!==t.readyState&&t.abort()})}var E,b=r,S=n.playlistsHandler,T=n.prefetchSlotsHandler,y=n.prefetchSpeedEstimator,R=Object.create(null),w=n.playlistsCache,P=!1;return{startPrefetch:m,stopPrefetch:_}}var i="error",a="load",o="abort";n.prePlayPrefetcher=r}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(t,n){function r(e){var t={type:"fileDownloaded",url:e.currentTarget._url,loaded:e.loaded,p2p:e.loadedP2P,http:e.loadedHTTP,waste:e.loadedP2P+e.loadedHTTP-e.total,fileSize:e.total,downloadTimeMS:Date.now()-e.currentTarget.timestamp};window.P2PPerformanceUpdate&&window.P2PPerformanceUpdate(t)}function i(){var t=new e.VideoRequest({downloadMode:o.downloadMode||"p2p",origin:"preload"}),n=o.segment;return t._segmentData=o,t.mediaPrefetch=!0,t.responseType="arraybuffer",t.open("GET",n),t.onswarmstatechange=function(e){s.onswarmstatechange&&s.onswarmstatechange(e)},t.onerror=function(t){e.info("onerror prefetching resource: "+n),s.onerror&&s.onerror(t)},t.onabort=function(e){s.onabort&&s.onabort(e)},t.onload=function(t){e.info(t),e.info("onload "+n),r(t),s.onload&&s.onload(t)},e.info("requesting "+n),t}function a(){return u.send(),u}var o=t,s=n,u=i();return{send:a}}t.PrefetchRequestSender=n}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(t){function n(){S++,S>=e.config.ADD_SLOT_LOADED_REQUESTS_THRESHOLD&&b&&l()}function o(){S=0}function s(){T++,T>=e.config.REDUCE_SLOT_ABORTS_THRESHOLD&&d()}function u(){T=0}function c(e){switch(p(),e){case r:o();break;case a:s(),o();break;case i:n()}}function l(){if(e.config.FEATURE_LIMIT_SLOTS_BY_PEERS){var t=g(),n=_();n>t&&(y.availableP2PSlots++,b=!1,u(),o())}else y.availableP2PSlots++,b=!1,u(),o()}function d(){var t=g();t<=e.config.MINIMUM_P2P_SLOTS||(y.availableP2PSlots--,u(),o())}function h(t){if(e.config.FEATURE_LIMIT_SLOTS_BY_PEERS){if(0===t)return;var n=g();if(n<=t)return;var r=Math.min(n-t,n-e.config.MINIMUM_P2P_SLOTS);y.availableP2PSlots-=r,u(),o()}}function f(){y.availableP2PSlots--,E++}function p(){y.availableP2PSlots++,E--}function g(){var e=y.availableP2PSlots+E;return e}function v(){return y.availableP2PSlots}function m(){b=!0}var _=t,E=0,b=!1,S=0,T=0,y={availableP2PSlots:e.config.INITIAL_P2P_SLOTS};return function(){radio("activePeerConnectionsNumberChanged").subscribe([h,this])}(),{availableP2PSlots:v,useP2PSlot:f,askForP2PSlot:m,reportRequestDone:c}}var r="error",i="load",a="abort";t.PrefetchSlotsHandler=n}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(){function t(t,n){var i=t.segmentData.playlistName,o=t.segmentData.duration,s=n/1e3;a[i]||(a[i]=[]),a[i].unshift({duration:o,downloadTime:s}),a[i].length>r&&a[i].splice(e.config.TIME_ESTIMATION_LIST_LENGTH,e.config.TIME_ESTIMATION_LIST_LENGTH)}function n(t){if(!a[t]||0===a[t].length)return e.config.INITIAL_DL_SECS_ESTIMATION;for(var n=a[t],r=0,i=0,o=0;o<Math.min(e.config.TIME_ESTIMATION_LIST_LENGTH,n.length);o++){var s=n[o];r+=s.duration,i+=s.downloadTime}var u=i/r;return u}function i(e,n){var r=n.currentTarget,i=Date.now()-r._startTime;if("load"===e)t(r._segmentData,i);else if("abort"===e){var a=n.total?n.loadedP2P/n.total:0;if(0===a)return;var o=i/a;t(r._segmentData,o)}}var a=Object.create(null);return{onRequestEvent:i,getAvgDownloadTime:n}}var r=2*e.config.TIME_ESTIMATION_LIST_LENGTH;t.PrefetchSpeedEstimator=n}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(t){function n(t,n){function o(t){t.downloadMode="p2p";var n={onswarmstatechange:function(e){g.requestSwarmStateChanged(e)},onerror:function(e){m.reportRequestDone(r),g.onP2PPrefetchComplete()},onabort:function(e){m.reportRequestDone(a),g.onP2PPrefetchComplete(),_.onRequestEvent("abort",e)},onload:function(e){m.reportRequestDone(i),g.onP2PPrefetchComplete(),_.onRequestEvent("load",e),200===e.currentTarget.status&&g.saveDownloadSpeed(e.currentTarget)}},o=e.core.util.PrefetchRequestSender(t,n),s=o.send();return m.useP2PSlot(),E[s._segmentData.segment]=s,s}function s(){if(!b||!b.segmentData)return 0;var e=b.segmentData.duration,t=(Date.now()-b.segmentData.playerAskTime)/1e3,n=e-t;return n}function u(e,t){var n=0;t.forEach(function(e){E[e.segment]||n++}),n>e&&m.askForP2PSlot()}function c(t){if(t)for(var n=s(),r=e.config.EXTERNAL_MEDIA_MAXBUFFER-n;r>0&&t.length>0;){var i=t.shift();S[i.segment]=!0,r-=i.segmentData.duration}}function l(e,t){if(S[e.segment])return null;var n=e.segmentData.duration,r=e.segmentData.playlistName,i=_.getAvgDownloadTime(r),a=i*n;if(a*=1.15,null===t||t>a){var s=g.getSeeders(e.segment),u=s?Object.keys(s).length:0;if(u>0&&!E[e.segment]){var c=o(e);return{xhr:c,url:e.segment}}}return null}function d(t){var n=m.availableP2PSlots();if(0===n)return e.warn("no available p2p slots for too long"),null;for(var r=t.length-1;r>=0;r--){var i=t[r],a=l(i,null);if(a)return a}return null}function h(){var t=v.getNextSegmentsDataWindow(e.config.P2P_VOD_WINDOW);if(!t||0===t.segmentsData.length)return[];var n=t.segmentsData,r=m.availableP2PSlots();u(r,n);for(var i=s(),a=[],o=0,c=0;o<r&&c<n.length;c++){var h=n[c],f=l(h,i);f&&(a.push(f),o++),i+=h.segmentData.duration}if(0===a.length){var p=d(n);p&&a.push(p)}return a}function f(){var t=v.getNextSegmentsDataWindow(e.config.P2P_VOD_WINDOW);c(t.segmentsData)}function p(e){v.setLastRequestedSegment(e),T&&(f(),T=!1);var t=v.getSegmentData(e);t.segmentData.playerAskTime=Date.now(),b=t,delete E[t.segment]}var g=n,v=t.playlistsHandler,m=t.prefetchSlotsHandler,_=t.prefetchSpeedEstimator,E=Object.create(null),b=null,S=Object.create(null),T=!0;return{prefetchSegments:h,updatePlayerLastRequestedSegment:p}}var r="error",i="load",a="abort";t.SegmentsPrefetcher=n}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){e.shaka.util.DataViewReader=function(t,n){this.dataView_=t,this.littleEndian_=n==e.shaka.util.DataViewReader.Endianness.LITTLE_ENDIAN,this.position_=0},e.shaka.util.DataViewReader.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:1},e.shaka.util.DataViewReader.prototype.hasMoreData=function(){return this.position_<this.dataView_.byteLength},e.shaka.util.DataViewReader.prototype.getPosition=function(){return this.position_},e.shaka.util.DataViewReader.prototype.getLength=function(){return this.dataView_.byteLength},e.shaka.util.DataViewReader.prototype.readUint8=function(){try{var e=this.dataView_.getUint8(this.position_)}catch(e){this.throwOutOfBounds_()}return this.position_+=1,e},e.shaka.util.DataViewReader.prototype.readUint16=function(){try{var e=this.dataView_.getUint16(this.position_,this.littleEndian_)}catch(e){this.throwOutOfBounds_()}return this.position_+=2,e},e.shaka.util.DataViewReader.prototype.readUint32=function(){try{var e=this.dataView_.getUint32(this.position_,this.littleEndian_)}catch(e){this.throwOutOfBounds_()}return this.position_+=4,e},e.shaka.util.DataViewReader.prototype.readUint64=function(){var e,t;try{this.littleEndian_?(e=this.dataView_.getUint32(this.position_,!0),t=this.dataView_.getUint32(this.position_+4,!0)):(t=this.dataView_.getUint32(this.position_,!1),e=this.dataView_.getUint32(this.position_+4,!1))}catch(e){this.throwOutOfBounds_()}if(t>2097151)throw new shaka.util.Error(shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);return this.position_+=8,t*Math.pow(2,32)+e},e.shaka.util.DataViewReader.prototype.readBytes=function(e){this.position_+e>this.dataView_.byteLength&&this.throwOutOfBounds_();var t=this.dataView_.buffer.slice(this.position_,this.position_+e);return this.position_+=e,new Uint8Array(t)},e.shaka.util.DataViewReader.prototype.skip=function(e){this.position_+e>this.dataView_.byteLength&&this.throwOutOfBounds_(),this.position_+=e},e.shaka.util.DataViewReader.prototype.readTerminatedString=function(){for(var t=this.position_;this.hasMoreData();){var n=this.dataView_.getUint8(this.position_);if(0==n)break;this.position_+=1}var r=this.dataView_.buffer.slice(t,this.position_);return this.position_+=1,e.shaka.util.StringUtils.fromUTF8(r)},e.shaka.util.DataViewReader.prototype.throwOutOfBounds_=function(){throw new shaka.util.Error(shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS)}}).call(t,n(1))},function(e,t,n){(function(e){e.shaka.util.LanguageUtils.match=function(t,n,r){e.shaka.util.LanguageUtils;return r==n||(t>=e.shaka.util.LanguageUtils.MatchType.BASE_LANGUAGE_OKAY&&r==n.split("-")[0]||t>=e.shaka.util.LanguageUtils.MatchType.OTHER_SUB_LANGUAGE_OKAY&&r.split("-")[0]==n.split("-")[0])},e.shaka.util.LanguageUtils.MatchType={EXACT:0,BASE_LANGUAGE_OKAY:1,OTHER_SUB_LANGUAGE_OKAY:2,MIN:0,MAX:2},e.shaka.util.LanguageUtils.normalize=function(t){var n=t.toLowerCase().split("-"),r=n[0],i=e.shaka.util.LanguageUtils.isoMap_[r];return i&&(n[0]=i),n.join("-")},e.shaka.util.LanguageUtils.isoMap_={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"}}).call(t,n(1))},function(e,t,n){(function(e){e.shaka.util.Mp4Parser.findBox=function(t,n){for(;n.hasMoreData();){var r=n.getPosition(),i=n.readUint32(),a=n.readUint32();if(1==i?i=n.readUint64():0==i&&(i=n.getLength()-r),a==t)return i;n.skip(i-(n.getPosition()-r))}return e.shaka.util.Mp4Parser.BOX_NOT_FOUND},e.shaka.util.Mp4Parser.findSampleDescriptionBox=function(t,n){for(var r=new e.shaka.util.DataViewReader(new DataView(t),e.shaka.util.DataViewReader.Endianness.BIG_ENDIAN),i=e.shaka.util.Mp4Parser,a=[[i.BOX_TYPE_MOOV,0],[i.BOX_TYPE_TRAK,0],[i.BOX_TYPE_MDIA,0],[i.BOX_TYPE_MINF,0],[i.BOX_TYPE_STBL,0],[i.BOX_TYPE_STSD,8],[n,0]],o=i.BOX_NOT_FOUND,s=0;s<a.length;s++){var u=a[s][0],c=a[s][1];if(o=i.findBox(u,r),o==i.BOX_NOT_FOUND)return i.BOX_NOT_FOUND;r.skip(c)}return o},e.shaka.util.Mp4Parser.BOX_NOT_FOUND=-1,e.shaka.util.Mp4Parser.BOX_TYPE_MDAT=1835295092,e.shaka.util.Mp4Parser.BOX_TYPE_MOOV=1836019574,e.shaka.util.Mp4Parser.BOX_TYPE_TRAK=1953653099,e.shaka.util.Mp4Parser.BOX_TYPE_MDIA=1835297121,e.shaka.util.Mp4Parser.BOX_TYPE_MINF=1835626086,e.shaka.util.Mp4Parser.BOX_TYPE_STBL=1937007212,e.shaka.util.Mp4Parser.BOX_TYPE_STSD=1937011556}).call(t,n(1))},function(e,t,n){(function(e){e.shaka.dash.mpd.parseMpd=function(t,n){var r=new DOMParser,i=r.parseFromString(t,"text/xml");if(!i)return null;var a={baseUrl:new e.goog.Uri(n)};return e.shaka.dash.mpd.parseChild_(a,i,e.shaka.dash.mpd.Mpd)},e.shaka.dash.mpd.DEFAULT_MIN_BUFFER_TIME_=5,e.shaka.dash.mpd.DEFAULT_SUGGESTED_PRESENTATION_DELAY_=1,e.shaka.dash.mpd.Mpd=function(){this.url=null,this.id=null,this.type="static",this.baseUrl=null,this.updateLocation=null,this.mediaPresentationDuration=null,this.minBufferTime=e.shaka.dash.mpd.DEFAULT_MIN_BUFFER_TIME_,this.minUpdatePeriod=null,this.availabilityStartTime=null,this.timeShiftBufferDepth=null,this.suggestedPresentationDelay=e.shaka.dash.mpd.DEFAULT_SUGGESTED_PRESENTATION_DELAY_,this.periods=[]},e.shaka.dash.mpd.Period=function(){this.id=null,this.start=null,this.duration=null,this.baseUrl=null,this.segmentBase=null,this.segmentList=null,this.segmentTemplate=null,this.adaptationSets=[]},e.shaka.dash.mpd.AdaptationSet=function(){this.id=null,this.lang=null,this.contentType=null,this.width=null,this.height=null,this.mimeType=null,this.codecs=null,this.main=!1,this.baseUrl=null,this.segmentBase=null,this.segmentList=null,this.segmentTemplate=null,this.contentProtections=[],this.representations=[]},e.shaka.dash.mpd.Role=function(){this.value=null},e.shaka.dash.mpd.ContentComponent=function(){this.id=null,this.lang=null,this.contentType=null},e.shaka.dash.mpd.Representation=function(){this.id=null,this.lang=null,this.bandwidth=null,this.width=null,this.height=null,this.mimeType=null,this.codecs=null,this.baseUrl=null,this.segmentBase=null,this.segmentList=null,this.segmentTemplate=null,this.contentProtections=[]},e.shaka.dash.mpd.ContentProtection=function(){this.schemeIdUri=null,this.value=null,this.children=[],this.pssh=null},e.shaka.dash.mpd.CencPssh=function(){this.psshBox=null,this.parsedPssh=null},e.shaka.dash.mpd.BaseUrl=function(){this.url=null},e.shaka.dash.mpd.Location=function(){this.url=null},e.shaka.dash.mpd.SegmentBase=function(){this.baseUrl=null,this.timescale=1,this.presentationTimeOffset=null,this.indexRange=null,this.representationIndex=null,this.initialization=null},e.shaka.dash.mpd.SegmentBase.prototype.clone=function(){var t=e.shaka.dash.mpd,n=new e.shaka.dash.mpd.SegmentBase;return n.baseUrl=this.baseUrl?new e.goog.Uri(this.baseUrl):null,n.timescale=this.timescale,n.presentationTimeOffset=this.presentationTimeOffset,n.indexRange=t.clone_(this.indexRange),n.representationIndex=t.clone_(this.representationIndex),n.initialization=t.clone_(this.initialization),n},e.shaka.dash.mpd.RepresentationIndex=function(){this.url=null,this.range=null},e.shaka.dash.mpd.RepresentationIndex.prototype.clone=function(){var t=e.shaka.dash.mpd,n=new e.shaka.dash.mpd.RepresentationIndex;return n.url=this.url?new e.goog.Uri(this.url):null,n.range=t.clone_(this.range),n},e.shaka.dash.mpd.Initialization=function(){this.url=null,this.range=null},e.shaka.dash.mpd.Initialization.prototype.clone=function(){var t=e.shaka.dash.mpd,n=new e.shaka.dash.mpd.Initialization;return n.url=this.url?new e.goog.Uri(this.url):null,n.range=t.clone_(this.range),n},e.shaka.dash.mpd.SegmentList=function(){this.baseUrl=null,this.timescale=1,this.presentationTimeOffset=null,this.segmentDuration=null,this.startNumber=1,this.initialization=null,this.segmentUrls=[]},e.shaka.dash.mpd.SegmentList.prototype.clone=function(){var t=e.shaka.dash.mpd,n=new e.shaka.dash.mpd.SegmentList;return n.baseUrl=this.baseUrl?new e.goog.Uri(this.baseUrl):null,n.timescale=this.timescale,n.presentationTimeOffset=this.presentationTimeOffset,n.segmentDuration=this.segmentDuration,n.startNumber=this.startNumber,n.initialization=t.clone_(this.initialization),n.segmentUrls=this.segmentUrls.map(function(e){return e.clone()}),n},e.shaka.dash.mpd.SegmentUrl=function(){this.mediaUrl=null,this.mediaRange=null},e.shaka.dash.mpd.SegmentUrl.prototype.clone=function(){var t=e.shaka.dash.mpd,n=new e.shaka.dash.mpd.SegmentUrl;return n.mediaUrl=this.mediaUrl?new e.goog.Uri(this.mediaUrl):null,n.mediaRange=t.clone_(this.mediaRange),n},e.shaka.dash.mpd.SegmentTemplate=function(){this.timescale=1,this.presentationTimeOffset=null,this.segmentDuration=null,this.startNumber=1,this.mediaUrlTemplate=null,this.indexUrlTemplate=null,this.initializationUrlTemplate=null,this.timeline=null},e.shaka.dash.mpd.SegmentTemplate.prototype.clone=function(){var t=e.shaka.dash.mpd,n=new e.shaka.dash.mpd.SegmentTemplate;return n.timescale=this.timescale,n.presentationTimeOffset=this.presentationTimeOffset,n.segmentDuration=this.segmentDuration,n.startNumber=this.startNumber,n.mediaUrlTemplate=this.mediaUrlTemplate,n.indexUrlTemplate=this.indexUrlTemplate,n.initializationUrlTemplate=this.initializationUrlTemplate,n.timeline=t.clone_(this.timeline),n},e.shaka.dash.mpd.SegmentTimeline=function(){this.timePoints=[]},e.shaka.dash.mpd.SegmentTimeline.prototype.clone=function(){var t=new e.shaka.dash.mpd.SegmentTimeline;return t.timePoints=this.timePoints.map(function(e){return e.clone()}),t},e.shaka.dash.mpd.SegmentTimePoint=function(){this.startTime=null,this.duration=null,this.repeat=null},e.shaka.dash.mpd.SegmentTimePoint.prototype.clone=function(){var t=new e.shaka.dash.mpd.SegmentTimePoint;return t.startTime=this.startTime,t.duration=this.duration,t.repeat=this.repeat,t},e.shaka.dash.mpd.Range=function(e,t){this.begin=e,this.end=t},e.shaka.dash.mpd.Range.prototype.clone=function(){return new e.shaka.dash.mpd.Range(this.begin,this.end)},e.shaka.dash.mpd.Mpd.TAG_NAME="MPD",e.shaka.dash.mpd.Period.TAG_NAME="Period",e.shaka.dash.mpd.AdaptationSet.TAG_NAME="AdaptationSet",e.shaka.dash.mpd.Role.TAG_NAME="Role",e.shaka.dash.mpd.ContentComponent.TAG_NAME="ContentComponent",e.shaka.dash.mpd.Representation.TAG_NAME="Representation",e.shaka.dash.mpd.ContentProtection.TAG_NAME="ContentProtection",e.shaka.dash.mpd.CencPssh.TAG_NAME="cenc:pssh",e.shaka.dash.mpd.BaseUrl.TAG_NAME="BaseURL",e.shaka.dash.mpd.Location.TAG_NAME="Location",e.shaka.dash.mpd.SegmentBase.TAG_NAME="SegmentBase",e.shaka.dash.mpd.RepresentationIndex.TAG_NAME="RepresentationIndex",e.shaka.dash.mpd.Initialization.TAG_NAME="Initialization",e.shaka.dash.mpd.SegmentList.TAG_NAME="SegmentList",e.shaka.dash.mpd.SegmentUrl.TAG_NAME="SegmentURL",e.shaka.dash.mpd.SegmentTemplate.TAG_NAME="SegmentTemplate",e.shaka.dash.mpd.SegmentTimeline.TAG_NAME="SegmentTimeline",e.shaka.dash.mpd.SegmentTimePoint.TAG_NAME="S",e.shaka.dash.mpd.Mpd.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.url=new e.goog.Uri(t.baseUrl),this.id=r.parseAttr_(n,"id",r.parseString_),this.type=r.parseAttr_(n,"type",r.parseString_)||"static",this.mediaPresentationDuration=r.parseAttr_(n,"mediaPresentationDuration",r.parseDuration_),this.minBufferTime=r.parseAttr_(n,"minBufferTime",r.parseDuration_,this.minBufferTime),this.minUpdatePeriod=r.parseAttr_(n,"minimumUpdatePeriod",r.parseDuration_,this.minUpdatePeriod),this.availabilityStartTime=r.parseAttr_(n,"availabilityStartTime",r.parseDate_,this.availabilityStartTime),this.timeShiftBufferDepth=r.parseAttr_(n,"timeShiftBufferDepth",r.parseDuration_,this.timeShiftBufferDepth),this.suggestedPresentationDelay=r.parseAttr_(n,"suggestedPresentationDelay",r.parseDuration_,this.suggestedPresentationDelay);var i=r.parseChild_(this,n,r.BaseUrl);this.baseUrl=r.resolveUrl_(t.baseUrl,i?i.url:null);var a=r.parseChild_(this,n,r.Location);a&&(this.updateLocation=r.resolveUrl_(t.baseUrl,a.url)),this.periods=r.parseChildren_(this,n,r.Period)},e.shaka.dash.mpd.Period.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.id=r.parseAttr_(n,"id",r.parseString_),this.start=r.parseAttr_(n,"start",r.parseDuration_),this.duration=r.parseAttr_(n,"duration",r.parseDuration_);var i=r.parseChild_(this,n,r.BaseUrl);this.baseUrl=r.resolveUrl_(t.baseUrl,i?i.url:null),this.segmentBase=r.parseChild_(this,n,r.SegmentBase),this.segmentList=r.parseChild_(this,n,r.SegmentList),this.segmentTemplate=r.parseChild_(this,n,r.SegmentTemplate),this.adaptationSets=r.parseChildren_(this,n,r.AdaptationSet)},e.shaka.dash.mpd.AdaptationSet.prototype.parse=function(t,n){var r=e.shaka.dash.mpd,i=r.parseChild_(this,n,r.ContentComponent)||{},a=r.parseChild_(this,n,r.Role);this.id=r.parseAttr_(n,"id",r.parseString_),this.lang=r.parseAttr_(n,"lang",r.parseString_,i.lang),this.contentType=r.parseAttr_(n,"contentType",r.parseString_,i.contentType),this.width=r.parseAttr_(n,"width",r.parsePositiveInt_),this.height=r.parseAttr_(n,"height",r.parsePositiveInt_),this.mimeType=r.parseAttr_(n,"mimeType",r.parseString_),this.codecs=r.parseAttr_(n,"codecs",r.parseString_),this.main=a&&"main"==a.value,this.lang&&(this.lang=e.shaka.util.LanguageUtils.normalize(this.lang));var o=r.parseChild_(this,n,r.BaseUrl);this.baseUrl=r.resolveUrl_(t.baseUrl,o?o.url:null),this.contentProtections=r.parseChildren_(this,n,r.ContentProtection),!this.contentType&&this.mimeType&&(this.contentType=this.mimeType.split("/")[0]),this.segmentBase=t.segmentBase?r.mergeChild_(this,n,t.segmentBase):r.parseChild_(this,n,r.SegmentBase),this.segmentList=t.segmentList?r.mergeChild_(this,n,t.segmentList):r.parseChild_(this,n,r.SegmentList),this.segmentTemplate=t.segmentTemplate?r.mergeChild_(this,n,t.segmentTemplate):r.parseChild_(this,n,r.SegmentTemplate),this.representations=r.parseChildren_(this,n,r.Representation),!this.mimeType&&this.representations.length&&(this.mimeType=this.representations[0].mimeType,!this.contentType&&this.mimeType&&(this.contentType=this.mimeType.split("/")[0]))},e.shaka.dash.mpd.Role.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.value=r.parseAttr_(n,"value",r.parseString_)},e.shaka.dash.mpd.ContentComponent.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.id=r.parseAttr_(n,"id",r.parseString_),this.lang=r.parseAttr_(n,"lang",r.parseString_),this.contentType=r.parseAttr_(n,"contentType",r.parseString_),this.lang&&(this.lang=e.shaka.util.LanguageUtils.normalize(this.lang))},e.shaka.dash.mpd.Representation.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.id=r.parseAttr_(n,"id",r.parseString_),this.bandwidth=r.parseAttr_(n,"bandwidth",r.parsePositiveInt_),this.width=r.parseAttr_(n,"width",r.parsePositiveInt_,t.width),this.height=r.parseAttr_(n,"height",r.parsePositiveInt_,t.height),this.mimeType=r.parseAttr_(n,"mimeType",r.parseString_,t.mimeType),this.codecs=r.parseAttr_(n,"codecs",r.parseString_,t.codecs),this.lang=t.lang;var i=r.parseChild_(this,n,r.BaseUrl);this.baseUrl=r.resolveUrl_(t.baseUrl,i?i.url:null),this.contentProtections=r.parseChildren_(this,n,r.ContentProtection),this.segmentBase=t.segmentBase?r.mergeChild_(this,n,t.segmentBase):r.parseChild_(this,n,r.SegmentBase),this.segmentList=t.segmentList?r.mergeChild_(this,n,t.segmentList):r.parseChild_(this,n,r.SegmentList),this.segmentTemplate=t.segmentTemplate?r.mergeChild_(this,n,t.segmentTemplate):r.parseChild_(this,n,r.SegmentTemplate),0==this.contentProtections.length&&(this.contentProtections=t.contentProtections)},e.shaka.dash.mpd.ContentProtection.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.schemeIdUri=r.parseAttr_(n,"schemeIdUri",r.parseString_),this.value=r.parseAttr_(n,"value",r.parseString_),this.pssh=r.parseChild_(this,n,r.CencPssh),this.children=Array.prototype.slice.call(n.childNodes)},e.shaka.dash.mpd.CencPssh.prototype.parse=function(t,n){var r=e.shaka.dash.mpd,i=e.shaka.util.Uint8ArrayUtils,a=r.getContents_(n);if(a){this.psshBox=i.fromBase64(a);try{this.parsedPssh=new e.shaka.util.Pssh(this.psshBox)}catch(e){if(!(e instanceof RangeError))throw e}}},e.shaka.dash.mpd.BaseUrl.prototype.parse=function(t,n){this.url=e.shaka.dash.mpd.getContents_(n)},e.shaka.dash.mpd.Location.prototype.parse=function(t,n){this.url=e.shaka.dash.mpd.getContents_(n)},e.shaka.dash.mpd.SegmentBase.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.baseUrl=t.baseUrl||this.baseUrl,this.timescale=r.parseAttr_(n,"timescale",r.parsePositiveInt_,this.timescale),this.presentationTimeOffset=r.parseAttr_(n,"presentationTimeOffset",r.parseNonNegativeInt_,this.presentationTimeOffset),this.indexRange=r.parseAttr_(n,"indexRange",r.parseRange_,this.indexRange),this.representationIndex=r.parseChild_(this,n,r.RepresentationIndex)||this.representationIndex,this.initialization=r.parseChild_(this,n,r.Initialization)||this.initialization},e.shaka.dash.mpd.RepresentationIndex.prototype.parse=function(t,n){var r=e.shaka.dash.mpd,i=r.parseAttr_(n,"sourceURL",r.parseString_);this.url=r.resolveUrl_(t.baseUrl,i),this.range=r.parseAttr_(n,"range",r.parseRange_,r.clone_(t.indexRange))},e.shaka.dash.mpd.Initialization.prototype.parse=function(t,n){var r=e.shaka.dash.mpd,i=r.parseAttr_(n,"sourceURL",r.parseString_);this.url=r.resolveUrl_(t.baseUrl,i),this.range=r.parseAttr_(n,"range",r.parseRange_)},e.shaka.dash.mpd.SegmentList.prototype.parse=function(t,n){
var r=e.shaka.dash.mpd;this.baseUrl=t.baseUrl||this.baseUrl,this.timescale=r.parseAttr_(n,"timescale",r.parsePositiveInt_,this.timescale),this.presentationTimeOffset=r.parseAttr_(n,"presentationTimeOffset",r.parseNonNegativeInt_,this.presentationTimeOffset),this.segmentDuration=r.parseAttr_(n,"duration",r.parsePositiveInt_,this.segmentDuration),this.startNumber=r.parseAttr_(n,"startNumber",r.parseNonNegativeInt_,this.startNumber),this.initialization=r.parseChild_(this,n,r.Initialization)||this.initialization,this.segmentUrls=r.parseChildren_(this,n,r.SegmentUrl)||this.segmentUrls},e.shaka.dash.mpd.SegmentUrl.prototype.parse=function(t,n){var r=e.shaka.dash.mpd,i=r.parseAttr_(n,"media",r.parseString_);this.mediaUrl=r.resolveUrl_(t.baseUrl,i),this.mediaRange=r.parseAttr_(n,"mediaRange",r.parseRange_)},e.shaka.dash.mpd.SegmentTemplate.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.timescale=r.parseAttr_(n,"timescale",r.parsePositiveInt_,this.timescale),this.presentationTimeOffset=r.parseAttr_(n,"presentationTimeOffset",r.parseNonNegativeInt_,this.presentationTimeOffset),this.segmentDuration=r.parseAttr_(n,"duration",r.parsePositiveInt_,this.segmentDuration),this.startNumber=r.parseAttr_(n,"startNumber",r.parseNonNegativeInt_,this.startNumber),this.mediaUrlTemplate=r.parseAttr_(n,"media",r.parseString_,this.mediaUrlTemplate),this.indexUrlTemplate=r.parseAttr_(n,"index",r.parseString_,this.indexUrlTemplate),this.initializationUrlTemplate=r.parseAttr_(n,"initialization",r.parseString_,this.initializationUrlTemplate),this.timeline=r.parseChild_(this,n,r.SegmentTimeline)||this.timeline},e.shaka.dash.mpd.SegmentTimeline.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.timePoints=r.parseChildren_(this,n,r.SegmentTimePoint)},e.shaka.dash.mpd.SegmentTimePoint.prototype.parse=function(t,n){var r=e.shaka.dash.mpd;this.startTime=r.parseAttr_(n,"t",r.parseNonNegativeInt_),this.duration=r.parseAttr_(n,"d",r.parseNonNegativeInt_),this.repeat=r.parseAttr_(n,"r",r.parseNonNegativeInt_)},e.shaka.dash.mpd.resolveUrl_=function(t,n){var r=n?new e.goog.Uri(n):null;return t?r?t.resolve(r):t:r},e.shaka.dash.mpd.mergeChild_=function(t,n,r){var i=e.shaka.dash.mpd,a=i.clone_(r),o=i.findChild_(n,r.constructor.TAG_NAME);return o&&a.parse(t,o),a},e.shaka.dash.mpd.parseChild_=function(t,n,r){var i=e.shaka.dash.mpd,a=null,o=i.findChild_(n,r.TAG_NAME);return o&&(a=new r,a.parse(t,o)),a},e.shaka.dash.mpd.findChild_=function(e,t){for(var n=null,r=0;r<e.childNodes.length;r++)if(e.childNodes[r].tagName==t){if(n)return null;n=e.childNodes[r]}return n},e.shaka.dash.mpd.parseChildren_=function(e,t,n){for(var r=[],i=0;i<t.childNodes.length;i++)if(t.childNodes[i].tagName==n.TAG_NAME){var a=new n;a.parse.call(a,e,t.childNodes[i]),r.push(a)}return r},e.shaka.dash.mpd.getContents_=function(e){var t=e.firstChild;return t.nodeType!=Node.TEXT_NODE?null:t.nodeValue},e.shaka.dash.mpd.clone_=function(e){return e?e.clone():null},e.shaka.dash.mpd.parseAttr_=function(e,t,n,r){var i=n(e.getAttribute(t));return null!=i?i:void 0!==r?r:null},e.shaka.dash.mpd.parseDate_=function(e){if(!e)return null;var t=Date.parse(e);return isNaN(t)?null:Math.floor(t/1e3)},e.shaka.dash.mpd.parseDuration_=function(t){if(!t)return null;var n="^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$",r=new RegExp(n).exec(t);if(!r)return null;var i=0,a=e.shaka.dash.mpd.parseNonNegativeInt_(r[1]);a&&(i+=31536e3*a);var o=e.shaka.dash.mpd.parseNonNegativeInt_(r[2]);o&&(i+=2592e3*o);var s=e.shaka.dash.mpd.parseNonNegativeInt_(r[3]);s&&(i+=86400*s);var u=e.shaka.dash.mpd.parseNonNegativeInt_(r[4]);u&&(i+=3600*u);var c=e.shaka.dash.mpd.parseNonNegativeInt_(r[5]);c&&(i+=60*c);var l=e.shaka.dash.mpd.parseFloat_(r[6]);return l&&(i+=l),i},e.shaka.dash.mpd.parseRange_=function(t){var n=/([0-9]+)-([0-9]+)/.exec(t);if(!n)return null;var r=e.shaka.dash.mpd.parseNonNegativeInt_(n[1]);if(null==r)return null;var i=e.shaka.dash.mpd.parseNonNegativeInt_(n[2]);return null==i?null:new e.shaka.dash.mpd.Range(r,i)},e.shaka.dash.mpd.parsePositiveInt_=function(e){var t=window.parseInt(e,10);return t>0?t:null},e.shaka.dash.mpd.parseNonNegativeInt_=function(e){var t=window.parseInt(e,10);return t>=0?t:null},e.shaka.dash.mpd.parseFloat_=function(e){var t=window.parseFloat(e);return isNaN(t)?null:t},e.shaka.dash.mpd.parseString_=function(e){return e}}).call(t,n(1))},function(e,t,n){(function(e){e.goog=e.goog||{},e.goog.uri=e.goog.uri||{},e.goog.uri.utils=e.goog.uri.utils||{},e.shaka=e.shaka||{},e.shaka.media=e.shaka.media||{},e.shaka.player=e.shaka.player||{},e.shaka.util=e.shaka.util||{},e.shaka.dash=e.shaka.dash||{},e.shaka.util.Clock=e.shaka.util.Clock||{},e.shaka.util.LanguageUtils=e.shaka.util.LanguageUtils||{},e.shaka.util.Uint8ArrayUtils=e.shaka.util.Uint8ArrayUtils||{},e.shaka.util.StringUtils=e.shaka.util.StringUtils||{},e.shaka.util.Mp4Parser=e.shaka.util.Mp4Parser||{},e.shaka.util.DataViewReader=e.shaka.util.DataViewReader||{},e.shaka.util.Pssh=e.shaka.util.Pssh||{},e.shaka.dash.mpd=e.shaka.dash.mpd||{},e.shaka.dash.MpdUtils=e.shaka.dash.MpdUtils||{}}).call(t,n(1))},function(e,t,n){(function(e){e.shaka.util.Pssh=function(t){this.systemIds=[],this.cencKeyIds=[],this.dataBoundaries=[];for(var n=new e.shaka.util.DataViewReader(new DataView(t.buffer),e.shaka.util.DataViewReader.Endianness.BIG_ENDIAN),r=!1;n.hasMoreData();){var i=e.shaka.util.Mp4Parser.findBox(e.shaka.util.Pssh.BOX_TYPE,n);if(i==e.shaka.util.Mp4Parser.BOX_NOT_FOUND)break;r=!0;var a=n.getPosition()-8,o=n.readUint8();if(o>1)n.skip(i-(n.getPosition()-a));else{n.skip(3);var s=e.shaka.util.Uint8ArrayUtils.toHex(n.readBytes(16)),u=[];if(o>0)for(var c=n.readUint32(),l=0;l<c;++l){var d=e.shaka.util.Uint8ArrayUtils.toHex(n.readBytes(16));u.push(d)}var h=n.readUint32();n.skip(h),this.cencKeyIds.push.apply(this.cencKeyIds,u),this.systemIds.push(s),this.dataBoundaries.push({start:a,end:n.getPosition()-1}),n.getPosition()!=a+i&&n.skip(i-(n.getPosition()-a))}}},e.shaka.util.Pssh.BOX_TYPE=1886614376}).call(t,n(1))},function(e,t,n){(function(e){e.shaka.util.StringUtils.fromUTF8=function(t){if(!t)return"";var n=new Uint8Array(t);239==n[0]&&187==n[1]&&191==n[2]&&(n=n.subarray(3));var r=e.shaka.util.StringUtils.fromCharCode_(n),i=escape(r);try{return decodeURIComponent(i)}catch(e){throw new shaka.util.Error(shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING)}},e.shaka.util.StringUtils.fromUTF16=function(e,t){if(!e)return"";if(e.byteLength%2!=0)throw new shaka.util.Error(shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING);var n;if(e instanceof ArrayBuffer)n=e;else{var r=new Uint8Array(e.byteLength);r.set(new Uint8Array(e)),n=r.buffer}for(var i=e.byteLength/2,a=new Uint16Array(i),o=new DataView(n),s=0;s<i;s++)a[s]=o.getUint16(2*s,t);return shaka.util.StringUtils.fromCharCode_(a)},e.shaka.util.StringUtils.fromBytesAutoDetect=function(t){var n=e.shaka.util.StringUtils,r=new Uint8Array(t);if(239==r[0]&&187==r[1]&&191==r[2])return n.fromUTF8(r);if(254==r[0]&&255==r[1])return n.fromUTF16(r.subarray(2),!1);if(255==r[0]&&254==r[1])return n.fromUTF16(r.subarray(2),!0);var i=function(e,t){return e.byteLength<=t||e[t]>=32&&e[t]<=126}.bind(null,r);if(0==r[0]&&0==r[2])return n.fromUTF16(t,!1);if(0==r[1]&&0==r[3])return n.fromUTF16(t,!0);if(i(0)&&i(1)&&i(2)&&i(3))return n.fromUTF8(t);throw new shaka.util.Error(shaka.util.Error.Category.TEXT,shaka.util.Error.Code.UNABLE_TO_DETECT_ENCODING)},e.shaka.util.StringUtils.toUTF8=function(e){for(var t=encodeURIComponent(e),n=unescape(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r.buffer},e.shaka.util.StringUtils.fromCharCode_=function(e){for(var t=16e3,n="",r=0;r<e.length;r+=t){var i=e.subarray(r,r+t);n+=String.fromCharCode.apply(null,i)}return n}}).call(t,n(1))},function(e,t,n){(function(e){e.shaka.util.Uint8ArrayUtils.toBase64=function(e,t){var n=String.fromCharCode.apply(null,e),r=void 0==t||t,i=window.btoa(n).replace(/\+/g,"-").replace(/\//g,"_");return r?i:i.replace(/=*$/,"")},e.shaka.util.Uint8ArrayUtils.fromBase64=function(e){for(var t=window.atob(e.replace(/-/g,"+").replace(/_/g,"/")),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n},e.shaka.util.Uint8ArrayUtils.fromHex=function(e){for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=window.parseInt(e.substr(n,2),16);return t},e.shaka.util.Uint8ArrayUtils.toHex=function(e){for(var t="",n=0;n<e.length;++n){var r=e[n].toString(16);1==r.length&&(r="0"+r),t+=r}return t},e.shaka.util.Uint8ArrayUtils.equal=function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!=t[n])return!1;return!0}}).call(t,n(1))},function(e,t,n){(function(e){e.goog.Uri=function(t){var n;t instanceof e.goog.Uri?(this.setScheme(t.getScheme()),this.setUserInfo(t.getUserInfo()),this.setDomain(t.getDomain()),this.setPort(t.getPort()),this.setPath(t.getPath()),this.setQueryData(t.getQueryData().clone()),this.setFragment(t.getFragment())):t&&(n=e.goog.uri.utils.split(String(t)))?(this.setScheme(n[e.goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(n[e.goog.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(n[e.goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(n[e.goog.uri.utils.ComponentIndex.PORT]),this.setPath(n[e.goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(n[e.goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(n[e.goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):this.queryData_=new e.goog.Uri.QueryData(null,null)},e.goog.Uri.prototype.scheme_="",e.goog.Uri.prototype.userInfo_="",e.goog.Uri.prototype.domain_="",e.goog.Uri.prototype.port_=null,e.goog.Uri.prototype.path_="",e.goog.Uri.prototype.queryData_,e.goog.Uri.prototype.fragment_="",e.goog.Uri.prototype.toString=function(){var t=[],n=this.getScheme();n&&t.push(e.goog.Uri.encodeSpecialChars_(n,e.goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),":");var r=this.getDomain();if(r){t.push("//");var i=this.getUserInfo();i&&t.push(e.goog.Uri.encodeSpecialChars_(i,e.goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),t.push(e.goog.Uri.removeDoubleEncoding_(encodeURIComponent(r)));var a=this.getPort();null!=a&&t.push(":",String(a))}var o=this.getPath();o&&(this.hasDomain()&&"/"!=o.charAt(0)&&t.push("/"),t.push(e.goog.Uri.encodeSpecialChars_(o,"/"==o.charAt(0)?e.goog.Uri.reDisallowedInAbsolutePath_:e.goog.Uri.reDisallowedInRelativePath_,!0)));var s=this.getEncodedQuery();s&&t.push("?",s);var u=this.getFragment();return u&&t.push("#",e.goog.Uri.encodeSpecialChars_(u,e.goog.Uri.reDisallowedInFragment_)),t.join("")},e.goog.Uri.prototype.resolve=function(t){var n=this.clone(),r=t.hasScheme();r?n.setScheme(t.getScheme()):r=t.hasUserInfo(),r?n.setUserInfo(t.getUserInfo()):r=t.hasDomain(),r?n.setDomain(t.getDomain()):r=t.hasPort();var i=t.getPath();if(r)n.setPort(t.getPort());else if(r=t.hasPath()){if("/"!=i.charAt(0))if(this.hasDomain()&&!this.hasPath())i="/"+i;else{var a=n.getPath().lastIndexOf("/");a!=-1&&(i=n.getPath().substr(0,a+1)+i)}i=e.goog.Uri.removeDotSegments(i)}return r?n.setPath(i):r=t.hasQuery(),r?n.setQueryData(t.getQueryData().clone()):r=t.hasFragment(),r&&n.setFragment(t.getFragment()),n},e.goog.Uri.prototype.clone=function(){return new e.goog.Uri(this)},e.goog.Uri.prototype.getScheme=function(){return this.scheme_},e.goog.Uri.prototype.setScheme=function(t,n){return this.scheme_=n?e.goog.Uri.decodeOrEmpty_(t,!0):t,this.scheme_&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},e.goog.Uri.prototype.hasScheme=function(){return!!this.scheme_},e.goog.Uri.prototype.getUserInfo=function(){return this.userInfo_},e.goog.Uri.prototype.setUserInfo=function(t,n){return this.userInfo_=n?e.goog.Uri.decodeOrEmpty_(t):t,this},e.goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},e.goog.Uri.prototype.getDomain=function(){return this.domain_},e.goog.Uri.prototype.setDomain=function(t,n){return this.domain_=n?e.goog.Uri.decodeOrEmpty_(t,!0):t,this},e.goog.Uri.prototype.hasDomain=function(){return!!this.domain_},e.goog.Uri.prototype.getPort=function(){return this.port_},e.goog.Uri.prototype.setPort=function(e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);this.port_=e}else this.port_=null;return this},e.goog.Uri.prototype.hasPort=function(){return null!=this.port_},e.goog.Uri.prototype.getPath=function(){return this.path_},e.goog.Uri.prototype.setPath=function(t,n){return this.path_=n?e.goog.Uri.decodeOrEmpty_(t,!0):t,this},e.goog.Uri.prototype.hasPath=function(){return!!this.path_},e.goog.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()},e.goog.Uri.prototype.setQueryData=function(t,n){return t instanceof e.goog.Uri.QueryData?this.queryData_=t:(n||(t=e.goog.Uri.encodeSpecialChars_(t,e.goog.Uri.reDisallowedInQuery_)),this.queryData_=new e.goog.Uri.QueryData(t,null)),this},e.goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},e.goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},e.goog.Uri.prototype.getQueryData=function(){return this.queryData_},e.goog.Uri.prototype.getFragment=function(){return this.fragment_},e.goog.Uri.prototype.setFragment=function(t,n){return this.fragment_=n?e.goog.Uri.decodeOrEmpty_(t):t,this},e.goog.Uri.prototype.hasFragment=function(){return!!this.fragment_},e.goog.Uri.removeDotSegments=function(e){if(".."==e||"."==e)return"";if(e.indexOf("./")==-1&&e.indexOf("/.")==-1)return e;for(var t=0==e.lastIndexOf("/",0),n=e.split("/"),r=[],i=0;i<n.length;){var a=n[i++];"."==a?t&&i==n.length&&r.push(""):".."==a?((r.length>1||1==r.length&&""!=r[0])&&r.pop(),t&&i==n.length&&r.push("")):(r.push(a),t=!0)}return r.join("/")},e.goog.Uri.decodeOrEmpty_=function(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""},e.goog.Uri.encodeSpecialChars_=function(t,n,r){if(e.goog.isString(t)){var i=encodeURI(t).replace(n,e.goog.Uri.encodeChar_);return r&&(i=e.goog.Uri.removeDoubleEncoding_(i)),i}return null},e.goog.Uri.encodeChar_=function(e){var t=e.charCodeAt(0);return"%"+(t>>4&15).toString(16)+(15&t).toString(16)},e.goog.Uri.removeDoubleEncoding_=function(e){return e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},e.goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,e.goog.Uri.reDisallowedInRelativePath_=/[\#\?:]/g,e.goog.Uri.reDisallowedInAbsolutePath_=/[\#\?]/g,e.goog.Uri.reDisallowedInQuery_=/[\#\?@]/g,e.goog.Uri.reDisallowedInFragment_=/#/g,e.goog.Uri.QueryData=function(e,t){this.encodedQuery_=e||null},e.goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_={},this.count_=0,this.encodedQuery_))for(var e=this.encodedQuery_.split("&"),t=0;t<e.length;t++){var n=e[t].indexOf("="),r=null,i=null;n>=0?(r=e[t].substring(0,n),i=e[t].substring(n+1)):r=e[t],r=decodeURIComponent(r.replace(/\+/g," ")),i=i||"",this.add(r,decodeURIComponent(i.replace(/\+/g," ")))}},e.goog.Uri.QueryData.prototype.keyMap_=null,e.goog.Uri.QueryData.prototype.count_=null,e.goog.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},e.goog.Uri.QueryData.prototype.add=function(e,t){this.ensureKeyMapInitialized_(),this.encodedQuery_=null;var n=this.keyMap_.hasOwnProperty(e)&&this.keyMap_[e];return n||(this.keyMap_[e]=n=[]),n.push(t),this.count_++,this},e.goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";var e=[];for(var t in this.keyMap_)for(var n=encodeURIComponent(t),r=this.keyMap_[t],i=0;i<r.length;i++){var a=n;""!==r[i]&&(a+="="+encodeURIComponent(r[i])),e.push(a)}return this.encodedQuery_=e.join("&")},e.goog.Uri.QueryData.prototype.toDecodedString=function(){return e.goog.Uri.decodeOrEmpty_(this.toString())},e.goog.Uri.QueryData.prototype.clone=function(){var t=new e.goog.Uri.QueryData;if(t.encodedQuery_=this.encodedQuery_,this.keyMap_){var n={};for(var r in this.keyMap_)n[r]=this.keyMap_[r].concat();t.keyMap_=n,t.count_=this.count_}return t}}).call(t,n(1))},function(e,t,n){(function(e){e.goog.uri.utils.splitRe_=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),e.goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},e.goog.uri.utils.split=function(t){return t.match(e.goog.uri.utils.splitRe_)}}).call(t,n(1))},function(e,t,n){(function(e){!function(e){e.slidingWindow=function(e){function t(e){o.push(e),o.length>i&&o.shift();var t=0;o.forEach(function(e){t+=e}),a=t/o.length}function n(){return a}function r(){var e=o.length?o[0]:-(1/0);return o.forEach(function(t){t<e&&(e=t)}),e}e=e||{};var i=e.maxSize||5,a=0,o=[];return{addValue:t,getAverage:n,getMinimum:r}}}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(e){function t(){function e(e,t){r[e]=t,i[t]=e}function t(e){return i[e]}function n(e){return r[e]}var r=Object.create(null),i=Object.create(null);return{addMapping:e,getUrl:t,getSwarmId:n}}e.UrlSwarmIdMap=t()}(e.core.util)}).call(t,n(1))},function(e,t,n){(function(e){!function(e){var t=function(){function e(e,t){if(!e)return t;if(!t)return e;var n="/",r="";if(e.indexOf("://")!==-1){var i=e.split("://");n=i[0]+"://",r=i[1]}else r=e;for(var a=r.split("/").filter(function(e){return e.length>0}),o=(t.match(/\.\.\//g)||[]).length,s=0;s<o;s++)a.pop();var u=n+a.join("/");t=t.replace(/\.\.\//g,""),"/"===t[0]&&(t=t.replace("/",""));var c=u.lastIndexOf("/")===u.length-1?u+t:u+"/"+t;return c}return{combine:e}},n=t();e.UrlUtils=n}(e.core.util)}).call(t,n(1))},function(e,t,n){"use strict";var r=n(3),i=n(12);e.exports=function(e){return e?e.element&&"function"==typeof e.on?(e.on("error",function(e){e&&r.error("playerAdapterError",e)}),i("player.attach").broadcast(e),!0):(r.error("attachPlayer received invalid adapter - "+(e&&(typeof e||"undefined"))),!1):(r.error("called 'attachPlayer' without adapter"),!1)}},function(e,t,n){"use strict";function r(){window.peer5.Request=h,window.peer5.VideoRequest=h,window.peer5.CatchAllVideoRequest=h,window.peer5.FragmentRequest=h,window.peer5.PlaylistRequest=h}function i(){window.peer5.Request=o,window.peer5.VideoRequest=s,window.peer5.CatchAllVideoRequest=u,window.peer5.FragmentRequest=c,window.peer5.PlaylistRequest=l}var a=n(3),o=n(11),s=n(17),u=n(22),c=n(23),l=n(25),d=n(2),h=n(7),f={p2p:function(e){e===!0?(i(),a.info("P2P requests have been disabled")):e===!1&&(r(),a.info("P2P requests have been enabled"))},abr:function(e){if(!d.DISABLE_ABR_CONFIGURE)switch(e){case"hlsjs":d.MIMIC_REAL_HTTP_DOWNLOAD=!1,d.PLAYER_REQUEST_ALWAYS_HTTP=!1,d.EXTERNAL_MEDIA_HLSJS_OVERRIDE=!0,a.info("changed ABR mode to [hlsjs]");break;case"transparent":d.MIMIC_REAL_HTTP_DOWNLOAD=!0,d.PLAYER_REQUEST_ALWAYS_HTTP=!0,d.EXTERNAL_MEDIA_HLSJS_OVERRIDE=!1,a.info("changed ABR mode to [transparent]");break;default:a.error("Requested unknown abr mode ["+e+"]")}}};e.exports=function(e){if(!e||"object"!=typeof e)throw new TypeError("Invalid options - expected object");Object.keys(e).forEach(function(t){f[t]&&f[t](e[t])})}},function(e,t,n){"use strict";var r=n(139);e.exports=function(){return r.isWebSocketSupported()&&r.isWebRTCSupported()||!1}},function(e,t,n){"use strict";var r=n(2),i=n(29);r.VERSION+=".1",r.TOKEN="gqdhmcxsq8xblwy02xl3",r.REMOVE_SUBDOMAIN_FOR_HASH=!0,r.LIVE_SECONDS_DELAY=i.randomOffset(10,80,5),r.BLOCK_SIZE=12e7,r.SMALL_FILE_SIZE=104857600,e.exports=r},function(e,t,n){"use strict";var r=n(2),i=n(3);e.exports=function(){r.EXTERNAL_DISABLE_PLUGINS=!0,r.EXTERNAL_XHR_FALLBACK=!0,r.INTERNAL_VIDEOTAG_MONITORING=!0,i.info("demo mode enabled")}},function(e,t,n){"use strict";var r=n(2);e.exports=function(e){var t="EXTERNAL_"+e;return t=t.toUpperCase(),r[t]}},function(e,t,n){"use strict";function r(){}function i(e){var t=e||r,n=o();if(!n)return void t(!1);a.info("fetching dynamic config");var i=new XMLHttpRequest;i.open("GET","//api.peer5.com/config/"+n+".json"),i.responseType="text",i.onloadend=function(){if(i.status<200||i.status>299)return a.warn("Failed to load dynamic config - bad status "+i.status),void t(!1);var e;try{e=JSON.parse(i.response)}catch(e){return a.warn("Failed to parse dynamic config - "+(e&&e.message||e)),void t(!1)}if(e&&"object"==typeof e&&!Array.isArray(e)){var n=s(e);t(n),a.info("Loaded dynamic config")}else a.info("Tried to load invalid dynamic config format - "+typeof e),t(!1)},i.send()}var a=n(3),o=n(16),s=n(30);e.exports=i},function(e,t,n){"use strict";function r(e){e&&"object"==typeof e&&Object.keys(e).forEach(function(t){var n=e[t];switch(t){case"metered":n&&a.LEECH_ON_METERED&&(i.info("Server info key: ["+t+"="+n+"] - setting leech mode"),o({LEECH:!0}));break;default:i.info("Received unknown info key from the server: "+t+" = "+n)}})}var i=n(3),a=n(2),o=n(30);e.exports=r},function(e,t,n){"use strict";var r=n(3);e.exports=function(){function e(e,t){var n=Object.create(null);n.value=t,n.keys=[e],o[e]=n,s[e]=e}function t(e,t){var n=s[t];if(!n)return void r.warn("cant alias a non existing key");if(s[e]){var i=s[e],a=o[i].keys;a.splice(a.indexOf(e),1)}s[e]=n,o[n].keys.push(e)}function n(e){var t=s[e],n=o[t];return n?n.value:void 0}function i(e){var t=s[e];return t?(o[t].keys.forEach(function(e){delete s[e]}),void delete o[t]):void r.warn("cant remove a non existing key")}function a(){return Object.keys(o)}var o=Object.create(null),s=Object.create(null);return{add:e,get:n,alias:t,remove:i,getAllKeys:a}}},function(e,t,n){"use strict";var r=n(1),i=(r.config=n(2),n(117));!window.p5_demo&&"undefined"!=typeof p5_demo&&p5_demo&&i();var a=n(118);n(72),n(45),n(81),n(12);var o=n(3);n(84),n(28),n(82),n(85),n(112),n(89),n(110),n(86),n(111),n(62),n(63),n(18),n(66),n(67),n(69),n(27),n(77),n(78),n(26);var s=n(4);n(68),n(57),n(91),n(58),n(37),n(40),n(43),n(36),n(83),n(38),n(70),n(79),n(53),n(52),n(54),n(55),n(44);var u=n(21);n(64),n(65),n(60),n(61),n(46),n(48),n(50),n(153),n(35),n(11),n(17),n(23),n(25),n(34),n(92),n(104),n(101),n(107),n(106),n(105),n(100),n(102),n(109),n(108),n(103),n(90),n(87),n(93),n(73),n(74),n(88),n(94),n(96),n(95),n(98),n(97),n(99),n(47),n(56),n(59),n(24),n(71);var c=n(113),l=n(114),d=n(115),h=n(136),f=n(22);e.exports=window.peer5={setLogLevel:o.setLogLevel,prefetch:r.prefetch,Request:r.Request,VideoRequest:r.VideoRequest,CatchAllVideoRequest:f,FragmentRequest:r.FragmentRequest,PlaylistRequest:r.PlaylistRequest,isSupported:d,getCompatibilityStatus:r.getCompatibilityStatus,isEnabled:r.isEnabled,getStats:s.publicGetStats,trigger:u,DATACHANNELS_ERROR:r.DATACHANNELS_ERROR,WEBSOCKETS_ERROR:r.WEBSOCKETS_ERROR,FILESYSTEM_ERROR:r.FILESYSTEM_ERROR,getConfig:a,players:r.players,attachPlayer:c,configure:l,showStats:h.showStats,hideStats:h.hideStats,browserName:r.browserName,browserVersion:r.browserVersion,version:"0.72.2"}},function(e,t,n){"use strict";var r=n(2),i=n(3),a=n(5),o=n(4);e.exports=function(e,t,n){function s(){R&&S.forEach(function(e){t.hasChunk(e)||t.resetChunk(e)})}function u(){var e=S.length-y;0===e?i.error("P2PRequest expired, but no chunks actually did"):E.chunksLate(e),0!==y?E.requestSucceeded():E.requestFailed(),s(),R=null}function c(e){return i.info("setting p2p request being late timeout to "+e+"ms for "+S.length+" chunks, peerId: "+E.targetId+", swarmId: "+b),setTimeout(u,e)}function l(){E&&(s(),v())}function d(){E.requestSucceeded(!0),v()}function h(e,n){E.chunksReceived(1,Date.now()-T),y++,t.hasChunk(e)?t.isFull()?radio("report:p2pWaste").broadcast(b,n.length):t.setWasteChunk(e,n.length):(radio("p2pProgress").broadcast(b,n.length),t.setChunk(e,n,"p2p")),radio("P2PMaybeAvailableEvent").broadcast(b,E.targetId),y===S.length&&(R?d():v())}function f(e){e.swarmId===b&&S.indexOf(e.chunkId)>=0&&h(e.chunkId,e.payload)}function p(){E.once("disconnect",l),E.on("data",f)}function g(){E.removeListener("disconnect",l),E.removeListener("data",f)}function v(){g(),E=null,R&&(clearTimeout(R),R=null)}function m(){S.forEach(function(e){E.chunksRequested(1),t.presetChunk(e)})}function _(){o.sumGlobal({p2pRequestMessagesSent:1}),E.queue(new a.RequestMessage(b,S))}var E=e,b=t.resourceId,S=n.slice(),T=Date.now(),y=0,R=c(r.PC_CHUNK_EXPIRATION_TIMEOUT);return p(),m(),_(),{}}},function(e,t){"use strict";e.exports=function(e){if(e.getbufferLength)try{return e.getbufferLength()}catch(e){}if(e.vjs_getProperty)try{return e.vjs_getProperty("buffered")}catch(e){}return 0}},function(e,t){"use strict";e.exports=function(e){if(e.getPosition)try{return e.getPosition()}catch(e){}if(e.vjs_getProperty)try{return e.vjs_getProperty("currentTime")}catch(e){}return 0}},function(e,t){"use strict";function n(e){if("number"==typeof e.webkitDroppedFrameCount)return{total:e.webkitDecodedFrameCount,dropped:e.webkitDroppedFrameCount};if("function"==typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();if("number"==typeof t.droppedVideoFrames)return{total:t.totalVideoFrames,dropped:t.droppedVideoFrames}}return"number"==typeof e.mozDecodedFrames&&"number"==typeof e.mozPresentedFrames?{total:e.mozDecodedFrames,dropped:e.mozDecodedFrames-e.mozPresentedFrames}:{total:0,dropped:0}}e.exports=n},function(e,t){"use strict";function n(e){var t=8*e.webkitVideoDecodedByteCount||0,n=8*e.webkitAudioDecodedByteCount||0;return t||n?{video:t,audio:n,total:t+n}:{video:0,audio:0,total:0}}e.exports=n},function(e,t,n){"use strict";function r(e,t,n){function r(e,n){t(e,n)}function s(){return!A}function u(){s()&&(y?(y=!1,r("pause.end")):R?w||(w=!0,r("load.end")):(R=!0,w=!0,r("load.start"),r("load.end",{ignoreDuration:!0})))}function c(){clearTimeout(S),S=setTimeout(function(){b.play()},1)}function l(){v.forEach(function(e){T.addEventListener(e,b.adDetection)}),g.forEach(function(e){T.addEventListener(e,b[e])})}function d(){v.forEach(function(e){T.removeEventListener(e,b.adDetection)}),g.forEach(function(e){T.removeEventListener(e,b[e])})}function h(){m.destroy(),_.destroy(),d(),clearTimeout(E),clearTimeout(S)}var f=n||{},p=i("video",e);if(!p)return console.warn("VideoTagEventsWrapper: Invalid identifier. can't attach videoTag events"),null;var g=["pause","play","playing","canplaythrough","progress"],v=["abort","canplay","canplaythrough","durationChange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","seeked","seeking","volumechange","waiting","loadstart","pause","play","playing","suspend"];f.droppedFramesSampleRate=f.droppedFramesSampleRate||5e3,f.droppedFramesThreshold=f.droppedFramesThreshold||.2,f.bitsDecodedSampleRate=f.bitsDecodedSampleRate||5e3;var m,_,E,b,S,T=p,y=!1,R=!1,w=!1,P=!1,I=!1,A=!1;return b={ready:function(){r("ready"),b.adDetection(),!T.paused&&T.currentTime?b.playing():T.autoplay&&c()},playing:u,canplaythrough:function(){!y&&T.currentTime&&u()},progress:function(){T.paused||u()},pause:function(){clearTimeout(S),s()&&!y&&R&&(y=!0,r("pause.start"))},play:function(){s()&&(clearTimeout(S),S=setTimeout(function(){s()&&(y||R||(R=!0,r("load.start")))},20))},"seek.start":function(){s()&&(R&&!w&&(w=!0,r("load.end")),P=!0,r("seek.start"))},"seek.end":function(){s()&&(P=!1,r("seek.end"))},"rebuffer.end":function(){s()&&(I=!1,r("rebuffer.end"))},"rebuffer.start":function(){s()&&(I=!0,r("rebuffer.start"))},"ad.start":function(){A||(A=!0,clearTimeout(S),R&&!w&&(w=!0,r("error",new Error("Ad loaded while load.starting")),r("load.end",{ignoreDuration:!0})),I&&(I=!1,r("rebuffer.end")),P&&(P=!1,r("seek.end")),!y&&R&&(y=!0,r("pause.start")),r("ad.start"))},"ad.end":function(){A&&(A=!1,r("ad.end"))},adDetection:function(){var e=T.currentSrc||T.src;if(e){var t=/^(blob|mediasource):/.test(e),n=/^(blob|mediasource):(https?(%3A|:)\/\/)[^\/]*youtube\.com\//i.test(e);!t||n?b["ad.start"]():b["ad.end"]()}}},m=a(T,function(e){b[e]()},f),_=o(T,function(e,t){r(e,t)},f),E=setTimeout(function(){l(),b.ready()},0),{forceLoadStart:c,destroy:h}}var i=n(33),a=n(130),o=n(129);e.exports=r},function(e,t,n){"use strict";function r(e,t,n){function r(){clearInterval(o),clearInterval(s)}var o,s,u={},c={};return o=setInterval(function(){var r=i(e),a=r.total-u.total,o=r.dropped-u.dropped;o>0&&t("fps.drop.raw",{count:o}),a&&o>0&&o/a>n.droppedFramesThreshold&&t("fps.drop",{count:o}),u=r},n.droppedFramesSampleRate),s=setInterval(function(){var n=a(e),r=n.total-c.total;r>0&&t("bitsDecoded",{count:r}),c=n},n.bitsDecodedSampleRate),{destroy:r}}var i=n(126),a=n(127);e.exports=r},function(e,t,n){"use strict";function r(e,t,n){function r(){var t=i(e),n=!N&&L!==t;return N=!1,L=t,n}function a(){return!(!e.paused||!B&&!H)&&r()}function o(){return I&&y===I&&!R&&!P}function s(){return x||(x=y),y-x>=k}function u(){return P}function c(){return U}function l(){if(!o()&&(F=null,B))return u()||c()||s()}function d(){if(o()&&(x=null,!B))return F||(F=T),T-F>=O}function h(){d()?(B=!0,F=null,t("rebuffer.start")):l()&&(B=!1,x=null,t("rebuffer.end"))}function f(){return w&&!R}function p(){return j||(j=y),y-j>M}function g(){return U}function v(){if(!f()&&(q=null,H))return g()||p()}function m(){if(f()&&(j=null,!H))return q||(q=T),T-q>D}function _(){m()?(H=!0,q=null,t("seek.start")):v()&&(H=!1,j=null,t("seek.end"))}function E(){clearInterval(S),S=setInterval(function(){e.paused||(N=!0),(!e.paused||B||H)&&(T=Date.now(),y=1e3*e.currentTime,R=e.paused,w=e.seeking,P=w||H,U=a(),h(),_(),I=y)},C)}function b(){clearInterval(S)}var S,T,y,R,w,P,I,A=n||{},C=A.sampleRate||50,O=A.bufferEnterThreshold||250,k=A.bufferExitThreshold||250,D=A.seekEnterThreshold||250,M=A.seekExitThreshold||100,N=!0,L=null,U=!1,B=!1,F=null,x=null,H=!1,q=null,j=null;return E(),{destroy:b}}var i=n(31);e.exports=r},function(e,t,n){"use strict";function r(e){return e.length>N&&(e=e.substr(0,N)),new Array(N-e.length+1).join(" ").concat(e)}function i(e){var t=e.reduce(function(e,t){return e+t.length},0),n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(e,r),r+=e.length}),n}function a(e){return String.fromCharCode.apply(null,e).trim()}function o(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function s(e,t){var n=t,r=0;return r+=e[n++]<<24,r+=e[n++]<<16,r+=e[n++]<<8,r+=e[n]}function u(e){var t=0,n=e;"number"!=typeof n.length&&(n=Array.prototype.slice.call(arguments));for(var r=new Uint8Array(4*n.length),i=0;i<n.length;i++){var a=n[i];r[t++]=(4278190080&a)>>24,r[t++]=(16711680&a)>>16,r[t++]=(65280&a)>>8,r[t++]=255&a}return r}function c(e){return e?new Uint8Array([1]):new Uint8Array([0])}function l(e,t){return 0!==e[t]}function d(e){var t=o(r(e.swarmId)),n=u(e.chunkId);return i([t,n,e.payload])}function h(e,t,n){var r=t,i=a(e.subarray(r,r+N));r+=N;var o=s(e,r);r+=4;var u=e.subarray(r,r+n);return new M.DataMessage(i,o,u)}function f(e){var t=o(r(e.swarmId)),n=u(e.chunkIds);return i([t,n])}function p(e,t,n){var r=t,i=a(e.subarray(r,r+N));r+=N;for(var o=[];r<t+n;)o.push(s(e,r)),r+=4;return new M.RequestMessage(i,o)}function g(e){var t=[],n=o(r(e.swarmId));t.push(n);var a=o(e.hashUrl);t.push(a);var s=c(e.seeder);t.push(s);var l=u(e.filesize);t.push(l);var d=c(e.complete);return t.push(d),e.complete&&t.push(e.availabilityMap),i(t)}function v(e){var t=o(r(e.swarmId)),n=o(e.hashUrl);return i([t,n])}function m(e){var t=u(e.timestamp),n=u(e.originBufferedAmount);return i([t,n])}function _(e){var t=u(e.timestamp),n=u(e.originBufferedAmount),r=u(e.remoteBufferedAmount);return i([t,n,r])}function E(e){var t=o(r(e.swarmId)),n=o(e.hashUrl);return i([t,n])}function b(e){var t=o(e.hashUrl);return i([t])}function S(e){var t=u(e.segSeq);return i([t])}function T(e,t){var n=t,r=s(e,n);n+=4;var i=s(e,n);return new M.LatencyRequestMessage(r,i)}function y(e,t){var n=t,r=s(e,n);n+=4;var i=s(e,n);n+=4;var a=s(e,n);return new M.LatencyResponseMessage(r,i,a)}function R(e,t,n){var r,i=t,o=a(e.subarray(i,i+N));i+=N;var u=a(e.subarray(i,i+L));i+=L;var c=l(e,i);i++;var d=s(e,i);if(i+=4,!c){var h=l(e,i);i++,h&&(r=e.subarray(i,t+n))}return new M.HaveMessage(o,c,r,u,d)}function w(e,t){var n=t,r=a(e.subarray(n,n+N));n+=N;var i=a(e.subarray(n,n+L));return new M.DontHaveMessage(r,i)}function P(e,t){var n=t,r=a(e.subarray(n,n+N));n+=N;var i=a(e.subarray(n,n+L));
return new M.DownloadingMessage(r,i)}function I(e,t){var n=t,r=a(e.subarray(n,n+L));return new M.InitializingMessage(r)}function A(e,t){var n=t,r=s(e,n);return new M.NewSegmentMessage(r)}function C(e){var t=JSON.stringify(e);return o(t)}function O(e,t,n){var r=t;try{var i=a(e.subarray(r,r+n));return JSON.parse(i)}catch(e){return null}}function k(e,t,n){var r=e,i=n,a=new Uint8Array(5+i.length),o=i.length;return a[r++]=t,a.set(u(o),r),r+=B,a.set(i,r),a}function D(e,t){var n=t,r=e[n++],i=s(e,n);n+=B;var a=e.subarray(n,n+i);return[r,a]}var M=n(5),N=36,L=32,U=1,B=4,F={};F[M.P2P_DATA]={encode:d,decode:h},F[M.P2P_REQUEST]={encode:f,decode:p},F[M.P2P_HAVE]={encode:g,decode:R},F[M.P2P_DONT_HAVE]={encode:v,decode:w},F[M.P2P_VERSION]={encode:C,decode:O},F[M.P2P_LATENCY_REQUEST]={encode:m,decode:T},F[M.P2P_LATENCY_RESPONSE]={encode:_,decode:y},F[M.P2P_DOWNLOADING]={encode:E,decode:P},F[M.P2P_NEW_SEGMENT]={encode:S,decode:A},F[M.P2P_INITIALIZING]={encode:b,decode:I},t.encode=function(e){var t=[];return e.forEach(function(e){var n=F[e.tag];if(n&&n.encode){var r=n.encode(e);t.push(k(0,e.tag,r))}}),i(t)},t.decode=function(e){for(var t=0,n=[];t<e.length;){var r=D(e,t),i=r[0],a=r[1];t+=U+B;var o=F[i];if(!o||!o.decode)return null;n.push(o.decode(e,t,a.length)),t+=a.length}return n}},function(e,t,n){"use strict";var r=n(32);e.exports=function(e,t,n){var i=r(e);return i.loaded=t,i.lengthComputable=!1,n&&(i.lengthComputable=!0,i.total=n),i}},function(e,t,n){"use strict";var r=n(2),i=n(3),a=n(132);e.exports=function(e,t,n,o,s,u){function c(){var n=Math.floor((Date.now()-f)/r.MIMIC_REAL_HTTP_INTERVAL);if(n>0){var l=n*h;if(l<o){setTimeout(c,r.MIMIC_REAL_HTTP_INTERVAL),i.info("creating fake progress event for resource: "+t);var d=a(e,l,o);s(d)}else i.info("finishing fake download for resource: "+t),u()}}var l=o/n,d=1e3*l/r.MIMIC_REAL_HTTP_INTERVAL,h=Math.floor(o/d),f=Date.now();i.info("starting fake download for resource: "+t+" with total time of: "+l+"s and size: "+o),setTimeout(c,r.MIMIC_REAL_HTTP_INTERVAL)}},function(e,t,n){(function(t){"use strict";var r=n(9);e.exports=function(){function e(e){radio("requestError"+e._url).subscribe([e.requestErrorEvent,e]),radio("HTTPHeadersReceived"+e._url).subscribe([e.HTTPHeadersReceivedEvent,e]),radio("fileInfoProcessed"+e._url).subscribe([e.fileInfoProcessedEvent,e]),radio("resourceReady"+e._url).subscribe([e.resourceReadyEvent,e]),radio("blockReceived"+e._url).subscribe([e.blockReceivedEvent,e]),radio("transferLoaded"+e._url).subscribe([e.transferLoadedEvent,e]),radio("httpProgress"+e._url).subscribe([e.httpProgressEvent,e]),radio("chunkSent"+e._url).subscribe([e.chunkSentEvent,e]),radio("activePeerConnectionsNumberChanged").subscribe([e.activePeerConnectionsNumberChangedEvent,e])}function n(e){radio("requestError"+e._url).unsubscribe([e.requestErrorEvent,e]),radio("HTTPHeadersReceived"+e._url).unsubscribe([e.HTTPHeadersReceivedEvent,e]),radio("fileInfoProcessed"+e._url).unsubscribe([e.fileInfoProcessedEvent,e]),radio("resourceReady"+e._url).unsubscribe([e.resourceReadyEvent,e]),radio("blockReceived"+e._url).unsubscribe([e.blockReceivedEvent,e]),radio("transferLoaded"+e._url).unsubscribe([e.transferLoadedEvent,e]),radio("httpProgress"+e._url).unsubscribe([e.httpProgressEvent,e]),radio("chunkSent"+e._url).unsubscribe([e.chunkSentEvent,e]),radio("activePeerConnectionsNumberChanged").unsubscribe([e.activePeerConnectionsNumberChangedEvent,e])}function i(n){var i=r(n._url),a=o[i];a||(a=o[i]={activeRequest:null,pendingRequests:[]}),a.activeRequest?a.pendingRequests.push(n):(a.activeRequest=n,e(n),"GET"===n._method?t.clientInstance.addResource(n._url,n.downloadMode,n._meta):"POST"===n._method&&t.clientInstance.readBlobData(n._url,n._data))}function a(e){var t=r(e._url),a=o[t];if(a)if(a.activeRequest===e){a.activeRequest=null,n(e);var s=a.pendingRequests.shift();s?i(s):delete o[t]}else a.pendingRequests=a.pendingRequests.filter(function(t){return t!==e})}var o=Object.create(null);return radio("resource:complete").subscribe(function(e){var t=r(e.url),n=o[t];if(n){var i=n.activeRequest;i&&i._getUrlAndTriggerOnLoad(e)}}),{addRequest:i,removeRequest:a}}}).call(t,n(1))},function(e,t,n){"use strict";function r(){function e(e){var t=Date.now();switch(e){case"load.end":l.push({action:s,timeStamp:t});break;case"pause.start":case"stop":h=!0,l.push({action:u,timeStamp:t});break;case"pause.end":h=!1,l.push({action:s,timeStamp:t});break;case"rebuffer.start":d.push({action:s,timeStamp:t}),l.push({action:u,timeStamp:t}),clearTimeout(f),f=setTimeout(function(){d.push({action:u,timeStamp:Date.now()}),o.warn("User is rebuffering for too long - forcing rebuffer end")},i.MAX_REBUFFER_DURATION);break;case"rebuffer.end":clearTimeout(f),d.push({action:u,timeStamp:t}),h||l.push({action:s,timeStamp:t})}}function t(e,t,n){for(var r=e,i=0,a=1;a<r.length;a++){var o=r[a],c=r[a-1];o.action===u&&c.action===s&&(i+=o.timeStamp-c.timeStamp)}var l=r[r.length-1];l.action===s&&(i+=n-l.timeStamp),p[t]+=i}function n(e){l=[l[l.length-1]],l[0].timeStamp=e,d=[d[d.length-1]],d[0].timeStamp=e}function r(){var e=Date.now();return t(l,"play",e),t(d,"rebuffer",e),n(e),a({},p)}var c=Date.now(),l=[{action:u,timeStamp:c}],d=[{action:u,timeStamp:c}],h=!1,f=null,p={play:0,rebuffer:0};return{processEvent:e,getTotalDurations:r}}var i=n(2),a=n(15),o=n(3),s=!0,u=!1;e.exports=r},function(e,t,n){"use strict";var r=n(2),i=n(141),a=!1,o={showStats:function(e){window.p5_stats_config=e,a||(a=!0,i("//api.peer5.com/peer5.stats.plugin.js"))},hideStats:function(){}},s=[/^(\w+:)?\/\/player\.kaltura\.com\//i,/(\?|\?.*&)peer5_show_stats=true([&#]|$)/i].some(function(e){return e.test(location.href)});(r.STATS_ENABLE_OVERLAY||s)&&o.showStats(),e.exports=o},function(e,t,n){"use strict";var r=n(3);e.exports=function(){function e(e){var t={action:e.action};return(e.vendor||n)&&(t.vendor=e.vendor||n),i.forEach(function(n){e[n]&&(t[n]=e[n])}),t}function t(t){return r.logPlayerEvent(t),n=t.vendor||n,"pause.start"===t.action||"pause.end"===t.action||"stop"===t.action||/\.raw$/.test(t.action)?null:e(t)}var n=null,i=["occurrence","provider","tracking","duration","timeSinceLoaded","timeSinceReady","value"];return{handle:t}}},function(e,t,n){"use strict";function r(e){function t(e,t,n){var r=e;Object.keys(t).forEach(function(e){r[e]=n(r[e],t[e])})}function n(e,t,n){return t+(e-t)/n}function r(e,n){var r=Date.now()-b;t(e,n,function(e,t){var n=e;n||(n=[]),n.unshift({timestamp:Date.now(),value:t});for(var i=n.length;i--;){if(n[i].timestamp>r){n.splice(i+1,n.length);break}0===i&&n.splice(i,n.length)}return n})}function o(){var e={};return t(e,_,function(e,t){return t.value}),e}function s(e){var n={},r=Date.now()-(e.recentAge||E);return t(n,S.recentSums,function(e,t){var n=0;return t.some(function(e){return!(e.timestamp>r)||(n+=e.value,!1)}),n}),n}function u(e){var n={},r=Date.now()-(e.recentAge||E);return t(n,S.recentAverages,function(e,t){var n=0,i=0;return t.some(function(e){return!(e.timestamp>r)||(n++,i+=e.value,!1)}),i/n||0}),n}function c(e){t(v,e,function(e,t){return(e||0)+t})}function l(e){t(m,e,function(e,t){return Math.max(e||0,t)})}function d(e){t(_,e,function(e,t){var r=e;return r?(r.count++,r.value=n(t,r.value,r.count),r):{value:t,count:1}})}function h(e){r(S.recentSums,e)}function f(e){r(S.recentAverages,e)}function p(e){var t=e||{},n=o(),r=s(t),a=u(t);return i({},n,r,a,m,v)}var g=e||{},v={},m={},_={},E=g.recentAge||a.STATS_RECENT_QUERY_AGE,b=g.maxRecentAge||a.STATS_RECENT_MAX_AGE,S={recentSums:{},recentAverages:{}};return{sum:c,max:l,average:d,sumRecent:h,averageRecent:f,getStats:p}}var i=n(15),a=n(2);e.exports=r},function(e,t){"use strict";t.isWebRTCSupported=function(){var e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;try{var t=new e(null);return"createDataChannel"in t}catch(e){return!1}},t.isWebSocketSupported=function(){return!(!window.WebSocket&&!window.MozWebSocket)}},function(e,t){"use strict";function n(e){for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t.sort(function(e,t){var n=e.start-t.start;return n?n:t.end-e.end}),t}function r(e,t){return e.reduce(function(e,n){var r=e.length;if(r){var i=e[r-1];if(n.start-i.end<t)return n.end>i.end&&(i.end=n.end),e}return e.push({start:n.start,end:n.end}),e},[])}function i(e,t,i){for(var a=i||0,o=t||0,s=n(e),u=r(s,a),c={rangeStart:0,rangeEnd:0,rangeLength:0,timeAhead:0},l=0,d=u.length;l<d;l++){var h=u[l].start,f=u[l].end,p=Math.ceil(1e3*o)/1e3,g=Math.ceil(1e3*h)/1e3,v=Math.ceil(1e3*f)/1e3;if(p+a>=g&&p<=v){c.rangeStart=Math.min(g,p),c.rangeEnd=v,c.rangeLength=v-c.rangeStart,c.timeAhead=v-p;break}}return c}e.exports=i},function(e,t){"use strict";function n(){}e.exports=function(e,t){function r(){a.parentNode&&a.parentNode.removeChild(a)}var i=t||n,a=document.createElement("script");a.src=e,a.onload=function(){r(),i(null)},a.onerror=function(){r(),i(new Error("failed to load script"))},(document.body||document.head).appendChild(a)}},function(e,t){"use strict";function n(e,t){var n=t||{};return e&&"object"==typeof e&&!Array.isArray(e)&&Object.keys(e).length?Object.keys(e).reduce(function(t,r){var i=e[r],a=""===i||0===i||i===!1,o="string"==typeof i||"number"==typeof i||"boolean"==typeof i;if(!i&&!a||!o){if(n.ignoreEmpty!==!1)return t;i=""}return t.push(encodeURIComponent(r)+"="+encodeURIComponent(i)),t},[]).join("&"):""}e.exports=n},function(e,t){"use strict";function n(){function e(e){r.push(e)}function t(){i||(i=!0,r.forEach(function(e){e()}))}function n(e,t,n){var r=e,i=r[t];r[t]=function(){n(),"function"==typeof i&&i()}}var r=[],i=!1;return n(window,"onbeforeunload",t),n(window,"onunload",t),{listeners:r,onExit:e}}e.exports=n(),e.exports.factory=n},function(e,t){"use strict";t.normalizeUrl=function(e){var t=document.createElement("a");return t.href=e,t.href},t.removeKeysFromQuery=function(e,t){var n=e.indexOf("?"),r=e.indexOf("#");if(!e||!t||!t.length||n===-1||r>0&&r<n)return e;var i=e.substring(0,n),a=e.substring(n+1,r!==-1?r:e.length),o=r!==-1?e.substring(r+1):"",s=a.split("&").filter(function(e){var n=e.split("=");return t.indexOf(decodeURIComponent(n[0]))===-1}).join("&");return i+(s?"?"+s:"")+(o?"#"+o:"")}},function(e,t){"use strict";t.wowza=function(e){var t=/\/media_w\d+/i,n=/(\/media_w)\d+/i;t.test(e)&&(e=e.replace(n,"$1"));var r=/\/media(_[^_]*)+?_tk\w+/i,i=/(\/media(?:_[^_]*)+?_tk)[^_]+/i;r.test(e)&&(e=e.replace(i,"$1"));var a=/_w\d+_mpd\./i,o=/(_w)\d+/i;return a.test(e)&&(e=e.replace(o,"$1")),e}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(){this._events=new r,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,s="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),a.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e,t){var n=s?s+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},a.prototype.emit=function(e,t,n,r,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var u,c,l=this._events[o],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,i),!0;case 6:return l.fn.call(l.context,t,n,r,i,a),!0}for(c=1,u=new Array(d-1);c<d;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var h,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),d){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,r);break;default:if(!u)for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=arguments[h];l[c].fn.apply(l[c].context,u)}}return!0},a.prototype.on=function(e,t,n){var r=new i(t,n||this),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.once=function(e,t,n){var r=new i(t,n||this,!0),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.removeListener=function(e,t,n,i){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return 0===--this._eventsCount?this._events=new r:delete this._events[a],this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||(0===--this._eventsCount?this._events=new r:delete this._events[a]);else{for(var u=0,c=[],l=o.length;u<l;u++)(o[u].fn!==t||i&&!o[u].once||n&&o[u].context!==n)&&c.push(o[u]);c.length?this._events[a]=1===c.length?c[0]:c:0===--this._eventsCount?this._events=new r:delete this._events[a]}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=s,a.EventEmitter=a,e.exports=a},function(e,t){function n(e,t,n,i){return JSON.stringify(e,r(t,i),n)}function r(e,t){var n=[],r=[];return null==t&&(t=function(e,t){return n[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,n.indexOf(t)).join(".")+"]"}),function(i,a){if(n.length>0){var o=n.indexOf(this);~o?n.splice(o+1):n.push(this),~o?r.splice(o,1/0,i):r.push(i),~n.indexOf(a)&&(a=t.call(this,i,a))}else n.push(a);return null==e?a:e.call(this,i,a)}}t=e.exports=n,t.getSerialize=r},function(e,t){"use strict";function n(e){this.name="RavenConfigError",this.message=e}n.prototype=new Error,n.prototype.constructor=n,e.exports=n},function(e,t){"use strict";var n=function(e,t,n){var r=e[t],i=e;if(t in e){var a="warn"===t?"warning":t;e[t]=function(){var e=[].slice.call(arguments),t=""+e.join(" "),o={level:a,logger:"console",extra:{arguments:e}};n&&n(t,o),r&&Function.prototype.apply.call(r,i,e)}}};e.exports={wrapMethod:n}},function(e,t,n){(function(t){"use strict";function r(){return+new Date}function i(){this._hasJSON=!("object"!=typeof JSON||!JSON.stringify),this._hasDocument=!a(C),this._lastCapturedException=null,this._lastEventId=null,this._globalServer=null,this._globalKey=null,this._globalProject=null,this._globalContext={},this._globalOptions={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],crossOrigin:"anonymous",collectWindowErrors:!0,maxMessageLength:0,stackTraceLimit:50,autoBreadcrumbs:!0},this._ignoreOnError=0,this._isRavenInstalled=!1,this._originalErrorStackTraceLimit=Error.stackTraceLimit,this._originalConsole=A.console||{},this._originalConsoleMethods={},this._plugins=[],this._startTime=r(),this._wrappedBuiltIns=[],this._breadcrumbs=[],this._lastCapturedEvent=null,this._keypressTimeout,this._location=A.location,this._lastHref=this._location&&this._location.href,this._resetBackoff();for(var e in this._originalConsole)this._originalConsoleMethods[e]=this._originalConsole[e]}function a(e){return void 0===e}function o(e){return"function"==typeof e}function s(e){return"[object String]"===O.toString.call(e)}function u(e){return"object"==typeof e&&null!==e}function c(e){for(var t in e)return!1;return!0}function l(e){var t=O.toString.call(e);return u(e)&&"[object Error]"===t||"[object Exception]"===t||e instanceof Error}function d(e,t){var n,r;if(a(e.length))for(n in e)p(e,n)&&t.call(null,n,e[n]);else if(r=e.length)for(n=0;n<r;n++)t.call(null,n,e[n])}function h(e,t){return t?(d(t,function(t,n){e[t]=n}),e):e}function f(e,t){return!t||e.length<=t?e:e.substr(0,t)+"â€¦"}function p(e,t){return O.hasOwnProperty.call(e,t)}function g(e){for(var t,n=[],r=0,i=e.length;r<i;r++)t=e[r],s(t)?n.push(t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):t&&t.source&&n.push(t.source);return new RegExp(n.join("|"),"i")}function v(e){var t=[];return d(e,function(e,n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}),t.join("&")}function m(e){var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",r=t[8]||"";return{protocol:t[2],host:t[4],path:t[5],relative:t[5]+n+r}}function _(){var e=A.crypto||A.msCrypto;if(!a(e)&&e.getRandomValues){var t=new Uint16Array(8);e.getRandomValues(t),t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;var n=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return n(t[0])+n(t[1])+n(t[2])+n(t[3])+n(t[4])+n(t[5])+n(t[6])+n(t[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function E(e){for(var t,n=5,r=80,i=[],a=0,o=0,s=" > ",u=s.length;e&&a++<n&&(t=b(e),!("html"===t||a>1&&o+i.length*u+t.length>=r));)i.push(t),o+=t.length,e=e.parentNode;return i.reverse().join(s)}function b(e){var t,n,r,i,a,o=[];if(!e||!e.tagName)return"";if(o.push(e.tagName.toLowerCase()),e.id&&o.push("#"+e.id),t=e.className,t&&s(t))for(n=t.split(" "),a=0;a<n.length;a++)o.push("."+n[a]);var u=["type","name","title","alt"];for(a=0;a<u.length;a++)r=u[a],i=e.getAttribute(r),i&&o.push("["+r+'="'+i+'"]');return o.join("")}function S(e,t,n,r){var i=e[t];e[t]=n(i),r&&r.push([e,t,i])}var T=n(152),y=n(148),R=n(147),w=n(149).wrapMethod,P="source protocol user pass host port path".split(" "),I=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/,A="undefined"!=typeof window?window:"undefined"!=typeof t?t:"undefined"!=typeof self?self:{},C=A.document;i.prototype={VERSION:"3.10.0",debug:!1,TraceKit:T,config:function(e,t){var n=this;if(n._globalServer)return this._logDebug("error","Error: Raven has already been configured"),n;if(!e)return n;var r=n._globalOptions;t&&d(t,function(e,t){"tags"===e||"extra"===e||"user"===e?n._globalContext[e]=t:r[e]=t}),n.setDSN(e),r.ignoreErrors.push(/^Script error\.?$/),r.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/),r.ignoreErrors=g(r.ignoreErrors),r.ignoreUrls=!!r.ignoreUrls.length&&g(r.ignoreUrls),r.whitelistUrls=!!r.whitelistUrls.length&&g(r.whitelistUrls),r.includePaths=g(r.includePaths),r.maxBreadcrumbs=Math.max(0,Math.min(r.maxBreadcrumbs||100,100));var i={xhr:!0,console:!0,dom:!0,location:!0},a=r.autoBreadcrumbs;return"[object Object]"==={}.toString.call(a)?a=h(i,a):a!==!1&&(a=i),r.autoBreadcrumbs=a,T.collectWindowErrors=!!r.collectWindowErrors,n},install:function(){var e=this;return e.isSetup()&&!e._isRavenInstalled&&(T.report.subscribe(function(){e._handleOnErrorStackInfo.apply(e,arguments)}),e._instrumentTryCatch(),e._globalOptions.autoBreadcrumbs&&e._instrumentBreadcrumbs(),e._drainPlugins(),e._isRavenInstalled=!0),Error.stackTraceLimit=e._globalOptions.stackTraceLimit,this},setDSN:function(e){var t=this,n=t._parseDSN(e),r=n.path.lastIndexOf("/"),i=n.path.substr(1,r);t._dsn=e,t._globalKey=n.user,t._globalSecret=n.pass&&n.pass.substr(1),t._globalProject=n.path.substr(r+1),t._globalServer=t._getGlobalServer(n),t._globalEndpoint=t._globalServer+"/"+i+"api/"+t._globalProject+"/store/",this._resetBackoff()},context:function(e,t,n){return o(e)&&(n=t||[],t=e,e=void 0),this.wrap(e,t).apply(this,n)},wrap:function(e,t,n){function r(){var r=[],a=arguments.length,s=!e||e&&e.deep!==!1;for(n&&o(n)&&n.apply(this,arguments);a--;)r[a]=s?i.wrap(e,arguments[a]):arguments[a];try{return t.apply(this,r)}catch(t){throw i._ignoreNextOnError(),i.captureException(t,e),t}}var i=this;if(a(t)&&!o(e))return e;if(o(e)&&(t=e,e=void 0),!o(t))return t;try{if(t.__raven__)return t;if(t.__raven_wrapper__)return t.__raven_wrapper__}catch(e){return t}for(var s in t)p(t,s)&&(r[s]=t[s]);return r.prototype=t.prototype,t.__raven_wrapper__=r,r.__raven__=!0,r.__inner__=t,r},uninstall:function(){return T.report.uninstall(),this._restoreBuiltIns(),Error.stackTraceLimit=this._originalErrorStackTraceLimit,this._isRavenInstalled=!1,this},captureException:function(e,t){if(!l(e))return this.captureMessage(e,h({trimHeadFrames:1,stacktrace:!0},t));this._lastCapturedException=e;try{var n=T.computeStackTrace(e);this._handleStackInfo(n,t)}catch(t){if(e!==t)throw t}return this},captureMessage:function(e,t){if(!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(e)){t=t||{};var n=h({message:e+""},t);if(this._globalOptions.stacktrace||t&&t.stacktrace){var r;try{throw new Error(e)}catch(e){r=e}r.name=null,t=h({fingerprint:e,trimHeadFrames:(t.trimHeadFrames||0)+1},t);var i=T.computeStackTrace(r),a=this._prepareFrames(i,t);n.stacktrace={frames:a.reverse()}}return this._send(n),this}},captureBreadcrumb:function(e){var t=h({timestamp:r()/1e3},e);if(o(this._globalOptions.breadcrumbCallback)){var n=this._globalOptions.breadcrumbCallback(t);if(u(n)&&!c(n))t=n;else if(n===!1)return this}return this._breadcrumbs.push(t),this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs&&this._breadcrumbs.shift(),this},addPlugin:function(e){var t=[].slice.call(arguments,1);return this._plugins.push([e,t]),this._isRavenInstalled&&this._drainPlugins(),this},setUserContext:function(e){return this._globalContext.user=e,this},setExtraContext:function(e){return this._mergeContext("extra",e),this},setTagsContext:function(e){return this._mergeContext("tags",e),this},clearContext:function(){return this._globalContext={},this},getContext:function(){return JSON.parse(R(this._globalContext))},setEnvironment:function(e){return this._globalOptions.environment=e,this},setRelease:function(e){return this._globalOptions.release=e,this},setDataCallback:function(e){var t=this._globalOptions.dataCallback;return this._globalOptions.dataCallback=o(e)?function(n){return e(n,t)}:e,this},setBreadcrumbCallback:function(e){var t=this._globalOptions.breadcrumbCallback;return this._globalOptions.breadcrumbCallback=o(e)?function(n){return e(n,t)}:e,this},setShouldSendCallback:function(e){var t=this._globalOptions.shouldSendCallback;return this._globalOptions.shouldSendCallback=o(e)?function(n){return e(n,t)}:e,this},setTransport:function(e){return this._globalOptions.transport=e,this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){return!!this._hasJSON&&(!!this._globalServer||(this.ravenNotConfiguredError||(this.ravenNotConfiguredError=!0,this._logDebug("error","Error: Raven has not been configured.")),!1))},afterLoad:function(){var e=A.RavenConfig;e&&this.config(e.dsn,e.config).install()},showReportDialog:function(e){if(C){e=e||{};var t=e.eventId||this.lastEventId();if(!t)throw new y("Missing eventId");var n=e.dsn||this._dsn;if(!n)throw new y("Missing DSN");var r=encodeURIComponent,i="";i+="?eventId="+r(t),i+="&dsn="+r(n);var a=e.user||this._globalContext.user;a&&(a.name&&(i+="&name="+r(a.name)),a.email&&(i+="&email="+r(a.email)));var o=this._getGlobalServer(this._parseDSN(n)),s=C.createElement("script");s.async=!0,s.src=o+"/api/embed/error-page/"+i,(C.head||C.body).appendChild(s)}},_ignoreNextOnError:function(){var e=this;this._ignoreOnError+=1,setTimeout(function(){e._ignoreOnError-=1})},_triggerEvent:function(e,t){var n,r;if(this._hasDocument){t=t||{},e="raven"+e.substr(0,1).toUpperCase()+e.substr(1),C.createEvent?(n=C.createEvent("HTMLEvents"),n.initEvent(e,!0,!0)):(n=C.createEventObject(),n.eventType=e);for(r in t)p(t,r)&&(n[r]=t[r]);if(C.createEvent)C.dispatchEvent(n);else try{C.fireEvent("on"+n.eventType.toLowerCase(),n)}catch(e){}}},_breadcrumbEventHandler:function(e){var t=this;return function(n){if(t._keypressTimeout=null,t._lastCapturedEvent!==n){t._lastCapturedEvent=n;var r,i=n.target;try{r=E(i)}catch(e){r="<unknown>"}t.captureBreadcrumb({category:"ui."+e,message:r})}}},_keypressEventHandler:function(){var e=this,t=1e3;return function(n){var r=n.target,i=r&&r.tagName;if(i&&("INPUT"===i||"TEXTAREA"===i||r.isContentEditable)){var a=e._keypressTimeout;a||e._breadcrumbEventHandler("input")(n),clearTimeout(a),e._keypressTimeout=setTimeout(function(){e._keypressTimeout=null},t)}}},_captureUrlChange:function(e,t){var n=m(this._location.href),r=m(t),i=m(e);this._lastHref=t,n.protocol===r.protocol&&n.host===r.host&&(t=r.relative),n.protocol===i.protocol&&n.host===i.host&&(e=i.relative),this.captureBreadcrumb({category:"navigation",data:{to:t,from:e}})},_instrumentTryCatch:function(){function e(e){return function(t,r){for(var i=new Array(arguments.length),a=0;a<i.length;++a)i[a]=arguments[a];var s=i[0];return o(s)&&(i[0]=n.wrap(s)),e.apply?e.apply(this,i):e(i[0],i[1])}}function t(e){var t=A[e]&&A[e].prototype;t&&t.hasOwnProperty&&t.hasOwnProperty("addEventListener")&&(S(t,"addEventListener",function(t){return function(r,a,o,s){try{a&&a.handleEvent&&(a.handleEvent=n.wrap(a.handleEvent))}catch(e){}var u,c,l;return i&&i.dom&&("EventTarget"===e||"Node"===e)&&(c=n._breadcrumbEventHandler("click"),l=n._keypressEventHandler(),u=function(e){if(e)return"click"===e.type?c(e):"keypress"===e.type?l(e):void 0}),t.call(this,r,n.wrap(a,void 0,u),o,s)}},r),S(t,"removeEventListener",function(e){return function(t,n,r,i){try{n=n&&(n.__raven_wrapper__?n.__raven_wrapper__:n)}catch(e){}return e.call(this,t,n,r,i)}},r))}var n=this,r=n._wrappedBuiltIns,i=this._globalOptions.autoBreadcrumbs;S(A,"setTimeout",e,r),S(A,"setInterval",e,r),A.requestAnimationFrame&&S(A,"requestAnimationFrame",function(e){return function(t){return e(n.wrap(t))}},r);for(var a=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],s=0;s<a.length;s++)t(a[s]);var u=A.jQuery||A.$;u&&u.fn&&u.fn.ready&&S(u.fn,"ready",function(e){return function(t){return e.call(this,n.wrap(t))}},r)},_instrumentBreadcrumbs:function(){function e(e,n){e in n&&o(n[e])&&S(n,e,function(e){return t.wrap(e)})}var t=this,n=this._globalOptions.autoBreadcrumbs,r=t._wrappedBuiltIns;if(n.xhr&&"XMLHttpRequest"in A){var i=XMLHttpRequest.prototype;S(i,"open",function(e){return function(n,r){return s(r)&&r.indexOf(t._globalKey)===-1&&(this.__raven_xhr={method:n,url:r,status_code:null}),e.apply(this,arguments)}},r),S(i,"send",function(n){return function(r){function i(){if(a.__raven_xhr&&(1===a.readyState||4===a.readyState)){try{a.__raven_xhr.status_code=a.status}catch(e){}t.captureBreadcrumb({type:"http",category:"xhr",data:a.__raven_xhr})}}for(var a=this,s=["onload","onerror","onprogress"],u=0;u<s.length;u++)e(s[u],a);return"onreadystatechange"in a&&o(a.onreadystatechange)?S(a,"onreadystatechange",function(e){return t.wrap(e,void 0,i)}):a.onreadystatechange=i,n.apply(this,arguments)}},r)}n.xhr&&"fetch"in A&&S(A,"fetch",function(e){return function(n,r){for(var i=new Array(arguments.length),a=0;a<i.length;++a)i[a]=arguments[a];var o="GET";i[1]&&i[1].method&&(o=i[1].method);var s={method:o,url:i[0],status_code:null};return t.captureBreadcrumb({type:"http",category:"fetch",data:s}),e.apply(this,i).then(function(e){return s.status_code=e.status,e})}},r),n.dom&&this._hasDocument&&(C.addEventListener?(C.addEventListener("click",t._breadcrumbEventHandler("click"),!1),C.addEventListener("keypress",t._keypressEventHandler(),!1)):(C.attachEvent("onclick",t._breadcrumbEventHandler("click")),C.attachEvent("onkeypress",t._keypressEventHandler())));var a=A.chrome,u=a&&a.app&&a.app.runtime,c=!u&&A.history&&history.pushState;if(n.location&&c){var l=A.onpopstate;A.onpopstate=function(){var e=t._location.href;if(t._captureUrlChange(t._lastHref,e),l)return l.apply(this,arguments)},S(history,"pushState",function(e){return function(){var n=arguments.length>2?arguments[2]:void 0;return n&&t._captureUrlChange(t._lastHref,n+""),e.apply(this,arguments)}},r)}if(n.console&&"console"in A&&console.log){var h=function(e,n){t.captureBreadcrumb({message:e,level:n.level,category:"console"})};d(["debug","info","warn","error","log"],function(e,t){w(console,t,h)})}},_restoreBuiltIns:function(){for(var e;this._wrappedBuiltIns.length;){e=this._wrappedBuiltIns.shift();var t=e[0],n=e[1],r=e[2];t[n]=r}},_drainPlugins:function(){var e=this;d(this._plugins,function(t,n){var r=n[0],i=n[1];r.apply(e,[e].concat(i))})},_parseDSN:function(e){var t=I.exec(e),n={},r=7;try{for(;r--;)n[P[r]]=t[r]||""}catch(t){throw new y("Invalid DSN: "+e)}if(n.pass&&!this._globalOptions.allowSecretKey)throw new y("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key");return n},_getGlobalServer:function(e){var t="//"+e.host+(e.port?":"+e.port:"");return e.protocol&&(t=e.protocol+":"+t),t},_handleOnErrorStackInfo:function(){this._ignoreOnError||this._handleStackInfo.apply(this,arguments)},_handleStackInfo:function(e,t){var n=this._prepareFrames(e,t);this._triggerEvent("handle",{stackInfo:e,options:t}),this._processException(e.name,e.message,e.url,e.lineno,n,t)},_prepareFrames:function(e,t){var n=this,r=[];if(e.stack&&e.stack.length&&(d(e.stack,function(e,t){var i=n._normalizeFrame(t);i&&r.push(i)}),t&&t.trimHeadFrames))for(var i=0;i<t.trimHeadFrames&&i<r.length;i++)r[i].in_app=!1;return r=r.slice(0,this._globalOptions.stackTraceLimit)},_normalizeFrame:function(e){if(e.url){var t={filename:e.url,lineno:e.line,colno:e.column,function:e.func||"?"};return t.in_app=!(this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(t.filename)||/(Raven|TraceKit)\./.test(t.function)||/raven\.(min\.)?js$/.test(t.filename)),t}},_processException:function(e,t,n,r,i,a){var o;if((!this._globalOptions.ignoreErrors.test||!this._globalOptions.ignoreErrors.test(t))&&(t+="",i&&i.length?(n=i[0].filename||n,i.reverse(),o={frames:i}):n&&(o={frames:[{filename:n,lineno:r,in_app:!0}]}),(!this._globalOptions.ignoreUrls.test||!this._globalOptions.ignoreUrls.test(n))&&(!this._globalOptions.whitelistUrls.test||this._globalOptions.whitelistUrls.test(n)))){var s=h({exception:{values:[{type:e,value:t,stacktrace:o}]},culprit:n},a);this._send(s)}},_trimPacket:function(e){var t=this._globalOptions.maxMessageLength;if(e.message&&(e.message=f(e.message,t)),e.exception){var n=e.exception.values[0];n.value=f(n.value,t)}return e},_getHttpData:function(){if(this._hasDocument&&C.location&&C.location.href){var e={headers:{"User-Agent":navigator.userAgent}};return e.url=C.location.href,C.referrer&&(e.headers.Referer=C.referrer),e}},_resetBackoff:function(){this._backoffDuration=0,this._backoffStart=null},_shouldBackoff:function(){return this._backoffDuration&&r()-this._backoffStart<this._backoffDuration},_setBackoffState:function(e){if(!this._shouldBackoff()){var t=e.status;if(400===t||401===t||429===t){var n;try{n=e.getResponseHeader("Retry-After"),n=parseInt(n,10)}catch(e){}this._backoffDuration=n?n:2*this._backoffDuration||1e3,this._backoffStart=r()}}},_send:function(e){var t=this._globalOptions,n={project:this._globalProject,logger:t.logger,platform:"javascript"},i=this._getHttpData();if(i&&(n.request=i),e.trimHeadFrames&&delete e.trimHeadFrames,e=h(n,e),e.tags=h(h({},this._globalContext.tags),e.tags),e.extra=h(h({},this._globalContext.extra),e.extra),e.extra["session:duration"]=r()-this._startTime,this._breadcrumbs&&this._breadcrumbs.length>0&&(e.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}),c(e.tags)&&delete e.tags,this._globalContext.user&&(e.user=this._globalContext.user),t.environment&&(e.environment=t.environment),t.release&&(e.release=t.release),t.serverName&&(e.server_name=t.serverName),o(t.dataCallback)&&(e=t.dataCallback(e)||e),e&&!c(e)&&(!o(t.shouldSendCallback)||t.shouldSendCallback(e)))return this._shouldBackoff()?void this._logDebug("warn","Raven dropped error due to backoff: ",e):void this._sendProcessedPayload(e);
},_getUuid:function(){return _()},_sendProcessedPayload:function(e,t){var n=this,r=this._globalOptions;if(this.isSetup()){this._lastEventId=e.event_id||(e.event_id=this._getUuid()),e=this._trimPacket(e),this._logDebug("debug","Raven about to send:",e);var i={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey};this._globalSecret&&(i.sentry_secret=this._globalSecret);var a=e.exception&&e.exception.values[0];this.captureBreadcrumb({category:"sentry",message:a?(a.type?a.type+": ":"")+a.value:e.message,event_id:e.event_id,level:e.level||"error"});var o=this._globalEndpoint;(r.transport||this._makeRequest).call(this,{url:o,auth:i,data:e,options:r,onSuccess:function(){n._resetBackoff(),n._triggerEvent("success",{data:e,src:o}),t&&t()},onError:function(r){n._logDebug("error","Raven transport failed to send: ",r),r.request&&n._setBackoffState(r.request),n._triggerEvent("failure",{data:e,src:o}),r=r||new Error("Raven send failed (no additional details provided)"),t&&t(r)}})}},_makeRequest:function(e){function t(){if(200===n.status)e.onSuccess&&e.onSuccess();else if(e.onError){var t=new Error("Sentry error code: "+n.status);t.request=n,e.onError(t)}}var n=new XMLHttpRequest,r="withCredentials"in n||"undefined"!=typeof XDomainRequest;if(r){var i=e.url;"withCredentials"in n?n.onreadystatechange=function(){4===n.readyState&&t()}:(n=new XDomainRequest,i=i.replace(/^https?:/,""),n.onload=t),n.open("POST",i+"?"+v(e.auth)),n.send(R(e.data))}},_logDebug:function(e){this._originalConsoleMethods[e]&&this.debug&&Function.prototype.apply.call(this._originalConsoleMethods[e],this._originalConsole,[].slice.call(arguments,1))},_mergeContext:function(e,t){a(t)?delete this._globalContext[e]:this._globalContext[e]=h(this._globalContext[e]||{},t)}};var O=Object.prototype;i.prototype.setUser=i.prototype.setUserContext,i.prototype.setReleaseContext=i.prototype.setRelease,e.exports=i}).call(t,function(){return this}())},function(e,t,n){(function(t){"use strict";var r=n(150),i="undefined"!=typeof window?window:"undefined"!=typeof t?t:"undefined"!=typeof self?self:{},a=i.Raven,o=new r;o.noConflict=function(){return i.Raven=a,o},o.afterLoad(),e.exports=o}).call(t,function(){return this}())},function(e,t){(function(t){"use strict";function n(){return"undefined"==typeof document||"undefined"==typeof document.location?"":document.location.href}var r={collectWindowErrors:!0,debug:!1},i="undefined"!=typeof window?window:"undefined"!=typeof t?t:"undefined"!=typeof self?self:{},a=[].slice,o="?",s=/^(?:Uncaught (?:exception: )?)?((?:Eval|Internal|Range|Reference|Syntax|Type|URI)Error): ?(.*)$/;r.report=function(){function e(e){d(),m.push(e)}function t(e){for(var t=m.length-1;t>=0;--t)m[t]===e&&m.splice(t,1)}function u(){h(),m=[]}function c(e,t){var n=null;if(!t||r.collectWindowErrors){for(var i in m)if(m.hasOwnProperty(i))try{m[i].apply(null,[e].concat(a.call(arguments,2)))}catch(e){n=e}if(n)throw n}}function l(e,t,i,a,u){var l=null;if(b)r.computeStackTrace.augmentStackTraceWithInitialElement(b,t,i,e),f();else if(u)l=r.computeStackTrace(u),c(l,!0);else{var d,h={url:t,line:i,column:a},p=void 0,v=e;if("[object String]"==={}.toString.call(e)){var d=e.match(s);d&&(p=d[1],v=d[2])}h.func=o,l={name:p,message:v,url:n(),stack:[h]},c(l,!0)}return!!g&&g.apply(this,arguments)}function d(){v||(g=i.onerror,i.onerror=l,v=!0)}function h(){v&&(i.onerror=g,v=!1,g=void 0)}function f(){var e=b,t=_;_=null,b=null,E=null,c.apply(null,[e,!1].concat(t))}function p(e,t){var n=a.call(arguments,1);if(b){if(E===e)return;f()}var i=r.computeStackTrace(e);if(b=i,E=e,_=n,setTimeout(function(){E===e&&f()},i.incomplete?2e3:0),t!==!1)throw e}var g,v,m=[],_=null,E=null,b=null;return p.subscribe=e,p.unsubscribe=t,p.uninstall=u,p}(),r.computeStackTrace=function(){function e(e){if("undefined"!=typeof e.stack&&e.stack){for(var t,r,i=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|<anonymous>).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,a=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|resource|\[native).*?)(?::(\d+))?(?::(\d+))?\s*$/i,s=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,u=e.stack.split("\n"),c=[],l=(/^(.*) is undefined$/.exec(e.message),0),d=u.length;l<d;++l){if(t=i.exec(u[l])){var h=t[2]&&t[2].indexOf("native")!==-1;r={url:h?null:t[2],func:t[1]||o,args:h?[t[2]]:[],line:t[3]?+t[3]:null,column:t[4]?+t[4]:null}}else if(t=s.exec(u[l]))r={url:t[2],func:t[1]||o,args:[],line:+t[3],column:t[4]?+t[4]:null};else{if(!(t=a.exec(u[l])))continue;r={url:t[3],func:t[1]||o,args:t[2]?t[2].split(","):[],line:t[4]?+t[4]:null,column:t[5]?+t[5]:null}}!r.func&&r.line&&(r.func=o),c.push(r)}return c.length?(c[0].column||"undefined"==typeof e.columnNumber||(c[0].column=e.columnNumber+1),{name:e.name,message:e.message,url:n(),stack:c}):null}}function t(e,t,n,r){var i={url:t,line:n};if(i.url&&i.line){if(e.incomplete=!1,i.func||(i.func=o),e.stack.length>0&&e.stack[0].url===i.url){if(e.stack[0].line===i.line)return!1;if(!e.stack[0].line&&e.stack[0].func===i.func)return e.stack[0].line=i.line,!1}return e.stack.unshift(i),e.partial=!0,!0}return e.incomplete=!0,!1}function i(e,s){for(var u,c,l=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,d=[],h={},f=!1,p=i.caller;p&&!f;p=p.caller)if(p!==a&&p!==r.report){if(c={url:null,func:o,line:null,column:null},p.name?c.func=p.name:(u=l.exec(p.toString()))&&(c.func=u[1]),"undefined"==typeof c.func)try{c.func=u.input.substring(0,u.input.indexOf("{"))}catch(e){}h[""+p]?f=!0:h[""+p]=!0,d.push(c)}s&&d.splice(0,s);var g={name:e.name,message:e.message,url:n(),stack:d};return t(g,e.sourceURL||e.fileName,e.line||e.lineNumber,e.message||e.description),g}function a(t,a){var o=null;a=null==a?0:+a;try{if(o=e(t))return o}catch(e){if(r.debug)throw e}try{if(o=i(t,a+1))return o}catch(e){if(r.debug)throw e}return{name:t.name,message:t.message,url:n()}}return a.augmentStackTraceWithInitialElement=t,a.computeStackTraceFromStackProp=e,a}(),e.exports=r}).call(t,function(){return this}())},function(e,t,n){(function(t){"use strict";function r(){function e(e){var t=Object.create(null);t.url=e.url,t.swarmId=e.swarmId,t.mod=e.mod,t.sha1=e.sha1,t.md5=e.md5,t.constraint=e.constraint,t.httpConstraint=e.httpConstraint,t.state=e.state,t.origin=e.origin,t.hashAlg=e.hashAlg,t.blockHashes=e.blockHashes,t.chunkRead=e.chunkRead,t.size=e.size,t.preventDownload=e.preventDownload,t.httpIdle=e.httpIdle,t.start=e.start,t.skipJoin=e.skipJoin;var n=t.url;return n&&(s.add(n,t),t.swarmId&&s.alias(swarmId,n)),t}function t(e){return s.get(e)}function n(e){s.remove(e)}function r(e,t){s.alias(e,t)}function a(){var e=s.getAllKeys();return e.map(s.get).filter(function(e){return e.state<4})}function o(){return s.getAllKeys().length}var s=i();return{add:e,get:t,remove:n,alias:r,getActiveResources:a,getNumOfResources:o}}var i=n(121);e.exports=r(),t.state.resources=e.exports}).call(t,n(1))}]);
//elahmad.com	
	!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var a=r[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="/",t(0)}([function(e,t,r){e.exports=r(6)},function(e,t){"use strict";function r(e){function t(){return!e.globalsCondition||e.globalsCondition.every(function(e){return"undefined"!=typeof window[e]})}function r(){i||e.condition&&!e.condition()||t()&&(clearInterval(a),document.removeEventListener("readystatechange",r),window.removeEventListener("load",r),i=!0,e.onConditionsMet())}var i,a;a=setInterval(r,1),document.addEventListener("readystatechange",r),window.addEventListener("load",r),e.globalsCondition&&e.globalsCondition.forEach(function(e){"undefined"==typeof window[e]&&Object.defineProperty(window,e,{configurable:!0,enumerable:!0,set:function(t){Object.defineProperty(window,e,{value:t,writable:!0,configurable:!0,enumerable:!0}),r()}})}),r()}e.exports=r},function(e,t,r){"use strict";function i(e){var t=window.peer5.getConfig("MEDIA_MAX_BUFFER_HOLE"),r=a(e.buffered,e.currentTime,t);return r.timeAhead}var a=r(28);e.exports=i},function(e,t){"use strict";e.exports=function(e,t){var r=t;return r="string"==typeof r?document.getElementById(r):r,r=r?r.tagName.toLowerCase()!==e?r.querySelector(e):r:document.querySelector(e),r||null}},function(e,t,r){var i=r(30);!function(e){var t={},r={},a={},n=function(e){var r;return t[e]?t[e]:(r=window.document[e]?window.document[e]:document.getElementById(e),t[e]=r,r)},o=function(t){e.trigger("player",t)},s={error:function(t,r,i){e.error("flashls error #"+t+": "+i+" url: "+r)},requestPlaylist:function(t,a,o,s){var l=n(t),u=r[a]=e.getConfig("MEDIA_FALLBACK_ON_FLASH")?new i:new e.VideoRequest;u.open("GET",a),u.responseType="text",u.url=a,u.onload=function(e){var t=r[a];if(t)return!this.response||this.status<200||this.status>=400?(delete r[a],l.CallFunction('<invoke name="'+s+'" returntype="xml"></invoke>')):(delete r[a],l.CallFunction('<invoke name="'+o+'" returntype="xml"><arguments><string>'+this.response+"</string></arguments></invoke>"))},u.onerror=u.onabort=function(){var e=r[a];if(e)return delete r[a],l.CallFunction('<invoke name="'+s+'" returntype="xml"></invoke>')},u.send()},abortPlaylist:function(e){var t=r;r={};for(var i in t){var a=t[i];a.onabort=null,a.abort()}},requestFragment:function(t,r,o,s){var l=n(t),u=a[r]=e.getConfig("MEDIA_FALLBACK_ON_FLASH")?new i:new e.VideoRequest;u.open("GET",r),u.responseType="arraybuffer",u.url=r,u.onload=function(t){var i=a[r];if(i){if(!this.response||this.status<200||this.status>=400)return delete a[r],l.CallFunction('<invoke name="'+s+'" returntype="xml"></invoke>');var n=this.response.byteLength;e.ab2b64(this.response,function(e){var t=a[r];if(t)return delete a[r],l.CallFunction('<invoke name="'+o+'" returntype="xml"><arguments><string>'+e+"</string><number>"+n+"</number></arguments></invoke>")})}},u.onerror=u.onabort=function(){var e=a[r];if(e)return delete a[r],l.CallFunction('<invoke name="'+s+'" returntype="xml"></invoke>')},u.send()},abortFragment:function(e){var t=a;a={};for(var r in t){var i=t[r];i.onabort=null,i.abort()}},fpsDrop:function(e,t){o({action:"fps.drop",label:e+"/"+t,value:t,timeSinceLoaded:0,duration:0,vendor:"",id:""})}};e.flashls={trigger:function(e,t){return!!s[e]&&(s[e].apply(s,t),!0)}}}(window.peer5=window.peer5||{})},function(e,t){!function(e){var t=function(e,t){for(var r=e.data?e.data:e,i=new Uint8Array(r),a="",n=0,o=i.length;n<o;n++)a+=String.fromCharCode(i[n]);var s=btoa(a);t?t(s):self.postMessage(s)};if("msie"!==e.browserName&&"safari"!==e.browserName){var r=window.URL.createObjectURL(new Blob(["onmessage="+t],{type:"text/javascript"})),i=new Worker(r),a=[];i.onmessage=function(e){var t=a.shift();t(e.data)}}e.ab2b64=function(r,n){"msie"===e.browserName||"safari"===e.browserName?t(r,n):(a.push(n),i.postMessage(r))}}(window.peer5=window.peer5||{})},function(e,t,r){"use strict";r(15)},function(e,t){"use strict";function r(){var e=document.createElement("span");return e.style.cssText=a,e.innerHTML=i,e}var i="Peer5 demo account, please register at https://app.peer5.com",a="background-color:#000;color:#fff;font-size:14px;left:0;position:absolute;top:0;z-index:2147483645;",n=document.location.hostname;e.exports=function(e){if(window.peer5.getConfig("MEDIA_WATERMARK")===!0&&"peer5.com"!==n.substr(-9)){var t=e.parentElement;if(t){var i=getComputedStyle(t);["relative","absolute","fixed"].indexOf(i.position)===-1&&(t.style.position="relative");var a=r();t.insertBefore(a,e)}}}},function(e,t){"use strict";e.exports=function(e){if(e.getbufferLength)try{return e.getbufferLength()}catch(e){}if(e.vjs_getProperty)try{return e.vjs_getProperty("buffered")}catch(e){}return 0}},function(e,t){"use strict";function r(e,t,r,i){var a=Math.max(r,i-peer5.getConfig("MINIMUM_HTTP_CONSTRAINT"));[t,e].forEach(function(t){Object.defineProperty(t,"trequest",{configurable:!0,set:function(){},get:function(){return e._delay?performance.now()-e._delay:a}})})}function i(e,t){var r=t,i=e.currentTarget._speed;i&&(r._delay=1e3*(e.loaded/i),r.tfirst=r.trequest)}function a(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup),this.destroy=function(){this.abort(),this.loader=null},this.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},this.load=function(e,t,r,i,a,n,o,s,l,u){this.url=e,!u||isNaN(u.byteRangeStartOffset)||isNaN(u.byteRangeEndOffset)||(this.byteRange=u.byteRangeStartOffset+"-"+(u.byteRangeEndOffset-1)),this.responseType=t,this.onSuccess=r,this.onProgress=l,this.onTimeout=a,this.onError=i,this._trequest=performance.now(),this.stats={trequest:this._trequest,retry:0},this.timeout=n,this.maxRetry=o,this.retryDelay=s,this.frag=u,this.loadInternal()},this.loadInternal=function(){var e;e="arraybuffer"===this.responseType?this.loader=new peer5.FragmentRequest:this.loader=new peer5.PlaylistRequest,e.onprogress=this.loadprogress.bind(this),e.onloadend=this.loadend.bind(this),e.open("GET",this.url,!0),this.byteRange&&e.setRequestHeader("Range","bytes="+this.byteRange),e.responseType=this.responseType;var t=this.stats;t.tfirst=0,t.loaded=0,this.xhrSetup&&this.xhrSetup(e,this.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.timeout),e.send(),e._constraint&&window.peer5.getConfig("MEDIA_HLSJS_OVERRIDE")&&r(t,this.frag,this._trequest,e._constraint)},this.loadend=function(e){var t=e.currentTarget,r=t.status,a=this.stats;a.aborted||(window.clearTimeout(this.requestTimeout),r>=200&&r<300?(window.peer5.getConfig("MEDIA_HLSJS_OVERRIDE")&&i(e,a),a.tload=Math.max(a.tfirst,performance.now()),this.onSuccess(e,a)):a.retry>=this.maxRetry||r>=400&&r<499?this.onError(e):(this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),a.retry++))},this.loadtimeout=function(e){this.onTimeout(e,this.stats)},this.loadprogress=function(e){var t=this.stats;e.loadedHTTP>0&&window.peer5.getConfig("MEDIA_HLSJS_OVERRIDE")&&i(e,t),0===t.tfirst&&(t.tfirst=Math.max(performance.now(),t.trequest)),t.loaded=e.loaded,this.onProgress&&this.onProgress(e,t)}}e.exports=a},function(e,t){"use strict";function r(e,t,r){var i=Math.max(t,r-window.peer5.getConfig("MINIMUM_HTTP_CONSTRAINT"));Object.defineProperty(e,"trequest",{configurable:!0,set:function(){},get:function(){return e._delay?performance.now()-e._delay:i}})}function i(e,t){var r=e.currentTarget._speed;r&&(t._delay=1e3*(e.loaded/r),t.tfirst=t.trequest)}function a(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup),this.destroy=function(){this.abort(),this.loader=null},this.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},this.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.trequest=performance.now(),this.stats={trequest:this.trequest,retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},this.loadInternal=function(){var e,t=this.context;e="arraybuffer"===t.responseType?this.loader=new window.peer5.FragmentRequest:this.loader=new window.peer5.PlaylistRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var i=this.stats;i.tfirst=0,i.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send(),e._constraint&&window.peer5.getConfig("MEDIA_HLSJS_OVERRIDE")&&r(i,this.trequest,e._constraint)},this.readystatechange=function(e){var t=e.currentTarget,r=t.readyState,a=this.stats,n=this.context,o=this.config;if(!a.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===a.tfirst&&(a.tfirst=Math.max(performance.now(),a.trequest)),4===r){var s=t.status;if(s>=200&&s<300){window.peer5.getConfig("MEDIA_HLSJS_OVERRIDE")&&i(e,a),a.tload=Math.max(a.tfirst,performance.now());var l,u;"arraybuffer"===n.responseType?(l=t.response,u=l.byteLength):(l=t.responseText,u=l.length),a.bw=t._speed,a.loaded=a.total=u;var d={url:n.url,data:l};this.callbacks.onSuccess(d,a,n)}else a.retry>=o.maxRetry||s>=400&&s<499?this.callbacks.onError({code:s,text:t.statusText},n):(this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),a.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},this.loadtimeout=function(){this.callbacks.onTimeout(this.stats,this.context)},this.loadprogress=function(e){var t=this.stats;e.loadedHTTP>0&&window.peer5.getConfig("MEDIA_HLSJS_OVERRIDE")&&i(e,t),t.loaded=e.loaded,t.bw=e.currentTarget._speed,e.lengthComputable&&(t.total=e.total);var r=this.callbacks.onProgress;r&&r(t,this.context,null)}}e.exports=a},function(e,t,r){"use strict";function i(e){var t;this.destroy=function(){t&&t.destroy()},this.abort=function(){t&&t.abort()},this.load=function(){t=3===arguments.length?new n(e):new a(e),t.load.apply(t,arguments),this.stats=t.stats,this.frag=t.frag}}var a=r(9),n=r(10);e.exports=i},function(e,t,r){"use strict";function i(e){var t=window.peer5,r=e.DefaultConfig;r.loader=a,r.maxBufferLength=r.maxMaxBufferLength=t.getConfig("MEDIA_MAXBUFFER"),r.maxBufferHole=t.getConfig("MEDIA_MAX_BUFFER_HOLE"),r.manifestLoadingTimeOut=r.levelLoadingTimeOut=t.getConfig("MEDIA_MANIFEST_TIMEOUT"),r.manifestLoadingMaxRetry=r.levelLoadingMaxRetry=t.getConfig("MEDIA_MANIFEST_RETRIES"),r.manifestLoadingRetryDelay=r.levelLoadingRetryDelay=t.getConfig("MEDIA_MANIFEST_RETRY_DELAY"),r.fragLoadingTimeOut=t.getConfig("MEDIA_FRAGMENT_TIMEOUT"),r.fragLoadingMaxRetry=t.getConfig("MEDIA_FRAGMENT_RETRIES"),r.fragLoadingRetryDelay=t.getConfig("MEDIA_FRAGMENT_RETRY_DELAY"),r.debug=t.getConfig("MEDIA_HLSJS_DEBUG"),e.DefaultConfig=r}var a=r(11);e.exports=i},function(e,t,r){"use strict";function i(){n(o)}var a=r(1),n=r(12),o=r(32);a({onConditionsMet:i,globalsCondition:["peer5"]}),window.Hls||(window.Hls=o),e.exports=o},function(e,t){"use strict";function r(e,t){function r(){return!(!d||f)&&(f=!0,t("load.end"),!0)}function i(e){switch(e){case"pause":l?t("rebuffer.end"):s&&t("seek.end"),s=!1,l=!1,u||(u=!0,t("pause.start"));break;case"complete":u||(u=!0,t("pause.start"));break;case"playlist":l?t("rebuffer.end"):s&&t("seek.end"),s=!1,l=!1;break;case"buffer":d?(r(),l=!0,t("rebuffer.start")):(d=!0,t("load.start"));break;case"play":if(r())return;u&&(u=!1,t("pause.end")),l&&(l=!1,t("rebuffer.end"));break;case"seek":l&&(l=!0,t("rebuffer.end")),r(),s=!0,t("seek.start");break;case"seeked":s&&(t("seek.end"),s=!1)}}function a(){var t=["pause","complete","playlist","buffer","play","seek","seeked"];t.forEach(function(t){var r=o[t]=function(e){i(t,e)};e.on(t,r)})}function n(){Object.keys(o).forEach(function(t){e.off(t,o[t])})}var o={},s=!1,l=!1,u=!1,d=!1,f=!1;return a(),e.once("remove",function(){n(),t("remove")}),setTimeout(function(){t("ready")},0),{destroy:n}}e.exports=r},function(e,t,r){"use strict";function i(){var e=window.peer5;if(!(e.getConfig("DISABLE_PLUGINS")||e.getConfig("DISABLE_UNSUPPORTED")&&!e.isSupported())){l.loadPlugin(s()),r(4),r(5);var t=r(13);o(window.jwplayer,window.peer5,t),n(u)}}var a=r(1),n=r(17),o=r(33),s=r(26),l=r(16),u=l.onPlayerSetup;a({onConditionsMet:i,globalsCondition:["peer5","jwplayer"]})},function(e,t,r){"use strict";function i(e,t){for(var r=0;r<f.length;r++)f[r].loadInstance({id:e,playerInstance:t})}function a(e,t){i(e,t),t.on("ready",function(){var r=o(e);if(r){var i=t.getPlaylistItem(t.getPlaylistIndex()||0),a=i&&i.sources&&i.sources[0];a&&a.file&&(!a.type||/^(hls|dash)$/i.test(a.type))&&window.peer5.prefetch(a.file);var n=window.peer5.getConfig("VIDEOTAG_MONITORING"),f=t.getProvider();f=f&&f.name;var c=r&&"video"===r.tagName.toLowerCase(),h=c&&"hlsjs"===f,g=n&&h?"videoTag":"player",v=s(r,{elementId:e});if(window.peer5.attachPlayer(v),v.emit("media.info",{vendor:"jwplayer7",provider:f,tracking:g}),"videoTag"===g){var p=l(t,r,v.onEvent);t.getConfig&&t.getConfig().autostart&&p.forceLoadStart()}else"player"===g&&u(t,v.onEvent);d(r)}})}function n(e){f.push(e)}var o=r(27),s=r(19),l=r(18),u=r(14),d=r(7),f=[];e.exports={onPlayerSetup:a,loadPlugin:n}},function(e,t,r){"use strict";function i(e){function t(e){"string"==typeof e?console.error("The Peer5 JWPlayer plugin doesn't support external JSON/RSS playlist"):Array.isArray(e)&&e.length>0&&e.forEach(function(e){if(!e.file||e.file.indexOf("m3u8")!==-1){if(e.sources)for(var t=0;t<e.sources.length;t++){var r=e.sources[t].file;if(r){if(r.indexOf("m3u8")===-1)return;break}}e.provider=a}})}function r(e){var r=e;if(r.playlist)t(r.playlist);else if(r.file){var i={};r.file.indexOf("m3u8")>-1&&(i.provider=a),r.playlist=[i]}else Array.isArray(r.sources)&&(r.playlist=[{sources:r.sources}],delete r.sources,t(r.playlist));var n=["file","image","title","description","mediaid","tracks"],o=r.playlist&&r.playlist[0];o&&n.forEach(function(e){e in r&&!(e in o)&&(o[e]=r[e],delete r[e])})}function i(e){var t=e,r=window.peer5,i=r.getConfig("MEDIA_MAXBUFFER"),a={flashplayer:"//api.peer5.com/jwplayer7/assets/jwplayer.flash.swf",primary:void 0,hls_callbackname:"peer5.flashls.trigger",hls_livestartpos:r.getConfig("MEDIA_LIVE_START_POS"),hls_maxbufferlength:i,hls_minbufferlength:r.getConfig("MEDIA_MINBUFFER"),hls_minbufferlengthcapping:r.getConfig("MEDIA_MINBUFFER_LENGTH_CAPPING"),hls_lowbufferlength:r.getConfig("MEDIA_LOWBUFFER"),hls_usehardwarevideodecoder:!1,hls_js:!0,androidhls:!0};t.defaults=t.defaults||{},Object.keys(a).forEach(function(e){t.defaults[e]=a[e]})}function n(i){if(!i)return o();var a=o(i);if(a._shimmed_)return a;a._shimmed_=!0;var n=!1,s=a.setup;a.setup=function(t){r(t);var o=s.call(a,t);return!n&&e&&(n=!0,e(i,a)),o};var l=a.load;return a.load=function(e){return t(e),l.call(a,e)},a}var o=window.jwplayer;if(n._shimmed_=!0,!o)return console.error("The Peer5 JWPlayer7 plugin must be loaded after JWPlayer"),null;if(o===n)return n;i(o);for(var s in o)n[s]=o[s];return window.jwplayer=n,n}var a="//api.peer5.com/jwplayer7/assets/flashls.provider.swf";e.exports=i},function(e,t,r){"use strict";function i(e,t,r){var i=a(t,r);return e.once("remove",function(){i.destroy(),r("remove")}),i}var a=r(23);e.exports=i},function(e,t,r){"use strict";function i(e,t,r){function i(e,t){d.emit(e,f(e,t))}function u(){switch(d.tagName){case"video":return n(d.element);case"object":case"embed":return"function"==typeof d.options.getBufferLength?d.options.getBufferLength():o(d.element);default:return 0}}var d=new a;t&&Object.keys(t).forEach(function(e){d[e]=t[e]}),d.element=e,d.options=r||{},d.instanceId=l++,d.tagName=e&&e.tagName&&e.tagName.toLowerCase();var f=s(d.instanceId);return d.onEvent=i,d.getBufferLength=u,d}var a=r(31),n=r(2),o=r(8),s=r(20),l=1;e.exports=i},function(e,t,r){"use strict";function i(e){var t=null,r=null,i=null,a=null,n=null,o=0,s=0;return function(l,u){var d={action:l,id:e},f=Date.now();switch(n=n||f,l){case"rebuffer.start":a=a||f,o++,t=f,d.timeSinceLoaded=f-a,d.occurrence=o;break;case"rebuffer.end":a=a||f,d.duration=t?f-t:void 0,d.timeSinceLoaded=f-a,d.occurrence=o,t=null;break;case"seek.start":a=a||f,s++,r=f,d.timeSinceLoaded=f-a,d.occurrence=s;break;case"seek.end":a=a||f,d.duration=r?f-r:void 0,d.timeSinceLoaded=f-a,d.occurrence=s,r=null;break;case"load.start":i=f,d.timeSinceReady=f-n;break;case"load.end":u&&u.ignoreDuration||(d.duration=i?f-i:void 0),a=f;break;case"fps.drop":case"fps.drop.raw":case"bitsDecoded":u&&u.count&&(d.value=u.count);break;case"ready":case"pause.start":case"pause.end":break;case"error":d=u;break;default:d=null}return d}}e.exports=i},function(e,t){"use strict";function r(e){if("number"==typeof e.webkitDroppedFrameCount)return{total:e.webkitDecodedFrameCount,dropped:e.webkitDroppedFrameCount};if("function"==typeof e.getVideoPlaybackQuality){var t=e.getVideoPlaybackQuality();if("number"==typeof t.droppedVideoFrames)return{total:t.totalVideoFrames,dropped:t.droppedVideoFrames}}return"number"==typeof e.mozDecodedFrames&&"number"==typeof e.mozPresentedFrames?{total:e.mozDecodedFrames,dropped:e.mozDecodedFrames-e.mozPresentedFrames}:{total:0,dropped:0}}e.exports=r},function(e,t){"use strict";function r(e){var t=8*e.webkitVideoDecodedByteCount||0,r=8*e.webkitAudioDecodedByteCount||0;return t||r?{video:t,audio:r,total:t+r}:{video:0,audio:0,total:0}}e.exports=r},function(e,t,r){"use strict";function i(e,t,r){function i(e,r){t(e,r)}function s(){return!L}function l(){s()&&(R?(R=!1,i("pause.end")):k?A||(A=!0,i("load.end")):(k=!0,A=!0,i("load.start"),i("load.end",{ignoreDuration:!0})))}function u(){clearTimeout(_),_=setTimeout(function(){b.play()},1)}function d(){p.forEach(function(e){T.addEventListener(e,b.adDetection)}),v.forEach(function(e){T.addEventListener(e,b[e])})}function f(){p.forEach(function(e){T.removeEventListener(e,b.adDetection)}),v.forEach(function(e){T.removeEventListener(e,b[e])})}function c(){y.destroy(),m.destroy(),f(),clearTimeout(E),clearTimeout(_)}var h=r||{},g=a("video",e);if(!g)return console.warn("VideoTagEventsWrapper: Invalid identifier. can't attach videoTag events"),null;var v=["pause","play","playing","canplaythrough","progress"],p=["abort","canplay","canplaythrough","durationChange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","seeked","seeking","volumechange","waiting","loadstart","pause","play","playing","suspend"];h.droppedFramesSampleRate=h.droppedFramesSampleRate||5e3,h.droppedFramesThreshold=h.droppedFramesThreshold||.2,h.bitsDecodedSampleRate=h.bitsDecodedSampleRate||5e3;var y,m,E,b,_,T=g,R=!1,k=!1,A=!1,S=!1,w=!1,L=!1;return b={ready:function(){i("ready"),b.adDetection(),!T.paused&&T.currentTime?b.playing():T.autoplay&&u()},playing:l,canplaythrough:function(){!R&&T.currentTime&&l()},progress:function(){T.paused||l()},pause:function(){clearTimeout(_),s()&&!R&&k&&(R=!0,i("pause.start"))},play:function(){s()&&(clearTimeout(_),_=setTimeout(function(){s()&&(R||k||(k=!0,i("load.start")))},20))},"seek.start":function(){s()&&(k&&!A&&(A=!0,i("load.end")),S=!0,i("seek.start"))},"seek.end":function(){s()&&(S=!1,i("seek.end"))},"rebuffer.end":function(){s()&&(w=!1,i("rebuffer.end"))},"rebuffer.start":function(){s()&&(w=!0,i("rebuffer.start"))},"ad.start":function(){L||(L=!0,clearTimeout(_),k&&!A&&(A=!0,i("error",new Error("Ad loaded while load.starting")),i("load.end",{ignoreDuration:!0})),w&&(w=!1,i("rebuffer.end")),S&&(S=!1,i("seek.end")),!R&&k&&(R=!0,i("pause.start")),i("ad.start"))},"ad.end":function(){L&&(L=!1,i("ad.end"))},adDetection:function(){var e=T.currentSrc||T.src;if(e){var t=/^(blob|mediasource):/.test(e),r=/^(blob|mediasource):(https?(%3A|:)\/\/)[^\/]*youtube\.com\//i.test(e);!t||r?b["ad.start"]():b["ad.end"]()}}},y=n(T,function(e){b[e]()},h),m=o(T,function(e,t){i(e,t)},h),E=setTimeout(function(){d(),b.ready()},0),{forceLoadStart:u,destroy:c}}var a=r(3),n=r(25),o=r(24);e.exports=i},function(e,t,r){"use strict";function i(e,t,r){function i(){clearInterval(o),clearInterval(s)}var o,s,l={},u={};return o=setInterval(function(){var i=a(e),n=i.total-l.total,o=i.dropped-l.dropped;o>0&&t("fps.drop.raw",{count:o}),n&&o>0&&o/n>r.droppedFramesThreshold&&t("fps.drop",{count:o}),l=i},r.droppedFramesSampleRate),s=setInterval(function(){var r=n(e),i=r.total-u.total;i>0&&t("bitsDecoded",{count:i}),u=r},r.bitsDecodedSampleRate),{destroy:i}}var a=r(21),n=r(22);e.exports=i},function(e,t,r){"use strict";function i(e,t,r){function i(){var t=a(e),r=!x&&M!==t;return x=!1,M=t,r}function n(){return!(!e.paused||!N&&!B)&&i()}function o(){return w&&R===w&&!k&&!S}function s(){return G||(G=R),R-G>=I}function l(){return S}function u(){return F}function d(){if(!o()&&(U=null,N))return l()||u()||s()}function f(){if(o()&&(G=null,!N))return U||(U=T),T-U>=O}function c(){f()?(N=!0,U=null,t("rebuffer.start")):d()&&(N=!1,G=null,t("rebuffer.end"))}function h(){return A&&!k}function g(){return H||(H=R),R-H>P}function v(){return F}function p(){if(!h()&&(j=null,B))return v()||g()}function y(){if(h()&&(H=null,!B))return j||(j=T),T-j>C}function m(){y()?(B=!0,j=null,t("seek.start")):p()&&(B=!1,H=null,t("seek.end"))}function E(){clearInterval(_),_=setInterval(function(){e.paused||(x=!0),(!e.paused||N||B)&&(T=Date.now(),R=1e3*e.currentTime,k=e.paused,A=e.seeking,S=A||B,F=n(),c(),m(),w=R)},D)}function b(){clearInterval(_)}var _,T,R,k,A,S,w,L=r||{},D=L.sampleRate||50,O=L.bufferEnterThreshold||250,I=L.bufferExitThreshold||250,C=L.seekEnterThreshold||250,P=L.seekExitThreshold||100,x=!0,M=null,F=!1,N=!1,U=null,G=null,B=!1,j=null,H=null;return E(),{destroy:b}}var a=r(2);e.exports=i},function(e,t,r){"use strict";var i=r(1),a=r(29);e.exports=function(){function e(e){window.initJWPlayerMux(e.playerInstance,{debug:!1,data:{property_key:"KyIwdhtHtEjxbtFxvIejw8dAM",page_type:"",viewer_user_id:"",experiment_name:"",player_name:"",player_version:"",player_init_time:Date.now(),video_id:"",video_title:"",video_series:"",video_producer:"",video_content_type:"",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:"",video_stream_type:"",video_encoding_variant:"",video_cdn:""}})}function t(t){window.peer5.getConfig("JW_MUX_PLUGIN")&&i({onConditionsMet:function(){e(t)},globalsCondition:["initJWPlayerMux"]})}return window.peer5.getConfig("JW_MUX_PLUGIN")&&a("//src.litix.io/jwplayer/2/jwplayer-mux.js"),{loadInstance:t}}},function(e,t,r){"use strict";var i=r(3);e.exports=function(e){var t;return t=i("video",e),t||(t=i("object",e)),t||(t=i("embed",e)),t}},function(e,t){"use strict";function r(e){for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t.sort(function(e,t){var r=e.start-t.start;return r?r:t.end-e.end}),t}function i(e,t){return e.reduce(function(e,r){var i=e.length;if(i){var a=e[i-1];if(r.start-a.end<t)return r.end>a.end&&(a.end=r.end),e}return e.push({start:r.start,end:r.end}),e},[])}function a(e,t,a){for(var n=a||0,o=t||0,s=r(e),l=i(s,n),u={rangeStart:0,rangeEnd:0,rangeLength:0,timeAhead:0},d=0,f=l.length;d<f;d++){var c=l[d].start,h=l[d].end,g=Math.ceil(1e3*o)/1e3,v=Math.ceil(1e3*c)/1e3,p=Math.ceil(1e3*h)/1e3;if(g+n>=v&&g<=p){u.rangeStart=Math.min(v,g),u.rangeEnd=p,u.rangeLength=p-u.rangeStart,u.timeAhead=p-g;break}}return u}e.exports=a},function(e,t){"use strict";function r(){}e.exports=function(e,t){function i(){n.parentNode&&n.parentNode.removeChild(n)}var a=t||r,n=document.createElement("script");n.src=e,n.onload=function(){i(),a(null)},n.onerror=function(){i(),a(new Error("failed to load script"))},(document.body||document.head).appendChild(n)}},function(e,t){"use strict";e.exports=window.XMLHttpRequest},function(e,t,r){"use strict";function i(){}function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(){this._events=new i,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,s="~";Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),n.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)o.call(e,t)&&r.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},n.prototype.listeners=function(e,t){var r=s?s+e:e,i=this._events[r];if(t)return!!i;if(!i)return[];if(i.fn)return[i.fn];for(var a=0,n=i.length,o=new Array(n);a<n;a++)o[a]=i[a].fn;return o},n.prototype.emit=function(e,t,r,i,a,n){var o=s?s+e:e;if(!this._events[o])return!1;var l,u,d=this._events[o],f=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),f){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,a),!0;case 6:return d.fn.call(d.context,t,r,i,a,n),!0}for(u=1,l=new Array(f-1);u<f;u++)l[u-1]=arguments[u];d.fn.apply(d.context,l)}else{var c,h=d.length;for(u=0;u<h;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),f){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,r);break;case 4:d[u].fn.call(d[u].context,t,r,i);break;default:if(!l)for(c=1,l=new Array(f-1);c<f;c++)l[c-1]=arguments[c];d[u].fn.apply(d[u].context,l)}}return!0},n.prototype.on=function(e,t,r){var i=new a(t,r||this),n=s?s+e:e;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],i]:this._events[n].push(i):(this._events[n]=i,this._eventsCount++),this},n.prototype.once=function(e,t,r){var i=new a(t,r||this,!0),n=s?s+e:e;return this._events[n]?this._events[n].fn?this._events[n]=[this._events[n],i]:this._events[n].push(i):(this._events[n]=i,this._eventsCount++),this},n.prototype.removeListener=function(e,t,r,a){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return 0===--this._eventsCount?this._events=new i:delete this._events[n],this;var o=this._events[n];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||(0===--this._eventsCount?this._events=new i:delete this._events[n]);else{for(var l=0,u=[],d=o.length;l<d;l++)(o[l].fn!==t||a&&!o[l].once||r&&o[l].context!==r)&&u.push(o[l]);u.length?this._events[n]=1===u.length?u[0]:u:0===--this._eventsCount?this._events=new i:delete this._events[n]}return this},n.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new i:delete this._events[t])):(this._events=new i,this._eventsCount=0),this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prototype.setMaxListeners=function(){return this},n.prefixed=s,n.EventEmitter=n,e.exports=n},function(e,t){!function(r){if("object"==typeof t&&"undefined"!=typeof e)e.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.Hls=r()}}(function(){var e;return function e(t,r,i){function a(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(n)return n(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[o]={exports:{}};t[o][0].call(d.exports,function(e){var r=t[o][1][e];return a(r?r:e)},d,d.exports,e,t,r,i)}return r[o].exports}for(var n="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function n(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,n,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(r=this._events[e],s(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),r.apply(this,n)}else if(o(r))for(n=Array.prototype.slice.call(arguments,1),u=r.slice(),i=u.length,l=0;l<i;l++)u[l].apply(this,n);return!0},i.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!a(t))throw TypeError("listener must be a function");var i=!1;return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var r,i,n,s;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],n=r.length,i=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(s=n;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,r,i){!function(t){var a={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var r=null,i=null,n=/^([^#]*)(.*)$/.exec(t);n&&(i=n[2],t=n[1]);var o=/^([^\?]*)(.*)$/.exec(t);o&&(r=o[2],t=o[1]);var s=/^([^#]*)(.*)$/.exec(e);s&&(e=s[1]);var l=/^([^\?]*)(.*)$/.exec(e);l&&(e=l[1]);var u=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(e);if(!u)throw new Error("Error trying to parse base URL.");var d=u[2]||"",f=u[1]||"",c=u[4],h=null;return h=/^\/\//.test(t)?d+"//"+a.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?f+"/"+a.buildAbsolutePath("",t.substring(1)):a.buildAbsolutePath(f+c,t),
r&&(h+=r),i&&(h+=i),h},buildAbsolutePath:function(e,t){for(var r,i,a=t,n="",o=e.replace(/[^\/]*$/,a.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),s=0;i=o.indexOf("/../",s),i>-1;s=i+r)r=/^\/(?:\.\.\/)*/.exec(o.slice(i))[0].length,n=(n+o.substring(s,i)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(r-1)/3+"}$"),"/");return n+o.substr(s)}};"object"==typeof i&&"object"==typeof r?r.exports=a:"function"==typeof e&&e.amd?e([],function(){return a}):"object"==typeof i?i.URLToolkit=a:t.URLToolkit=a}(this)},{}],3:[function(e,t,r){var i=arguments[3],a=arguments[4],n=arguments[5],o=JSON.stringify;t.exports=function(e,t){function r(e){p[e]=!0;for(var t in a[e][1]){var i=a[e][1][t];p[i]||r(i)}}for(var s,l=Object.keys(n),u=0,d=l.length;u<d;u++){var f=l[u],c=n[f].exports;if(c===e||c&&c.default===e){s=f;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},u=0,d=l.length;u<d;u++){var f=l[u];h[f]=f}a[s]=[Function(["require","module","exports"],"("+e+")(self)"),h]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),v={};v[s]=s,a[g]=[Function(["require"],"var f = require("+o(s)+");(f.default ? f.default : f)(self);"),v];var p={};r(g);var y="("+i+")({"+Object.keys(p).map(function(e){return o(e)+":["+a[e][0]+","+o(a[e][1])+"]"}).join(",")+"},{},["+o(g)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([y],{type:"text/javascript"});if(t&&t.bare)return E;var b=m.createObjectURL(E),_=new Worker(b);return _.objectURL=b,_}},{}],4:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(30),h=i(c),g=e(26),v=e(45),p=e(9),y=i(p),m=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return r.lastLoadedFragLevel=0,r._autoLevelCapping=-1,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r.abandonRulesCheck.bind(r),r}return o(t,e),s(t,[{key:"destroy",value:function(){this.clearTimer(),f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var r=this.hls,i=e.frag.level,a=r.levels[i].details.live,n=r.config,o=void 0,s=void 0;a?(o=n.abrEwmaFastLive,s=n.abrEwmaSlowLive):(o=n.abrEwmaFastVoD,s=n.abrEwmaSlowVoD),this.bwEstimator=new y.default(r,s,o,n.abrEwmaDefaultEstimate)}this.fragCurrent=t}}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,r=this.fragCurrent,i=r.loader,a=this.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return v.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var n=i.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var o=performance.now()-n.trequest,s=Math.abs(t.playbackRate);if(o>500*r.duration/s){var l=e.levels,d=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/o),f=l[r.level],c=f.realbitrate?Math.max(f.realbitrate,f.bitrate):f.bitrate,g=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*c/8)),p=t.currentTime,y=(g-n.loaded)/d,m=(h.default.bufferInfo(t,p,e.config.maxBufferHole).end-p)/s;if(m<2*r.duration/s&&y>m){var E=void 0,b=void 0;for(b=r.level-1;b>a;b--){var _=l[b].realbitrate?Math.max(l[b].realbitrate,l[b].bitrate):l[b].bitrate;if(E=r.duration*_/(6.4*d),E<m)break}E<y&&(v.logger.warn("loading too slow, abort fragment loading and switch to level "+b+":fragLoadedDelay["+b+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+E.toFixed(1)+"<"+y.toFixed(1)+":"+m.toFixed(1)),e.nextLoadLevel=b,this.bwEstimator.sample(o,n.loaded),i.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type){this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1;var r=this.hls.levels[t.level],i=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,a=(r.loaded?r.loaded.duration:0)+e.frag.duration;if(r.loaded={bytes:i,duration:a},r.realBitrate=Math.round(8*i/a),e.frag.bitrateTest){var n=e.stats;n.tparsed=n.tbuffered=n.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,r=e.frag;if(t.aborted!==!0&&1===r.loadCounter&&"main"===r.type&&(!r.bitrateTest||t.tload===t.tbuffered)){var i=t.tparsed-t.trequest;v.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this.bwEstimator.sample(i,t.loaded),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(e,t,r,i,a,n,o,s,l){for(var u=a;u>=i;u--){var d=l[u],f=d.details,c=f?f.totalduration/f.fragments.length:t,h=!!f&&f.live,g=void 0;g=u<=e?o*r:s*r;var p=l[u].realbitrate?Math.max(l[u].realbitrate,l[u].bitrate):l[u].bitrate,y=p*c/g;if(v.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(g)+"/"+p+"/"+c+"/"+n+"/"+y),g>p&&(!y||h||y<n))return u}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator,r=this.hls,i=r.levels,a=r.config.minAutoBitrate;if(!(e===-1||t&&t.canEstimate()))return Math.min(e,this.maxAutoLevel);var n=this.nextABRAutoLevel;if(e!==-1&&(n=Math.min(e,n)),void 0!==a)for(var o=i[n].realbitrate?Math.max(i[n].realbitrate,i[n].bitrate):i[n].bitrate;o<a;)n++;return n},set:function(e){this._nextAutoLevel=e}},{key:"minAutoLevel",get:function(){for(var e=this.hls,t=e.levels,r=e.config.minAutoBitrate,i=t?t.length:0,a=0;a<i;a++){var n=t[a].realbitrate?Math.max(t[a].realbitrate,t[a].bitrate):t[a].bitrate;if(n>r)return a}return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.hls.levels,r=this._autoLevelCapping;return e=r===-1&&t&&t.length?t.length-1:r}},{key:"nextABRAutoLevel",get:function(){var e=this.hls,t=this.maxAutoLevel,r=e.levels,i=e.config,a=this.minAutoLevel,n=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,f=(h.default.bufferInfo(n,l,i.maxBufferHole).end-l)/u,c=this.findBestLevel(o,s,d,a,t,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(c>=0)return c;v.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=i.maxStarvationDelay,p=i.abrBandWidthFactor,y=i.abrBandWidthUpFactor;if(0===f){var m=this.bitrateTestDelay;if(m){var E=s?Math.min(s,i.maxLoadingDelay):i.maxLoadingDelay;g=E-m,v.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=y=1}}return c=this.findBestLevel(o,s,d,a,t,f+g,p,y,r),Math.max(c,0)}}]),t}(f.default);r.default=m},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=e(41),d=i(u),f=e(30),c=i(f),h=e(22),g=i(h),v=e(28),p=i(v),y=e(27),m=i(y),E=e(31),b=i(E),_=e(46),T=i(_),R=e(26),k=e(45),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},S=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.AUDIO_TRACKS_UPDATED,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED,p.default.INIT_PTS_FOUND));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=A.STOPPED,r.ontick=r.tick.bind(r),r.initPTS=[],r.waitingFragment=null,r}return o(t,e),l(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),m.default.prototype.destroy.call(this),this.state=A.STOPPED}},{key:"onInitPtsFound",value:function(e){var t=e.id,r=e.cc,i=e.initPTS;"main"===t&&(this.initPTS[r]=i,k.logger.log("InitPTS for cc:"+r+" found from video track:"+i),this.state===A.WAITING_INIT_PTS&&(k.logger.log("sending pending audio frag to demuxer"),this.state=A.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&e===-1?(k.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,r,i,a,n,o=this,l=this.hls,u=l.config,f=function(){switch(o.state){case A.ERROR:case A.PAUSED:case A.BUFFER_FLUSHING:break;case A.STARTING:o.state=A.WAITING_TRACK,o.loadedmetadata=!1;break;case A.IDLE:var s=o.tracks;if(!s)break;if(!o.media&&(o.startFragRequested||!u.startFragPrefetch))break;e=o.loadedmetadata?o.media.currentTime:o.nextLoadPosition;var f=o.mediaBuffer?o.mediaBuffer:o.media,h=c.default.bufferInfo(f,e,u.maxBufferHole),g=h.len,v=h.end,y=o.fragPrevious,m=u.maxMaxBufferLength,E=o.audioSwitch,b=o.trackId;if(g<m&&b<s.length){if(r=s[b].details,"undefined"==typeof r){o.state=A.WAITING_TRACK;break}if(!E&&!r.live&&y&&y.sn===r.endSN&&(!o.media.seeking||o.media.duration-v<y.duration/2)){o.hls.trigger(p.default.BUFFER_EOS,{type:"audio"}),o.state=A.ENDED;break}var _=r.fragments,T=_.length,S=_[0].start,w=_[T-1].start+_[T-1].duration,L=void 0;if(E)if(r.live&&!r.PTSKnown)k.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),v=0;else if(v=e,r.PTSKnown&&e<S){if(!(h.end>S||h.nextStart))return{v:void 0};k.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),o.media.currentTime=S+.05}if(v<=S){if(L=_[0],r.live&&L.loadIdx&&L.loadIdx===o.fragLoadIdx){var D=h.nextStart?h.nextStart:S;return k.logger.log("no alt audio available @currentTime:"+o.media.currentTime+", seeking @"+(D+.05)),o.media.currentTime=D+.05,{v:void 0}}}else!function(){var e=void 0,t=u.maxFragLookUpTolerance;v<w?(v>w-t&&(t=0),e=d.default.search(_,function(e){return e.start+e.duration-t<=v?1:e.start-t>v?-1:0}),e||k.logger.log("frag not found @bufferEnd/start:"+v+"/"+S)):e=_[T-1],e&&(L=e,S=e.start,y&&L.level===y.level&&L.sn===y.sn&&(L.sn<r.endSN?(L=_[L.sn+1-r.startSN],k.logger.log("SN just loaded, load next one: "+L.sn)):L=null))}();if(L)if(null!=L.decryptdata.uri&&null==L.decryptdata.key)k.logger.log("Loading key for "+L.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+b),o.state=A.KEY_LOADING,l.trigger(p.default.KEY_LOADING,{frag:L});else{if(k.logger.log("Loading "+L.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+b+", currentTime:"+e+",bufferEnd:"+v.toFixed(3)),void 0!==o.fragLoadIdx?o.fragLoadIdx++:o.fragLoadIdx=0,L.loadCounter){L.loadCounter++;var O=u.fragLoadingLoopThreshold;if(L.loadCounter>O&&Math.abs(o.fragLoadIdx-L.loadIdx)<O)return l.trigger(p.default.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:L}),{v:void 0}}else L.loadCounter=1;L.loadIdx=o.fragLoadIdx,o.fragCurrent=L,o.startFragRequested=!0,o.nextLoadPosition=L.start+L.duration,l.trigger(p.default.FRAG_LOADING,{frag:L}),o.state=A.FRAG_LOADING}}break;case A.WAITING_TRACK:t=o.tracks[o.trackId],t&&t.details&&(o.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:i=performance.now(),a=o.retryDate,f=o.media,n=f&&f.seeking,(!a||i>=a||n)&&(k.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),o.state=A.IDLE);break;case A.WAITING_INIT_PTS:case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}}();if("object"===("undefined"==typeof f?"undefined":s(f)))return f.v}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(k.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===A.ENDED&&(this.state=A.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){k.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.state=A.IDLE,this.fragCurrent=null,this.state=A.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=A.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,r=e.id,i=this.tracks[r],a=t.totalduration,n=0;if(k.logger.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var o=i.details;o&&t.fragments.length>0?(b.default.mergeDetails(o,t),n=t.fragments[0].start,t.PTSKnown?k.logger.log("live audio playlist sliding:"+n.toFixed(3)):k.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,k.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,!this.startFragRequested){if(this.startPosition===-1){var s=t.startTimeOffset;isNaN(s)?this.startPosition=0:(k.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s)}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_TRACK&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&"audio"===e.frag.type&&e.frag.level===t.level&&e.frag.sn===t.sn){this.state=A.PARSING,this.stats=e.stats;var r=this.tracks[this.trackId],i=r.details,a=i.totalduration,n=t.start,o=t.level,s=t.sn,l=t.cc,u=this.config.defaultAudioCodec||r.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new g.default(this.hls,"audio"));var d=this.initPTS[l];if(void 0!==d){this.pendingBuffering=!0,k.logger.log("Demuxing "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+o);var f=!1;this.demuxer.push(e.payload,u,null,n,l,o,s,a,t.decryptdata,f,d)}else k.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+i.startSN+" ,"+i.endSN+"],track "+o),this.waitingFragment=e,this.state=A.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING){var r=e.tracks,i=void 0;if(r.video&&delete r.video,i=r.audio){i.levelCodec="mp4a.40.2",i.id=e.id,this.hls.trigger(p.default.BUFFER_CODECS,r),k.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var a=i.initSegment;if(a){var n={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[n]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,n))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,r=this.fragCurrent;r&&"audio"===e.id&&"audio"===e.type&&e.sn===r.sn&&e.level===r.level&&this.state===A.PARSING&&!function(){var r=t.trackId,i=t.tracks[r],a=t.fragCurrent,n=t.hls;k.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),b.default.updateFragPTSDTS(i.details,a.sn,e.startPTS,e.endPTS);var o=t.audioSwitch,s=t.media,l=!1;if(o&&s)if(s.readyState){var u=s.currentTime;k.logger.log("switching audio track : currentTime:"+u),u>=e.startPTS&&(k.logger.log("switching audio track : flushing all audio"),t.state=A.BUFFER_FLUSHING,n.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l=!0,t.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:r}))}else t.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:r});var d=t.pendingData;t.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&d.push({type:e.type,data:t,parent:"audio",content:"data"})}),!l&&d.length&&(d.forEach(function(e){t.pendingBuffering=!0,t.hls.trigger(p.default.BUFFER_APPENDING,e)}),t.pendingData=[],t.appended=!0)),t.tick()}()}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==A.PARSING&&t!==A.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==A.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),r.trigger(p.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;k.logger.log("audio buffered : "+T.default.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=A.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r,t.loadCounter=0;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);k.logger.warn("audioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=performance.now()+a,this.state=A.FRAG_LOADING_WAITING_RETRY}else k.logger.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=A.ERROR}break;case R.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case R.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case R.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case R.ErrorDetails.KEY_LOAD_ERROR:case R.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,k.logger.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(k.logger.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(p.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=A.PARSED):(this.state=A.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,k.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(m.default);r.default=S},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(45),h=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.AUDIO_TRACK_LOADED));return r.ticks=0,r.ontick=r.tick.bind(r),r}return o(t,e),s(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,r=e.audioTracks||[],i=!1;this.tracks=r,this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:r});var a=0;r.forEach(function(e){return e.default?(t.audioTrack=a,void(i=!0)):void a++}),i===!1&&r.length&&(c.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(c.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,c.logger.log("switching to audioTrack "+e);var t=this.tracks[e],r=this.hls,i=t.type,a=t.url,n={id:e,type:i,url:a};r.trigger(u.default.AUDIO_TRACK_SWITCH,n),r.trigger(u.default.AUDIO_TRACK_SWITCHING,n);var o=t.details;!a||void 0!==o&&o.live!==!0||(c.logger.log("(re)loading playlist for audioTrack "+e),r.trigger(u.default.AUDIO_TRACK_LOADING,{url:a,id:e}))}}},{key:"updateTrack",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,c.logger.log("updating audioTrack "+e);var t=this.tracks[e],r=t.url,i=t.details;!r||void 0!==i&&i.live!==!0||(c.logger.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:r,id:e}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(f.default);r.default=h},{27:27,28:28,45:45}],7:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(45),h=e(26),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),r.pendingTracks={},r.tracks={},r}return o(t,e),s(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var i=this.sourceBuffer.audio,a=Math.abs(i.timestampOffset-e.start);if(a>.1){var n=i.updating;try{i.abort()}catch(e){n=!0,c.logger.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(c.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+e.start),i.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){var t=e.audio,r=e.video,i=0;e.altAudio&&(t||r)&&(i=(t?1:0)+(r?1:0),c.logger.log(i+" sourceBuffer(s) expected")),this.sourceBufferNb=i}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(r)}}},{key:"onMediaDetaching",value:function(){c.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){c.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){c.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){c.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){c.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;c.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,r=this.segments.reduce(function(e,r){return r.parent===t?e+1:e},0);this.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(e){c.logger.error("sourceBuffer error:"+e),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var i in e)if(!t[i]){var a=e[i],n=a.levelCodec||a.codec,o=a.container+";codecs="+n;c.logger.log("creating sourceBuffer("+o+")");try{var s=t[i]=r.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),
this.tracks[i]={codec:n,container:a.container},a.buffer=s}catch(e){c.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){c.logger.error("sourceBuffer error:",e.event),this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,r=e.type;for(var i in t)r&&i!==r||t[i].ended||(t[i].ended=!0,c.logger.log(i+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var r in e){var i=e[r];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}c.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){c.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e=this.media,t=this.mediaSource,r=this.sourceBuffer,i=this._levelDuration;if(null!==i&&e&&t&&r&&0!==e.readyState&&"open"===t.readyState){for(var a in r)if(r[a].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var n=e.duration;(i>this._msDuration&&i>n||n===1/0||isNaN(n))&&(c.logger.log("Updating mediasource duration to "+i.toFixed(3)),this._msDuration=t.duration=i)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var i in r)t+=r[i].buffered.length}catch(e){c.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,r=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void c.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var i=r.shift();try{var a=i.type,n=t[a];n?n.updating?r.unshift(i):(n.ended=!1,this.parent=i.parent,n.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){c.logger.error("error while trying to append buffer:"+t.message),r.unshift(i);var o={type:h.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],o.details=h.ErrorDetails.BUFFER_FULL_ERROR,o.fatal=!1,void e.trigger(u.default.ERROR,o);if(this.appendError?this.appendError++:this.appendError=1,o.details=h.ErrorDetails.BUFFER_APPEND_ERROR,o.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return c.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],o.fatal=!0,void e.trigger(u.default.ERROR,o);o.fatal=!1,e.trigger(u.default.ERROR,o)}}}}},{key:"flushBuffer",value:function(e,t,r){var i,a,n,o,s,l,u=this.sourceBuffer;if(Object.keys(u).length){if(c.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if(i=u[d],i.ended=!1,i.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),o=i.buffered.end(a),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&t===Number.POSITIVE_INFINITY?(s=e,l=t):(s=Math.max(n,e),l=Math.min(o,t)),Math.min(l,o)-s>.5)return this.flushBufferCounter++,c.logger.log("flush "+d+" ["+s+","+l+"], of ["+n+","+o+"], pos:"+this.media.currentTime),i.remove(s,l),!1}catch(e){c.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else c.logger.warn("abort flushing too many retries");c.logger.log("buffer flushed")}return!0}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],8:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED))}return o(t,e),s(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var t=0,r=void 0,i=void 0,a=this.mediaWidth,n=this.mediaHeight,o=0,s=0;for(r=0;r<=e&&(i=this.levels[r],!this.isLevelRestricted(r))&&(t=r,o=i.width,s=i.height,!(a<=o||n<=s));r++);return t}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||this.restrictedLevels.indexOf(e)===-1)}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(f.default);r.default=c},{27:27,28:28}],9:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(44),s=i(o),l=function(){function e(t,r,i,n){a(this,e),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(r),this.fast_=new s.default(i)}return n(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var r=8e3*t/e,i=e/1e3;this.fast_.sample(i,r),this.slow_.sample(i,r)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();r.default=l},{44:44}],10:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(45),h=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING))}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var r=this.video=e.media instanceof HTMLVideoElement?e.media:null;"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*n/a,l=this.hls;if(l.trigger(u.default.FPS_DROP,{currentDropped:n,currentDecoded:o,totalDroppedFrames:r}),s>0&&n>l.config.fpsDroppedMonitoringThreshold*o){var d=l.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=d)&&(d-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:l.currentLevel}),l.autoLevelCapping=d,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(f.default);r.default=h},{27:27,28:28,45:45}],11:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(45),h=e(26),g=e(30),v=i(g),p=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.FRAG_LOADED,u.default.ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=r._autoLevelCapping=-1,r}return o(t,e),s(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,r=[],i=[],a={},n=!1,o=!1,s=this.hls,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(e,t){return MediaSource.isTypeSupported(e+"/mp4;codecs="+t)};if(e.levels.forEach(function(e){e.videoCodec&&(n=!0),l&&e.audioCodec&&e.audioCodec.indexOf("mp4a.40.34")!==-1&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(o=!0);var t=a[e.bitrate];void 0===t?(a[e.bitrate]=r.length,e.url=[e.url],e.urlId=0,r.push(e)):r[t].url.push(e.url)}),n&&o?r.forEach(function(e){e.videoCodec&&i.push(e)}):i=r,i=i.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||d("audio",t))&&(!r||d("video",r))}),i.length){t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var f=0;f<i.length;f++)if(i[f].bitrate===t){this._firstLevel=f,c.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}s.trigger(u.default.MANIFEST_PARSED,{levels:i,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:n,altAudio:e.audioTracks.length>0})}else s.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:s.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e&&(c.logger.log("switching to level "+e),this._level=e,this.hls.trigger(u.default.LEVEL_SWITCH,{level:e}));var r=t[e],i=r.details;if(!i||i.live===!0){var a=r.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:r.url[a],level:e,id:a})}}else this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,r=this.hls,i=void 0,a=void 0,n=!1,o=r.abrController,s=o.minAutoLevel;switch(t){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:i=e.frag.level;break;case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:i=e.context.level,n=!0;break;case h.ErrorDetails.REMUX_ALLOC_ERROR:i=e.level}if(void 0!==i){a=this._levels[i],a.loadError?a.loadError++:a.loadError=1;var l=a.url.length;if(l>1&&a.loadError<l)a.urlId=(a.urlId+1)%l,a.details=void 0,c.logger.warn("level controller,"+t+" for level "+i+": switching to redundant stream id "+a.urlId);else{var d=this._manualLevel===-1&&i;if(d)c.logger.warn("level controller,"+t+": switch-down for next fragment"),o.nextAutoLevel=Math.max(s,i-1);else if(a&&a.details&&a.details.live)c.logger.warn("level controller,"+t+" on live stream, discard"),n&&(this._level=void 0);else if(t===h.ErrorDetails.LEVEL_LOAD_ERROR||t===h.ErrorDetails.LEVEL_LOAD_TIMEOUT){var f=r.media,g=f&&v.default.isBuffered(f,f.currentTime)&&v.default.isBuffered(f,f.currentTime+.5);if(g){var p=r.config.levelLoadingRetryDelay;c.logger.warn("level controller,"+t+", but media buffered, retry in "+p+"ms"),this.timer=setTimeout(this.ontick,p)}else c.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,r.trigger(u.default.ERROR,e)}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(t&&"main"===t.type){var r=this._levels[t.level];r&&(r.loadError=0)}}},{key:"onLevelLoaded",value:function(e){var t=e.level;if(t===this._level){var r=this._levels[t];r.loadError=0;var i=e.details;if(i.live){var a=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),n=r.details;n&&i.endSN===n.endSN&&(a/=2,c.logger.log("same live playlist, reload twice faster")),a-=performance.now()-e.stats.trequest,a=Math.max(1e3,Math.round(a)),c.logger.log("live playlist, reload in "+a+" ms"),this.timer=setTimeout(this.ontick,a)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],r=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:t.url[r],level:e,id:r})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){e!==-1&&(e=Math.max(e,this.hls.abrController.minAutoLevel)),this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,this._manualLevel===-1&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(f.default);r.default=p},{26:26,27:27,28:28,30:30,45:45}],12:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(41),u=i(l),d=e(30),f=i(d),c=e(22),h=i(c),g=e(28),v=i(g),p=e(27),y=i(p),m=e(31),E=i(m),b=e(46),_=i(b),T=e(26),R=e(45),k={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},A=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.MANIFEST_LOADING,v.default.MANIFEST_PARSED,v.default.LEVEL_LOADED,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.FRAG_LOAD_EMERGENCY_ABORTED,v.default.FRAG_PARSING_INIT_SEGMENT,v.default.FRAG_PARSING_DATA,v.default.FRAG_PARSED,v.default.ERROR,v.default.AUDIO_TRACK_SWITCHING,v.default.AUDIO_TRACK_SWITCHED,v.default.BUFFER_CREATED,v.default.BUFFER_APPENDED,v.default.BUFFER_FLUSHED));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=k.STOPPED,r.ontick=r.tick.bind(r),r}return o(t,e),s(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),y.default.prototype.destroy.call(this),this.state=k.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;i===-1&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&e===-1&&(R.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=k.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else R.logger.warn("cannot start loading as manifest not parsed yet"),this.state=k.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case k.ERROR:break;case k.BUFFER_FLUSHING:this.fragLoadError=0;break;case k.IDLE:if(!this._doTickIdle())return;break;case k.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=k.IDLE);break;case k.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),r=this.retryDate;(!r||t>=r||this.media&&this.media.seeking)&&(R.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=k.IDLE);break;case k.ERROR:case k.STOPPED:case k.FRAG_LOADING:case k.PARSING:case k.PARSED:case k.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&!r&&(this.startFragRequested||!t.startFragPrefetch))return!0;var i=void 0;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var a=e.nextLoadLevel,n=this.levels[a],o=n.bitrate,s=void 0;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=f.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,t.maxBufferHole),u=l.len;if(u>=s)return!0;R.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=a;var d=n.details;if("undefined"==typeof d||d.live&&this.levelLastLoaded!==a)return this.state=k.WAITING_LEVEL,!0;var c=this.fragPrevious;if(!d.live&&c&&c.sn===d.endSN&&r.duration-Math.max(l.end,c.start)<=Math.max(.2,c.duration/2)){var h={};return this.altAudio&&(h.type="video"),this.hls.trigger(v.default.BUFFER_EOS,h),this.state=k.ENDED,!0}return this._fetchPayloadOrEos(i,l,d)}},{key:"_fetchPayloadOrEos",value:function(e,t,r){var i=this.fragPrevious,a=this.level,n=r.fragments,o=n.length;if(0===o)return!1;var s=n[0].start,l=n[o-1].start+n[o-1].duration,u=t.end,d=void 0;if(r.live){var f=this.config.initialLiveManifestSize;if(o<f)return R.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+f),!1;if(d=this._ensureFragmentAtLivePoint(r,u,s,l,i,n,o),null===d)return!1}else u<s&&(d=n[0]);return d||(d=this._findFragment(s,i,o,n,u,l,r)),!d||this._loadFragmentOrKey(d,a,r,e,u)}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,r,i,a,n,o){var s=this.hls.config,l=this.media,u=void 0,d=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-s.maxFragLookUpTolerance,i-d)){var f=this.liveSyncPosition=this.computeLivePosition(r,e);R.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),t=f,l&&l.readyState&&l.duration>f&&(l.currentTime=f)}if(e.PTSKnown&&t>i&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(a){var c=a.sn+1;c>=e.startSN&&c<=e.endSN&&(u=n[c-e.startSN],R.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=n[Math.min(o-1,Math.round(o/2))],R.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u}},{key:"_findFragment",value:function(e,t,r,i,a,n,o){var s=this.hls.config,l=void 0,d=void 0,f=s.maxFragLookUpTolerance;if(a<n?(a>n-f&&(f=0),d=u.default.search(i,function(e){return e.start+e.duration-f<=a?1:e.start-f>a&&e.start?-1:0})):d=i[r-1],d&&(l=d,e=d.start,t&&l.level===t.level&&l.sn===t.sn))if(l.sn<o.endSN){var c=t.deltaPTS,h=l.sn-o.startSN;c&&c>s.maxBufferHole&&t.dropped&&h?(l=i[h-1],R.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(l=i[h+1],R.logger.log("SN just loaded, load next one: "+l.sn))}else l=null;return l}},{key:"_loadFragmentOrKey",value:function(e,t,r,i,a){var n=this.hls,o=n.config;if(null==e.decryptdata.uri||null!=e.decryptdata.key){if(R.logger.log("Loading "+e.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+t+", currentTime:"+i.toFixed(3)+",bufferEnd:"+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var s=o.fragLoadingLoopThreshold;if(e.loadCounter>s&&Math.abs(this.fragLoadIdx-e.loadIdx)<s)return n.trigger(v.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e}),!1}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,this.nextLoadPosition=e.start+e.duration,e.autoLevel=n.autoLevelEnabled,e.bitrateTest=this.bitrateTest,n.trigger(v.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new h.default(n,"main")),this.state=k.FRAG_LOADING,!0}R.logger.log("Loading key for "+e.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+t),this.state=k.KEY_LOADING,n.trigger(v.default.KEY_LOADING,{frag:e})}},{key:"getBufferRange",value:function(e){return u.default.search(this.bufferRange,function(t){return e<t.start?-1:e>t.end?1:0})}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var e,t,r=this.media;if(r&&r.readyState&&r.seeking===!1&&(t=r.currentTime,t>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),f.default.isBuffered(r,t)?e=this.getBufferRange(t):f.default.isBuffered(r,t+.1)&&(e=this.getBufferRange(t+.1)),e)){var i=e.frag;i!==this.fragPlaying&&(this.fragPlaying=i,this.hls.trigger(v.default.FRAG_CHANGED,{frag:i}))}}},{key:"immediateLevelSwitch",value:function(){if(R.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,r=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,r=this.getBufferRange(e.currentTime),r&&r.start>1&&this.flushMainBuffer(0,r.start-1),e.paused)t=0;else{var a=this.hls.nextLoadLevel,n=this.levels[a],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*o)+1:0}if(i=this.getBufferRange(e.currentTime+t),i&&(i=this.followingBufferRange(i))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=k.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};this.altAudio&&(r.type="video"),this.hls.trigger(v.default.BUFFER_FLUSHING,r)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(R.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.media,t=e?e.currentTime:void 0,r=this.config;if(R.logger.log("media seeking to "+t.toFixed(3)),this.state===k.FRAG_LOADING){var i=this.mediaBuffer?this.mediaBuffer:e,a=f.default.bufferInfo(i,t,this.config.maxBufferHole),n=this.fragCurrent;if(0===a.len&&n){var o=r.maxFragLookUpTolerance,s=n.start-o,l=n.start+n.duration+o;t<s||t>l?(n.loader&&(R.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=k.IDLE):R.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===k.ENDED&&(this.state=k.IDLE);e&&(this.lastCurrentTime=t),this.state!==k.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()}},{key:"onMediaSeeked",value:function(){R.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){R.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){R.logger.log("trigger BUFFER_RESET"),this.hls.trigger(v.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t,r=!1,i=!1;e.levels.forEach(function(e){t=e.audioCodec,t&&(t.indexOf("mp4a.40.2")!==-1&&(r=!0),t.indexOf("mp4a.40.5")!==-1&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&R.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var a=this.config;a.autoStartLoad&&this.hls.startLoad(a.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,r=e.level,i=this.levels[r],a=t.totalduration,n=0;if(R.logger.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),this.levelLastLoaded=r,t.live){var o=i.details;o&&t.fragments.length>0?(E.default.mergeDetails(o,t),n=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(n,o),t.PTSKnown?R.logger.log("live playlist sliding:"+n.toFixed(3)):R.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,R.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,this.hls.trigger(v.default.LEVEL_UPDATED,{details:t,level:r}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var s=t.startTimeOffset;isNaN(s)?t.live?(this.startPosition=this.computeLivePosition(n,t),R.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(s<0&&(R.logger.log("negative start time offset "+s+", count from end of last fragment"),
s=n+a+s),R.logger.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===k.WAITING_LEVEL&&(this.state=k.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===k.KEY_LOADING&&(this.state=k.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,r=e.frag;if(this.state===k.FRAG_LOADING&&t&&"main"===r.type&&r.level===t.level&&r.sn===t.sn){var i=e.stats,a=this.levels[t.level],n=a.details;if(R.logger.log("Loaded  "+t.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t.level),this.bitrateTest=!1,r.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=k.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(v.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.tick();else{this.state=k.PARSING,this.stats=i;var o=n.totalduration,s=isNaN(t.startDTS)?t.start:t.startDTS,l=t.level,u=t.sn,d=this.config.defaultAudioCodec||a.audioCodec;this.audioCodecSwap&&(R.logger.log("swapping playlist audio codec"),void 0===d&&(d=this.lastAudioCodec),d&&(d=d.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,R.logger.log("Parsing "+u+" of ["+n.startSN+" ,"+n.endSN+"],level "+l+", cc "+t.cc);var f=this.demuxer;f||(f=this.demuxer=new h.default(this.hls,"main"));var c=this.media,g=c&&c.seeking,p=!g&&(n.PTSKnown||!n.live);f.push(e.payload,d,a.videoCodec,s,t.cc,l,u,o,t.decryptdata,p,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===k.PARSING){var r,i,a=e.tracks;if(a.audio&&this.altAudio&&delete a.audio,i=a.audio){var n=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();n&&this.audioCodecSwap&&(R.logger.log("swapping playlist audio codec"),n=n.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&o.indexOf("firefox")===-1&&(n="mp4a.40.5"),o.indexOf("android")!==-1&&"audio/mpeg"!==i.container&&(n="mp4a.40.2",R.logger.log("Android: force audio codec to "+n)),i.levelCodec=n,i.id=e.id}if(i=a.video,i&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),e.unique){var s={codec:"",levelCodec:""};for(r in e.tracks)i=a[r],s.container=i.container,s.codec&&(s.codec+=",",s.levelCodec+=","),i.codec&&(s.codec+=i.codec),i.levelCodec&&(s.levelCodec+=i.levelCodec);a={audiovideo:s}}this.hls.trigger(v.default.BUFFER_CODECS,a);for(r in a){i=a[r],R.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var l=i.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(v.default.BUFFER_APPENDING,{type:r,data:l,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,r=this.fragCurrent;if(r&&"main"===e.id&&e.sn===r.sn&&e.level===r.level&&("audio"!==e.type||!this.altAudio)&&this.state===k.PARSING){var i=this.levels[this.level],a=this.fragCurrent;R.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var n=E.default.updateFragPTSDTS(i.details,a.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),o=this.hls;o.trigger(v.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:n,type:e.type,start:e.startPTS,end:e.endPTS}),"video"===e.type&&(a.dropped=e.dropped),[e.data1,e.data2].forEach(function(r){r&&(t.appended=!0,t.pendingBuffering=!0,o.trigger(v.default.BUFFER_APPENDING,{type:e.type,data:r,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===k.PARSING&&(this.stats.tparsed=performance.now(),this.state=k.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){R.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(R.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.IDLE}var a=this.hls;a.trigger(v.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(v.default.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(R.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,r=void 0,i=void 0,a=!1;for(var n in t){var o=t[n];"main"===o.id?(i=n,r=o,"video"===n&&(this.videoBuffer=t[n].buffer)):a=!0}a&&r?(R.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==k.PARSING&&t!==k.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var e=this;if(!(this.state!==k.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;t&&!function(){var r=e.mediaBuffer?e.mediaBuffer:e.media;R.logger.log("main buffered : "+_.default.toString(r.buffered));var i=e.bufferRange.filter(function(e){return f.default.isBuffered(r,(e.start+e.end)/2)});i.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:t}),e.bufferRange=i.sort(function(e,t){return e.start-t.start}),e.fragPrevious=t;var a=e.stats;a.tbuffered=performance.now(),e.fragLastKbps=Math.round(8*a.total/(a.tbuffered-a.tfirst)),e.hls.trigger(v.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),e.state=k.IDLE}(),this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r=this.media,i=r&&f.default.isBuffered(r,r.currentTime)&&f.default.isBuffered(r,r.currentTime+.5);switch(e.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var a=this.fragLoadError;a?a++:a=1;var n=this.config;if(a<=n.fragLoadingMaxRetry||i||t.autoLevel&&t.level){this.fragLoadError=a,t.loadCounter=0;var o=Math.min(Math.pow(2,a-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);R.logger.warn("mediaController: frag loading failed, retry in "+o+" ms"),this.retryDate=performance.now()+o,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=k.FRAG_LOADING_WAITING_RETRY}else R.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(v.default.ERROR,e),this.state=k.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(i?(this._reduceMaxBufferLength(t.duration),this.state=k.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.hls.trigger(v.default.ERROR,e),this.state=k.ERROR));break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==k.ERROR&&(e.fatal?(this.state=k.ERROR,R.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):this.state===k.WAITING_LEVEL&&(this.state=k.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:this.state!==k.PARSING&&this.state!==k.PARSED||(i?(this._reduceMaxBufferLength(t.duration),this.state=k.IDLE):(R.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,R.logger.warn("reduce max buffer length to "+t.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,r=this.mediaBuffer?this.mediaBuffer:e,i=r.buffered;if(this.loadedmetadata||!i.length||e.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var a=f.default.bufferInfo(e,t,0),n=!(e.paused||e.ended||0===e.buffered.length),o=.5,s=t!==this.lastCurrentTime,l=this.config;if(s)this.stallReported&&(R.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(n){var u=performance.now(),d=this.hls;if(this.stalled){var c=u-this.stalled,h=a.len,g=this.nudgeRetry||0;if(h<=o&&c>1e3*l.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,R.logger.warn("playback stalling in low buffer @"+t),d.trigger(v.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h}));var p=a.nextStart,y=p-t;if(p&&y<l.maxSeekHole&&y>0){this.nudgeRetry=++g;var m=g*l.nudgeOffset;R.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+p+" + nudge "+m),e.currentTime=p+m,this.stalled=void 0,d.trigger(v.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:p+m-t})}}else if(h>o&&c>1e3*l.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,R.logger.warn("playback stalling in high buffer @"+t),d.trigger(v.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h})),this.stalled=void 0,this.nudgeRetry=++g,g<l.nudgeMaxRetry){var E=e.currentTime,b=E+g*l.nudgeOffset;R.logger.log("adjust currentTime from "+E+" to "+b),e.currentTime=b,d.trigger(v.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("still stuck in high buffer @"+t+" after "+l.nudgeMaxRetry+", raise fatal error"),d.trigger(v.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=u,this.stallReported=!1}}else{this.loadedmetadata=!0;var _=this.startPosition,k=f.default.isBuffered(r,_);t===_&&k||(R.logger.log("target start position:"+_),k||(_=i.start(0),R.logger.log("target start position not buffered, seek to buffered.start(0) "+_)),R.logger.log("adjust currentTime from "+t+" to "+_),e.currentTime=_)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=k.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(t){return f.default.isBuffered(e,(t.start+t.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=k.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,R.logger.log("main stream:"+t+"->"+e),this.hls.trigger(v.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferRange(e.currentTime);if(t)return t.frag.level}return-1}},{key:"nextBufferRange",get:function(){var e=this.media;return e?this.followingBufferRange(this.getBufferRange(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(y.default);r.default=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(42),h=i(c),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.MANIFEST_LOADING,u.default.FRAG_LOADED,u.default.LEVEL_SWITCH));if(r.hls=e,r.config=e.config,r.enabled=!0,r.Cues=e.config.cueHandler,r.config.enableCEA708Captions){var i=r,o=function(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)},s={newCue:function(e,t,r){if(!i.textTrack1){var a=i.getExistingTrack("1");a?(i.textTrack1=a,i.clearCurrentCues(i.textTrack1),o(i.textTrack1,i.media)):(i.textTrack1=i.createTextTrack("captions","English","en"),i.textTrack1.textTrack1=!0)}i.Cues.newCue(i.textTrack1,e,t,r)}},l={newCue:function(e,t,r){if(!i.textTrack2){var a=i.getExistingTrack("2");a?(i.textTrack2=a,i.clearCurrentCues(i.textTrack2),o(i.textTrack2,i.media)):(i.textTrack2=i.createTextTrack("captions","Spanish","es"),i.textTrack2.textTrack2=!0)}i.Cues.newCue(i.textTrack2,e,t,r)}};r.cea608Parser=new h.default(0,s,l)}return r}return o(t,e),s(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r],a="textTrack"+e;if(i[a]===!0)return i}return null}},{key:"createTextTrack",value:function(e,t,r){if(this.media)return this.media.addTextTrack(e,t,r)}},{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}}},{key:"extractCea608Data",value:function(e){for(var t,r,i,a,n,o=31&e[0],s=2,l=[],u=0;u<o;u++)t=e[s++],r=127&e[s++],i=127&e[s++],a=0!==(4&t),n=3&t,0===r&&0===i||a&&0===n&&(l.push(r),l.push(i));return l}}]),t}(f.default);r.default=g},{27:27,28:28,42:42}],14:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.aesIV=r}return a(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();r.default=n},{}],15:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<r.length;i++)r[i]=t.getUint32(4*i);return r}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix[0],i=this.subMix[1],a=this.subMix[2],n=this.subMix[3],o=this.invSubMix[0],s=this.invSubMix[1],l=this.invSubMix[2],u=this.invSubMix[3],d=new Uint32Array(256),f=0,c=0,h=0;for(h=0;h<256;h++)h<128?d[h]=h<<1:d[h]=h<<1^283;for(h=0;h<256;h++){var g=c^c<<1^c<<2^c<<3^c<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var v=d[f],p=d[v],y=d[p],m=257*d[g]^16843008*g;r[f]=m<<24|m>>>8,i[f]=m<<16|m>>>16,a[f]=m<<8|m>>>24,n[f]=m,m=16843009*y^65537*p^257*v^16843008*f,o[g]=m<<24|m>>>8,s[g]=m<<16|m>>>16,l[g]=m<<8|m>>>24,u[g]=m,f?(f=v^d[d[d[y^v]]],c^=d[d[c]]):f=c=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var a=this.keySize=t.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);var n=this.ksRows=4*(a+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(this.ksRows),u=this.invKeySchedule=new Uint32Array(this.ksRows),d=this.sBox,f=this.rcon,c=this.invSubMix[0],h=this.invSubMix[1],g=this.invSubMix[2],v=this.invSubMix[3],p=void 0,y=void 0;for(o=0;o<n;o++)o<a?p=l[o]=t[o]:(y=p,o%a===0?(y=y<<8|y>>>24,y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y],y^=f[o/a|0]<<24):a>6&&o%a===4&&(y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y]),l[o]=p=(l[o-a]^y)>>>0);for(s=0;s<n;s++)o=n-s,y=3&s?l[o]:l[o-4],s<4||o<=4?u[s]=y:u[s]=c[d[y>>>24]]^h[d[y>>>16&255]]^g[d[y>>>8&255]]^v[d[255&y]],u[s]=u[s]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,r){for(var i,a,n=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,l=this.invSubMix[0],u=this.invSubMix[1],d=this.invSubMix[2],f=this.invSubMix[3],c=this.uint8ArrayToUint32Array_(r),h=c[0],g=c[1],v=c[2],p=c[3],y=new Int32Array(e),m=new Int32Array(y.length),E=void 0,b=void 0,_=void 0,T=void 0,R=void 0,k=void 0,A=void 0,S=void 0,w=void 0,L=void 0,D=void 0,O=void 0;t<y.length;){for(w=this.networkToHostOrderSwap(y[t]),L=this.networkToHostOrderSwap(y[t+1]),D=this.networkToHostOrderSwap(y[t+2]),O=this.networkToHostOrderSwap(y[t+3]),R=w^o[0],k=O^o[1],A=D^o[2],S=L^o[3],i=4,a=1;a<n;a++)E=l[R>>>24]^u[k>>16&255]^d[A>>8&255]^f[255&S]^o[i],b=l[k>>>24]^u[A>>16&255]^d[S>>8&255]^f[255&R]^o[i+1],_=l[A>>>24]^u[S>>16&255]^d[R>>8&255]^f[255&k]^o[i+2],T=l[S>>>24]^u[R>>16&255]^d[k>>8&255]^f[255&A]^o[i+3],R=E,k=b,A=_,S=T,i+=4;E=s[R>>>24]<<24^s[k>>16&255]<<16^s[A>>8&255]<<8^s[255&S]^o[i],b=s[k>>>24]<<24^s[A>>16&255]<<16^s[S>>8&255]<<8^s[255&R]^o[i+1],_=s[A>>>24]<<24^s[S>>16&255]<<16^s[R>>8&255]<<8^s[255&k]^o[i+2],T=s[S>>>24]<<24^s[R>>16&255]<<16^s[k>>8&255]<<8^s[255&A]^o[i+3],i+=3,m[t]=this.networkToHostOrderSwap(E^h),m[t+1]=this.networkToHostOrderSwap(T^g),m[t+2]=this.networkToHostOrderSwap(_^v),m[t+3]=this.networkToHostOrderSwap(b^p),h=w,g=L,v=D,p=O,t+=4}return m.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();r.default=n},{}],16:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(14),s=i(o),l=e(17),u=i(l),d=e(15),f=i(d),c=e(26),h=e(45),g=function(){function e(t,r){a(this,e),this.observer=t,this.config=r;try{var i=crypto?crypto:self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return n(e,[{key:"decrypt",value:function(e,t,r,i){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){h.logger.log("JS AES decrypt");var n=this.decryptor;n||(this.decryptor=n=new f.default),n.expandKey(t),i(n.decrypt(e,0,r))}else!function(){h.logger.log("WebCrypto AES decrypt");var n=a.subtle;a.key!==t&&(a.key=t,a.fastAesKey=new u.default(n,t)),a.fastAesKey.expandKey().then(function(t){var a=new s.default(n,r);a.decrypt(e,t).then(function(e){i(e)})}).catch(function(n){a.onWebCryptoError(n,e,t,r,i)})}()}},{key:"onWebCryptoError",value:function(e,t,r,i,a){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(t,r,i,a)):(h.logger.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();r.default=g},{14:14,15:15,17:17,26:26,45:45}],17:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.key=r}return a(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();r.default=n},{}],18:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(19),s=i(o),l=e(45),u=e(24),d=i(u),f=function(){function e(t,r,i,n,o){a(this,e),this.observer=t,this.id=r,this.remuxerClass=i,this.config=n,this.remuxer=new this.remuxerClass(t,r,n,o),this.insertDiscontinuity()}return n(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(e,t,r,i,a,n,o,u,f,c){var h,g,v,p,y,m,E,b,_,T,R=new d.default(e),k=90*R.timeStamp,A=!1;for(a!==this.lastCC?(l.logger.log(this.id+" discontinuity detected"),this.lastCC=a,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):n!==this.lastLevel?(l.logger.log("audio track switch detected"),this.lastLevel=n,this.remuxer.switchLevel(),this.insertDiscontinuity()):o===this.lastSN+1&&(A=!0),h=this._aacTrack,this.lastSN=o,this.lastLevel=n,m=R.length,_=e.length;m<_-1&&(255!==e[m]||240!==(240&e[m+1]));m++);for(h.audiosamplerate||(g=s.default.getAudioConfig(this.observer,e,m,t),h.config=g.config,h.audiosamplerate=g.samplerate,h.channelCount=g.channelCount,h.codec=g.codec,h.manifestCodec=g.manifestCodec,h.duration=u,l.logger.log("parsed codec:"+h.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)),y=0,p=9216e4/h.audiosamplerate;m+5<_&&(E=1&e[m+1]?7:9,v=(3&e[m+3])<<11|e[m+4]<<3|(224&e[m+5])>>>5,v-=E,v>0&&m+E+v<=_);)for(b=k+y*p,T={unit:e.subarray(m+E,m+E+v),pts:b,dts:b},h.samples.push(T),h.len+=v,m+=v+E,y++;m<_-1&&(255!==e[m]||240!==(240&e[m+1]));m++);this.remuxer.remux(n,o,a,h,{samples:[]},{samples:[{pts:k,dts:k,unit:R.payload}]},{samples:[]},i,A,f,c)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,r,i=new d.default(e);if(i.hasTimeStamp)for(t=i.length,r=e.length;t<r-1;t++)if(255===e[t]&&240===(240&e[t+1]))return!0;return!1}}]),e}();r.default=f},{19:19,24:24,45:45}],19:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),o=e(26),s=function(){function e(){i(this,e)}return a(e,null,[{key:"getAudioConfig",value:function(e,t,r,i){var a,s,l,u,d,f=navigator.userAgent.toLowerCase(),c=i,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return a=((192&t[r+2])>>>6)+1,s=(60&t[r+2])>>>2,s>h.length-1?void e.trigger(Event.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s}):(u=(1&t[r+2])<<2,u|=(192&t[r+3])>>>6,n.logger.log("manifest codec:"+i+",ADTS data:type:"+a+",sampleingIndex:"+s+"["+h[s]+"Hz],channelConfig:"+u),/firefox/i.test(f)?s>=6?(a=5,d=new Array(4),l=s-3):(a=2,d=new Array(2),l=s):f.indexOf("android")!==-1?(a=2,d=new Array(2),l=s):(a=5,d=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&s>=6?l=s-3:((i&&i.indexOf("mp4a.40.2")!==-1&&s>=6&&1===u||!i&&1===u)&&(a=2,d=new Array(2)),l=s)),d[0]=a<<3,d[0]|=(14&s)>>1,d[1]|=(1&s)<<7,d[1]|=u<<3,5===a&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:h[s],channelCount:u,codec:"mp4a.40."+a,manifestCodec:c})}}]),e}();r.default=s},{26:26,45:45}],20:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(28),s=i(o),l=e(26),u=e(16),d=i(u),f=e(18),c=i(f),h=e(25),g=i(h),v=e(38),p=i(v),y=e(39),m=i(y),E=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a(this,e),this.hls=t,this.id=r,this.config=this.hls.config||n,this.typeSupported=i}return n(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,r,i,a,n,o,l,u,f,c){if(e.byteLength>0&&null!=u&&null!=u.key&&"AES-128"===u.method){null==this.decrypter&&(this.decrypter=new d.default(this.hls,this.config));var h,g=this;try{h=performance.now()}catch(e){h=Date.now()}this.decrypter.decrypt(e,u.key.buffer,u.iv.buffer,function(e){var u;try{u=performance.now()}catch(e){u=Date.now()}g.hls.trigger(s.default.FRAG_DECRYPTED,{level:n,sn:o,stats:{tstart:h,tdecrypt:u}}),g.pushDecrypted(new Uint8Array(e),t,r,i,a,n,o,l,f,c)})}else this.pushDecrypted(new Uint8Array(e),t,r,i,a,n,o,l,f,c)}},{key:"pushDecrypted",value:function(e,t,r,i,a,n,o,u,d,f){var h=this.demuxer;if(!h||a!==this.cc&&!h.probe(e)){var v=this.hls,y=this.id,E=this.config,b=this.typeSupported;if(g.default.probe(e))h=this.typeSupported.mp2t===!0?new g.default(v,y,m.default,E,b):new g.default(v,y,p.default,E,b),h.probe=g.default.probe;else{if(!c.default.probe(e))return void v.trigger(s.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,id:y,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});h=new c.default(v,y,p.default,E,b),h.probe=c.default.probe}this.demuxer=h}h.push(e,t,r,i,a,n,o,u,d,f),this.cc=a}}]),e}();r.default=E},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e(20),n=i(a),o=e(28),s=i(o),l=e(45),u=e(1),d=i(u),f=function(e){var t=new d.default;t.trigger=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.emit.apply(t,[e,e].concat(i))},t.off=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.removeListener.apply(t,[e].concat(i))};var r=function(t,r){e.postMessage({event:t,data:r})};e.addEventListener("message",function(i){var a=i.data;switch(a.cmd){case"init":var o=JSON.parse(a.config);e.demuxer=new n.default(t,a.id,a.typeSupported,o);try{(0,l.enableLogs)(o.debug===!0)}catch(e){console.warn("demuxerWorker: unable to enable logs")}r("init",null);break;case"demux":e.demuxer.push(a.data,a.audioCodec,a.videoCodec,a.timeOffset,a.cc,a.level,a.sn,a.duration,a.decryptdata,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(s.default.FRAG_DECRYPTED,r),t.on(s.default.FRAG_PARSING_INIT_SEGMENT,r),t.on(s.default.FRAG_PARSED,r),t.on(s.default.ERROR,r),t.on(s.default.FRAG_PARSING_METADATA,r),t.on(s.default.FRAG_PARSING_USERDATA,r),t.on(s.default.INIT_PTS_FOUND,r),t.on(s.default.FRAG_PARSING_DATA,function(t,r){var i=r.data1.buffer,a=r.data2.buffer;delete r.data1,delete r.data2,e.postMessage({event:t,data:r,data1:i,data2:a},[i,a])})};r.default=f},{1:1,20:20,28:28,45:45}],22:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(28),s=i(o),l=e(20),u=i(l),d=e(21),f=i(d),c=e(45),h=e(26),g=function(){function t(r,i){a(this,t),this.hls=r,this.id=i;var n={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:r.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(r.config.enableWorker&&"undefined"!=typeof Worker){c.logger.log("demuxing in webworker");var o=void 0;try{var l=e(3);o=this.w=l(f.default),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(e){r.trigger(s.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:n,id:i,config:JSON.stringify(r.config)})}catch(e){c.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&URL.revokeObjectURL(o.objectURL),this.demuxer=new u.default(r,i,n);
}}else this.demuxer=new u.default(r,i,n);this.demuxInitialized=!0}return n(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}}},{key:"push",value:function(e,t,r,i,a,n,o,s,l,u,d){var f=this.w;if(f)f.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:r,timeOffset:i,cc:a,level:n,sn:o,duration:s,decryptdata:l,accurateTimeOffset:u,defaultInitPTS:d},[e]);else{var c=this.demuxer;c&&c.push(e,t,r,i,a,n,o,s,l,u,d)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,r=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data.data2=new Uint8Array(t.data2);default:r.trigger(t.event,t.data)}}}]),t}();r.default=g},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),o=function(){function e(t){i(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return a(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");i.set(e.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,r,i=8,a=8;for(t=0;t<e;t++)0!==a&&(r=this.readEG(),a=(i+r+256)%256),i=0===a?i:a}},{key:"readSPS",value:function(){var e,t,r,i,a,n,o,s,l,u=0,d=0,f=0,c=0,h=this.readUByte.bind(this),g=this.readBits.bind(this),v=this.readUEG.bind(this),p=this.readBoolean.bind(this),y=this.skipBits.bind(this),m=this.skipEG.bind(this),E=this.skipUEG.bind(this),b=this.skipScalingList.bind(this);if(h(),e=h(),t=g(5),y(3),r=h(),E(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=v();if(3===_&&y(1),E(),E(),y(1),p())for(s=3!==_?8:12,l=0;l<s;l++)p()&&b(l<6?16:64)}E();var T=v();if(0===T)v();else if(1===T)for(y(1),m(),m(),i=v(),l=0;l<i;l++)m();E(),y(1),a=v(),n=v(),o=g(1),0===o&&y(1),y(1),p()&&(u=v(),d=v(),f=v(),c=v());var R=[1,1];if(p()&&p()){var k=h();switch(k){case 1:R=[1,1];break;case 2:R=[12,11];break;case 3:R=[10,11];break;case 4:R=[16,11];break;case 5:R=[40,33];break;case 6:R=[24,11];break;case 7:R=[20,11];break;case 8:R=[32,11];break;case 9:R=[80,33];break;case 10:R=[18,11];break;case 11:R=[15,11];break;case 12:R=[64,33];break;case 13:R=[160,99];break;case 14:R=[4,3];break;case 15:R=[3,2];break;case 16:R=[2,1];break;case 255:R=[h()<<8|h(),h()<<8|h()]}}return{width:Math.ceil(16*(a+1)-2*u-2*d),height:(2-o)*(n+1)*16-(o?2:4)*(f+c),pixelRatio:R}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();r.default=o},{45:45}],24:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),o=function(){function e(t){i(this,e),this._hasTimeStamp=!1;for(var r,a,o,s,l,u,d,f,c=0;;)if(d=this.readUTF(t,c,3),c+=3,"ID3"===d)c+=3,r=127&t[c++],a=127&t[c++],o=127&t[c++],s=127&t[c++],l=(r<<21)+(a<<14)+(o<<7)+s,u=c+l,this._parseID3Frames(t,c,u),c=u;else{if("3DI"!==d)return c-=3,f=c,void(f&&(this.hasTimeStamp||n.logger.warn("ID3 tag found, but no timestamp"),this._length=f,this._payload=t.subarray(0,f)));c+=7,n.logger.log("3DI footer found, end: "+c)}}return a(e,[{key:"readUTF",value:function(e,t,r){var i="",a=t,n=t+r;do i+=String.fromCharCode(e[a++]);while(a<n);return i}},{key:"_parseID3Frames",value:function(e,t,r){for(var i,a,o,s,l;t+8<=r;)switch(i=this.readUTF(e,t,4),t+=4,a=e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],s=e[t++]<<8+e[t++],o=t,i){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var u=1&e[t++];this._hasTimeStamp=!0,l=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,u&&(l+=47721858.84),l=Math.round(l),n.logger.trace("ID3 timestamp found: "+l),this._timeStamp=l}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();r.default=o},{45:45}],25:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(19),s=i(o),l=e(28),u=i(l),d=e(23),f=i(d),c=e(45),h=e(26),g=function(){function e(t,r,i,n,o){a(this,e),this.observer=t,this.id=r,this.remuxerClass=i,this.config=n,this.typeSupported=o,this.lastCC=0,this.remuxer=new this.remuxerClass(t,r,n,o)}return n(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,r,i,a,n,o,s,l,d){var f,g,v,p,y,m,E=e.length,b=this.remuxer.passthrough,_=!1;this.audioCodec=t,this.videoCodec=r,this._duration=s,this.contiguous=!1,this.accurateTimeOffset=l,a!==this.lastCC&&(c.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=a),n!==this.lastLevel?(c.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=n):o===this.lastSN+1&&(this.contiguous=!0),this.lastSN=o;var T=this.pmtParsed,R=this._avcTrack,k=this._audioTrack,A=this._id3Track,S=R.id,w=k.id,L=A.id,D=this._pmtId,O=R.pesData,I=k.pesData,C=A.pesData,P=this._parsePAT,x=this._parsePMT,M=this._parsePES,F=this._parseAVCPES.bind(this),N=this._parseAACPES.bind(this),U=this._parseMPEGPES.bind(this),G=this._parseID3PES.bind(this);for(E-=E%188,f=0;f<E;f+=188)if(71===e[f]){if(g=!!(64&e[f+1]),v=((31&e[f+1])<<8)+e[f+2],p=(48&e[f+3])>>4,p>1){if(y=f+5+e[f+4],y===f+188)continue}else y=f+4;switch(v){case S:if(g){if(O&&(m=M(O))&&(F(m,!1),b&&R.codec&&(w===-1||k.codec)))return void this.remux(n,o,a,e,i);O={data:[],size:0}}O&&(O.data.push(e.subarray(y,f+188)),O.size+=f+188-y);break;case w:if(g){if(I&&(m=M(I))&&(k.isAAC?N(m):U(m),b&&k.codec&&(S===-1||R.codec)))return void this.remux(n,o,a,e,i);I={data:[],size:0}}I&&(I.data.push(e.subarray(y,f+188)),I.size+=f+188-y);break;case L:g&&(C&&(m=M(C))&&G(m),C={data:[],size:0}),C&&(C.data.push(e.subarray(y,f+188)),C.size+=f+188-y);break;case 0:g&&(y+=e[y]+1),D=this._pmtId=P(e,y);break;case D:g&&(y+=e[y]+1);var B=x(e,y,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0);S=B.avc,S>0&&(R.id=S),w=B.audio,w>0&&(k.id=w,k.isAAC=B.isAAC),L=B.id3,L>0&&(A.id=L),_&&!T&&(c.logger.log("reparse from beginning"),_=!1,f=-188),T=this.pmtParsed=!0;break;case 17:case 8191:break;default:_=!0}}else this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});O&&(m=M(O))?(F(m,!0),R.pesData=null):R.pesData=O,I&&(m=M(I))?(k.isAAC?N(m):U(m),k.pesData=null):(I&&I.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),k.pesData=I),C&&(m=M(C))?(G(m),A.pesData=null):A.pesData=C,this.remux(n,o,a,null,i,d)}},{key:"remux",value:function(e,t,r,i,a,n){for(var o=this._avcTrack,s=o.samples,l=0,u=0,d=0;d<s.length;d++){for(var f=s[d],c=f.units.units,h=c.length,g=0,v=0;v<h;v++)g+=c[v].data.length;u+=g,l+=h,f.length=g}o.len=u,o.nbNalu=l,this.remuxer.remux(e,t,r,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,a,this.contiguous,this.accurateTimeOffset,n,i)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,r){var i,a,n,o,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=(15&e[t+1])<<8|e[t+2],a=t+3+i-4,n=(15&e[t+10])<<8|e[t+11],t+=12+n;t<a;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 15:s.audio===-1&&(s.audio=o);break;case 21:s.id3===-1&&(s.id3=o);break;case 27:s.avc===-1&&(s.avc=o);break;case 3:case 4:r?s.audio===-1&&(s.audio=o,s.isAAC=!1):c.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:c.logger.warn("HEVC stream type found, not supported for now");break;default:c.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}return s}},{key:"_parsePES",value:function(e){var t,r,i,a,n,o,s,l,u,d=0,f=e.data;if(!e||0===e.size)return null;for(;f[0].length<19&&f.length>1;){var h=new Uint8Array(f[0].length+f[1].length);h.set(f[0]),h.set(f[1],f[0].length),f[0]=h,f.splice(1,1)}if(t=f[0],i=(t[0]<<16)+(t[1]<<8)+t[2],1===i){if(a=(t[4]<<8)+t[5],a&&a>e.size-6)return null;r=t[7],192&r&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,s>4294967295&&(s-=8589934592),64&r?(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,l>4294967295&&(l-=8589934592),s-l>54e5&&(c.logger.warn(Math.round((s-l)/9e4)+"s delta between PTS and DTS, align them"),s=l)):l=s),n=t[8],u=n+9,e.size-=u,o=new Uint8Array(e.size);for(var g=0,v=f.length;g<v;g++){t=f[g];var p=t.byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}o.set(t,d),d+=p}return a&&(a-=n+3),{data:o,pts:s,dts:l,len:a}}return null}},{key:"pushAccesUnit",value:function(e,t){e.units.units.length&&e.frame&&(!this.config.forceKeyFrameOnDiscontinuity||e.key===!0||t.sps&&(t.samples.length||this.contiguous)?t.samples.push(e):t.dropped++),e.debug.length&&c.logger.log(e.pts+"/"+e.dts+":"+e.debug+","+e.units.length)}},{key:"_parseAVCPES",value:function(e,t){var r,i,a,n=this,o=this._avcTrack,s=this._parseAVCNALu(e.data),l=!1,u=this.avcSample;e.data=null,s.forEach(function(t){switch(t.type){case 1:i=!0,l&&u&&(u.debug+="NDR "),u.frame=!0;var s=t.data;if(s.length>4){var d=new f.default(s).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(u.key=!0)}break;case 5:i=!0,u||(u=n.avcSample=n._createAVCSample(!0,e.pts,e.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:i=!0,l&&u&&(u.debug+="SEI "),r=new f.default(n.discardEPB(t.data)),r.readUByte();for(var c=0,h=0,g=!1,v=0;!g&&r.bytesAvailable>1;){c=0;do v=r.readUByte(),c+=v;while(255===v);h=0;do v=r.readUByte(),h+=v;while(255===v);if(4===c&&0!==r.bytesAvailable){g=!0;var p=r.readUByte();if(181===p){var y=r.readUShort();if(49===y){var m=r.readUInt();if(1195456820===m){var E=r.readUByte();if(3===E){var b=r.readUByte(),_=r.readUByte(),T=31&b,R=[b,_];for(a=0;a<T;a++)R.push(r.readUByte()),R.push(r.readUByte()),R.push(r.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{type:3,pts:e.pts,bytes:R})}}}}}else if(h<r.bytesAvailable)for(a=0;a<h;a++)r.readUByte()}break;case 7:if(i=!0,l&&u&&(u.debug+="SPS "),!o.sps){r=new f.default(t.data);var k=r.readSPS();o.width=k.width,o.height=k.height,o.pixelRatio=k.pixelRatio,o.sps=[t.data],o.duration=n._duration;var A=t.data.subarray(1,4),S="avc1.";for(a=0;a<3;a++){var w=A[a].toString(16);w.length<2&&(w="0"+w),S+=w}o.codec=S}break;case 8:i=!0,l&&u&&(u.debug+="PPS "),o.pps||(o.pps=[t.data]);break;case 9:i=!1,u&&n.pushAccesUnit(u,o),u=n.avcSample=n._createAVCSample(!1,e.pts,e.dts,l?"AUD ":"");break;case 12:i=!1;break;default:i=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}if(u&&i){var L=u.units;L.units.push(t)}}),t&&u&&(this.pushAccesUnit(u,o),this.avcSample=null)}},{key:"_createAVCSample",value:function(e,t,r,i){return{key:e,pts:t,dts:r,units:{units:[],length:0},debug:i}}},{key:"_insertSampleInOrder",value:function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;i>=0;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.units.length){var r=this._avcTrack,i=r.samples;e=i[i.length-1]}if(e){var a=e.units.units;t=a[a.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t,r,i,a,n,o=0,s=e.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,f=[],c=-1;for(u===-1&&(c=0,n=31&e[0],u=0,o=1);o<s;)if(t=e[o++],u)if(1!==u)if(t)if(1===t){if(c>=0)i={data:e.subarray(c,o-u-1),type:n},f.push(i);else{var h=this._getLastNalUnit();if(h&&(d&&o<=4-d&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-d)),r=o-u-1,r>0)){var g=new Uint8Array(h.data.byteLength+r);g.set(h.data,0),g.set(e.subarray(0,r),h.data.byteLength),h.data=g}}o<s?(a=31&e[o],c=o,n=a,u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(c>=0&&u>=0&&(i={data:e.subarray(c,s),type:n,state:u},f.push(i)),0===f.length){var v=this._getLastNalUnit();if(v){var p=new Uint8Array(v.data.byteLength+e.byteLength);p.set(v.data,0),p.set(e,v.data.byteLength),v.data=p}}return l.naluState=u,f}},{key:"discardEPB",value:function(e){for(var t,r,i=e.byteLength,a=[],n=1;n<i-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;t=i-a.length,r=new Uint8Array(t);var o=0;for(n=0;n<t;o++,n++)o===a[0]&&(o++,a.shift()),r[n]=e[o];return r}},{key:"_parseAACPES",value:function(e){var t,r,i,a,n,o,l,d,f,g=this._audioTrack,v=e.data,p=e.pts,y=0,m=this.aacOverFlow,E=this.aacLastPTS;if(m){var b=new Uint8Array(m.byteLength+v.byteLength);b.set(m,0),b.set(v,m.byteLength),v=b}for(n=y,d=v.length;n<d-1&&(255!==v[n]||240!==(240&v[n+1]));n++);if(n){var _,T;if(n<d-1?(_="AAC PES did not start with ADTS header,offset:"+n,T=!1):(_="no ADTS header found in AAC PES",T=!0),c.logger.warn("parsing error:"+_),this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:T,reason:_}),T)return}if(!g.audiosamplerate){var R=this.audioCodec;t=s.default.getAudioConfig(this.observer,v,n,R),g.config=t.config,g.audiosamplerate=t.samplerate,g.channelCount=t.channelCount,g.codec=t.codec,g.manifestCodec=t.manifestCodec,g.duration=this._duration,c.logger.log("parsed codec:"+g.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)}if(a=0,i=9216e4/g.audiosamplerate,m&&E){var k=E+i;Math.abs(k-p)>1&&(c.logger.log("AAC: align PTS for overlapping frames by "+Math.round((k-p)/90)),p=k)}for(;n+5<d&&(o=1&v[n+1]?7:9,r=(3&v[n+3])<<11|v[n+4]<<3|(224&v[n+5])>>>5,r-=o,r>0&&n+o+r<=d);)for(l=p+a*i,f={unit:v.subarray(n+o,n+o+r),pts:l,dts:l},g.samples.push(f),g.len+=r,n+=r+o,a++;n<d-1&&(255!==v[n]||240!==(240&v[n+1]));n++);m=n<d?v.subarray(n,d):null,this.aacOverFlow=m,this.aacLastPTS=l}},{key:"_parseMPEGPES",value:function(e){for(var t,r=e.data,i=e.pts,a=r.length,n=0,o=0;o<a&&(t=this._parseMpeg(r,o,a,n++,i))>0;)o+=t}},{key:"_onMpegFrame",value:function(e,t,r,i,a,n){var o=1152/r*1e3,s=n+a*o,l=this._audioTrack;l.config=[],l.channelCount=i,l.audiosamplerate=r,l.duration=this._duration,l.samples.push({unit:e,pts:s,dts:s}),l.len+=e.length}},{key:"_onMpegNoise",value:function(e){c.logger.warn("mpeg audio has noise: "+e.length+" bytes")}},{key:"_parseMpeg",value:function(e,t,r,i,a){var n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(t+2>r)return-1;if(255===e[t]||224===(224&e[t+1])){if(t+24>r)return-1;var s=e[t+1]>>3&3,l=e[t+1]>>1&3,u=e[t+2]>>4&15,d=e[t+2]>>2&3,f=!!(2&e[t+2]);if(1!==s&&0!==u&&15!==u&&3!==d){var c=3===s?3-l:3===l?3:4,h=1e3*n[14*c+u-1],g=3===s?0:2===s?1:2,v=o[3*g+d],p=f?1:0,y=e[t+3]>>6===3?1:2,m=3===l?(3===s?12:6)*h/v+p<<2:(3===s?144:72)*h/v+p|0;return t+m>r?-1:(this._onMpegFrame&&this._onMpegFrame(e.subarray(t,t+m),h,v,y,i,a),m)}}for(var E=t+2;E<r;){if(255===e[E-1]&&224===(224&e[E]))return this._onMpegNoise&&this._onMpegNoise(e.subarray(t,E-1)),E-t-1;E++}return-1}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();r.default=g},{19:19,23:23,26:26,28:28,45:45}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},r.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(45),l=e(26),u=e(28),d=i(u),f=function(){function e(t){a(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return o(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var r=function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)};try{r.call(this,e,t).call()}catch(t){s.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(d.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();r.default=f},{26:26,28:28,45:45}],28:[function(e,t,r){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();r.default=n},{}],30:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"isBuffered",value:function(e,t){if(e)for(var r=e.buffered,i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0;return!1}},{key:"bufferInfo",value:function(e,t,r){if(e){var i,a=e.buffered,n=[];for(i=0;i<a.length;i++)n.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(n,t,r)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,r){var i,a,n,o,s,l=[];for(e.sort(function(e,t){var r=e.start-t.start;return r?r:t.end-e.end}),s=0;s<e.length;s++){var u=l.length;if(u){var d=l[u-1].end;e[s].start-d<r?e[s].end>d&&(l[u-1].end=e[s].end):l.push(e[s])}else l.push(e[s])}for(s=0,i=0,a=n=t;s<l.length;s++){var f=l[s].start,c=l[s].end;if(t+r>=f&&t<c)a=f,n=c,i=n-t;else if(t+r<f){o=f;break}}return{len:i,start:a,end:n,nextStart:o}}}]),e}();r.default=n},{}],31:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),o=function(){function e(){i(this,e)}return a(e,null,[{key:"mergeDetails",value:function(t,r){var i,a=Math.max(t.startSN,r.startSN)-r.startSN,o=Math.min(t.endSN,r.endSN)-r.startSN,s=r.startSN-t.startSN,l=t.fragments,u=r.fragments,d=0;if(o<a)return void(r.PTSKnown=!1);for(var f=a;f<=o;f++){var c=l[s+f],h=u[f];h&&c&&(d=c.cc-h.cc,isNaN(c.startPTS)||(h.start=h.startPTS=c.startPTS,h.endPTS=c.endPTS,h.duration=c.duration,i=h))}if(d)for(n.logger.log("discontinuity sliding from playlist, take drift into account"),f=0;f<u.length;f++)u[f].cc+=d;if(i)e.updateFragPTSDTS(r,i.sn,i.startPTS,i.endPTS,i.startDTS,i.endDTS);else if(s>=0&&s<l.length){var g=l[s].start;for(f=0;f<u.length;f++)u[f].start+=g}r.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,r,i,a,n,o){var s,l,u,d;if(!t||r<t.startSN||r>t.endSN)return 0;if(s=r-t.startSN,l=t.fragments,u=l[s],!isNaN(u.startPTS)){var f=Math.abs(u.startPTS-i);isNaN(u.deltaPTS)?u.deltaPTS=f:u.deltaPTS=Math.max(f,u.deltaPTS),i=Math.min(i,u.startPTS),a=Math.max(a,u.endPTS),n=Math.min(n,u.startDTS),o=Math.max(o,u.endDTS)}var c=i-u.start;for(u.start=u.startPTS=i,u.endPTS=a,u.startDTS=n,u.endDTS=o,u.duration=a-i,d=s;d>0;d--)e.updatePTS(l,d,d-1);for(d=s;d<l.length-1;d++)e.updatePTS(l,d,d+1);return t.PTSKnown=!0,c}},{key:"updatePTS",value:function(e,t,r){var i=e[t],a=e[r],o=a.startPTS;isNaN(o)?r>t?a.start=i.start+i.duration:a.start=i.start-a.duration:r>t?(i.duration=o-i.start,i.duration<0&&n.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-o,a.duration<0&&n.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();r.default=o},{45:45}],32:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(28),s=i(o),l=e(26),u=e(36),d=i(u),f=e(34),c=i(f),h=e(4),g=i(h),v=e(7),p=i(v),y=e(8),m=i(y),E=e(5),b=i(E),_=e(12),T=i(_),R=e(11),k=i(R),A=e(13),S=i(A),w=e(10),L=i(w),D=e(6),O=i(D),I=e(45),C=e(47),P=i(C),x=e(1),M=i(x),F=e(35),N=i(F),U=e(43),G=i(U),B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e);var r=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var i in r)i in t||(t[i]=r[i]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,I.enableLogs)(t.debug),this.config=t;var n=this.observer=new M.default;n.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.emit.apply(n,[e,e].concat(r))},n.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.removeListener.apply(n,[e].concat(r))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n),this.playlistLoader=new d.default(this),this.fragmentLoader=new c.default(this),this.levelController=new k.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new O.default(this),this.keyLoader=new N.default(this)}return n(e,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.20"}},{key:"Events",get:function(){return s.default}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,
maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:P.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:g.default,bufferController:p.default,capLevelController:m.default,fpsController:L.default,streamController:T.default,audioStreamController:b.default,timelineController:S.default,cueHandler:G.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),n(e,[{key:"destroy",value:function(){I.logger.log("destroy"),this.trigger(s.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){I.logger.log("attachMedia"),this.media=e,this.trigger(s.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){I.logger.log("detachMedia"),this.trigger(s.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){I.logger.log("loadSource:"+e),this.url=e,this.trigger(s.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;I.logger.log("startLoad("+e+")"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){I.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){I.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){I.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){I.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){I.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){I.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(e){I.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){I.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){I.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();r.default=B},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(e,t,r){"use strict";t.exports=e(32).default},{32:32}],34:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(26),h=e(45),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING));return r.loaders={},r}return o(t,e),s(t,[{key:"destroy",value:function(){var e=this.loaders;for(var t in e){var r=e[t];r&&r.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=this.hls.config;t.loaded=0,i&&(h.logger.warn("abort previous fragment loader for type:"+r),i.abort()),i=this.loaders[r]=t.loader="undefined"!=typeof a.fLoader?new a.fLoader(a):new a.loader(a);var n=void 0,o=void 0,s=void 0;n={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var l=t.byteRangeStartOffset,u=t.byteRangeEndOffset;isNaN(l)||isNaN(u)||(n.rangeStart=l,n.rangeEnd=u),o={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(n,o,s)}},{key:"loadsuccess",value:function(e,t,r){var i=e.data,a=r.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:a,stats:t})}},{key:"loaderror",value:function(e,t){var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e})}},{key:"loadtimeout",value:function(e,t){var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(e,t,r){var i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e})}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],35:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),c=e(26),h=e(45),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return o(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=t.decryptdata,n=a.uri;if(n!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;i&&(h.logger.warn("abort previous key loader for type:"+r),i.abort()),t.loader=this.loaders[r]=new o.loader(o),this.decrypturl=n,this.decryptkey=null;var s=void 0,l=void 0,d=void 0;s={url:n,frag:t,responseType:"arraybuffer"},l={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(s,l,d)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(u.default.KEY_LOADED,{frag:i})}},{key:"loaderror",value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})}},{key:"loadtimeout",value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],36:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(2),u=i(l),d=e(28),f=i(d),c=e(27),h=i(c),g=e(26),v=e(40),p=i(v),y=e(45),m=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,E=/#EXT-X-MEDIA:(.*)/g,b=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,_=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,T=function(){function e(){o(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return s(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=u.default.buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),e}(),R=function(){function e(){o(this,e),this._url=null,this._byteRange=null,this._decryptdata=null}return s(e,[{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&(r=new T,r.method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=u.default.buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r?r:0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),k=function(e){function t(e){o(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MANIFEST_LOADING,f.default.LEVEL_LOADING,f.default.AUDIO_TRACK_LOADING));return r.loaders={},r}return n(t,e),s(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},h.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(e,t){var r=this.loaders[t.type];if(r){var i=r.context;if(i&&i.url===e)return void y.logger.trace("playlist request ongoing");y.logger.warn("abort previous loader for type:"+t.type),r.abort()}var a=this.hls.config,n=void 0,o=void 0,s=void 0,l=void 0;"manifest"===t.type?(n=a.manifestLoadingMaxRetry,o=a.manifestLoadingTimeOut,s=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout):(n=a.levelLoadingMaxRetry,o=a.levelLoadingTimeOut,s=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout,y.logger.log("loading playlist for "+t.type+" "+(t.level||t.id))),r=this.loaders[t.type]=t.loader="undefined"!=typeof a.pLoader?new a.pLoader(a):new a.loader(a),t.url=e,t.responseType="";var u=void 0,d=void 0;u={timeout:o,maxRetry:n,retryDelay:s,maxRetryDelay:l},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.load(t,u,d)}},{key:"resolve",value:function(e,t){return u.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){var r=[],i=void 0;for(m.lastIndex=0;null!=(i=m.exec(e));){var a={},n=a.attrs=new p.default(i[1]);a.url=this.resolve(i[2],t);var o=n.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),a.name=n.NAME;var s=n.CODECS;if(s){s=s.split(/[ ,]+/);for(var l=0;l<s.length;l++){var u=s[l];u.indexOf("avc1")!==-1?a.videoCodec=this.avc1toavcoti(u):a.audioCodec=u}}r.push(a)}return r}},{key:"parseMasterPlaylistMedia",value:function(e,t,r){var i=void 0,a=[];for(E.lastIndex=0;null!=(i=E.exec(e));){var n={},o=new p.default(i[1]);o.TYPE===r&&(n.groupId=o["GROUP-ID"],n.name=o.NAME,n.type=r,n.default="YES"===o.DEFAULT,n.autoselect="YES"===o.AUTOSELECT,n.forced="YES"===o.FORCED,o.URI&&(n.url=this.resolve(o.URI,t)),n.lang=o.LANGUAGE,n.name||(n.name=n.lang),a.push(n))}return a}},{key:"avc1toavcoti",value:function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseLevelPlaylist",value:function(e,t,r,i){var a,n,o=0,s=0,l={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},u=new T,d=0,f=null,c=new R;for(c.tagList=[],b.lastIndex=0;null!==(a=b.exec(e));){var h=a[1];if(h){c.duration=parseFloat(h);var g=(" "+a[2]).slice(1);c.title=g?g:null,c.tagList.push(g?["INF",h,g]:["INF",h])}else if(a[3]){if(!isNaN(c.duration)){var v=o++;c.type=i,c.start=s,c.levelkey=u,c.sn=v,c.level=r,c.cc=d,c.baseurl=t,c.relurl=(" "+a[3]).slice(1),l.fragments.push(c),f=c,s+=c.duration,c=new R,c.tagList=[]}}else if(a[4]){if(c.rawByteRange=(" "+a[4]).slice(1),f){var m=f.byteRangeEndOffset;m&&(c.lastByteRangeEndOffset=m)}}else if(a[5])c.rawProgramDateTime=(" "+a[5]).slice(1),c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]);else{for(a=a[0].match(_),n=1;n<a.length&&void 0===a[n];n++);var E=(" "+a[n+1]).slice(1),k=(" "+a[n+2]).slice(1);switch(a[n]){case"#":c.tagList.push(k?[E,k]:[E]);break;case"PLAYLIST-TYPE":l.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(E);break;case"TARGETDURATION":l.targetduration=parseFloat(E);break;case"VERSION":l.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,c.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(E);break;case"KEY":var A=E,S=new p.default(A),w=S.enumeratedString("METHOD"),L=S.URI,D=S.hexadecimalInteger("IV");w&&(u=new T,L&&"AES-128"===w&&(u.method=w,u.baseuri=t,u.reluri=L,u.key=null,u.iv=D));break;case"START":var O=E,I=new p.default(O),C=I.decimalFloatingPoint("TIME-OFFSET");isNaN(C)||(l.startTimeOffset=C);break;default:y.logger.warn("line parsed but not handled: "+a)}}}return c=f,c&&!c.relurl&&(l.fragments.pop(),s-=c.duration),l.totalduration=s,l.averagetargetduration=s/l.fragments.length,l.endSN=o-1,l}},{key:"loadsuccess",value:function(e,t,r){var i=e.data,a=e.url,n=r.type,o=r.id,s=r.level,l=this.hls;if(this.loaders[n]=void 0,void 0!==a&&0!==a.indexOf("data:")||(a=r.url),t.tload=performance.now(),0===i.indexOf("#EXTM3U"))if(i.indexOf("#EXTINF:")>0){var u="audioTrack"!==n,d=this.parseLevelPlaylist(i,a,(u?s:o)||0,u?"main":"audio");"manifest"===n&&l.trigger(f.default.MANIFEST_LOADED,{levels:[{url:a,details:d}],audioTracks:[],url:a,stats:t}),t.tparsed=performance.now(),d.targetduration?u?l.trigger(f.default.LEVEL_LOADED,{details:d,level:s||0,id:o||0,stats:t}):l.trigger(f.default.AUDIO_TRACK_LOADED,{details:d,id:o,stats:t}):l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"invalid targetduration"})}else{var c=this.parseMasterPlaylist(i,a);if(c.length){var h=this.parseMasterPlaylistMedia(i,a,"AUDIO");if(h.length){var v=!1;h.forEach(function(e){e.url||(v=!0)}),v===!1&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(y.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main"}))}l.trigger(f.default.MANIFEST_LOADED,{levels:c,audioTracks:h,url:a,stats:t})}else l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no level found in manifest"})}else l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e,t){var r,i,a=t.loader;switch(t.type){case"manifest":r=g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case"level":r=g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":r=g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,response:e,context:t})}},{key:"loadtimeout",value:function(e,t){var r,i,a=t.loader;switch(t.type){case"manifest":r=g.ErrorDetails.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":r=g.ErrorDetails.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":r=g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,context:t})}}]),t}(h.default);r.default=k},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=n,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,o,l,o,s),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,a))}},{key:"box",value:function(e){for(var t,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for(t=new Uint8Array(i),t[0]=i>>24&255,t[1]=i>>16&255,t[2]=i>>8&255,t[3]=255&i,t.set(e,4),a=0,i=8;a<n;a++)t.set(r[a],i),i+=r[a].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){return r*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))}},{key:"moov",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,r){r*=t;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)}},{key:"sdtp",value:function(t){var r,i,a=t.samples||[],n=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)r=a[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,n)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,i,a,n=[],o=[];for(r=0;r<t.sps.length;r++)i=t.sps[r],a=i.byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)i=t.pps[r],a=i.byteLength,o.push(a>>>8&255),o.push(255&a),o=o.concat(Array.prototype.slice.call(i));var s=e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(o))),l=t.width,u=t.height,d=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var r=t.audiosamplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,n=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))}},{key:"traf",value:function(t,r){var i=e.sdtp(t),a=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.trun(t,i.length+16+16+8+16+8+8),i)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var i,a,n,o,s,l,u=t.samples||[],d=u.length,f=12+16*d,c=new Uint8Array(f);for(r+=8+f,c.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)a=u[i],n=a.duration,o=a.size,s=a.flags,l=a.cts,c.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,c)}},{key:"initSegment",value:function(t){e.types||e.init();var r,i=e.moov(t);return r=new Uint8Array(e.FTYP.byteLength+i.byteLength),r.set(e.FTYP),r.set(i,e.FTYP.byteLength),r}}]),e}();r.default=n},{}],38:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(29),s=i(o),l=e(28),u=i(l),d=e(45),f=e(37),c=i(f),h=e(26),g=function(){function e(t,r,i,n){a(this,e),this.observer=t,this.id=r,this.config=i,this.typeSupported=n,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,i,a,n,o,s,l,d,f){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(i,a,s,r),null!==f&&(this._initPTS=this._initDTS=f),this.ISGenerated)if(i.samples.length){var c=this.remuxAudio(i,s,l,d);if(a.samples.length){var h=void 0;c&&(h=c.endPTS-c.startPTS),this.remuxVideo(a,s,l,h)}}else{var g=void 0;a.samples.length&&(g=this.remuxVideo(a,s,l)),g&&i.codec&&this.remuxEmptyAudio(i,s,l,g)}n.samples.length&&this.remuxID3(n,s),o.samples.length&&this.remuxText(o,s),this.observer.trigger(u.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,r,i){var a,n,o=this.observer,s=e.samples,l=t.samples,f=this.PES_TIMESCALE,g=this.typeSupported,v="audio/mp4",p={},y={id:this.id,level:this.level,sn:this.sn,tracks:p,unique:!1},m=void 0===this._initPTS;m&&(a=n=1/0),e.config&&s.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&!function(){var t=function e(t,r){return r?e(r,t%r):t};e.timescale=e.audiosamplerate/t(e.audiosamplerate,e.isAAC?1024:1152)}(),d.logger.log("audio mp4 timescale :"+e.timescale),e.isAAC||(g.mpeg?(v="audio/mpeg",e.codec=""):g.mp3&&(e.codec="mp3")),p.audio={container:v,codec:e.codec,initSegment:!e.isAAC&&g.mpeg?new Uint8Array:c.default.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(a=n=s[0].pts-f*r)),t.sps&&t.pps&&l.length&&(t.timescale=this.MP4_TIMESCALE,p.video={container:"video/mp4",codec:t.codec,initSegment:c.default.initSegment([t]),metadata:{width:t.width,height:t.height}},m&&(a=Math.min(a,l[0].pts-f*r),n=Math.min(n,l[0].dts-f*r),this.observer.trigger(u.default.INIT_PTS_FOUND,{id:this.id,initPTS:a,cc:i}))),Object.keys(p).length?(o.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,y),this.ISGenerated=!0,m&&(this._initPTS=a,this._initDTS=n)):o.trigger(u.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,id:this.id,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,r,i){var a,n,o,s,l,f,g,v,p=8,y=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,E=e.samples,b=[],_=E.length,T=this._PTSNormalize,R=this._initDTS;E.sort(function(e,t){var r=e.dts-t.dts;return r?r:e.pts-t.pts});var k=E.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(k<0){d.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(k/90)+" ms to overcome this issue");for(var A=0;A<E.length;A++)E[A].dts+=k}var S=void 0;S=r?this.nextAvcDts:t*y;var w=E[0];l=Math.max(T(w.dts-R,S),0),s=Math.max(T(w.pts-R,S),0);var L=Math.round((l-S)/90);r&&L&&(L>1?d.logger.log("AVC:"+L+" ms hole between fragments detected,filling it"):L<-1&&d.logger.log("AVC:"+-L+" ms overlapping between fragments detected"),l=S,E[0].dts=l+R,s=Math.max(s-L,S),E[0].pts=s+R,d.logger.log("Video/PTS/DTS adjusted: "+Math.round(s/90)+"/"+Math.round(l/90)+",delta:"+L+" ms")),f=l,w=E[E.length-1],v=Math.max(T(w.dts-R,S),0),
g=Math.max(T(w.pts-R,S),0),g=Math.max(g,v);var D=navigator.vendor,O=navigator.userAgent,I=D&&D.indexOf("Apple")>-1&&O&&!O.match("CriOS");I&&(a=Math.round((v-l)/(m*(E.length-1))));for(var C=0;C<_;C++){var P=E[C];I?P.dts=l+C*m*a:(P.dts=Math.max(T(P.dts-R,S),l),P.dts=Math.round(P.dts/m)*m),P.pts=Math.max(T(P.pts-R,S),P.dts),P.pts=Math.round(P.pts/m)*m}var x=e.len+4*e.nbNalu+8;try{n=new Uint8Array(x)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:x,reason:"fail allocating video mdat "+x})}var M=new DataView(n.buffer);M.setUint32(0,x),n.set(c.default.types.mdat,4);for(var F=0;F<_;F++){for(var N=E[F],U=N.units.units,G=0,B=void 0,j=0,H=U.length;j<H;j++){var W=U[j],K=W.data,V=W.data.byteLength;M.setUint32(p,V),p+=4,n.set(K,p),p+=V,G+=4+V}if(I)B=Math.max(0,a*Math.round((N.pts-N.dts)/(m*a)));else{if(F<_-1)a=E[F+1].dts-N.dts;else{var Y=this.config,q=N.dts-E[F>0?F-1:F].dts;if(Y.stretchShortVideoTrack){var X=Y.maxBufferHole,z=Y.maxSeekHole,J=Math.floor(Math.min(X,z)*y),Q=(i?s+i*y:this.nextAudioPts)-N.pts;Q>J?(a=Q-q,a<0&&(a=q),d.logger.log("It is approximately "+Q/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=q}else a=q}a/=m,B=Math.round((N.pts-N.dts)/m)}b.push({size:G,duration:a,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:N.key?2:1,isNonSync:N.key?0:1}})}this.nextAvcDts=v+a*m;var $=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,b.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Z=b[0].flags;Z.dependsOn=2,Z.isNonSync=0}e.samples=b,o=c.default.moof(e.sequenceNumber++,l/m,e),e.samples=[];var ee={id:this.id,level:this.level,sn:this.sn,data1:o,data2:n,startPTS:s/y,endPTS:(g+m*a)/y,startDTS:l/y,endDTS:this.nextAvcDts/y,type:"video",nb:b.length,dropped:$};return this.observer.trigger(u.default.FRAG_PARSING_DATA,ee),ee}},{key:"remuxAudio",value:function(e,t,r,i){var a,n,o,l,f,g,v,p,y,m,E,b,_,T,R,k,A=this.PES_TIMESCALE,S=e.timescale,w=A/S,L=e.timescale*(e.isAAC?1024:1152)/e.audiosamplerate,D=L*w,O=this._PTSNormalize,I=this._initDTS,C=!e.isAAC&&this.typeSupported.mpeg,P=C?0:8,x=[],M=[];if(e.samples.sort(function(e,t){return e.pts-t.pts}),M=e.samples,k=this.nextAudioPts,r|=M.length&&k&&(Math.abs(t-k/A)<.1||Math.abs(M[0].pts-k-this._initDTS)<20*D),r||(k=t*A),i&&e.isAAC)for(var F=0,N=k;F<M.length;){var U=M[F],G=O(U.pts-I,k),B=G-N;if(B<=-D)d.logger.warn("Dropping 1 audio frame @ "+Math.round(N/90)/1e3+"s due to "+Math.round(Math.abs(B/90))+" ms overlap."),M.splice(F,1),e.len-=U.unit.length;else if(B>=D&&N){var j=Math.round(B/D);d.logger.warn("Injecting "+j+" audio frame @ "+Math.round(N/90)/1e3+"s due to "+Math.round(B/90)+" ms gap.");for(var H=0;H<j;H++)R=N+I,R=Math.max(R,I),T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(d.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),T=U.unit.subarray()),M.splice(F,0,{unit:T,pts:R,dts:R}),e.len+=T.length,N+=D,F+=1;U.pts=U.dts=N+I,N+=D,F+=1}else Math.abs(B)>.1*D,N+=D,0===F?U.pts=U.dts=I+k:U.pts=U.dts=M[F-1].pts+D,F+=1}for(var W=0,K=M.length;W<K;W++){if(n=M[W],l=n.unit,m=n.pts-I,E=n.dts-I,void 0!==y)b=O(m,y),_=O(E,y),o.duration=Math.round((_-y)/w);else{b=O(m,k),_=O(E,k);var V=Math.round(1e3*(b-k)/A),Y=0;if(r&&e.isAAC&&V){if(V>0)Y=Math.round((b-k)/D),d.logger.log(V+" ms hole between AAC samples detected,filling it"),Y>0&&(T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(T=l.subarray()),e.len+=Y*T.length);else if(V<-12){d.logger.log(-V+" ms overlapping between AAC samples detected, drop frame"),e.len-=l.byteLength;continue}b=_=k}if(v=Math.max(0,b),p=Math.max(0,_),!(e.len>0))return;var q=C?e.len:e.len+8;try{f=new Uint8Array(q)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:h.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:q,reason:"fail allocating audio mdat "+q})}C||(a=new DataView(f.buffer),a.setUint32(0,q),f.set(c.default.types.mdat,4));for(var X=0;X<Y;X++)R=b-(Y-X)*D,T=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),T||(d.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),T=l.subarray()),f.set(T,P),P+=T.byteLength,o={size:T.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},x.push(o)}f.set(l,P);var z=l.byteLength;P+=z,o={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},x.push(o),y=_}var J=0,Q=x.length;if(Q>=2&&(J=x[Q-2].duration,o.duration=J),Q){this.nextAudioPts=b+w*J,e.len=0,e.samples=x,g=C?new Uint8Array:c.default.moof(e.sequenceNumber++,p/w,e),e.samples=[];var $={id:this.id,level:this.level,sn:this.sn,data1:g,data2:f,startPTS:v/A,endPTS:this.nextAudioPts/A,startDTS:p/A,endDTS:(_+w*J)/A,type:"audio",nb:Q};return this.observer.trigger(u.default.FRAG_PARSING_DATA,$),$}return null}},{key:"remuxEmptyAudio",value:function(e,t,r,i){var a=this.PES_TIMESCALE,n=e.timescale?e.timescale:e.audiosamplerate,o=a/n,l=this.nextAudioPts,u=(void 0!==l?l:i.startDTS*a)+this._initDTS,f=i.endDTS*a+this._initDTS,c=1024,h=o*c,g=Math.ceil((f-u)/h),v=s.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(d.logger.warn("remux empty Audio"),!v)return void d.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],y=0;y<g;y++){var m=u+y*h;p.push({unit:v,pts:m,dts:m}),e.len+=v.length}e.samples=p,this.remuxAudio(e,t,r)}},{key:"remuxID3",value:function(e,t){var r,i=e.samples.length;if(i){for(var a=0;a<i;a++)r=e.samples[a],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE,r.dts=(r.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var r,i=e.samples.length;if(i){for(var a=0;a<i;a++)r=e.samples[a],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}},{key:"passthrough",get:function(){return!1}}]),e}();r.default=g},{26:26,28:28,29:29,37:37,45:45}],39:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(28),s=i(o),l=function(){function e(t,r){a(this,e),this.observer=t,this.id=r,this.ISGenerated=!1}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,i,a,n){var o=this.observer;if(!this.ISGenerated){var l={},u={id:this.id,tracks:l,unique:!0},d=t,f=d.codec;f&&(u.tracks.video={container:d.container,codec:f,metadata:{width:d.width,height:d.height}}),d=e,f=d.codec,f&&(u.tracks.audio={container:d.container,codec:f,metadata:{channelCount:d.channelCount}}),this.ISGenerated=!0,o.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,u)}o.trigger(s.default.FRAG_PARSING_DATA,{id:this.id,data1:n,startPTS:a,startDTS:a,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();r.default=l},{28:28}],40:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){i(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r])}return a(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=n.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,r={};for(o.lastIndex=0;null!==(t=o.exec(e));){var i=t[2],a='"';0===i.indexOf(a)&&i.lastIndexOf(a)===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r}}]),e}();r.default=s},{}],41:[function(e,t,r){"use strict";var i={search:function(e,t){for(var r=0,i=e.length-1,a=null,n=null;r<=i;){a=(r+i)/2|0,n=e[a];var o=t(n);if(o>0)r=a+1;else{if(!(o<0))return n;i=a-1}}return null}};t.exports=i},{}],42:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(e){var t=e;return n.hasOwnProperty(e)&&(t=n[e]),String.fromCharCode(t)},s=15,l=32,u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},d={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},c={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var r=this.verboseFilter[e];this.verboseLevel>=r&&console.log(this.time+" ["+e+"] "+t)}},v=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},p=function(){function e(t,r,a,n,o){i(this,e),this.foreground=t||"white",this.underline=r||!1,this.italics=a||!1,this.background=n||"black",this.flash=o||!1}return a(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),y=function(){function e(t,r,a,n,o,s){i(this,e),this.uchar=t||" ",this.penState=new p(r,a,n,o,s)}return a(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),m=function(){function e(){i(this,e),this.chars=[];for(var t=0;t<l;t++)this.chars.push(new y);this.pos=0,this.currPenState=new p}return a(e,[{key:"equals",value:function(e){for(var t=!0,r=0;r<l;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<l;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<l;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(g.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(g.log("ERROR","Too large cursor position "+this.pos),this.pos=l)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=o(e);return this.pos>=l?void g.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<l;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,r=0;r<l;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)}}]),e}(),E=function(){function e(){i(this,e),this.rows=[];for(var t=0;t<s;t++)this.rows.push(new m);this.currRow=s-1,this.nrRollUpRows=null,this.reset()}return a(e,[{key:"reset",value:function(){for(var e=0;e<s;e++)this.rows[e].clear();this.currRow=s-1}},{key:"equals",value:function(e){for(var t=!0,r=0;r<s;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<s;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<s;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){var e=this.rows[this.currRow];e.backSpace()}},{key:"clearToEndOfRow",value:function(){var e=this.rows[this.currRow];e.clearToEndOfRow()}},{key:"insertChar",value:function(e){var t=this.rows[this.currRow];t.insertChar(e)}},{key:"setPen",value:function(e){var t=this.rows[this.currRow];t.setPenStyles(e)}},{key:"moveCursor",value:function(e){var t=this.rows[this.currRow];t.moveCursor(e)}},{key:"setCursor",value:function(e){g.log("INFO","setCursor: "+e);var t=this.rows[this.currRow];t.setCursor(e)}},{key:"setPAC",value:function(e,t){g.log("INFO","pacData = "+JSON.stringify(e));var r=e.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1&&(r=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==r){for(var i=0;i<s;i++)this.rows[i].clear();var a=this.currRow+1-this.nrRollUpRows,n=t.rows[a].cueStartTime;if(n&&n<g.time)for(i=0;i<this.nrRollUpRows;i++)this.rows[r-this.nrRollUpRows+i+1].copy(t.rows[a+i])}this.currRow=r;var o=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,u=Math.max(l-1,0);o.setCursor(e.indent),e.color=o.chars[u].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)}},{key:"setBkgData",value:function(e){g.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void g.log("DEBUG","roll_up but nrRollUpRows not set yet");g.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),g.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<s;a++){var n=this.rows[a].getTextString();n&&(i=a+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),b=function(){function e(t,r){i(this,e),this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new E,this.nonDisplayedMemory=new E,this.lastOutputScreen=new E,this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[s-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e,this.lastOutputScreen)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,g.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";g.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(g.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){g.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){g.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){g.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){g.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){g.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){g.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){g.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){g.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){g.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){g.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){g.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(g.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,g.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){g.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}g.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=g.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),_=function(){function e(t,r,a){i(this,e),this.field=t||1,this.outputs=[r,a],this.channels=[new b(1,r),new b(2,a)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return a(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var r,i,a,n=!1;this.lastTime=e,g.setTime(e);for(var o=0;o<t.length;o+=2)if(i=127&t[o],a=127&t[o+1],0!==i||0!==a){if(g.log("DATA","["+v([t[o],t[o+1]])+"] -> ("+v([i,a])+")"),r=this.parseCmd(i,a),r||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(n=this.parseChars(i,a)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(n)}else g.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,g.log("WARNING","Couldn't parse cleaned data "+v([i,a])+" orig: "+v([t[o],t[o+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var r=null,i=(20===e||28===e)&&32<=t&&t<=47,a=(23===e||31===e)&&33<=t&&t<=35;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,g.log("DEBUG","Repeated command ("+v([e,t])+") is dropped"),!0;r=20===e||23===e?1:2;var n=this.channels[r-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0}},{key:"parseMidrow",value:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if(r=17===e?1:2,r!==this.currChNr)return g.log("ERROR","Mismatch channel in midrow parsing"),!1;var i=this.channels[r-1];return i.ccMIDROW(t),g.log("DEBUG","MIDROW ("+v([e,t])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var r=null,i=null,a=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,n=(16===e||24===e)&&64<=t&&t<=95;if(!a&&!n)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=e<=23?1:2,i=64<=t&&t<=95?1===r?u[e]:f[e]:1===r?d[e]:c[e];var o=this.interpretPAC(i,t),s=this.channels[r-1];return s.setPAC(o),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0}},{key:"interpretPAC",value:function(e,t){var r=t,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1===(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}},{key:"parseChars",value:function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),17<=a&&a<=19){var n=t;n=17===a?t+80:18===a?t+112:t+144,g.log("INFO","Special char '"+o(n)+"' in channel "+r),i=[n]}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t]);if(i){var s=v(i);g.log("DEBUG","Char codes =  "+s.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i}},{key:"parseBackgroundAttributes",value:function(e,t){var r,i,a,n,o=(16===e||24===e)&&32<=t&&t<=47,s=(23===e||31===e)&&45<=t&&t<=47;return!(!o&&!s)&&(r={},16===e||24===e?(i=Math.floor((t-32)/2),r.background=h[i],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),a=e<24?1:2,n=this.channels[a-1],n.setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();r.default=_},{}],43:[function(e,t,r){"use strict";var i={newCue:function(e,t,r,i){for(var a,n,o,s,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(a=i.rows[d],o=!0,s=0,l="",!a.isEmpty()){for(var f=0;f<a.chars.length;f++)a.chars[f].uchar.match(/\s/)&&o?s++:(l+=a.chars[f].uchar,o=!1);a.cueStartTime=t,n=new u(t,r,l.trim()),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=d>7?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,100*(s/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(n)}}};t.exports=i},{}],44:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){i(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return a(e,[{key:"sample",value:function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();r.default=n},{}],45:[function(e,t,r){"use strict";function i(){}function a(e,t){return t="["+e+"] > "+t}function n(e){var t=self.console[e];return t?function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=a(e,i[0])),t.apply(self.console,i)}:i}function o(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(t){u[t]=e[t]?e[t].bind(e):n(t)})}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l={trace:i,debug:i,log:i,warn:i,info:i,error:i},u=l;r.enableLogs=function(e){if(e===!0||"object"===("undefined"==typeof e?"undefined":s(e))){o(e,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},r.logger=u},{}],46:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"toString",value:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]";return t}}]),e}();r.default=n},{}],47:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),o=function(){function e(t){i(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return a(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var r=this.stats;r.tfirst=0,r.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,r=t.readyState,i=this.stats,a=this.context,o=this.config;if(!i.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===r){var s=t.status;if(s>=200&&s<300){i.tload=Math.max(i.tfirst,performance.now());var l=void 0,u=void 0;"arraybuffer"===a.responseType?(l=t.response,u=l.byteLength):(l=t.responseText,u=l.length),i.loaded=i.total=u;var d={url:t.responseURL,data:l};this.callbacks.onSuccess(d,i,a)}else i.retry>=o.maxRetry||s>=400&&s<499?(n.logger.error(s+" while loading "+a.url),this.callbacks.onError({code:s,text:t.statusText},a)):(n.logger.warn(s+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)}},{key:"loadtimeout",value:function(){n.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var r=this.callbacks.onProgress;r&&r(t,this.context,null)}}]),e}();r.default=o},{45:45}]},{},[33])(33)})},function(e,t){"use strict";function r(e,t,r){function i(e,t){u.foreach(e,function(e,r){t.addEventListener(e,r,!1)})}function a(e,t){u.foreach(e,function(e,r){t.removeEventListener(e,r,!1)})}function n(e){
if("hls"===e.type)if(e.androidhls!==!1){var t=u.isAndroidNative;if(t(2)||t(3)||t("4.0"))return!1;if(u.isAndroid())return!0}else if(u.isAndroid())return!1;return null}function o(t,o){function k(){Te(Qe.videoTracks),ve(Qe.audioTracks),Ee(Qe.textTracks)}function A(e){Ie.trigger("click",e)}function S(){Ne&&!Ge&&(C(I()),D(ne(),we,Se))}function w(){Ne&&D(ne(),we,Se)}function L(){g(Me),Pe=!0,Ne&&(Ie.state===c.STALLED?Ie.setState(c.PLAYING):Ie.state===c.PLAYING&&(Me=setTimeout(ae,v)),Ge&&Xe&&0===Qe.currentTime||(C(I()),O(Qe.currentTime),D(ne(),we,Se),Ie.state===c.PLAYING&&Ie.trigger(f.JWPLAYER_MEDIA_TIME,{position:we,duration:Se})))}function D(e,t,r){e===Fe&&r===Se||(Fe=e,Ie.trigger(f.JWPLAYER_MEDIA_BUFFER,{bufferPercent:100*e,position:t,duration:r}))}function O(e){Le=e,Se<0&&(e=-(te()-e)),we=e}function I(){var e=Qe.duration,t=te();if(Xe&&t){var r=t-Qe.seekable.start(0);e=!s&&r!==1/0&&r>120?-r:1/0}return e}function C(e){Se=e,xe&&e&&e!==1/0&&Ie.seek(xe)}function P(){var e=I();Ge&&Xe&&(e=0),Ie.trigger(f.JWPLAYER_MEDIA_META,{duration:e,height:Qe.videoHeight,width:Qe.videoWidth}),C(e)}function x(){Ne&&(Pe=!0,F())}function M(){Ne&&(Qe.muted&&(Qe.muted=!1,Qe.muted=!0),P())}function F(){De||(De=!0,Ie.trigger(f.JWPLAYER_MEDIA_BUFFER_FULL))}function N(){Ie.setState(c.PLAYING),Ie.trigger(f.JWPLAYER_PROVIDER_FIRST_FRAME,{})}function U(){Ie.state!==c.COMPLETE&&Qe.currentTime!==Qe.duration&&Ie.setState(c.PAUSED)}function G(){Ge||Qe.paused||Qe.ended||Ie.state!==c.LOADING&&Ie.state!==c.ERROR&&(Ie.seeking||Ie.setState(c.STALLED))}function B(e){if(Ne){var t=e.currentTarget.error;t.code===t.MEDIA_ERR_DECODE?$e():H()}}function j(){var e=null,t=null;return function(){var r=Date.now();!e||r-e>2e3?(e=r,qe.recoverMediaError()):!t||r-t>2e3?(t=r,qe.swapAudioCodec(),qe.recoverMediaError()):H()}}function H(){u.log("Error playing media: %o %s",Qe.error,Qe.src||Ae.file),Ie.trigger(f.JWPLAYER_MEDIA_ERROR,{message:"Error loading media: File could not be played"})}function W(e){var t;return"array"===u.typeOf(e)&&e.length>0&&(t=l.map(e,function(e,t){return{label:e.label||t}})),t}function K(e){Oe=e,Ue=V(e);var t=W(e);t&&Ie.trigger(f.JWPLAYER_MEDIA_LEVELS,{levels:t,currentQuality:Ue})}function V(){var e=Math.max(0,Ue);return e}function Y(e){var t=e.map(function(e){var t={};if(e.bitrate&&(t.label=Math.round(e.bitrate/1e3)+" kbps"),e.width&&(t.label=e.width+"px"),e.height&&(t.label=e.height+"p"),e.name&&(t.label=e.name),o.hlslabels&&e.bitrate){var r=e.bitrate/1e3;o.hlslabels[r]&&(t.label=o.hlslabels[r])}return t});return t.length>1&&t.unshift({label:"Auto"}),t}function q(){return ze||(m||E)&&Qe.ended}function X(e,t){Ae=Oe[Ue],xe=0,g(Me);var r=document.createElement("source");r.src=Ae.file;var i=J()!==r.src;i||q()?(ze=!1,Se=t,z(),qe.loadSource(Ae.file)):(0===e&&0!==Qe.currentTime&&(xe=-1,Ie.seek(e)),Qe.play()),we=Le=Qe.currentTime,m&&(F(),Qe.paused||Ie.state===c.PLAYING||Ie.setState(c.LOADING)),u.isIOS()&&Ie.getFullScreen()&&(Qe.controls=!0),e>0&&Ie.seek(e)}function z(e){He=null,We=null,Ve=-1,Ke=-1,Ye=-1,Pe=!1,De=!1,Ge=n(Ae),Ae.preload&&Qe.setAttribute("preload",Ae.preload),u.isIOS()&&e&&$(e.tracks);var t=document.createElement("source");t.src=Ae.file,Qe.setAttribute("data-src",t.src)}function J(){return Qe.getAttribute("data-src")}function Q(){Qe&&(Qe.removeAttribute("src"),Qe.removeAttribute("data-src"),!y&&Qe.load&&Qe.load())}function $(e){for(;Qe.firstChild;)Qe.removeChild(Qe.firstChild);Z(e)}function Z(e){if(e){Qe.setAttribute("crossorigin","anonymous");for(var t=0;t<e.length&&e[t].file.indexOf(".vtt")!==-1;t++){var r=document.createElement("track");r.src=e[t].file,r.kind=e[t].kind,r.srclang=e[t].language||"",r.label=e[t].label,r.mode="disabled",Qe.appendChild(r)}}}function ee(){for(var e=Qe.seekable?Qe.seekable.length:0,t=1/0;e--;)t=Math.min(t,Qe.seekable.start(e));return t}function te(){for(var e=Qe.seekable?Qe.seekable.length:0,t=0;e--;)t=Math.max(t,Qe.seekable.end(e));return t}function re(){Ie.seeking=!1,Ie.trigger(f.JWPLAYER_MEDIA_SEEKED)}function ie(){Ie.trigger("volume",{volume:Math.round(100*Qe.volume)}),Ie.trigger("mute",{mute:Qe.muted})}function ae(){Qe.currentTime===Le&&G()}function ne(){var e=Qe.buffered,t=Qe.duration;return!e||0===e.length||t<=0||Xe?0:u.between(e.end(e.length-1)/t,0,1)}function oe(){if(Ne&&Ie.state!==c.IDLE&&Ie.state!==c.COMPLETE){if(g(Me),Ue=-1,Be=!0,Ie.trigger(f.JWPLAYER_MEDIA_BEFORECOMPLETE),!Ne)return;se()}}function se(){g(Me),Ie.setState(c.COMPLETE),Be=!1,Ie.trigger(f.JWPLAYER_MEDIA_COMPLETE)}function le(e){je=!0,ge(e),u.isIOS()&&(Qe.controls=!1)}function ue(){var e=null,t=-1,r=0;for(Ye=-1,r;r<Qe.textTracks.length;r++)if("showing"===Qe.textTracks[r].mode){e=Qe.textTracks[r];break}if(e&&He)for(r=0;r<He.length;r++)if(He[r].label===e.label){t=r;break}be(t+1)}function de(){for(var e=-1,t=0;t<Qe.audioTracks.length;t++)if(Qe.audioTracks[t].enabled){e=t;break}pe(e)}function fe(e){ce(e.currentTarget.activeCues)}function ce(e){if(e&&e.length&&Ye!==e[0].startTime){var t={TIT1:"group",TIT2:"title",TT2:"title",WXXX:"url",TPE1:"artist",TP1:"artist",TALB:"album",TAL:"album"},r=l.reduce(e,function(e,r){if(t.hasOwnProperty(r.value.key)&&(e[t[r.value.key]]=r.value.data),e[r.value.info||r.value.key]=r.value.data,r.value.info){var i=e[r.value.key];l.isObject(i)||(i={},e[r.value.key]=i),i[r.value.info]=r.value.data}else e[r.value.key]=r.value.data;return e},{});Ye=e[0].startTime,Ie.trigger("meta",{metadataTime:Ye,metadata:r})}}function he(e){je=!1,ge(e),u.isIOS()&&(Qe.controls=!1)}function ge(e){Ie.trigger("fullscreenchange",{target:e.target,jwstate:je})}function ve(e){if(We=null,e){if(e.length){for(var t=0;t<e.length;t++)if(e[t].enabled){Ve=t;break}Ve===-1&&(Ve=0,e[Ve].enabled=!0),We=l.map(e,function(e){var t={name:e.label||e.language,language:e.language};return t})}e.onchange=de,We&&Ie.trigger("audioTracks",{currentTrack:Ve,tracks:We})}}function pe(e){Qe&&Qe.audioTracks&&We&&e>-1&&e<Qe.audioTracks.length&&e!==Ve&&(Qe.audioTracks[Ve].enabled=!1,Ve=e,Qe.audioTracks[Ve].enabled=!0,Ie.trigger("audioTrackChanged",{currentTrack:Ve,tracks:We}))}function ye(){return We||[]}function me(){return Ve}function Ee(e){if(He=null,e){if(e.length){var t=0,r=e.length;for(t;t<r;t++)"metadata"===e[t].kind?(e[t].oncuechange=fe,e[t].mode="showing"):"subtitles"!==e[t].kind&&"captions"!==e[t].kind||(e[t].mode="disabled",He||(He=[]),He.push(e[t]))}e.onchange=ue,He&&He.length&&Ie.trigger("subtitlesTracks",{tracks:He})}}function be(e){He&&Ke!==e-1&&(Ke>-1&&Ke<He.length?He[Ke].mode="disabled":l.each(He,function(e){e.mode="disabled"}),e>0&&e<=He.length?(Ke=e-1,He[Ke].mode="showing"):Ke=-1,Ie.trigger("subtitlesTrackChanged",{currentTrack:Ke+1,tracks:He}))}function _e(){return Ke}function Te(e){if(e&&"hls"===Oe[0].type){var t=e.length?"video":"audio";Ie.trigger("mediaType",{mediaType:t})}}this.state=c.IDLE,this.seeking=!1;var Re=e(t);l.extend(this,Re.Events);var ke,Ae,Se,we,Le,De,Oe,Ie=this,Ce={click:A,durationchange:S,ended:oe,error:B,loadeddata:k,loadedmetadata:M,canplay:x,playing:N,progress:w,pause:U,seeked:re,timeupdate:L,volumechange:ie,webkitbeginfullscreen:le,webkitendfullscreen:he},Pe=!1,xe=0,Me=-1,Fe=-1,Ne=!0,Ue=-1,Ge=null,Be=!1,je=!1,He=null,We=null,Ke=-1,Ve=-1,Ye=-1,qe=null,Xe=!1,ze=!1,Je=document.getElementById(t),Qe=Je?Je.querySelector("video"):void 0;Qe=Qe||document.createElement("video"),Qe.className="jw-video jw-reset",i(Ce,Qe),T||(Qe.controls=!0,Qe.controls=!1),Qe.setAttribute("x-webkit-airplay","allow"),Qe.setAttribute("webkit-playsinline","");var $e=j(),Ze=j();this.stop=function(){g(Me),Ne&&(Q(),u.isIETrident()&&Qe.pause(),Ue=-1,this.setState(c.IDLE))},this.destroy=function(){a(Ce,Qe),Qe.audioTracks&&(Qe.audioTracks.onchange=null),Qe.textTracks&&(Qe.textTracks.onchange=null),this.remove(),this.off(),qe.destroy()},this.init=function(e){Ne&&(qe&&qe.destroy(),qe=new r(o.hlsjs),qe.attachMedia(Qe),qe.on(r.Events.MANIFEST_PARSED,function(e,t){K(Y(t.levels)),Qe.play()}),qe.on(r.Events.LEVEL_LOADED,function(e,t){Xe=t.details.live}),qe.on(r.Events.ERROR,function(e,t){if(t.fatal)switch(t.type){case r.ErrorTypes.NETWORK_ERROR:qe.startLoad();break;case r.ErrorTypes.MEDIA_ERROR:Ze();break;default:H()}}),Oe=e.sources,Ue=V(e.sources),e.sources.length&&"hls"!==e.sources[0].type&&this.sendMediaType(e.sources),Ae=Oe[Ue],we=Le=e.starttime||0,Se=e.duration||0,z(e),ze=!0)},this.load=function(e){Ne&&(e.sources.length&&"hls"!==e.sources[0].type&&this.sendMediaType(e.sources),m||this.setState(c.LOADING),X(e.starttime||0,e.duration||0))},this.play=function(){return Ie.seeking?(Ie.setState(c.LOADING),void Ie.once(f.JWPLAYER_MEDIA_SEEKED,Ie.play)):void Qe.play()},this.pause=function(){g(Me),Qe.pause(),this.setState(c.PAUSED)},this.seek=function(e){if(Ne)if(e<0&&(e+=ee()+te()),0===xe&&this.trigger(f.JWPLAYER_MEDIA_SEEK,{position:Qe.currentTime,offset:e}),Pe||(Pe=!!te()),Pe){xe=0;try{Ie.seeking=!0,Qe.currentTime=e}catch(t){Ie.seeking=!1,xe=e}}else xe=e,b&&Qe.paused&&Qe.play()},this.volume=function(e){e=u.between(e/100,0,1),Qe.volume=e},this.mute=function(e){Qe.muted=!!e},this.checkComplete=function(){return Be},this.detachMedia=function(){return qe.detachMedia(),g(Me),Ne=!1,Qe},this.attachMedia=function(){Ne=!0,Pe=!1,this.seeking=!1,Qe.loop=!1,Be&&se(),qe.attachMedia(Qe)},this.setContainer=function(e){ke=e,e.appendChild(Qe)},this.getContainer=function(){return ke},this.remove=function(){Q(),g(Me),Ue=-1,ke===Qe.parentNode&&ke.removeChild(Qe)},this.setVisibility=function(e){e=!!e,e||_?d.style(ke,{visibility:"visible",opacity:1}):d.style(ke,{visibility:"",opacity:0})},this.resize=function(e,t,r){if(!(e&&t&&Qe.videoWidth&&Qe.videoHeight))return!1;var i={objectFit:""};if("uniform"===r){var a=e/t,n=Qe.videoWidth/Qe.videoHeight;Math.abs(a-n)<.09&&(i.objectFit="fill",r="exactfit")}var o=p||_||T||R;if(o){var s=-Math.floor(Qe.videoWidth/2+1),l=-Math.floor(Qe.videoHeight/2+1),u=Math.ceil(100*e/Qe.videoWidth)/100,f=Math.ceil(100*t/Qe.videoHeight)/100;"none"===r?u=f=1:"fill"===r?u=f=Math.max(u,f):"uniform"===r&&(u=f=Math.min(u,f)),i.width=Qe.videoWidth,i.height=Qe.videoHeight,i.top=i.left="50%",i.margin=0,d.transform(Qe,"translate("+s+"px, "+l+"px) scale("+u.toFixed(2)+", "+f.toFixed(2)+")")}return d.style(Qe,i),!1},this.setFullscreen=function(e){if(e=!!e){var t=u.tryCatch(function(){var e=Qe.webkitEnterFullscreen||Qe.webkitEnterFullScreen;e&&e.apply(Qe)});return!(t instanceof u.Error)&&this.getFullScreen()}var r=Qe.webkitExitFullscreen||Qe.webkitExitFullScreen;return r&&r.apply(Qe),e},this.getFullScreen=function(){return je||!!Qe.webkitDisplayingFullscreen},this.setCurrentQuality=function(e){Ue!==e&&(e=parseInt(e,10),e>=0&&Oe&&Oe.length>e&&(Ue=e,this.trigger(f.JWPLAYER_MEDIA_LEVEL_CHANGED,{currentQuality:e,levels:W(Oe)}),o.qualityLabel=Oe[e].label),qe.nextLevel=e-1)},this.getCurrentQuality=function(){return Ue},this.getQualityLevels=function(){return W(Oe)},this.getName=function(){return{name:h}},this.setCurrentAudioTrack=pe,this.getAudioTracks=ye,this.getCurrentAudioTrack=me,this.setSubtitlesTrack=be,this.getSubtitlesTrack=_e}if(t&&t.getConfig&&t.getConfig("MEDIA_HLSJS_ENABLE")!==!1){var s=t.getConfig("DISABLE_DVR"),l=e._,u=e.utils,d=u.css,f=e.events,c=f.state,h="hlsjs",g=window.clearTimeout,v=256,p=u.isIE(),y=u.isMSIE(),m=u.isMobile(),E=u.isSafari(),b=u.isFF(),_=u.isAndroidNative(),T=u.isIOS(7),R=u.isIOS(8);o.getName=function(){return{name:h}},o.supports=function(t){var i=e(),a=i.getConfig(),n=a.primary;return"flash"!==n&&r.isSupported()&&"hls"===t.type},e.api.registerProvider(o)}}e.exports=r}])});
	